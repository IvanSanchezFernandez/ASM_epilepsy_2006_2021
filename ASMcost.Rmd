
# Cost of antiseizure medications 2006-2021








## 1. Preparation of software for analysis




Install needed packages
```{r}
# install.packages("dplyr")
library(dplyr)

# install.packages("dbplyr")
library(dbplyr)

# install.packages("tidyr")
library(tidyr)

# install.packages("RSQLite")
library(RSQLite)

# install.packages("tibble")
library(tibble)

# install.packages("haven")
library(haven)

# install.packages("lubridate")
library(lubridate)

# install.packages("gmodels")
library(gmodels)

# install.packages("bazar")
library(bazar)

# install.packages("ggplot2")
library(ggplot2)

# install.packages("plotly")
library(plotly)
```








## 2. Data ingestion




Create the connection to the database
```{r}
# Create the connection to the MarketScan database
MarketScan <- DBI::dbConnect(RSQLite::SQLite(), "E:\\MarketScan\\MarketScan.db")
src_dbi(MarketScan)
```




Create the link to the relevant tables
```{r}
# Year 2006
ms_i_2006 <- tbl(MarketScan, "ms_i_2006")
ms_s_2006 <- tbl(MarketScan, "ms_s_2006")
ms_d_2006 <- tbl(MarketScan, "ms_d_2006")
ms_o_2006 <- tbl(MarketScan, "ms_o_2006")
ms_a_2006 <- tbl(MarketScan, "ms_a_2006")
ms_t_2006 <- tbl(MarketScan, "ms_t_2006")
redbook_2006 <- tbl(MarketScan, "redbook_2006")

# Year 2007
ms_i_2007 <- tbl(MarketScan, "ms_i_2007")
ms_s_2007 <- tbl(MarketScan, "ms_s_2007")
ms_d_2007 <- tbl(MarketScan, "ms_d_2007")
ms_o_2007 <- tbl(MarketScan, "ms_o_2007")
ms_a_2007 <- tbl(MarketScan, "ms_a_2007")
ms_t_2007 <- tbl(MarketScan, "ms_t_2007")
redbook_2007 <- tbl(MarketScan, "redbook_2007")

# Year 2008
ms_i_2008 <- tbl(MarketScan, "ms_i_2008")
ms_s_2008 <- tbl(MarketScan, "ms_s_2008")
ms_d_2008 <- tbl(MarketScan, "ms_d_2008")
ms_o_2008 <- tbl(MarketScan, "ms_o_2008")
ms_a_2008 <- tbl(MarketScan, "ms_a_2008")
ms_t_2008 <- tbl(MarketScan, "ms_t_2008")
redbook_2008 <- tbl(MarketScan, "redbook_2008")

# Year 2009
ms_i_2009 <- tbl(MarketScan, "ms_i_2009")
ms_s_2009 <- tbl(MarketScan, "ms_s_2009")
ms_d_2009 <- tbl(MarketScan, "ms_d_2009")
ms_o_2009 <- tbl(MarketScan, "ms_o_2009")
ms_a_2009 <- tbl(MarketScan, "ms_a_2009")
ms_t_2009 <- tbl(MarketScan, "ms_t_2009")
redbook_2009 <- tbl(MarketScan, "redbook_2009")

# Year 2010
ms_i_2010 <- tbl(MarketScan, "ms_i_2010")
ms_s_2010 <- tbl(MarketScan, "ms_s_2010")
ms_d_2010 <- tbl(MarketScan, "ms_d_2010")
ms_o_2010 <- tbl(MarketScan, "ms_o_2010")
ms_a_2010 <- tbl(MarketScan, "ms_a_2010")
ms_t_2010 <- tbl(MarketScan, "ms_t_2010")
redbook_2010 <- tbl(MarketScan, "redbook_2010")

# Year 2011
ms_i_2011 <- tbl(MarketScan, "ms_i_2011")
ms_s_2011 <- tbl(MarketScan, "ms_s_2011")
ms_d_2011 <- tbl(MarketScan, "ms_d_2011")
ms_o_2011 <- tbl(MarketScan, "ms_o_2011")
ms_a_2011 <- tbl(MarketScan, "ms_a_2011")
ms_t_2011 <- tbl(MarketScan, "ms_t_2011")
redbook_2011 <- tbl(MarketScan, "redbook_2011")

# Year 2012
ms_i_2012 <- tbl(MarketScan, "ms_i_2012")
ms_s_2012 <- tbl(MarketScan, "ms_s_2012")
ms_d_2012 <- tbl(MarketScan, "ms_d_2012")
ms_o_2012 <- tbl(MarketScan, "ms_o_2012")
ms_a_2012 <- tbl(MarketScan, "ms_a_2012")
ms_t_2012 <- tbl(MarketScan, "ms_t_2012")
redbook_2012 <- tbl(MarketScan, "redbook_2012")

# Year 2013
ms_i_2013 <- tbl(MarketScan, "ms_i_2013")
ms_s_2013 <- tbl(MarketScan, "ms_s_2013")
ms_d_2013 <- tbl(MarketScan, "ms_d_2013")
ms_o_2013 <- tbl(MarketScan, "ms_o_2013")
ms_a_2013 <- tbl(MarketScan, "ms_a_2013")
ms_t_2013 <- tbl(MarketScan, "ms_t_2013")
redbook_2013 <- tbl(MarketScan, "redbook_2013")

# Year 2014
ms_i_2014 <- tbl(MarketScan, "ms_i_2014")
ms_s_2014 <- tbl(MarketScan, "ms_s_2014")
ms_d_2014 <- tbl(MarketScan, "ms_d_2014")
ms_o_2014 <- tbl(MarketScan, "ms_o_2014")
ms_a_2014 <- tbl(MarketScan, "ms_a_2014")
ms_t_2014 <- tbl(MarketScan, "ms_t_2014")
redbook_2014 <- tbl(MarketScan, "redbook_2014")

# Year 2015
ms_i_2015 <- tbl(MarketScan, "ms_i_2015")
ms_s_2015 <- tbl(MarketScan, "ms_s_2015")
ms_d_2015 <- tbl(MarketScan, "ms_d_2015")
ms_o_2015 <- tbl(MarketScan, "ms_o_2015")
ms_a_2015 <- tbl(MarketScan, "ms_a_2015")
ms_t_2015 <- tbl(MarketScan, "ms_t_2015")
redbook_2015 <- tbl(MarketScan, "redbook_2015")

# Year 2016
ms_i_2016 <- tbl(MarketScan, "ms_i_2016")
ms_s_2016 <- tbl(MarketScan, "ms_s_2016")
ms_d_2016 <- tbl(MarketScan, "ms_d_2016")
ms_o_2016 <- tbl(MarketScan, "ms_o_2016")
ms_a_2016 <- tbl(MarketScan, "ms_a_2016")
ms_t_2016 <- tbl(MarketScan, "ms_t_2016")
redbook_2016 <- tbl(MarketScan, "redbook_2016")

# Year 2017
ms_i_2017 <- tbl(MarketScan, "ms_i_2017")
ms_s_2017 <- tbl(MarketScan, "ms_s_2017")
ms_d_2017 <- tbl(MarketScan, "ms_d_2017")
ms_o_2017 <- tbl(MarketScan, "ms_o_2017")
ms_a_2017 <- tbl(MarketScan, "ms_a_2017")
ms_t_2017 <- tbl(MarketScan, "ms_t_2017")
redbook_2017 <- tbl(MarketScan, "redbook_2017")

# Year 2018
ms_i_2018 <- tbl(MarketScan, "ms_i_2018")
ms_s_2018 <- tbl(MarketScan, "ms_s_2018")
ms_d_2018 <- tbl(MarketScan, "ms_d_2018")
ms_o_2018 <- tbl(MarketScan, "ms_o_2018")
ms_a_2018 <- tbl(MarketScan, "ms_a_2018")
ms_t_2018 <- tbl(MarketScan, "ms_t_2018")
redbook_2018 <- tbl(MarketScan, "redbook_2018")

# Year 2019
ms_i_2019 <- tbl(MarketScan, "ms_i_2019")
ms_s_2019 <- tbl(MarketScan, "ms_s_2019")
ms_d_2019 <- tbl(MarketScan, "ms_d_2019")
ms_o_2019 <- tbl(MarketScan, "ms_o_2019")
ms_a_2019 <- tbl(MarketScan, "ms_a_2019")
ms_t_2019 <- tbl(MarketScan, "ms_t_2019")
redbook_2019 <- tbl(MarketScan, "redbook_2019")

# Year 2020
ms_i_2020 <- tbl(MarketScan, "ms_i_2020")
ms_s_2020 <- tbl(MarketScan, "ms_s_2020")
ms_d_2020 <- tbl(MarketScan, "ms_d_2020")
ms_o_2020 <- tbl(MarketScan, "ms_o_2020")
ms_a_2020 <- tbl(MarketScan, "ms_a_2020")
ms_t_2020 <- tbl(MarketScan, "ms_t_2020")
redbook_2020 <- tbl(MarketScan, "redbook_2020")

# Year 2021
ms_i_2021 <- tbl(MarketScan, "ms_i_2021")
ms_s_2021 <- tbl(MarketScan, "ms_s_2021")
ms_d_2021 <- tbl(MarketScan, "ms_d_2021")
ms_o_2021 <- tbl(MarketScan, "ms_o_2021")
ms_a_2021 <- tbl(MarketScan, "ms_a_2021")
ms_t_2021 <- tbl(MarketScan, "ms_t_2021")
redbook_2021 <- tbl(MarketScan, "redbook_2021")
```




Identify patients with epilepsy
```{r}
# Codes for patients with epilepsy
codes_epilepsy_ICD9 <- c("345", "3450", "34500", "34501", "3451", "34510", "34511", "3454", "34540", "34541", "3455", "34550", "34551", "3456", "34560", "34561", "3457", "34570", "34571", "3458", "34580", "34581", "3459", "34590", "34591")

codes_epilepsy_ICD10 <- c("G40", "G400", "G4000", "G40001", "G40009", "G4001", "G40011", "G40019", "G401", "G4010", "G40101", "G40109", "G4011", "G40111", "G40119", "G402", "G4020", "G40201", "G40209", "G4021", "G40211", "G40219", "G403", "G4030", "G40301", "G40309", "G4031", "G40311", "G40319", "G40A", "G40A0", "G40A01", "G40A09", "G40A1", "G40A11", "G40A19", "G40B", "G40B0", "G40B01", "G40B09", "G40B1", "G40B11", "G40B19", "G404", "G4040", "G40401", "G40409", "G4041", "G40411", "G40419", "G408", "G4080", "G40801", "G40802", "G40803", "G40804", "G4081", "G40811", "G40812", "G40813", "G40814", "G4082", "G40821", "G40822", "G40823", "G40824", "G4083", "G40833", "G40834", "G409", "G4090", "G40901", "G40909", "G4091", "G40911", "G40919")


# Patients with epilepsy

#################################2006#################################
epilepsy_2006_i <- ms_i_2006 %>% select(ENROLID, AGE, SEX, DX1, DX2, DX3, DX4, DX5, DX6, DX7, DX8, DX9,
                                      DX10, DX11, DX12, DX13, DX14, DX15, ADMDATE) %>% filter(
                                      DX1 %in% codes_epilepsy_ICD9 | DX2 %in% codes_epilepsy_ICD9 |
                                      DX3 %in% codes_epilepsy_ICD9 | DX4 %in% codes_epilepsy_ICD9 |
                                      DX5 %in% codes_epilepsy_ICD9 | DX6 %in% codes_epilepsy_ICD9 |
                                      DX7 %in% codes_epilepsy_ICD9 | DX8 %in% codes_epilepsy_ICD9 |
                                      DX9 %in% codes_epilepsy_ICD9 | DX10 %in% codes_epilepsy_ICD9 |
                                      DX11%in% codes_epilepsy_ICD9 | DX12 %in% codes_epilepsy_ICD9 |
                                      DX13 %in% codes_epilepsy_ICD9 | DX14 %in% codes_epilepsy_ICD9 |
                                      DX15 %in% codes_epilepsy_ICD9
                                      ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                      filter(ENROLID>0) %>%    
                                      mutate(SVCDATE=ADMDATE) %>%
                                      distinct(ENROLID, SVCDATE) %>% 
                                      collect() %>% 
                                      mutate(across(SVCDATE, mdy))

epilepsy_2006_o <- ms_o_2006 %>% select(ENROLID, AGE, SEX, DX1, DX2, SVCDATE) %>% filter(
                                     DX1 %in% codes_epilepsy_ICD9 | DX2 %in% codes_epilepsy_ICD9
                                     ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                     filter(ENROLID>0) %>% 
                                     distinct(ENROLID, SVCDATE) %>% 
                                     collect() %>% 
                                     mutate(across(SVCDATE, mdy))

epilepsy_2006_s <- ms_s_2006 %>% select(ENROLID, AGE, SEX, DX1, DX2, SVCDATE) %>% filter(
                                     DX1 %in% codes_epilepsy_ICD9 | DX2 %in% codes_epilepsy_ICD9
                                     ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                     filter(ENROLID>0) %>% 
                                     distinct(ENROLID, SVCDATE) %>% 
                                     collect() %>% 
                                     mutate(across(SVCDATE, mdy))


#################################2007#################################
epilepsy_2007_i <- ms_i_2007 %>% select(ENROLID, AGE, SEX, DX1, DX2, DX3, DX4, DX5, DX6, DX7, DX8, DX9,
                                      DX10, DX11, DX12, DX13, DX14, DX15, ADMDATE) %>% filter(
                                      DX1 %in% codes_epilepsy_ICD9 | DX2 %in% codes_epilepsy_ICD9 |
                                      DX3 %in% codes_epilepsy_ICD9 | DX4 %in% codes_epilepsy_ICD9 |
                                      DX5 %in% codes_epilepsy_ICD9 | DX6 %in% codes_epilepsy_ICD9 |
                                      DX7 %in% codes_epilepsy_ICD9 | DX8 %in% codes_epilepsy_ICD9 |
                                      DX9 %in% codes_epilepsy_ICD9 | DX10 %in% codes_epilepsy_ICD9 |
                                      DX11%in% codes_epilepsy_ICD9 | DX12 %in% codes_epilepsy_ICD9 |
                                      DX13 %in% codes_epilepsy_ICD9 | DX14 %in% codes_epilepsy_ICD9 |
                                      DX15 %in% codes_epilepsy_ICD9
                                      ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                      filter(ENROLID>0) %>%    
                                      mutate(SVCDATE=ADMDATE) %>%
                                      distinct(ENROLID, SVCDATE) %>% 
                                      collect() %>% 
                                      mutate(across(SVCDATE, mdy))

epilepsy_2007_o <- ms_o_2007 %>% select(ENROLID, AGE, SEX, DX1, DX2, SVCDATE) %>% filter(
                                     DX1 %in% codes_epilepsy_ICD9 | DX2 %in% codes_epilepsy_ICD9
                                     ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                     filter(ENROLID>0) %>% 
                                     distinct(ENROLID, SVCDATE) %>% 
                                     collect() %>% 
                                     mutate(across(SVCDATE, mdy))

epilepsy_2007_s <- ms_s_2007 %>% select(ENROLID, AGE, SEX, DX1, DX2, SVCDATE) %>% filter(
                                     DX1 %in% codes_epilepsy_ICD9 | DX2 %in% codes_epilepsy_ICD9
                                     ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                     filter(ENROLID>0) %>% 
                                     distinct(ENROLID, SVCDATE) %>% 
                                     collect() %>% 
                                     mutate(across(SVCDATE, mdy))


#################################2008#################################
epilepsy_2008_i <- ms_i_2008 %>% select(ENROLID, AGE, SEX, DX1, DX2, DX3, DX4, DX5, DX6, DX7, DX8, DX9,
                                      DX10, DX11, DX12, DX13, DX14, DX15, ADMDATE) %>% filter(
                                      DX1 %in% codes_epilepsy_ICD9 | DX2 %in% codes_epilepsy_ICD9 |
                                      DX3 %in% codes_epilepsy_ICD9 | DX4 %in% codes_epilepsy_ICD9 |
                                      DX5 %in% codes_epilepsy_ICD9 | DX6 %in% codes_epilepsy_ICD9 |
                                      DX7 %in% codes_epilepsy_ICD9 | DX8 %in% codes_epilepsy_ICD9 |
                                      DX9 %in% codes_epilepsy_ICD9 | DX10 %in% codes_epilepsy_ICD9 |
                                      DX11%in% codes_epilepsy_ICD9 | DX12 %in% codes_epilepsy_ICD9 |
                                      DX13 %in% codes_epilepsy_ICD9 | DX14 %in% codes_epilepsy_ICD9 |
                                      DX15 %in% codes_epilepsy_ICD9
                                      ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                      filter(ENROLID>0) %>%    
                                      mutate(SVCDATE=ADMDATE) %>%
                                      distinct(ENROLID, SVCDATE) %>% 
                                      collect() %>% 
                                      mutate(across(SVCDATE, mdy))

epilepsy_2008_o <- ms_o_2008 %>% select(ENROLID, AGE, SEX, DX1, DX2, SVCDATE) %>% filter(
                                     DX1 %in% codes_epilepsy_ICD9 | DX2 %in% codes_epilepsy_ICD9
                                     ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                     filter(ENROLID>0) %>% 
                                     distinct(ENROLID, SVCDATE) %>% 
                                     collect() %>% 
                                     mutate(across(SVCDATE, mdy))

epilepsy_2008_s <- ms_s_2008 %>% select(ENROLID, AGE, SEX, DX1, DX2, SVCDATE) %>% filter(
                                     DX1 %in% codes_epilepsy_ICD9 | DX2 %in% codes_epilepsy_ICD9
                                     ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                     filter(ENROLID>0) %>% 
                                     distinct(ENROLID, SVCDATE) %>% 
                                     collect() %>% 
                                     mutate(across(SVCDATE, mdy))


#################################2009#################################
epilepsy_2009_i <- ms_i_2009 %>% select(ENROLID, AGE, SEX, DX1, DX2, DX3, DX4, DX5, DX6, DX7, DX8, DX9,
                                      DX10, DX11, DX12, DX13, DX14, DX15, ADMDATE) %>% filter(
                                      DX1 %in% codes_epilepsy_ICD9 | DX2 %in% codes_epilepsy_ICD9 |
                                      DX3 %in% codes_epilepsy_ICD9 | DX4 %in% codes_epilepsy_ICD9 |
                                      DX5 %in% codes_epilepsy_ICD9 | DX6 %in% codes_epilepsy_ICD9 |
                                      DX7 %in% codes_epilepsy_ICD9 | DX8 %in% codes_epilepsy_ICD9 |
                                      DX9 %in% codes_epilepsy_ICD9 | DX10 %in% codes_epilepsy_ICD9 |
                                      DX11%in% codes_epilepsy_ICD9 | DX12 %in% codes_epilepsy_ICD9 |
                                      DX13 %in% codes_epilepsy_ICD9 | DX14 %in% codes_epilepsy_ICD9 |
                                      DX15 %in% codes_epilepsy_ICD9
                                      ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                      filter(ENROLID>0) %>%    
                                      mutate(SVCDATE=ADMDATE) %>%
                                      distinct(ENROLID, SVCDATE) %>% 
                                      collect() %>% 
                                      mutate(across(SVCDATE, mdy))

epilepsy_2009_o <- ms_o_2009 %>% select(ENROLID, AGE, SEX, DX1, DX2, SVCDATE) %>% filter(
                                     DX1 %in% codes_epilepsy_ICD9 | DX2 %in% codes_epilepsy_ICD9
                                     ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                     filter(ENROLID>0) %>% 
                                     distinct(ENROLID, SVCDATE) %>% 
                                     collect() %>% 
                                     mutate(across(SVCDATE, mdy))

epilepsy_2009_s <- ms_s_2009 %>% select(ENROLID, AGE, SEX, DX1, DX2, SVCDATE) %>% filter(
                                     DX1 %in% codes_epilepsy_ICD9 | DX2 %in% codes_epilepsy_ICD9
                                     ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                     filter(ENROLID>0) %>% 
                                     distinct(ENROLID, SVCDATE) %>% 
                                     collect() %>% 
                                     mutate(across(SVCDATE, mdy))


#################################2010#################################
epilepsy_2010_i <- ms_i_2010 %>% select(ENROLID, AGE, SEX, DX1, DX2, DX3, DX4, DX5, DX6, DX7, DX8, DX9,
                                      DX10, DX11, DX12, DX13, DX14, DX15, ADMDATE) %>% filter(
                                      DX1 %in% codes_epilepsy_ICD9 | DX2 %in% codes_epilepsy_ICD9 |
                                      DX3 %in% codes_epilepsy_ICD9 | DX4 %in% codes_epilepsy_ICD9 |
                                      DX5 %in% codes_epilepsy_ICD9 | DX6 %in% codes_epilepsy_ICD9 |
                                      DX7 %in% codes_epilepsy_ICD9 | DX8 %in% codes_epilepsy_ICD9 |
                                      DX9 %in% codes_epilepsy_ICD9 | DX10 %in% codes_epilepsy_ICD9 |
                                      DX11%in% codes_epilepsy_ICD9 | DX12 %in% codes_epilepsy_ICD9 |
                                      DX13 %in% codes_epilepsy_ICD9 | DX14 %in% codes_epilepsy_ICD9 |
                                      DX15 %in% codes_epilepsy_ICD9
                                      ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                      filter(ENROLID>0) %>%    
                                      mutate(SVCDATE=ADMDATE) %>%
                                      distinct(ENROLID, SVCDATE) %>% 
                                      collect() %>% 
                                      mutate(across(SVCDATE, mdy))

epilepsy_2010_o <- ms_o_2010 %>% select(ENROLID, AGE, SEX, DX1, DX2, SVCDATE) %>% filter(
                                     DX1 %in% codes_epilepsy_ICD9 | DX2 %in% codes_epilepsy_ICD9
                                     ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                     filter(ENROLID>0) %>% 
                                     distinct(ENROLID, SVCDATE) %>% 
                                     collect() %>% 
                                     mutate(across(SVCDATE, mdy))

epilepsy_2010_s <- ms_s_2010 %>% select(ENROLID, AGE, SEX, DX1, DX2, SVCDATE) %>% filter(
                                     DX1 %in% codes_epilepsy_ICD9 | DX2 %in% codes_epilepsy_ICD9
                                     ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                     filter(ENROLID>0) %>% 
                                     distinct(ENROLID, SVCDATE) %>% 
                                     collect() %>% 
                                     mutate(across(SVCDATE, mdy))


#################################2011#################################
epilepsy_2011_i <- ms_i_2011 %>% select(ENROLID, AGE, SEX, DX1, DX2, DX3, DX4, DX5, DX6, DX7, DX8, DX9,
                                      DX10, DX11, DX12, DX13, DX14, DX15, ADMDATE) %>% filter(
                                      DX1 %in% codes_epilepsy_ICD9 | DX2 %in% codes_epilepsy_ICD9 |
                                      DX3 %in% codes_epilepsy_ICD9 | DX4 %in% codes_epilepsy_ICD9 |
                                      DX5 %in% codes_epilepsy_ICD9 | DX6 %in% codes_epilepsy_ICD9 |
                                      DX7 %in% codes_epilepsy_ICD9 | DX8 %in% codes_epilepsy_ICD9 |
                                      DX9 %in% codes_epilepsy_ICD9 | DX10 %in% codes_epilepsy_ICD9 |
                                      DX11%in% codes_epilepsy_ICD9 | DX12 %in% codes_epilepsy_ICD9 |
                                      DX13 %in% codes_epilepsy_ICD9 | DX14 %in% codes_epilepsy_ICD9 |
                                      DX15 %in% codes_epilepsy_ICD9
                                      ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                      filter(ENROLID>0) %>%    
                                      mutate(SVCDATE=ADMDATE) %>%
                                      distinct(ENROLID, SVCDATE) %>% 
                                      collect() %>% 
                                      mutate(across(SVCDATE, mdy))

epilepsy_2011_o <- ms_o_2011 %>% select(ENROLID, AGE, SEX, DX1, DX2, SVCDATE) %>% filter(
                                     DX1 %in% codes_epilepsy_ICD9 | DX2 %in% codes_epilepsy_ICD9
                                     ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                     filter(ENROLID>0) %>% 
                                     distinct(ENROLID, SVCDATE) %>% 
                                     collect() %>% 
                                     mutate(across(SVCDATE, mdy))

epilepsy_2011_s <- ms_s_2011 %>% select(ENROLID, AGE, SEX, DX1, DX2, SVCDATE) %>% filter(
                                     DX1 %in% codes_epilepsy_ICD9 | DX2 %in% codes_epilepsy_ICD9
                                     ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                     filter(ENROLID>0) %>% 
                                     distinct(ENROLID, SVCDATE) %>% 
                                     collect() %>% 
                                     mutate(across(SVCDATE, mdy))


#################################2012#################################
epilepsy_2012_i <- ms_i_2012 %>% select(ENROLID, AGE, SEX, DX1, DX2, DX3, DX4, DX5, DX6, DX7, DX8, DX9,
                                      DX10, DX11, DX12, DX13, DX14, DX15, ADMDATE) %>% filter(
                                      DX1 %in% codes_epilepsy_ICD9 | DX2 %in% codes_epilepsy_ICD9 |
                                      DX3 %in% codes_epilepsy_ICD9 | DX4 %in% codes_epilepsy_ICD9 |
                                      DX5 %in% codes_epilepsy_ICD9 | DX6 %in% codes_epilepsy_ICD9 |
                                      DX7 %in% codes_epilepsy_ICD9 | DX8 %in% codes_epilepsy_ICD9 |
                                      DX9 %in% codes_epilepsy_ICD9 | DX10 %in% codes_epilepsy_ICD9 |
                                      DX11%in% codes_epilepsy_ICD9 | DX12 %in% codes_epilepsy_ICD9 |
                                      DX13 %in% codes_epilepsy_ICD9 | DX14 %in% codes_epilepsy_ICD9 |
                                      DX15 %in% codes_epilepsy_ICD9
                                      ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                      filter(ENROLID>0) %>%    
                                      mutate(SVCDATE=ADMDATE) %>%
                                      distinct(ENROLID, SVCDATE) %>% 
                                      collect() %>% 
                                      mutate(across(SVCDATE, mdy))

epilepsy_2012_o <- ms_o_2012 %>% select(ENROLID, AGE, SEX, DX1, DX2, SVCDATE) %>% filter(
                                     DX1 %in% codes_epilepsy_ICD9 | DX2 %in% codes_epilepsy_ICD9
                                     ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                     filter(ENROLID>0) %>% 
                                     distinct(ENROLID, SVCDATE) %>% 
                                     collect() %>% 
                                     mutate(across(SVCDATE, mdy))

epilepsy_2012_s <- ms_s_2012 %>% select(ENROLID, AGE, SEX, DX1, DX2, SVCDATE) %>% filter(
                                     DX1 %in% codes_epilepsy_ICD9 | DX2 %in% codes_epilepsy_ICD9
                                     ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                     filter(ENROLID>0) %>% 
                                     distinct(ENROLID, SVCDATE) %>% 
                                     collect() %>% 
                                     mutate(across(SVCDATE, mdy))


#################################2013#################################
epilepsy_2013_i <- ms_i_2013 %>% select(ENROLID, AGE, SEX, DX1, DX2, DX3, DX4, DX5, DX6, DX7, DX8, DX9,
                                      DX10, DX11, DX12, DX13, DX14, DX15, ADMDATE) %>% filter(
                                      DX1 %in% codes_epilepsy_ICD9 | DX2 %in% codes_epilepsy_ICD9 |
                                      DX3 %in% codes_epilepsy_ICD9 | DX4 %in% codes_epilepsy_ICD9 |
                                      DX5 %in% codes_epilepsy_ICD9 | DX6 %in% codes_epilepsy_ICD9 |
                                      DX7 %in% codes_epilepsy_ICD9 | DX8 %in% codes_epilepsy_ICD9 |
                                      DX9 %in% codes_epilepsy_ICD9 | DX10 %in% codes_epilepsy_ICD9 |
                                      DX11%in% codes_epilepsy_ICD9 | DX12 %in% codes_epilepsy_ICD9 |
                                      DX13 %in% codes_epilepsy_ICD9 | DX14 %in% codes_epilepsy_ICD9 |
                                      DX15 %in% codes_epilepsy_ICD9
                                      ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                      filter(ENROLID>0) %>%    
                                      mutate(SVCDATE=ADMDATE) %>%
                                      distinct(ENROLID, SVCDATE) %>% 
                                      collect() %>% 
                                      mutate(across(SVCDATE, mdy))

epilepsy_2013_o <- ms_o_2013 %>% select(ENROLID, AGE, SEX, DX1, DX2, SVCDATE) %>% filter(
                                     DX1 %in% codes_epilepsy_ICD9 | DX2 %in% codes_epilepsy_ICD9
                                     ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                     filter(ENROLID>0) %>% 
                                     distinct(ENROLID, SVCDATE) %>% 
                                     collect() %>% 
                                     mutate(across(SVCDATE, mdy))

epilepsy_2013_s <- ms_s_2013 %>% select(ENROLID, AGE, SEX, DX1, DX2, SVCDATE) %>% filter(
                                     DX1 %in% codes_epilepsy_ICD9 | DX2 %in% codes_epilepsy_ICD9
                                     ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                     filter(ENROLID>0) %>% 
                                     distinct(ENROLID, SVCDATE) %>% 
                                     collect() %>% 
                                     mutate(across(SVCDATE, mdy))


#################################2014#################################
epilepsy_2014_i <- ms_i_2014 %>% select(ENROLID, AGE, SEX, DX1, DX2, DX3, DX4, DX5, DX6, DX7, DX8, DX9,
                                      DX10, DX11, DX12, DX13, DX14, DX15, ADMDATE) %>% filter(
                                      DX1 %in% codes_epilepsy_ICD9 | DX2 %in% codes_epilepsy_ICD9 |
                                      DX3 %in% codes_epilepsy_ICD9 | DX4 %in% codes_epilepsy_ICD9 |
                                      DX5 %in% codes_epilepsy_ICD9 | DX6 %in% codes_epilepsy_ICD9 |
                                      DX7 %in% codes_epilepsy_ICD9 | DX8 %in% codes_epilepsy_ICD9 |
                                      DX9 %in% codes_epilepsy_ICD9 | DX10 %in% codes_epilepsy_ICD9 |
                                      DX11%in% codes_epilepsy_ICD9 | DX12 %in% codes_epilepsy_ICD9 |
                                      DX13 %in% codes_epilepsy_ICD9 | DX14 %in% codes_epilepsy_ICD9 |
                                      DX15 %in% codes_epilepsy_ICD9
                                      ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                      filter(ENROLID>0) %>%    
                                      mutate(SVCDATE=ADMDATE) %>%
                                      distinct(ENROLID, SVCDATE) %>% 
                                      collect() %>% 
                                      mutate(across(SVCDATE, mdy))

epilepsy_2014_o <- ms_o_2014 %>% select(ENROLID, AGE, SEX, DX1, DX2, SVCDATE) %>% filter(
                                     DX1 %in% codes_epilepsy_ICD9 | DX2 %in% codes_epilepsy_ICD9
                                     ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                     filter(ENROLID>0) %>% 
                                     distinct(ENROLID, SVCDATE) %>% 
                                     collect() %>% 
                                     mutate(across(SVCDATE, mdy))

epilepsy_2014_s <- ms_s_2014 %>% select(ENROLID, AGE, SEX, DX1, DX2, SVCDATE) %>% filter(
                                     DX1 %in% codes_epilepsy_ICD9 | DX2 %in% codes_epilepsy_ICD9
                                     ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                     filter(ENROLID>0) %>% 
                                     distinct(ENROLID, SVCDATE) %>% 
                                     collect() %>% 
                                     mutate(across(SVCDATE, mdy))


#################################2015#################################
epilepsy_2015_i <- ms_i_2015 %>% select(ENROLID, AGE, SEX, DX1, DX2, DX3, DX4, DX5, DX6, DX7, DX8, DX9,
                                      DX10, DX11, DX12, DX13, DX14, DX15, ADMDATE) %>% filter(
                                      DX1 %in% codes_epilepsy_ICD9 | DX2 %in% codes_epilepsy_ICD9 |
                                      DX3 %in% codes_epilepsy_ICD9 | DX4 %in% codes_epilepsy_ICD9 |
                                      DX5 %in% codes_epilepsy_ICD9 | DX6 %in% codes_epilepsy_ICD9 |
                                      DX7 %in% codes_epilepsy_ICD9 | DX8 %in% codes_epilepsy_ICD9 |
                                      DX9 %in% codes_epilepsy_ICD9 | DX10 %in% codes_epilepsy_ICD9 |
                                      DX11%in% codes_epilepsy_ICD9 | DX12 %in% codes_epilepsy_ICD9 |
                                      DX13 %in% codes_epilepsy_ICD9 | DX14 %in% codes_epilepsy_ICD9 |
                                      DX15 %in% codes_epilepsy_ICD9 |
                                      DX1 %in% codes_epilepsy_ICD10 | DX2 %in% codes_epilepsy_ICD10 |
                                      DX3 %in% codes_epilepsy_ICD10 | DX4 %in% codes_epilepsy_ICD10 |
                                      DX5 %in% codes_epilepsy_ICD10 | DX6 %in% codes_epilepsy_ICD10 |
                                      DX7 %in% codes_epilepsy_ICD10 | DX8 %in% codes_epilepsy_ICD10 |
                                      DX9 %in% codes_epilepsy_ICD10 | DX10 %in% codes_epilepsy_ICD10 |
                                      DX11%in% codes_epilepsy_ICD10 | DX12 %in% codes_epilepsy_ICD10 |
                                      DX13 %in% codes_epilepsy_ICD10 | DX14 %in% codes_epilepsy_ICD10 |
                                      DX15 %in% codes_epilepsy_ICD10
                                      ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                      filter(ENROLID>0) %>%    
                                      mutate(SVCDATE=ADMDATE) %>%
                                      distinct(ENROLID, SVCDATE) %>% 
                                      collect() %>% 
                                      mutate(across(SVCDATE, mdy))

epilepsy_2015_o <- ms_o_2015 %>% select(ENROLID, AGE, SEX, DX1, DX2, SVCDATE) %>% filter(
                                     DX1 %in% codes_epilepsy_ICD9 | DX2 %in% codes_epilepsy_ICD9 |
                                     DX1 %in% codes_epilepsy_ICD10 | DX2 %in% codes_epilepsy_ICD10
                                     ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                     filter(ENROLID>0) %>% 
                                     distinct(ENROLID, SVCDATE) %>% 
                                     collect() %>% 
                                     mutate(across(SVCDATE, mdy))

epilepsy_2015_s <- ms_s_2015 %>% select(ENROLID, AGE, SEX, DX1, DX2, SVCDATE) %>% filter(
                                     DX1 %in% codes_epilepsy_ICD9 | DX2 %in% codes_epilepsy_ICD9 |
                                     DX1 %in% codes_epilepsy_ICD10 | DX2 %in% codes_epilepsy_ICD10
                                     ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                     filter(ENROLID>0) %>% 
                                     distinct(ENROLID, SVCDATE) %>% 
                                     collect() %>% 
                                     mutate(across(SVCDATE, mdy))


#################################2016#################################
epilepsy_2016_i <- ms_i_2016 %>% select(ENROLID, AGE, SEX, DX1, DX2, DX3, DX4, DX5, DX6, DX7, DX8, DX9,
                                      DX10, DX11, DX12, DX13, DX14, DX15, ADMDATE) %>% filter(
                                      DX1 %in% codes_epilepsy_ICD10 | DX2 %in% codes_epilepsy_ICD10 |
                                      DX3 %in% codes_epilepsy_ICD10 | DX4 %in% codes_epilepsy_ICD10 |
                                      DX5 %in% codes_epilepsy_ICD10 | DX6 %in% codes_epilepsy_ICD10 |
                                      DX7 %in% codes_epilepsy_ICD10 | DX8 %in% codes_epilepsy_ICD10 |
                                      DX9 %in% codes_epilepsy_ICD10 | DX10 %in% codes_epilepsy_ICD10 |
                                      DX11%in% codes_epilepsy_ICD10 | DX12 %in% codes_epilepsy_ICD10 |
                                      DX13 %in% codes_epilepsy_ICD10 | DX14 %in% codes_epilepsy_ICD10 |
                                      DX15 %in% codes_epilepsy_ICD10
                                      ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                      filter(ENROLID>0) %>%    
                                      mutate(SVCDATE=ADMDATE) %>%
                                      distinct(ENROLID, SVCDATE) %>% 
                                      collect() %>% 
                                      mutate(across(SVCDATE, mdy))

epilepsy_2016_o <- ms_o_2016 %>% select(ENROLID, AGE, SEX, DX1, DX2, SVCDATE) %>% filter(
                                     DX1 %in% codes_epilepsy_ICD10 | DX2 %in% codes_epilepsy_ICD10
                                     ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                     filter(ENROLID>0) %>% 
                                     distinct(ENROLID, SVCDATE) %>% 
                                     collect() %>% 
                                     mutate(across(SVCDATE, mdy))

epilepsy_2016_s <- ms_s_2016 %>% select(ENROLID, AGE, SEX, DX1, DX2, SVCDATE) %>% filter(
                                     DX1 %in% codes_epilepsy_ICD10 | DX2 %in% codes_epilepsy_ICD10
                                     ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                     filter(ENROLID>0) %>% 
                                     distinct(ENROLID, SVCDATE) %>% 
                                     collect() %>% 
                                     mutate(across(SVCDATE, mdy))


#################################2017#################################
epilepsy_2017_i <- ms_i_2017 %>% select(ENROLID, AGE, SEX, DX1, DX2, DX3, DX4, DX5, DX6, DX7, DX8, DX9,
                                      DX10, DX11, DX12, DX13, DX14, DX15, ADMDATE) %>% filter(
                                      DX1 %in% codes_epilepsy_ICD10 | DX2 %in% codes_epilepsy_ICD10 |
                                      DX3 %in% codes_epilepsy_ICD10 | DX4 %in% codes_epilepsy_ICD10 |
                                      DX5 %in% codes_epilepsy_ICD10 | DX6 %in% codes_epilepsy_ICD10 |
                                      DX7 %in% codes_epilepsy_ICD10 | DX8 %in% codes_epilepsy_ICD10 |
                                      DX9 %in% codes_epilepsy_ICD10 | DX10 %in% codes_epilepsy_ICD10 |
                                      DX11%in% codes_epilepsy_ICD10 | DX12 %in% codes_epilepsy_ICD10 |
                                      DX13 %in% codes_epilepsy_ICD10 | DX14 %in% codes_epilepsy_ICD10 |
                                      DX15 %in% codes_epilepsy_ICD10
                                      ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                      filter(ENROLID>0) %>%    
                                      mutate(SVCDATE=ADMDATE) %>%
                                      distinct(ENROLID, SVCDATE) %>% 
                                      collect() %>% 
                                      mutate(across(SVCDATE, mdy))

epilepsy_2017_o <- ms_o_2017 %>% select(ENROLID, AGE, SEX, DX1, DX2, SVCDATE) %>% filter(
                                     DX1 %in% codes_epilepsy_ICD10 | DX2 %in% codes_epilepsy_ICD10
                                     ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                     filter(ENROLID>0) %>% 
                                     distinct(ENROLID, SVCDATE) %>% 
                                     collect() %>% 
                                     mutate(across(SVCDATE, mdy))

epilepsy_2017_s <- ms_s_2017 %>% select(ENROLID, AGE, SEX, DX1, DX2, SVCDATE) %>% filter(
                                     DX1 %in% codes_epilepsy_ICD10 | DX2 %in% codes_epilepsy_ICD10
                                     ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                     filter(ENROLID>0) %>% 
                                     distinct(ENROLID, SVCDATE) %>% 
                                     collect() %>% 
                                     mutate(across(SVCDATE, mdy))


#################################2018#################################
epilepsy_2018_i <- ms_i_2018 %>% select(ENROLID, AGE, SEX, DX1, DX2, DX3, DX4, DX5, DX6, DX7, DX8, DX9,
                                      DX10, DX11, DX12, DX13, DX14, DX15, ADMDATE) %>% filter(
                                      DX1 %in% codes_epilepsy_ICD10 | DX2 %in% codes_epilepsy_ICD10 |
                                      DX3 %in% codes_epilepsy_ICD10 | DX4 %in% codes_epilepsy_ICD10 |
                                      DX5 %in% codes_epilepsy_ICD10 | DX6 %in% codes_epilepsy_ICD10 |
                                      DX7 %in% codes_epilepsy_ICD10 | DX8 %in% codes_epilepsy_ICD10 |
                                      DX9 %in% codes_epilepsy_ICD10 | DX10 %in% codes_epilepsy_ICD10 |
                                      DX11%in% codes_epilepsy_ICD10 | DX12 %in% codes_epilepsy_ICD10 |
                                      DX13 %in% codes_epilepsy_ICD10 | DX14 %in% codes_epilepsy_ICD10 |
                                      DX15 %in% codes_epilepsy_ICD10
                                      ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                      filter(ENROLID>0) %>%    
                                      mutate(SVCDATE=ADMDATE) %>%
                                      distinct(ENROLID, SVCDATE) %>% 
                                      collect() %>% 
                                      mutate(across(SVCDATE, mdy))

epilepsy_2018_o <- ms_o_2018 %>% select(ENROLID, AGE, SEX, DX1, DX2, SVCDATE) %>% filter(
                                     DX1 %in% codes_epilepsy_ICD10 | DX2 %in% codes_epilepsy_ICD10
                                     ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                     filter(ENROLID>0) %>% 
                                     distinct(ENROLID, SVCDATE) %>% 
                                     collect() %>% 
                                     mutate(across(SVCDATE, mdy))

epilepsy_2018_s <- ms_s_2018 %>% select(ENROLID, AGE, SEX, DX1, DX2, SVCDATE) %>% filter(
                                     DX1 %in% codes_epilepsy_ICD10 | DX2 %in% codes_epilepsy_ICD10
                                     ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                     filter(ENROLID>0) %>% 
                                     distinct(ENROLID, SVCDATE) %>% 
                                     collect() %>% 
                                     mutate(across(SVCDATE, mdy))


#################################2019#################################
epilepsy_2019_i <- ms_i_2019 %>% select(ENROLID, AGE, SEX, DX1, DX2, DX3, DX4, DX5, DX6, DX7, DX8, DX9,
                                      DX10, DX11, DX12, DX13, DX14, DX15, ADMDATE) %>% filter(
                                      DX1 %in% codes_epilepsy_ICD10 | DX2 %in% codes_epilepsy_ICD10 |
                                      DX3 %in% codes_epilepsy_ICD10 | DX4 %in% codes_epilepsy_ICD10 |
                                      DX5 %in% codes_epilepsy_ICD10 | DX6 %in% codes_epilepsy_ICD10 |
                                      DX7 %in% codes_epilepsy_ICD10 | DX8 %in% codes_epilepsy_ICD10 |
                                      DX9 %in% codes_epilepsy_ICD10 | DX10 %in% codes_epilepsy_ICD10 |
                                      DX11%in% codes_epilepsy_ICD10 | DX12 %in% codes_epilepsy_ICD10 |
                                      DX13 %in% codes_epilepsy_ICD10 | DX14 %in% codes_epilepsy_ICD10 |
                                      DX15 %in% codes_epilepsy_ICD10
                                      ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                      filter(ENROLID>0) %>%    
                                      mutate(SVCDATE=ADMDATE) %>%
                                      distinct(ENROLID, SVCDATE) %>% 
                                      collect() %>% 
                                      mutate(across(SVCDATE, mdy))

epilepsy_2019_o <- ms_o_2019 %>% select(ENROLID, AGE, SEX, DX1, DX2, SVCDATE) %>% filter(
                                     DX1 %in% codes_epilepsy_ICD10 | DX2 %in% codes_epilepsy_ICD10
                                     ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                     filter(ENROLID>0) %>% 
                                     distinct(ENROLID, SVCDATE) %>% 
                                     collect() %>% 
                                     mutate(across(SVCDATE, mdy))

epilepsy_2019_s <- ms_s_2019 %>% select(ENROLID, AGE, SEX, DX1, DX2, SVCDATE) %>% filter(
                                     DX1 %in% codes_epilepsy_ICD10 | DX2 %in% codes_epilepsy_ICD10
                                     ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                     filter(ENROLID>0) %>% 
                                     distinct(ENROLID, SVCDATE) %>% 
                                     collect() %>% 
                                     mutate(across(SVCDATE, mdy))


#################################2020#################################
epilepsy_2020_i <- ms_i_2020 %>% select(ENROLID, AGE, SEX, DX1, DX2, DX3, DX4, DX5, DX6, DX7, DX8, DX9,
                                      DX10, DX11, DX12, DX13, DX14, DX15, ADMDATE) %>% filter(
                                      DX1 %in% codes_epilepsy_ICD10 | DX2 %in% codes_epilepsy_ICD10 |
                                      DX3 %in% codes_epilepsy_ICD10 | DX4 %in% codes_epilepsy_ICD10 |
                                      DX5 %in% codes_epilepsy_ICD10 | DX6 %in% codes_epilepsy_ICD10 |
                                      DX7 %in% codes_epilepsy_ICD10 | DX8 %in% codes_epilepsy_ICD10 |
                                      DX9 %in% codes_epilepsy_ICD10 | DX10 %in% codes_epilepsy_ICD10 |
                                      DX11%in% codes_epilepsy_ICD10 | DX12 %in% codes_epilepsy_ICD10 |
                                      DX13 %in% codes_epilepsy_ICD10 | DX14 %in% codes_epilepsy_ICD10 |
                                      DX15 %in% codes_epilepsy_ICD10
                                      ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                      filter(ENROLID>0) %>%    
                                      mutate(SVCDATE=ADMDATE) %>%
                                      distinct(ENROLID, SVCDATE) %>% 
                                      collect() %>% 
                                      mutate(across(SVCDATE, mdy))

epilepsy_2020_o <- ms_o_2020 %>% select(ENROLID, AGE, SEX, DX1, DX2, SVCDATE) %>% filter(
                                     DX1 %in% codes_epilepsy_ICD10 | DX2 %in% codes_epilepsy_ICD10
                                     ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                     filter(ENROLID>0) %>% 
                                     distinct(ENROLID, SVCDATE) %>% 
                                     collect() %>% 
                                     mutate(across(SVCDATE, mdy))

epilepsy_2020_s <- ms_s_2020 %>% select(ENROLID, AGE, SEX, DX1, DX2, SVCDATE) %>% filter(
                                     DX1 %in% codes_epilepsy_ICD10 | DX2 %in% codes_epilepsy_ICD10
                                     ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                     filter(ENROLID>0) %>% 
                                     distinct(ENROLID, SVCDATE) %>% 
                                     collect() %>% 
                                     mutate(across(SVCDATE, mdy))


#################################2021#################################
epilepsy_2021_i <- ms_i_2021 %>% select(ENROLID, AGE, SEX, DX1, DX2, DX3, DX4, DX5, DX6, DX7, DX8, DX9,
                                      DX10, DX11, DX12, DX13, DX14, DX15, ADMDATE) %>% filter(
                                      DX1 %in% codes_epilepsy_ICD10 | DX2 %in% codes_epilepsy_ICD10 |
                                      DX3 %in% codes_epilepsy_ICD10 | DX4 %in% codes_epilepsy_ICD10 |
                                      DX5 %in% codes_epilepsy_ICD10 | DX6 %in% codes_epilepsy_ICD10 |
                                      DX7 %in% codes_epilepsy_ICD10 | DX8 %in% codes_epilepsy_ICD10 |
                                      DX9 %in% codes_epilepsy_ICD10 | DX10 %in% codes_epilepsy_ICD10 |
                                      DX11%in% codes_epilepsy_ICD10 | DX12 %in% codes_epilepsy_ICD10 |
                                      DX13 %in% codes_epilepsy_ICD10 | DX14 %in% codes_epilepsy_ICD10 |
                                      DX15 %in% codes_epilepsy_ICD10
                                      ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                      filter(ENROLID>0) %>%    
                                      mutate(SVCDATE=ADMDATE) %>%
                                      distinct(ENROLID, SVCDATE) %>% 
                                      collect() %>% 
                                      mutate(across(SVCDATE, mdy))

epilepsy_2021_o <- ms_o_2021 %>% select(ENROLID, AGE, SEX, DX1, DX2, SVCDATE) %>% filter(
                                     DX1 %in% codes_epilepsy_ICD10 | DX2 %in% codes_epilepsy_ICD10
                                     ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                     filter(ENROLID>0) %>% 
                                     distinct(ENROLID, SVCDATE) %>% 
                                     collect() %>% 
                                     mutate(across(SVCDATE, mdy))

epilepsy_2021_s <- ms_s_2021 %>% select(ENROLID, AGE, SEX, DX1, DX2, SVCDATE) %>% filter(
                                     DX1 %in% codes_epilepsy_ICD10 | DX2 %in% codes_epilepsy_ICD10
                                     ) %>% mutate(across(c(ENROLID, AGE), as.numeric)) %>% 
                                     filter(ENROLID>0) %>% 
                                     distinct(ENROLID, SVCDATE) %>% 
                                     collect() %>% 
                                     mutate(across(SVCDATE, mdy))


# Patients with epilepsy (at least 2 different codes for epilepsy separated by at least 180 days)
epilepsy <- bind_rows(epilepsy_2006_i, epilepsy_2006_o, epilepsy_2006_s, epilepsy_2007_i, epilepsy_2007_o, epilepsy_2007_s, epilepsy_2008_i, epilepsy_2008_o, epilepsy_2008_s, epilepsy_2009_i, epilepsy_2009_o, epilepsy_2009_s, epilepsy_2010_i, epilepsy_2010_o, epilepsy_2010_s, epilepsy_2011_i, epilepsy_2011_o, epilepsy_2011_s, epilepsy_2012_i, epilepsy_2012_o, epilepsy_2012_s, epilepsy_2013_i, epilepsy_2013_o, epilepsy_2013_s, epilepsy_2014_i, epilepsy_2014_o, epilepsy_2014_s, epilepsy_2015_i, epilepsy_2015_o, epilepsy_2015_s, epilepsy_2016_i, epilepsy_2016_o, epilepsy_2016_s, epilepsy_2017_i, epilepsy_2017_o, epilepsy_2017_s, epilepsy_2018_i, epilepsy_2018_o, epilepsy_2018_s, epilepsy_2019_i, epilepsy_2019_o, epilepsy_2019_s, epilepsy_2020_i, epilepsy_2020_o, epilepsy_2020_s, epilepsy_2021_i, epilepsy_2021_o, epilepsy_2021_s) %>% 
  distinct(ENROLID, SVCDATE) %>% 
  group_by(ENROLID) %>% 
  mutate(maximum_days_between_epilepsy_diagnoses=max(SVCDATE)-min(SVCDATE)) %>% 
  filter(maximum_days_between_epilepsy_diagnoses>=180)

epilepsy_n <- epilepsy %>% distinct(ENROLID) %>% nrow()
epilepsy_n
```




Information on antiseizure medications
```{r}
# Extract the information from the redbook data
redbook_2006_data <- redbook_2006 %>% collect()
redbook_2007_data <- redbook_2007 %>% collect()
redbook_2008_data <- redbook_2008 %>% collect()
redbook_2009_data <- redbook_2009 %>% collect()
redbook_2010_data <- redbook_2010 %>% collect()
redbook_2011_data <- redbook_2011 %>% collect()
redbook_2012_data <- redbook_2012 %>% collect()
redbook_2013_data <- redbook_2013 %>% collect()
redbook_2014_data <- redbook_2014 %>% collect()
redbook_2015_data <- redbook_2015 %>% collect()
redbook_2016_data <- redbook_2016 %>% collect()
redbook_2017_data <- redbook_2017 %>% collect()
redbook_2018_data <- redbook_2018 %>% collect()
redbook_2019_data <- redbook_2019 %>% collect()
redbook_2020_data <- redbook_2020 %>% collect()
redbook_2021_data <- redbook_2021 %>% collect()


# Antiseizure medications
############################################2006############################################
codes_NDCNUM_phenobarbital_2006 <- redbook_2006_data %>% 
  filter(
      grepl("phenobarb", GENNME, ignore.case=TRUE) |
      grepl("phenobarb", THRDTDS, ignore.case=TRUE) |
      grepl("phenobarb", PRODNME, ignore.case=TRUE) |
      grepl("luminal", PRODNME, ignore.case=TRUE) |
      grepl("solfoton", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("/", GENNME, ignore.case=TRUE) &
    !grepl("/", PRODNME, ignore.case=TRUE) &
    !grepl("/", THRDTDS, ignore.case=TRUE) &
    !grepl("&", GENNME, ignore.case=TRUE) &
    !grepl("&", PRODNME, ignore.case=TRUE) &
    !grepl("&", THRDTDS, ignore.case=TRUE) &
    !grepl("-", GENNME, ignore.case=TRUE) &
    !grepl("-", PRODNME, ignore.case=TRUE) &
    !grepl("-", THRDTDS, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_phenobarbital_2006 <- as.numeric(codes_NDCNUM_phenobarbital_2006)


codes_NDCNUM_phenytoin_2006 <- redbook_2006_data %>% 
  filter(
      grepl("phenytoin", GENNME, ignore.case=TRUE) |
      grepl("phenytoin", THRDTDS, ignore.case=TRUE) |
      grepl("phenytoin", PRODNME, ignore.case=TRUE) |
      grepl("dilantin", PRODNME, ignore.case=TRUE) |
      grepl("phenytek", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_phenytoin_2006 <- as.numeric(codes_NDCNUM_phenytoin_2006)


codes_NDCNUM_valproate_2006 <- redbook_2006_data %>% 
  filter(
      grepl("valpro", GENNME, ignore.case=TRUE) |
      grepl("valpro", THRDTDS, ignore.case=TRUE) |
      grepl("valpro", PRODNME, ignore.case=TRUE) |
      grepl("depakene", PRODNME, ignore.case=TRUE) |
      grepl("depakote", PRODNME, ignore.case=TRUE) |
      grepl("depacon", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_valproate_2006 <- as.numeric(codes_NDCNUM_valproate_2006)


codes_NDCNUM_carbamazepine_2006 <- redbook_2006_data %>% 
  filter(
      grepl("carbamazepine", GENNME, ignore.case=TRUE) |
      grepl("carbamazepine", THRDTDS, ignore.case=TRUE) |
      grepl("carbamazepine", PRODNME, ignore.case=TRUE) |
      grepl("tegretol", PRODNME, ignore.case=TRUE) |
      grepl("carbatrol", PRODNME, ignore.case=TRUE) |
      grepl("epitol", PRODNME, ignore.case=TRUE) |
      grepl("equetro", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("atretol", PRODNME, ignore.case=TRUE)
    ) %>%   
  pull(NDCNUM)
codes_NDCNUM_carbamazepine_2006 <- as.numeric(codes_NDCNUM_carbamazepine_2006)


codes_NDCNUM_oxcarbazepine_2006 <- redbook_2006_data %>% 
  filter(
      grepl("oxcarbazepine", GENNME, ignore.case=TRUE) |
      grepl("oxcarbazepine", THRDTDS, ignore.case=TRUE) |
      grepl("oxcarbazepine", PRODNME, ignore.case=TRUE) |
      grepl("oxtellar", PRODNME, ignore.case=TRUE) |
      grepl("trileptal", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_oxcarbazepine_2006 <- as.numeric(codes_NDCNUM_oxcarbazepine_2006)


codes_NDCNUM_rufinamide_2006 <- redbook_2006_data %>% 
  filter(
      grepl("rufinamide", GENNME, ignore.case=TRUE) |
      grepl("rufinamide", THRDTDS, ignore.case=TRUE) |
      grepl("rufinamide", PRODNME, ignore.case=TRUE) |
      grepl("banzel", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_rufinamide_2006 <- as.numeric(codes_NDCNUM_rufinamide_2006)


codes_NDCNUM_levetiracetam_2006 <- redbook_2006_data %>% 
  filter(
      grepl("levetiracetam", GENNME, ignore.case=TRUE) |
      grepl("levetiracetam", THRDTDS, ignore.case=TRUE) |
      grepl("levetiracetam", PRODNME, ignore.case=TRUE) |
      grepl("elepsia", PRODNME, ignore.case=TRUE) |
      grepl("keppra", PRODNME, ignore.case=TRUE) |
      grepl("roweepra", PRODNME, ignore.case=TRUE) |
      grepl("spritam", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_levetiracetam_2006 <- as.numeric(codes_NDCNUM_levetiracetam_2006)


codes_NDCNUM_lamotrigine_2006 <- redbook_2006_data %>% 
  filter(
      grepl("lamotrigine", GENNME, ignore.case=TRUE) |
      grepl("lamotrigine", THRDTDS, ignore.case=TRUE) |
      grepl("lamotrigine", PRODNME, ignore.case=TRUE) |
      grepl("lamictal", PRODNME, ignore.case=TRUE) |
      grepl("subvenite", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_lamotrigine_2006 <- as.numeric(codes_NDCNUM_lamotrigine_2006)


codes_NDCNUM_brivaracetam_2006 <- redbook_2006_data %>% 
  filter(
      grepl("brivaracetam", GENNME, ignore.case=TRUE) |
      grepl("brivaracetam", THRDTDS, ignore.case=TRUE) |
      grepl("brivaracetam", PRODNME, ignore.case=TRUE) |
      grepl("briviact", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_brivaracetam_2006 <- as.numeric(codes_NDCNUM_brivaracetam_2006)


codes_NDCNUM_cenobamate_2006 <- redbook_2006_data %>% 
  filter(
      grepl("cenobamate", GENNME, ignore.case=TRUE) |
      grepl("cenobamate", THRDTDS, ignore.case=TRUE) |
      grepl("cenobamate", PRODNME, ignore.case=TRUE) |
      grepl("xcopri", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_cenobamate_2006 <- as.numeric(codes_NDCNUM_cenobamate_2006)


codes_NDCNUM_clobazam_2006 <- redbook_2006_data %>% 
  filter(
      grepl("clobazam", GENNME, ignore.case=TRUE) |
      grepl("clobazam", THRDTDS, ignore.case=TRUE) |
      grepl("clobazam", PRODNME, ignore.case=TRUE) |
      grepl("onfi", PRODNME, ignore.case=TRUE) |
      grepl("sympazan", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("HIV", GENNME, ignore.case=TRUE) &
    !grepl("pregnancy", GENNME, ignore.case=TRUE) &
    !grepl("denture", GENNME, ignore.case=TRUE) &
    !grepl("hyoscyamine", GENNME, ignore.case=TRUE) &
    !grepl("glucose", GENNME, ignore.case=TRUE) &
    !grepl("device", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_clobazam_2006 <- as.numeric(codes_NDCNUM_clobazam_2006)


codes_NDCNUM_eslicarbazepine_2006 <- redbook_2006_data %>% 
  filter(
      grepl("eslicarbazepine", GENNME, ignore.case=TRUE) |
      grepl("eslicarbazepine", THRDTDS, ignore.case=TRUE) |
      grepl("eslicarbazepine", PRODNME, ignore.case=TRUE) |
      grepl("aptiom", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_eslicarbazepine_2006 <- as.numeric(codes_NDCNUM_eslicarbazepine_2006)


codes_NDCNUM_ethosuximide_2006 <- redbook_2006_data %>% 
  filter(
      grepl("ethosuximide", GENNME, ignore.case=TRUE) |
      grepl("ethosuximide", THRDTDS, ignore.case=TRUE) |
      grepl("ethosuximide", PRODNME, ignore.case=TRUE) |
      grepl("zarontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_ethosuximide_2006 <- as.numeric(codes_NDCNUM_ethosuximide_2006)


codes_NDCNUM_lacosamide_2006 <- redbook_2006_data %>% 
  filter(
      grepl("lacosamide", GENNME, ignore.case=TRUE) |
      grepl("lacosamide", THRDTDS, ignore.case=TRUE) |
      grepl("lacosamide", PRODNME, ignore.case=TRUE) |
      grepl("vimpat", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_lacosamide_2006 <- as.numeric(codes_NDCNUM_lacosamide_2006)


codes_NDCNUM_perampanel_2006 <- redbook_2006_data %>% 
  filter(
      grepl("perampanel", GENNME, ignore.case=TRUE) |
      grepl("perampanel", THRDTDS, ignore.case=TRUE) |
      grepl("perampanel", PRODNME, ignore.case=TRUE) |
      grepl("fycompa", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_perampanel_2006 <- as.numeric(codes_NDCNUM_perampanel_2006)


codes_NDCNUM_stiripentol_2006 <- redbook_2006_data %>% 
  filter(
      grepl("stiripentol", GENNME, ignore.case=TRUE) |
      grepl("stiripentol", THRDTDS, ignore.case=TRUE) |
      grepl("stiripentol", PRODNME, ignore.case=TRUE) |
      grepl("diacomit", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_stiripentol_2006 <- as.numeric(codes_NDCNUM_stiripentol_2006)


codes_NDCNUM_topiramate_2006 <- redbook_2006_data %>% 
  filter(
      grepl("topiramate", GENNME, ignore.case=TRUE) |
      grepl("topiramate", THRDTDS, ignore.case=TRUE) |
      grepl("topiramate", PRODNME, ignore.case=TRUE) |
      grepl("eprontia", PRODNME, ignore.case=TRUE) |
      grepl("topamax", PRODNME, ignore.case=TRUE) |
      grepl("trokendi", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("/", GENNME, ignore.case=TRUE) &
    !grepl("/", PRODNME, ignore.case=TRUE) &
    !grepl("/", THRDTDS, ignore.case=TRUE) &
    !grepl("&", GENNME, ignore.case=TRUE) &
    !grepl("&", PRODNME, ignore.case=TRUE) &
    !grepl("&", THRDTDS, ignore.case=TRUE) &
    !grepl("-", GENNME, ignore.case=TRUE) &
    !grepl("-", PRODNME, ignore.case=TRUE) &
    !grepl("-", THRDTDS, ignore.case=TRUE) &
    !grepl("qudexy", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_topiramate_2006 <- as.numeric(codes_NDCNUM_topiramate_2006)


codes_NDCNUM_vigabatrin_2006 <- redbook_2006_data %>% 
  filter(
      grepl("vigabatrin", GENNME, ignore.case=TRUE) |
      grepl("vigabatrin", THRDTDS, ignore.case=TRUE) |
      grepl("vigabatrin", PRODNME, ignore.case=TRUE) |
      grepl("sabril", PRODNME, ignore.case=TRUE) |
      grepl("vigadrone", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_vigabatrin_2006 <- as.numeric(codes_NDCNUM_vigabatrin_2006)


codes_NDCNUM_zonisamide_2006 <- redbook_2006_data %>% 
  filter(
      grepl("zonisamide", GENNME, ignore.case=TRUE) |
      grepl("zonisamide", THRDTDS, ignore.case=TRUE) |
      grepl("zonisamide", PRODNME, ignore.case=TRUE) |
      grepl("zonegran", PRODNME, ignore.case=TRUE) |
      grepl("zonisade", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_zonisamide_2006 <- as.numeric(codes_NDCNUM_zonisamide_2006)


codes_NDCNUM_felbamate_2006 <- redbook_2006_data %>% 
  filter(
      grepl("felbamate", GENNME, ignore.case=TRUE) |
      grepl("felbamate", THRDTDS, ignore.case=TRUE) |
      grepl("felbamate", PRODNME, ignore.case=TRUE) |
      grepl("felbatol", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_felbamate_2006 <- as.numeric(codes_NDCNUM_felbamate_2006)


codes_NDCNUM_pregabalin_2006 <- redbook_2006_data %>% 
  filter(
      grepl("pregabalin", GENNME, ignore.case=TRUE) |
      grepl("pregabalin", THRDTDS, ignore.case=TRUE) |
      grepl("pregabalin", PRODNME, ignore.case=TRUE) |
      grepl("lyrica", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_pregabalin_2006 <- as.numeric(codes_NDCNUM_pregabalin_2006)


codes_NDCNUM_tiagabine_2006 <- redbook_2006_data %>% 
  filter(
      grepl("tiagabine", GENNME, ignore.case=TRUE) |
      grepl("tiagabine", THRDTDS, ignore.case=TRUE) |
      grepl("tiagabine", PRODNME, ignore.case=TRUE) |
      grepl("gabitril", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_tiagabine_2006 <- as.numeric(codes_NDCNUM_tiagabine_2006)


codes_NDCNUM_cannabidiol_2006 <- redbook_2006_data %>% 
  filter(
      grepl("epidiolex", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_cannabidiol_2006 <- as.numeric(codes_NDCNUM_cannabidiol_2006)


codes_NDCNUM_gabapentin_2006 <- redbook_2006_data %>% 
  filter(
      grepl("gabapentin", GENNME, ignore.case=TRUE) |
      grepl("gabapentin", THRDTDS, ignore.case=TRUE) |
      grepl("gabapentin", PRODNME, ignore.case=TRUE) |
      grepl("gralise", PRODNME, ignore.case=TRUE) |
      grepl("neurontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl(";", GENNME, ignore.case=TRUE) &
    !grepl("enacarbil", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_gabapentin_2006 <- as.numeric(codes_NDCNUM_gabapentin_2006)


codes_NDCNUM_fenfluramine_2006 <- redbook_2006_data %>% 
  filter(
      grepl("fenfluramine", GENNME, ignore.case=TRUE) |
      grepl("fenfluramine", THRDTDS, ignore.case=TRUE) |
      grepl("fenfluramine", PRODNME, ignore.case=TRUE) |
      grepl("fintepla", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("dex", GENNME, ignore.case=TRUE) &
    !grepl("dex", THRDTDS, ignore.case=TRUE) &
    !grepl("hydrochloride", GENNME, ignore.case=TRUE) &    
    !grepl("hydrochloride", THRDTDS, ignore.case=TRUE) &
    !grepl("pondimin", PRODNME, ignore.case=TRUE) &
    !grepl("redux", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_fenfluramine_2006 <- as.numeric(codes_NDCNUM_fenfluramine_2006)


codes_NDCNUM_methsuximide_2006 <- redbook_2006_data %>% 
  filter(
      grepl("methsuximide", GENNME, ignore.case=TRUE) |
      grepl("methsuximide", THRDTDS, ignore.case=TRUE) |
      grepl("methsuximide", PRODNME, ignore.case=TRUE) |
      grepl("celontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_methsuximide_2006 <- as.numeric(codes_NDCNUM_methsuximide_2006)


codes_NDCNUM_ASM_2006 <- c(
  codes_NDCNUM_phenobarbital_2006,
  codes_NDCNUM_phenytoin_2006,
  codes_NDCNUM_valproate_2006,
  codes_NDCNUM_carbamazepine_2006,
  codes_NDCNUM_oxcarbazepine_2006,
  codes_NDCNUM_rufinamide_2006,
  codes_NDCNUM_levetiracetam_2006,
  codes_NDCNUM_lamotrigine_2006,
  codes_NDCNUM_brivaracetam_2006,
  codes_NDCNUM_cenobamate_2006,
  codes_NDCNUM_clobazam_2006,
  codes_NDCNUM_eslicarbazepine_2006,
  codes_NDCNUM_ethosuximide_2006,
  codes_NDCNUM_lacosamide_2006,
  codes_NDCNUM_perampanel_2006,
  codes_NDCNUM_stiripentol_2006,
  codes_NDCNUM_topiramate_2006,
  codes_NDCNUM_vigabatrin_2006,
  codes_NDCNUM_zonisamide_2006,
  codes_NDCNUM_felbamate_2006,
  codes_NDCNUM_pregabalin_2006,
  codes_NDCNUM_tiagabine_2006,
  codes_NDCNUM_cannabidiol_2006,
  codes_NDCNUM_gabapentin_2006,
  codes_NDCNUM_fenfluramine_2006,
  codes_NDCNUM_methsuximide_2006
)




############################################2007############################################
codes_NDCNUM_phenobarbital_2007 <- redbook_2007_data %>% 
  filter(
      grepl("phenobarb", GENNME, ignore.case=TRUE) |
      grepl("phenobarb", THRDTDS, ignore.case=TRUE) |
      grepl("phenobarb", PRODNME, ignore.case=TRUE) |
      grepl("luminal", PRODNME, ignore.case=TRUE) |
      grepl("solfoton", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("/", GENNME, ignore.case=TRUE) &
    !grepl("/", PRODNME, ignore.case=TRUE) &
    !grepl("/", THRDTDS, ignore.case=TRUE) &
    !grepl("&", GENNME, ignore.case=TRUE) &
    !grepl("&", PRODNME, ignore.case=TRUE) &
    !grepl("&", THRDTDS, ignore.case=TRUE) &
    !grepl("-", GENNME, ignore.case=TRUE) &
    !grepl("-", PRODNME, ignore.case=TRUE) &
    !grepl("-", THRDTDS, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_phenobarbital_2007 <- as.numeric(codes_NDCNUM_phenobarbital_2007)


codes_NDCNUM_phenytoin_2007 <- redbook_2007_data %>% 
  filter(
      grepl("phenytoin", GENNME, ignore.case=TRUE) |
      grepl("phenytoin", THRDTDS, ignore.case=TRUE) |
      grepl("phenytoin", PRODNME, ignore.case=TRUE) |
      grepl("dilantin", PRODNME, ignore.case=TRUE) |
      grepl("phenytek", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_phenytoin_2007 <- as.numeric(codes_NDCNUM_phenytoin_2007)


codes_NDCNUM_valproate_2007 <- redbook_2007_data %>% 
  filter(
      grepl("valpro", GENNME, ignore.case=TRUE) |
      grepl("valpro", THRDTDS, ignore.case=TRUE) |
      grepl("valpro", PRODNME, ignore.case=TRUE) |
      grepl("depakene", PRODNME, ignore.case=TRUE) |
      grepl("depakote", PRODNME, ignore.case=TRUE) |
      grepl("depacon", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_valproate_2007 <- as.numeric(codes_NDCNUM_valproate_2007)


codes_NDCNUM_carbamazepine_2007 <- redbook_2007_data %>% 
  filter(
      grepl("carbamazepine", GENNME, ignore.case=TRUE) |
      grepl("carbamazepine", THRDTDS, ignore.case=TRUE) |
      grepl("carbamazepine", PRODNME, ignore.case=TRUE) |
      grepl("tegretol", PRODNME, ignore.case=TRUE) |
      grepl("carbatrol", PRODNME, ignore.case=TRUE) |
      grepl("epitol", PRODNME, ignore.case=TRUE) |
      grepl("equetro", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("atretol", PRODNME, ignore.case=TRUE)
    ) %>%   
  pull(NDCNUM)
codes_NDCNUM_carbamazepine_2007 <- as.numeric(codes_NDCNUM_carbamazepine_2007)


codes_NDCNUM_oxcarbazepine_2007 <- redbook_2007_data %>% 
  filter(
      grepl("oxcarbazepine", GENNME, ignore.case=TRUE) |
      grepl("oxcarbazepine", THRDTDS, ignore.case=TRUE) |
      grepl("oxcarbazepine", PRODNME, ignore.case=TRUE) |
      grepl("oxtellar", PRODNME, ignore.case=TRUE) |
      grepl("trileptal", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_oxcarbazepine_2007 <- as.numeric(codes_NDCNUM_oxcarbazepine_2007)


codes_NDCNUM_rufinamide_2007 <- redbook_2007_data %>% 
  filter(
      grepl("rufinamide", GENNME, ignore.case=TRUE) |
      grepl("rufinamide", THRDTDS, ignore.case=TRUE) |
      grepl("rufinamide", PRODNME, ignore.case=TRUE) |
      grepl("banzel", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_rufinamide_2007 <- as.numeric(codes_NDCNUM_rufinamide_2007)


codes_NDCNUM_levetiracetam_2007 <- redbook_2007_data %>% 
  filter(
      grepl("levetiracetam", GENNME, ignore.case=TRUE) |
      grepl("levetiracetam", THRDTDS, ignore.case=TRUE) |
      grepl("levetiracetam", PRODNME, ignore.case=TRUE) |
      grepl("elepsia", PRODNME, ignore.case=TRUE) |
      grepl("keppra", PRODNME, ignore.case=TRUE) |
      grepl("roweepra", PRODNME, ignore.case=TRUE) |
      grepl("spritam", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_levetiracetam_2007 <- as.numeric(codes_NDCNUM_levetiracetam_2007)


codes_NDCNUM_lamotrigine_2007 <- redbook_2007_data %>% 
  filter(
      grepl("lamotrigine", GENNME, ignore.case=TRUE) |
      grepl("lamotrigine", THRDTDS, ignore.case=TRUE) |
      grepl("lamotrigine", PRODNME, ignore.case=TRUE) |
      grepl("lamictal", PRODNME, ignore.case=TRUE) |
      grepl("subvenite", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_lamotrigine_2007 <- as.numeric(codes_NDCNUM_lamotrigine_2007)


codes_NDCNUM_brivaracetam_2007 <- redbook_2007_data %>% 
  filter(
      grepl("brivaracetam", GENNME, ignore.case=TRUE) |
      grepl("brivaracetam", THRDTDS, ignore.case=TRUE) |
      grepl("brivaracetam", PRODNME, ignore.case=TRUE) |
      grepl("briviact", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_brivaracetam_2007 <- as.numeric(codes_NDCNUM_brivaracetam_2007)


codes_NDCNUM_cenobamate_2007 <- redbook_2007_data %>% 
  filter(
      grepl("cenobamate", GENNME, ignore.case=TRUE) |
      grepl("cenobamate", THRDTDS, ignore.case=TRUE) |
      grepl("cenobamate", PRODNME, ignore.case=TRUE) |
      grepl("xcopri", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_cenobamate_2007 <- as.numeric(codes_NDCNUM_cenobamate_2007)


codes_NDCNUM_clobazam_2007 <- redbook_2007_data %>% 
  filter(
      grepl("clobazam", GENNME, ignore.case=TRUE) |
      grepl("clobazam", THRDTDS, ignore.case=TRUE) |
      grepl("clobazam", PRODNME, ignore.case=TRUE) |
      grepl("onfi", PRODNME, ignore.case=TRUE) |
      grepl("sympazan", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("HIV", GENNME, ignore.case=TRUE) &
    !grepl("pregnancy", GENNME, ignore.case=TRUE) &
    !grepl("denture", GENNME, ignore.case=TRUE) &
    !grepl("hyoscyamine", GENNME, ignore.case=TRUE) &
    !grepl("glucose", GENNME, ignore.case=TRUE) &
    !grepl("device", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_clobazam_2007 <- as.numeric(codes_NDCNUM_clobazam_2007)


codes_NDCNUM_eslicarbazepine_2007 <- redbook_2007_data %>% 
  filter(
      grepl("eslicarbazepine", GENNME, ignore.case=TRUE) |
      grepl("eslicarbazepine", THRDTDS, ignore.case=TRUE) |
      grepl("eslicarbazepine", PRODNME, ignore.case=TRUE) |
      grepl("aptiom", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_eslicarbazepine_2007 <- as.numeric(codes_NDCNUM_eslicarbazepine_2007)


codes_NDCNUM_ethosuximide_2007 <- redbook_2007_data %>% 
  filter(
      grepl("ethosuximide", GENNME, ignore.case=TRUE) |
      grepl("ethosuximide", THRDTDS, ignore.case=TRUE) |
      grepl("ethosuximide", PRODNME, ignore.case=TRUE) |
      grepl("zarontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_ethosuximide_2007 <- as.numeric(codes_NDCNUM_ethosuximide_2007)


codes_NDCNUM_lacosamide_2007 <- redbook_2007_data %>% 
  filter(
      grepl("lacosamide", GENNME, ignore.case=TRUE) |
      grepl("lacosamide", THRDTDS, ignore.case=TRUE) |
      grepl("lacosamide", PRODNME, ignore.case=TRUE) |
      grepl("vimpat", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_lacosamide_2007 <- as.numeric(codes_NDCNUM_lacosamide_2007)


codes_NDCNUM_perampanel_2007 <- redbook_2007_data %>% 
  filter(
      grepl("perampanel", GENNME, ignore.case=TRUE) |
      grepl("perampanel", THRDTDS, ignore.case=TRUE) |
      grepl("perampanel", PRODNME, ignore.case=TRUE) |
      grepl("fycompa", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_perampanel_2007 <- as.numeric(codes_NDCNUM_perampanel_2007)


codes_NDCNUM_stiripentol_2007 <- redbook_2007_data %>% 
  filter(
      grepl("stiripentol", GENNME, ignore.case=TRUE) |
      grepl("stiripentol", THRDTDS, ignore.case=TRUE) |
      grepl("stiripentol", PRODNME, ignore.case=TRUE) |
      grepl("diacomit", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_stiripentol_2007 <- as.numeric(codes_NDCNUM_stiripentol_2007)


codes_NDCNUM_topiramate_2007 <- redbook_2007_data %>% 
  filter(
      grepl("topiramate", GENNME, ignore.case=TRUE) |
      grepl("topiramate", THRDTDS, ignore.case=TRUE) |
      grepl("topiramate", PRODNME, ignore.case=TRUE) |
      grepl("eprontia", PRODNME, ignore.case=TRUE) |
      grepl("topamax", PRODNME, ignore.case=TRUE) |
      grepl("trokendi", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("/", GENNME, ignore.case=TRUE) &
    !grepl("/", PRODNME, ignore.case=TRUE) &
    !grepl("/", THRDTDS, ignore.case=TRUE) &
    !grepl("&", GENNME, ignore.case=TRUE) &
    !grepl("&", PRODNME, ignore.case=TRUE) &
    !grepl("&", THRDTDS, ignore.case=TRUE) &
    !grepl("-", GENNME, ignore.case=TRUE) &
    !grepl("-", PRODNME, ignore.case=TRUE) &
    !grepl("-", THRDTDS, ignore.case=TRUE) &
    !grepl("qudexy", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_topiramate_2007 <- as.numeric(codes_NDCNUM_topiramate_2007)


codes_NDCNUM_vigabatrin_2007 <- redbook_2007_data %>% 
  filter(
      grepl("vigabatrin", GENNME, ignore.case=TRUE) |
      grepl("vigabatrin", THRDTDS, ignore.case=TRUE) |
      grepl("vigabatrin", PRODNME, ignore.case=TRUE) |
      grepl("sabril", PRODNME, ignore.case=TRUE) |
      grepl("vigadrone", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_vigabatrin_2007 <- as.numeric(codes_NDCNUM_vigabatrin_2007)


codes_NDCNUM_zonisamide_2007 <- redbook_2007_data %>% 
  filter(
      grepl("zonisamide", GENNME, ignore.case=TRUE) |
      grepl("zonisamide", THRDTDS, ignore.case=TRUE) |
      grepl("zonisamide", PRODNME, ignore.case=TRUE) |
      grepl("zonegran", PRODNME, ignore.case=TRUE) |
      grepl("zonisade", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_zonisamide_2007 <- as.numeric(codes_NDCNUM_zonisamide_2007)


codes_NDCNUM_felbamate_2007 <- redbook_2007_data %>% 
  filter(
      grepl("felbamate", GENNME, ignore.case=TRUE) |
      grepl("felbamate", THRDTDS, ignore.case=TRUE) |
      grepl("felbamate", PRODNME, ignore.case=TRUE) |
      grepl("felbatol", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_felbamate_2007 <- as.numeric(codes_NDCNUM_felbamate_2007)


codes_NDCNUM_pregabalin_2007 <- redbook_2007_data %>% 
  filter(
      grepl("pregabalin", GENNME, ignore.case=TRUE) |
      grepl("pregabalin", THRDTDS, ignore.case=TRUE) |
      grepl("pregabalin", PRODNME, ignore.case=TRUE) |
      grepl("lyrica", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_pregabalin_2007 <- as.numeric(codes_NDCNUM_pregabalin_2007)


codes_NDCNUM_tiagabine_2007 <- redbook_2007_data %>% 
  filter(
      grepl("tiagabine", GENNME, ignore.case=TRUE) |
      grepl("tiagabine", THRDTDS, ignore.case=TRUE) |
      grepl("tiagabine", PRODNME, ignore.case=TRUE) |
      grepl("gabitril", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_tiagabine_2007 <- as.numeric(codes_NDCNUM_tiagabine_2007)


codes_NDCNUM_cannabidiol_2007 <- redbook_2007_data %>% 
  filter(
      grepl("epidiolex", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_cannabidiol_2007 <- as.numeric(codes_NDCNUM_cannabidiol_2007)


codes_NDCNUM_gabapentin_2007 <- redbook_2007_data %>% 
  filter(
      grepl("gabapentin", GENNME, ignore.case=TRUE) |
      grepl("gabapentin", THRDTDS, ignore.case=TRUE) |
      grepl("gabapentin", PRODNME, ignore.case=TRUE) |
      grepl("gralise", PRODNME, ignore.case=TRUE) |
      grepl("neurontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl(";", GENNME, ignore.case=TRUE) &
    !grepl("enacarbil", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_gabapentin_2007 <- as.numeric(codes_NDCNUM_gabapentin_2007)


codes_NDCNUM_fenfluramine_2007 <- redbook_2007_data %>% 
  filter(
      grepl("fenfluramine", GENNME, ignore.case=TRUE) |
      grepl("fenfluramine", THRDTDS, ignore.case=TRUE) |
      grepl("fenfluramine", PRODNME, ignore.case=TRUE) |
      grepl("fintepla", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("dex", GENNME, ignore.case=TRUE) &
    !grepl("dex", THRDTDS, ignore.case=TRUE) &
    !grepl("hydrochloride", GENNME, ignore.case=TRUE) &    
    !grepl("hydrochloride", THRDTDS, ignore.case=TRUE) &
    !grepl("pondimin", PRODNME, ignore.case=TRUE) &
    !grepl("redux", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_fenfluramine_2007 <- as.numeric(codes_NDCNUM_fenfluramine_2007)


codes_NDCNUM_methsuximide_2007 <- redbook_2007_data %>% 
  filter(
      grepl("methsuximide", GENNME, ignore.case=TRUE) |
      grepl("methsuximide", THRDTDS, ignore.case=TRUE) |
      grepl("methsuximide", PRODNME, ignore.case=TRUE) |
      grepl("celontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_methsuximide_2007 <- as.numeric(codes_NDCNUM_methsuximide_2007)


codes_NDCNUM_ASM_2007 <- c(
  codes_NDCNUM_phenobarbital_2007,
  codes_NDCNUM_phenytoin_2007,
  codes_NDCNUM_valproate_2007,
  codes_NDCNUM_carbamazepine_2007,
  codes_NDCNUM_oxcarbazepine_2007,
  codes_NDCNUM_rufinamide_2007,
  codes_NDCNUM_levetiracetam_2007,
  codes_NDCNUM_lamotrigine_2007,
  codes_NDCNUM_brivaracetam_2007,
  codes_NDCNUM_cenobamate_2007,
  codes_NDCNUM_clobazam_2007,
  codes_NDCNUM_eslicarbazepine_2007,
  codes_NDCNUM_ethosuximide_2007,
  codes_NDCNUM_lacosamide_2007,
  codes_NDCNUM_perampanel_2007,
  codes_NDCNUM_stiripentol_2007,
  codes_NDCNUM_topiramate_2007,
  codes_NDCNUM_vigabatrin_2007,
  codes_NDCNUM_zonisamide_2007,
  codes_NDCNUM_felbamate_2007,
  codes_NDCNUM_pregabalin_2007,
  codes_NDCNUM_tiagabine_2007,
  codes_NDCNUM_cannabidiol_2007,
  codes_NDCNUM_gabapentin_2007,
  codes_NDCNUM_fenfluramine_2007,
  codes_NDCNUM_methsuximide_2007
)




############################################2008############################################
codes_NDCNUM_phenobarbital_2008 <- redbook_2008_data %>% 
  filter(
      grepl("phenobarb", GENNME, ignore.case=TRUE) |
      grepl("phenobarb", THRDTDS, ignore.case=TRUE) |
      grepl("phenobarb", PRODNME, ignore.case=TRUE) |
      grepl("luminal", PRODNME, ignore.case=TRUE) |
      grepl("solfoton", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("/", GENNME, ignore.case=TRUE) &
    !grepl("/", PRODNME, ignore.case=TRUE) &
    !grepl("/", THRDTDS, ignore.case=TRUE) &
    !grepl("&", GENNME, ignore.case=TRUE) &
    !grepl("&", PRODNME, ignore.case=TRUE) &
    !grepl("&", THRDTDS, ignore.case=TRUE) &
    !grepl("-", GENNME, ignore.case=TRUE) &
    !grepl("-", PRODNME, ignore.case=TRUE) &
    !grepl("-", THRDTDS, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_phenobarbital_2008 <- as.numeric(codes_NDCNUM_phenobarbital_2008)


codes_NDCNUM_phenytoin_2008 <- redbook_2008_data %>% 
  filter(
      grepl("phenytoin", GENNME, ignore.case=TRUE) |
      grepl("phenytoin", THRDTDS, ignore.case=TRUE) |
      grepl("phenytoin", PRODNME, ignore.case=TRUE) |
      grepl("dilantin", PRODNME, ignore.case=TRUE) |
      grepl("phenytek", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_phenytoin_2008 <- as.numeric(codes_NDCNUM_phenytoin_2008)


codes_NDCNUM_valproate_2008 <- redbook_2008_data %>% 
  filter(
      grepl("valpro", GENNME, ignore.case=TRUE) |
      grepl("valpro", THRDTDS, ignore.case=TRUE) |
      grepl("valpro", PRODNME, ignore.case=TRUE) |
      grepl("depakene", PRODNME, ignore.case=TRUE) |
      grepl("depakote", PRODNME, ignore.case=TRUE) |
      grepl("depacon", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_valproate_2008 <- as.numeric(codes_NDCNUM_valproate_2008)


codes_NDCNUM_carbamazepine_2008 <- redbook_2008_data %>% 
  filter(
      grepl("carbamazepine", GENNME, ignore.case=TRUE) |
      grepl("carbamazepine", THRDTDS, ignore.case=TRUE) |
      grepl("carbamazepine", PRODNME, ignore.case=TRUE) |
      grepl("tegretol", PRODNME, ignore.case=TRUE) |
      grepl("carbatrol", PRODNME, ignore.case=TRUE) |
      grepl("epitol", PRODNME, ignore.case=TRUE) |
      grepl("equetro", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("atretol", PRODNME, ignore.case=TRUE)
    ) %>%   
  pull(NDCNUM)
codes_NDCNUM_carbamazepine_2008 <- as.numeric(codes_NDCNUM_carbamazepine_2008)


codes_NDCNUM_oxcarbazepine_2008 <- redbook_2008_data %>% 
  filter(
      grepl("oxcarbazepine", GENNME, ignore.case=TRUE) |
      grepl("oxcarbazepine", THRDTDS, ignore.case=TRUE) |
      grepl("oxcarbazepine", PRODNME, ignore.case=TRUE) |
      grepl("oxtellar", PRODNME, ignore.case=TRUE) |
      grepl("trileptal", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_oxcarbazepine_2008 <- as.numeric(codes_NDCNUM_oxcarbazepine_2008)


codes_NDCNUM_rufinamide_2008 <- redbook_2008_data %>% 
  filter(
      grepl("rufinamide", GENNME, ignore.case=TRUE) |
      grepl("rufinamide", THRDTDS, ignore.case=TRUE) |
      grepl("rufinamide", PRODNME, ignore.case=TRUE) |
      grepl("banzel", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_rufinamide_2008 <- as.numeric(codes_NDCNUM_rufinamide_2008)


codes_NDCNUM_levetiracetam_2008 <- redbook_2008_data %>% 
  filter(
      grepl("levetiracetam", GENNME, ignore.case=TRUE) |
      grepl("levetiracetam", THRDTDS, ignore.case=TRUE) |
      grepl("levetiracetam", PRODNME, ignore.case=TRUE) |
      grepl("elepsia", PRODNME, ignore.case=TRUE) |
      grepl("keppra", PRODNME, ignore.case=TRUE) |
      grepl("roweepra", PRODNME, ignore.case=TRUE) |
      grepl("spritam", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_levetiracetam_2008 <- as.numeric(codes_NDCNUM_levetiracetam_2008)


codes_NDCNUM_lamotrigine_2008 <- redbook_2008_data %>% 
  filter(
      grepl("lamotrigine", GENNME, ignore.case=TRUE) |
      grepl("lamotrigine", THRDTDS, ignore.case=TRUE) |
      grepl("lamotrigine", PRODNME, ignore.case=TRUE) |
      grepl("lamictal", PRODNME, ignore.case=TRUE) |
      grepl("subvenite", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_lamotrigine_2008 <- as.numeric(codes_NDCNUM_lamotrigine_2008)


codes_NDCNUM_brivaracetam_2008 <- redbook_2008_data %>% 
  filter(
      grepl("brivaracetam", GENNME, ignore.case=TRUE) |
      grepl("brivaracetam", THRDTDS, ignore.case=TRUE) |
      grepl("brivaracetam", PRODNME, ignore.case=TRUE) |
      grepl("briviact", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_brivaracetam_2008 <- as.numeric(codes_NDCNUM_brivaracetam_2008)


codes_NDCNUM_cenobamate_2008 <- redbook_2008_data %>% 
  filter(
      grepl("cenobamate", GENNME, ignore.case=TRUE) |
      grepl("cenobamate", THRDTDS, ignore.case=TRUE) |
      grepl("cenobamate", PRODNME, ignore.case=TRUE) |
      grepl("xcopri", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_cenobamate_2008 <- as.numeric(codes_NDCNUM_cenobamate_2008)


codes_NDCNUM_clobazam_2008 <- redbook_2008_data %>% 
  filter(
      grepl("clobazam", GENNME, ignore.case=TRUE) |
      grepl("clobazam", THRDTDS, ignore.case=TRUE) |
      grepl("clobazam", PRODNME, ignore.case=TRUE) |
      grepl("onfi", PRODNME, ignore.case=TRUE) |
      grepl("sympazan", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("HIV", GENNME, ignore.case=TRUE) &
    !grepl("pregnancy", GENNME, ignore.case=TRUE) &
    !grepl("denture", GENNME, ignore.case=TRUE) &
    !grepl("hyoscyamine", GENNME, ignore.case=TRUE) &
    !grepl("glucose", GENNME, ignore.case=TRUE) &
    !grepl("device", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_clobazam_2008 <- as.numeric(codes_NDCNUM_clobazam_2008)


codes_NDCNUM_eslicarbazepine_2008 <- redbook_2008_data %>% 
  filter(
      grepl("eslicarbazepine", GENNME, ignore.case=TRUE) |
      grepl("eslicarbazepine", THRDTDS, ignore.case=TRUE) |
      grepl("eslicarbazepine", PRODNME, ignore.case=TRUE) |
      grepl("aptiom", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_eslicarbazepine_2008 <- as.numeric(codes_NDCNUM_eslicarbazepine_2008)


codes_NDCNUM_ethosuximide_2008 <- redbook_2008_data %>% 
  filter(
      grepl("ethosuximide", GENNME, ignore.case=TRUE) |
      grepl("ethosuximide", THRDTDS, ignore.case=TRUE) |
      grepl("ethosuximide", PRODNME, ignore.case=TRUE) |
      grepl("zarontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_ethosuximide_2008 <- as.numeric(codes_NDCNUM_ethosuximide_2008)


codes_NDCNUM_lacosamide_2008 <- redbook_2008_data %>% 
  filter(
      grepl("lacosamide", GENNME, ignore.case=TRUE) |
      grepl("lacosamide", THRDTDS, ignore.case=TRUE) |
      grepl("lacosamide", PRODNME, ignore.case=TRUE) |
      grepl("vimpat", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_lacosamide_2008 <- as.numeric(codes_NDCNUM_lacosamide_2008)


codes_NDCNUM_perampanel_2008 <- redbook_2008_data %>% 
  filter(
      grepl("perampanel", GENNME, ignore.case=TRUE) |
      grepl("perampanel", THRDTDS, ignore.case=TRUE) |
      grepl("perampanel", PRODNME, ignore.case=TRUE) |
      grepl("fycompa", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_perampanel_2008 <- as.numeric(codes_NDCNUM_perampanel_2008)


codes_NDCNUM_stiripentol_2008 <- redbook_2008_data %>% 
  filter(
      grepl("stiripentol", GENNME, ignore.case=TRUE) |
      grepl("stiripentol", THRDTDS, ignore.case=TRUE) |
      grepl("stiripentol", PRODNME, ignore.case=TRUE) |
      grepl("diacomit", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_stiripentol_2008 <- as.numeric(codes_NDCNUM_stiripentol_2008)


codes_NDCNUM_topiramate_2008 <- redbook_2008_data %>% 
  filter(
      grepl("topiramate", GENNME, ignore.case=TRUE) |
      grepl("topiramate", THRDTDS, ignore.case=TRUE) |
      grepl("topiramate", PRODNME, ignore.case=TRUE) |
      grepl("eprontia", PRODNME, ignore.case=TRUE) |
      grepl("topamax", PRODNME, ignore.case=TRUE) |
      grepl("trokendi", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("/", GENNME, ignore.case=TRUE) &
    !grepl("/", PRODNME, ignore.case=TRUE) &
    !grepl("/", THRDTDS, ignore.case=TRUE) &
    !grepl("&", GENNME, ignore.case=TRUE) &
    !grepl("&", PRODNME, ignore.case=TRUE) &
    !grepl("&", THRDTDS, ignore.case=TRUE) &
    !grepl("-", GENNME, ignore.case=TRUE) &
    !grepl("-", PRODNME, ignore.case=TRUE) &
    !grepl("-", THRDTDS, ignore.case=TRUE) &
    !grepl("qudexy", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_topiramate_2008 <- as.numeric(codes_NDCNUM_topiramate_2008)


codes_NDCNUM_vigabatrin_2008 <- redbook_2008_data %>% 
  filter(
      grepl("vigabatrin", GENNME, ignore.case=TRUE) |
      grepl("vigabatrin", THRDTDS, ignore.case=TRUE) |
      grepl("vigabatrin", PRODNME, ignore.case=TRUE) |
      grepl("sabril", PRODNME, ignore.case=TRUE) |
      grepl("vigadrone", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_vigabatrin_2008 <- as.numeric(codes_NDCNUM_vigabatrin_2008)


codes_NDCNUM_zonisamide_2008 <- redbook_2008_data %>% 
  filter(
      grepl("zonisamide", GENNME, ignore.case=TRUE) |
      grepl("zonisamide", THRDTDS, ignore.case=TRUE) |
      grepl("zonisamide", PRODNME, ignore.case=TRUE) |
      grepl("zonegran", PRODNME, ignore.case=TRUE) |
      grepl("zonisade", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_zonisamide_2008 <- as.numeric(codes_NDCNUM_zonisamide_2008)


codes_NDCNUM_felbamate_2008 <- redbook_2008_data %>% 
  filter(
      grepl("felbamate", GENNME, ignore.case=TRUE) |
      grepl("felbamate", THRDTDS, ignore.case=TRUE) |
      grepl("felbamate", PRODNME, ignore.case=TRUE) |
      grepl("felbatol", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_felbamate_2008 <- as.numeric(codes_NDCNUM_felbamate_2008)


codes_NDCNUM_pregabalin_2008 <- redbook_2008_data %>% 
  filter(
      grepl("pregabalin", GENNME, ignore.case=TRUE) |
      grepl("pregabalin", THRDTDS, ignore.case=TRUE) |
      grepl("pregabalin", PRODNME, ignore.case=TRUE) |
      grepl("lyrica", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_pregabalin_2008 <- as.numeric(codes_NDCNUM_pregabalin_2008)


codes_NDCNUM_tiagabine_2008 <- redbook_2008_data %>% 
  filter(
      grepl("tiagabine", GENNME, ignore.case=TRUE) |
      grepl("tiagabine", THRDTDS, ignore.case=TRUE) |
      grepl("tiagabine", PRODNME, ignore.case=TRUE) |
      grepl("gabitril", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_tiagabine_2008 <- as.numeric(codes_NDCNUM_tiagabine_2008)


codes_NDCNUM_cannabidiol_2008 <- redbook_2008_data %>% 
  filter(
      grepl("epidiolex", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_cannabidiol_2008 <- as.numeric(codes_NDCNUM_cannabidiol_2008)


codes_NDCNUM_gabapentin_2008 <- redbook_2008_data %>% 
  filter(
      grepl("gabapentin", GENNME, ignore.case=TRUE) |
      grepl("gabapentin", THRDTDS, ignore.case=TRUE) |
      grepl("gabapentin", PRODNME, ignore.case=TRUE) |
      grepl("gralise", PRODNME, ignore.case=TRUE) |
      grepl("neurontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl(";", GENNME, ignore.case=TRUE) &
    !grepl("enacarbil", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_gabapentin_2008 <- as.numeric(codes_NDCNUM_gabapentin_2008)


codes_NDCNUM_fenfluramine_2008 <- redbook_2008_data %>% 
  filter(
      grepl("fenfluramine", GENNME, ignore.case=TRUE) |
      grepl("fenfluramine", THRDTDS, ignore.case=TRUE) |
      grepl("fenfluramine", PRODNME, ignore.case=TRUE) |
      grepl("fintepla", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("dex", GENNME, ignore.case=TRUE) &
    !grepl("dex", THRDTDS, ignore.case=TRUE) &
    !grepl("hydrochloride", GENNME, ignore.case=TRUE) &    
    !grepl("hydrochloride", THRDTDS, ignore.case=TRUE) &
    !grepl("pondimin", PRODNME, ignore.case=TRUE) &
    !grepl("redux", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_fenfluramine_2008 <- as.numeric(codes_NDCNUM_fenfluramine_2008)


codes_NDCNUM_methsuximide_2008 <- redbook_2008_data %>% 
  filter(
      grepl("methsuximide", GENNME, ignore.case=TRUE) |
      grepl("methsuximide", THRDTDS, ignore.case=TRUE) |
      grepl("methsuximide", PRODNME, ignore.case=TRUE) |
      grepl("celontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_methsuximide_2008 <- as.numeric(codes_NDCNUM_methsuximide_2008)


codes_NDCNUM_ASM_2008 <- c(
  codes_NDCNUM_phenobarbital_2008,
  codes_NDCNUM_phenytoin_2008,
  codes_NDCNUM_valproate_2008,
  codes_NDCNUM_carbamazepine_2008,
  codes_NDCNUM_oxcarbazepine_2008,
  codes_NDCNUM_rufinamide_2008,
  codes_NDCNUM_levetiracetam_2008,
  codes_NDCNUM_lamotrigine_2008,
  codes_NDCNUM_brivaracetam_2008,
  codes_NDCNUM_cenobamate_2008,
  codes_NDCNUM_clobazam_2008,
  codes_NDCNUM_eslicarbazepine_2008,
  codes_NDCNUM_ethosuximide_2008,
  codes_NDCNUM_lacosamide_2008,
  codes_NDCNUM_perampanel_2008,
  codes_NDCNUM_stiripentol_2008,
  codes_NDCNUM_topiramate_2008,
  codes_NDCNUM_vigabatrin_2008,
  codes_NDCNUM_zonisamide_2008,
  codes_NDCNUM_felbamate_2008,
  codes_NDCNUM_pregabalin_2008,
  codes_NDCNUM_tiagabine_2008,
  codes_NDCNUM_cannabidiol_2008,
  codes_NDCNUM_gabapentin_2008,
  codes_NDCNUM_fenfluramine_2008,
  codes_NDCNUM_methsuximide_2008
)




############################################2009############################################
codes_NDCNUM_phenobarbital_2009 <- redbook_2009_data %>% 
  filter(
      grepl("phenobarb", GENNME, ignore.case=TRUE) |
      grepl("phenobarb", THRDTDS, ignore.case=TRUE) |
      grepl("phenobarb", PRODNME, ignore.case=TRUE) |
      grepl("luminal", PRODNME, ignore.case=TRUE) |
      grepl("solfoton", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("/", GENNME, ignore.case=TRUE) &
    !grepl("/", PRODNME, ignore.case=TRUE) &
    !grepl("/", THRDTDS, ignore.case=TRUE) &
    !grepl("&", GENNME, ignore.case=TRUE) &
    !grepl("&", PRODNME, ignore.case=TRUE) &
    !grepl("&", THRDTDS, ignore.case=TRUE) &
    !grepl("-", GENNME, ignore.case=TRUE) &
    !grepl("-", PRODNME, ignore.case=TRUE) &
    !grepl("-", THRDTDS, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_phenobarbital_2009 <- as.numeric(codes_NDCNUM_phenobarbital_2009)


codes_NDCNUM_phenytoin_2009 <- redbook_2009_data %>% 
  filter(
      grepl("phenytoin", GENNME, ignore.case=TRUE) |
      grepl("phenytoin", THRDTDS, ignore.case=TRUE) |
      grepl("phenytoin", PRODNME, ignore.case=TRUE) |
      grepl("dilantin", PRODNME, ignore.case=TRUE) |
      grepl("phenytek", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_phenytoin_2009 <- as.numeric(codes_NDCNUM_phenytoin_2009)


codes_NDCNUM_valproate_2009 <- redbook_2009_data %>% 
  filter(
      grepl("valpro", GENNME, ignore.case=TRUE) |
      grepl("valpro", THRDTDS, ignore.case=TRUE) |
      grepl("valpro", PRODNME, ignore.case=TRUE) |
      grepl("depakene", PRODNME, ignore.case=TRUE) |
      grepl("depakote", PRODNME, ignore.case=TRUE) |
      grepl("depacon", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_valproate_2009 <- as.numeric(codes_NDCNUM_valproate_2009)


codes_NDCNUM_carbamazepine_2009 <- redbook_2009_data %>% 
  filter(
      grepl("carbamazepine", GENNME, ignore.case=TRUE) |
      grepl("carbamazepine", THRDTDS, ignore.case=TRUE) |
      grepl("carbamazepine", PRODNME, ignore.case=TRUE) |
      grepl("tegretol", PRODNME, ignore.case=TRUE) |
      grepl("carbatrol", PRODNME, ignore.case=TRUE) |
      grepl("epitol", PRODNME, ignore.case=TRUE) |
      grepl("equetro", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("atretol", PRODNME, ignore.case=TRUE)
    ) %>%   
  pull(NDCNUM)
codes_NDCNUM_carbamazepine_2009 <- as.numeric(codes_NDCNUM_carbamazepine_2009)


codes_NDCNUM_oxcarbazepine_2009 <- redbook_2009_data %>% 
  filter(
      grepl("oxcarbazepine", GENNME, ignore.case=TRUE) |
      grepl("oxcarbazepine", THRDTDS, ignore.case=TRUE) |
      grepl("oxcarbazepine", PRODNME, ignore.case=TRUE) |
      grepl("oxtellar", PRODNME, ignore.case=TRUE) |
      grepl("trileptal", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_oxcarbazepine_2009 <- as.numeric(codes_NDCNUM_oxcarbazepine_2009)


codes_NDCNUM_rufinamide_2009 <- redbook_2009_data %>% 
  filter(
      grepl("rufinamide", GENNME, ignore.case=TRUE) |
      grepl("rufinamide", THRDTDS, ignore.case=TRUE) |
      grepl("rufinamide", PRODNME, ignore.case=TRUE) |
      grepl("banzel", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_rufinamide_2009 <- as.numeric(codes_NDCNUM_rufinamide_2009)


codes_NDCNUM_levetiracetam_2009 <- redbook_2009_data %>% 
  filter(
      grepl("levetiracetam", GENNME, ignore.case=TRUE) |
      grepl("levetiracetam", THRDTDS, ignore.case=TRUE) |
      grepl("levetiracetam", PRODNME, ignore.case=TRUE) |
      grepl("elepsia", PRODNME, ignore.case=TRUE) |
      grepl("keppra", PRODNME, ignore.case=TRUE) |
      grepl("roweepra", PRODNME, ignore.case=TRUE) |
      grepl("spritam", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_levetiracetam_2009 <- as.numeric(codes_NDCNUM_levetiracetam_2009)


codes_NDCNUM_lamotrigine_2009 <- redbook_2009_data %>% 
  filter(
      grepl("lamotrigine", GENNME, ignore.case=TRUE) |
      grepl("lamotrigine", THRDTDS, ignore.case=TRUE) |
      grepl("lamotrigine", PRODNME, ignore.case=TRUE) |
      grepl("lamictal", PRODNME, ignore.case=TRUE) |
      grepl("subvenite", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_lamotrigine_2009 <- as.numeric(codes_NDCNUM_lamotrigine_2009)


codes_NDCNUM_brivaracetam_2009 <- redbook_2009_data %>% 
  filter(
      grepl("brivaracetam", GENNME, ignore.case=TRUE) |
      grepl("brivaracetam", THRDTDS, ignore.case=TRUE) |
      grepl("brivaracetam", PRODNME, ignore.case=TRUE) |
      grepl("briviact", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_brivaracetam_2009 <- as.numeric(codes_NDCNUM_brivaracetam_2009)


codes_NDCNUM_cenobamate_2009 <- redbook_2009_data %>% 
  filter(
      grepl("cenobamate", GENNME, ignore.case=TRUE) |
      grepl("cenobamate", THRDTDS, ignore.case=TRUE) |
      grepl("cenobamate", PRODNME, ignore.case=TRUE) |
      grepl("xcopri", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_cenobamate_2009 <- as.numeric(codes_NDCNUM_cenobamate_2009)


codes_NDCNUM_clobazam_2009 <- redbook_2009_data %>% 
  filter(
      grepl("clobazam", GENNME, ignore.case=TRUE) |
      grepl("clobazam", THRDTDS, ignore.case=TRUE) |
      grepl("clobazam", PRODNME, ignore.case=TRUE) |
      grepl("onfi", PRODNME, ignore.case=TRUE) |
      grepl("sympazan", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("HIV", GENNME, ignore.case=TRUE) &
    !grepl("pregnancy", GENNME, ignore.case=TRUE) &
    !grepl("denture", GENNME, ignore.case=TRUE) &
    !grepl("hyoscyamine", GENNME, ignore.case=TRUE) &
    !grepl("glucose", GENNME, ignore.case=TRUE) &
    !grepl("device", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_clobazam_2009 <- as.numeric(codes_NDCNUM_clobazam_2009)


codes_NDCNUM_eslicarbazepine_2009 <- redbook_2009_data %>% 
  filter(
      grepl("eslicarbazepine", GENNME, ignore.case=TRUE) |
      grepl("eslicarbazepine", THRDTDS, ignore.case=TRUE) |
      grepl("eslicarbazepine", PRODNME, ignore.case=TRUE) |
      grepl("aptiom", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_eslicarbazepine_2009 <- as.numeric(codes_NDCNUM_eslicarbazepine_2009)


codes_NDCNUM_ethosuximide_2009 <- redbook_2009_data %>% 
  filter(
      grepl("ethosuximide", GENNME, ignore.case=TRUE) |
      grepl("ethosuximide", THRDTDS, ignore.case=TRUE) |
      grepl("ethosuximide", PRODNME, ignore.case=TRUE) |
      grepl("zarontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_ethosuximide_2009 <- as.numeric(codes_NDCNUM_ethosuximide_2009)


codes_NDCNUM_lacosamide_2009 <- redbook_2009_data %>% 
  filter(
      grepl("lacosamide", GENNME, ignore.case=TRUE) |
      grepl("lacosamide", THRDTDS, ignore.case=TRUE) |
      grepl("lacosamide", PRODNME, ignore.case=TRUE) |
      grepl("vimpat", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_lacosamide_2009 <- as.numeric(codes_NDCNUM_lacosamide_2009)


codes_NDCNUM_perampanel_2009 <- redbook_2009_data %>% 
  filter(
      grepl("perampanel", GENNME, ignore.case=TRUE) |
      grepl("perampanel", THRDTDS, ignore.case=TRUE) |
      grepl("perampanel", PRODNME, ignore.case=TRUE) |
      grepl("fycompa", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_perampanel_2009 <- as.numeric(codes_NDCNUM_perampanel_2009)


codes_NDCNUM_stiripentol_2009 <- redbook_2009_data %>% 
  filter(
      grepl("stiripentol", GENNME, ignore.case=TRUE) |
      grepl("stiripentol", THRDTDS, ignore.case=TRUE) |
      grepl("stiripentol", PRODNME, ignore.case=TRUE) |
      grepl("diacomit", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_stiripentol_2009 <- as.numeric(codes_NDCNUM_stiripentol_2009)


codes_NDCNUM_topiramate_2009 <- redbook_2009_data %>% 
  filter(
      grepl("topiramate", GENNME, ignore.case=TRUE) |
      grepl("topiramate", THRDTDS, ignore.case=TRUE) |
      grepl("topiramate", PRODNME, ignore.case=TRUE) |
      grepl("eprontia", PRODNME, ignore.case=TRUE) |
      grepl("topamax", PRODNME, ignore.case=TRUE) |
      grepl("trokendi", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("/", GENNME, ignore.case=TRUE) &
    !grepl("/", PRODNME, ignore.case=TRUE) &
    !grepl("/", THRDTDS, ignore.case=TRUE) &
    !grepl("&", GENNME, ignore.case=TRUE) &
    !grepl("&", PRODNME, ignore.case=TRUE) &
    !grepl("&", THRDTDS, ignore.case=TRUE) &
    !grepl("-", GENNME, ignore.case=TRUE) &
    !grepl("-", PRODNME, ignore.case=TRUE) &
    !grepl("-", THRDTDS, ignore.case=TRUE) &
    !grepl("qudexy", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_topiramate_2009 <- as.numeric(codes_NDCNUM_topiramate_2009)


codes_NDCNUM_vigabatrin_2009 <- redbook_2009_data %>% 
  filter(
      grepl("vigabatrin", GENNME, ignore.case=TRUE) |
      grepl("vigabatrin", THRDTDS, ignore.case=TRUE) |
      grepl("vigabatrin", PRODNME, ignore.case=TRUE) |
      grepl("sabril", PRODNME, ignore.case=TRUE) |
      grepl("vigadrone", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_vigabatrin_2009 <- as.numeric(codes_NDCNUM_vigabatrin_2009)


codes_NDCNUM_zonisamide_2009 <- redbook_2009_data %>% 
  filter(
      grepl("zonisamide", GENNME, ignore.case=TRUE) |
      grepl("zonisamide", THRDTDS, ignore.case=TRUE) |
      grepl("zonisamide", PRODNME, ignore.case=TRUE) |
      grepl("zonegran", PRODNME, ignore.case=TRUE) |
      grepl("zonisade", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_zonisamide_2009 <- as.numeric(codes_NDCNUM_zonisamide_2009)


codes_NDCNUM_felbamate_2009 <- redbook_2009_data %>% 
  filter(
      grepl("felbamate", GENNME, ignore.case=TRUE) |
      grepl("felbamate", THRDTDS, ignore.case=TRUE) |
      grepl("felbamate", PRODNME, ignore.case=TRUE) |
      grepl("felbatol", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_felbamate_2009 <- as.numeric(codes_NDCNUM_felbamate_2009)


codes_NDCNUM_pregabalin_2009 <- redbook_2009_data %>% 
  filter(
      grepl("pregabalin", GENNME, ignore.case=TRUE) |
      grepl("pregabalin", THRDTDS, ignore.case=TRUE) |
      grepl("pregabalin", PRODNME, ignore.case=TRUE) |
      grepl("lyrica", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_pregabalin_2009 <- as.numeric(codes_NDCNUM_pregabalin_2009)


codes_NDCNUM_tiagabine_2009 <- redbook_2009_data %>% 
  filter(
      grepl("tiagabine", GENNME, ignore.case=TRUE) |
      grepl("tiagabine", THRDTDS, ignore.case=TRUE) |
      grepl("tiagabine", PRODNME, ignore.case=TRUE) |
      grepl("gabitril", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_tiagabine_2009 <- as.numeric(codes_NDCNUM_tiagabine_2009)


codes_NDCNUM_cannabidiol_2009 <- redbook_2009_data %>% 
  filter(
      grepl("epidiolex", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_cannabidiol_2009 <- as.numeric(codes_NDCNUM_cannabidiol_2009)


codes_NDCNUM_gabapentin_2009 <- redbook_2009_data %>% 
  filter(
      grepl("gabapentin", GENNME, ignore.case=TRUE) |
      grepl("gabapentin", THRDTDS, ignore.case=TRUE) |
      grepl("gabapentin", PRODNME, ignore.case=TRUE) |
      grepl("gralise", PRODNME, ignore.case=TRUE) |
      grepl("neurontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl(";", GENNME, ignore.case=TRUE) &
    !grepl("enacarbil", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_gabapentin_2009 <- as.numeric(codes_NDCNUM_gabapentin_2009)


codes_NDCNUM_fenfluramine_2009 <- redbook_2009_data %>% 
  filter(
      grepl("fenfluramine", GENNME, ignore.case=TRUE) |
      grepl("fenfluramine", THRDTDS, ignore.case=TRUE) |
      grepl("fenfluramine", PRODNME, ignore.case=TRUE) |
      grepl("fintepla", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("dex", GENNME, ignore.case=TRUE) &
    !grepl("dex", THRDTDS, ignore.case=TRUE) &
    !grepl("hydrochloride", GENNME, ignore.case=TRUE) &    
    !grepl("hydrochloride", THRDTDS, ignore.case=TRUE) &
    !grepl("pondimin", PRODNME, ignore.case=TRUE) &
    !grepl("redux", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_fenfluramine_2009 <- as.numeric(codes_NDCNUM_fenfluramine_2009)


codes_NDCNUM_methsuximide_2009 <- redbook_2009_data %>% 
  filter(
      grepl("methsuximide", GENNME, ignore.case=TRUE) |
      grepl("methsuximide", THRDTDS, ignore.case=TRUE) |
      grepl("methsuximide", PRODNME, ignore.case=TRUE) |
      grepl("celontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_methsuximide_2009 <- as.numeric(codes_NDCNUM_methsuximide_2009)


codes_NDCNUM_ASM_2009 <- c(
  codes_NDCNUM_phenobarbital_2009,
  codes_NDCNUM_phenytoin_2009,
  codes_NDCNUM_valproate_2009,
  codes_NDCNUM_carbamazepine_2009,
  codes_NDCNUM_oxcarbazepine_2009,
  codes_NDCNUM_rufinamide_2009,
  codes_NDCNUM_levetiracetam_2009,
  codes_NDCNUM_lamotrigine_2009,
  codes_NDCNUM_brivaracetam_2009,
  codes_NDCNUM_cenobamate_2009,
  codes_NDCNUM_clobazam_2009,
  codes_NDCNUM_eslicarbazepine_2009,
  codes_NDCNUM_ethosuximide_2009,
  codes_NDCNUM_lacosamide_2009,
  codes_NDCNUM_perampanel_2009,
  codes_NDCNUM_stiripentol_2009,
  codes_NDCNUM_topiramate_2009,
  codes_NDCNUM_vigabatrin_2009,
  codes_NDCNUM_zonisamide_2009,
  codes_NDCNUM_felbamate_2009,
  codes_NDCNUM_pregabalin_2009,
  codes_NDCNUM_tiagabine_2009,
  codes_NDCNUM_cannabidiol_2009,
  codes_NDCNUM_gabapentin_2009,
  codes_NDCNUM_fenfluramine_2009,
  codes_NDCNUM_methsuximide_2009
)




############################################2010############################################
codes_NDCNUM_phenobarbital_2010 <- redbook_2010_data %>% 
  filter(
      grepl("phenobarb", GENNME, ignore.case=TRUE) |
      grepl("phenobarb", THRDTDS, ignore.case=TRUE) |
      grepl("phenobarb", PRODNME, ignore.case=TRUE) |
      grepl("luminal", PRODNME, ignore.case=TRUE) |
      grepl("solfoton", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("/", GENNME, ignore.case=TRUE) &
    !grepl("/", PRODNME, ignore.case=TRUE) &
    !grepl("/", THRDTDS, ignore.case=TRUE) &
    !grepl("&", GENNME, ignore.case=TRUE) &
    !grepl("&", PRODNME, ignore.case=TRUE) &
    !grepl("&", THRDTDS, ignore.case=TRUE) &
    !grepl("-", GENNME, ignore.case=TRUE) &
    !grepl("-", PRODNME, ignore.case=TRUE) &
    !grepl("-", THRDTDS, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_phenobarbital_2010 <- as.numeric(codes_NDCNUM_phenobarbital_2010)


codes_NDCNUM_phenytoin_2010 <- redbook_2010_data %>% 
  filter(
      grepl("phenytoin", GENNME, ignore.case=TRUE) |
      grepl("phenytoin", THRDTDS, ignore.case=TRUE) |
      grepl("phenytoin", PRODNME, ignore.case=TRUE) |
      grepl("dilantin", PRODNME, ignore.case=TRUE) |
      grepl("phenytek", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_phenytoin_2010 <- as.numeric(codes_NDCNUM_phenytoin_2010)


codes_NDCNUM_valproate_2010 <- redbook_2010_data %>% 
  filter(
      grepl("valpro", GENNME, ignore.case=TRUE) |
      grepl("valpro", THRDTDS, ignore.case=TRUE) |
      grepl("valpro", PRODNME, ignore.case=TRUE) |
      grepl("depakene", PRODNME, ignore.case=TRUE) |
      grepl("depakote", PRODNME, ignore.case=TRUE) |
      grepl("depacon", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_valproate_2010 <- as.numeric(codes_NDCNUM_valproate_2010)


codes_NDCNUM_carbamazepine_2010 <- redbook_2010_data %>% 
  filter(
      grepl("carbamazepine", GENNME, ignore.case=TRUE) |
      grepl("carbamazepine", THRDTDS, ignore.case=TRUE) |
      grepl("carbamazepine", PRODNME, ignore.case=TRUE) |
      grepl("tegretol", PRODNME, ignore.case=TRUE) |
      grepl("carbatrol", PRODNME, ignore.case=TRUE) |
      grepl("epitol", PRODNME, ignore.case=TRUE) |
      grepl("equetro", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("atretol", PRODNME, ignore.case=TRUE)
    ) %>%   
  pull(NDCNUM)
codes_NDCNUM_carbamazepine_2010 <- as.numeric(codes_NDCNUM_carbamazepine_2010)


codes_NDCNUM_oxcarbazepine_2010 <- redbook_2010_data %>% 
  filter(
      grepl("oxcarbazepine", GENNME, ignore.case=TRUE) |
      grepl("oxcarbazepine", THRDTDS, ignore.case=TRUE) |
      grepl("oxcarbazepine", PRODNME, ignore.case=TRUE) |
      grepl("oxtellar", PRODNME, ignore.case=TRUE) |
      grepl("trileptal", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_oxcarbazepine_2010 <- as.numeric(codes_NDCNUM_oxcarbazepine_2010)


codes_NDCNUM_rufinamide_2010 <- redbook_2010_data %>% 
  filter(
      grepl("rufinamide", GENNME, ignore.case=TRUE) |
      grepl("rufinamide", THRDTDS, ignore.case=TRUE) |
      grepl("rufinamide", PRODNME, ignore.case=TRUE) |
      grepl("banzel", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_rufinamide_2010 <- as.numeric(codes_NDCNUM_rufinamide_2010)


codes_NDCNUM_levetiracetam_2010 <- redbook_2010_data %>% 
  filter(
      grepl("levetiracetam", GENNME, ignore.case=TRUE) |
      grepl("levetiracetam", THRDTDS, ignore.case=TRUE) |
      grepl("levetiracetam", PRODNME, ignore.case=TRUE) |
      grepl("elepsia", PRODNME, ignore.case=TRUE) |
      grepl("keppra", PRODNME, ignore.case=TRUE) |
      grepl("roweepra", PRODNME, ignore.case=TRUE) |
      grepl("spritam", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_levetiracetam_2010 <- as.numeric(codes_NDCNUM_levetiracetam_2010)


codes_NDCNUM_lamotrigine_2010 <- redbook_2010_data %>% 
  filter(
      grepl("lamotrigine", GENNME, ignore.case=TRUE) |
      grepl("lamotrigine", THRDTDS, ignore.case=TRUE) |
      grepl("lamotrigine", PRODNME, ignore.case=TRUE) |
      grepl("lamictal", PRODNME, ignore.case=TRUE) |
      grepl("subvenite", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_lamotrigine_2010 <- as.numeric(codes_NDCNUM_lamotrigine_2010)


codes_NDCNUM_brivaracetam_2010 <- redbook_2010_data %>% 
  filter(
      grepl("brivaracetam", GENNME, ignore.case=TRUE) |
      grepl("brivaracetam", THRDTDS, ignore.case=TRUE) |
      grepl("brivaracetam", PRODNME, ignore.case=TRUE) |
      grepl("briviact", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_brivaracetam_2010 <- as.numeric(codes_NDCNUM_brivaracetam_2010)


codes_NDCNUM_cenobamate_2010 <- redbook_2010_data %>% 
  filter(
      grepl("cenobamate", GENNME, ignore.case=TRUE) |
      grepl("cenobamate", THRDTDS, ignore.case=TRUE) |
      grepl("cenobamate", PRODNME, ignore.case=TRUE) |
      grepl("xcopri", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_cenobamate_2010 <- as.numeric(codes_NDCNUM_cenobamate_2010)


codes_NDCNUM_clobazam_2010 <- redbook_2010_data %>% 
  filter(
      grepl("clobazam", GENNME, ignore.case=TRUE) |
      grepl("clobazam", THRDTDS, ignore.case=TRUE) |
      grepl("clobazam", PRODNME, ignore.case=TRUE) |
      grepl("onfi", PRODNME, ignore.case=TRUE) |
      grepl("sympazan", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("HIV", GENNME, ignore.case=TRUE) &
    !grepl("pregnancy", GENNME, ignore.case=TRUE) &
    !grepl("denture", GENNME, ignore.case=TRUE) &
    !grepl("hyoscyamine", GENNME, ignore.case=TRUE) &
    !grepl("glucose", GENNME, ignore.case=TRUE) &
    !grepl("device", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_clobazam_2010 <- as.numeric(codes_NDCNUM_clobazam_2010)


codes_NDCNUM_eslicarbazepine_2010 <- redbook_2010_data %>% 
  filter(
      grepl("eslicarbazepine", GENNME, ignore.case=TRUE) |
      grepl("eslicarbazepine", THRDTDS, ignore.case=TRUE) |
      grepl("eslicarbazepine", PRODNME, ignore.case=TRUE) |
      grepl("aptiom", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_eslicarbazepine_2010 <- as.numeric(codes_NDCNUM_eslicarbazepine_2010)


codes_NDCNUM_ethosuximide_2010 <- redbook_2010_data %>% 
  filter(
      grepl("ethosuximide", GENNME, ignore.case=TRUE) |
      grepl("ethosuximide", THRDTDS, ignore.case=TRUE) |
      grepl("ethosuximide", PRODNME, ignore.case=TRUE) |
      grepl("zarontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_ethosuximide_2010 <- as.numeric(codes_NDCNUM_ethosuximide_2010)


codes_NDCNUM_lacosamide_2010 <- redbook_2010_data %>% 
  filter(
      grepl("lacosamide", GENNME, ignore.case=TRUE) |
      grepl("lacosamide", THRDTDS, ignore.case=TRUE) |
      grepl("lacosamide", PRODNME, ignore.case=TRUE) |
      grepl("vimpat", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_lacosamide_2010 <- as.numeric(codes_NDCNUM_lacosamide_2010)


codes_NDCNUM_perampanel_2010 <- redbook_2010_data %>% 
  filter(
      grepl("perampanel", GENNME, ignore.case=TRUE) |
      grepl("perampanel", THRDTDS, ignore.case=TRUE) |
      grepl("perampanel", PRODNME, ignore.case=TRUE) |
      grepl("fycompa", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_perampanel_2010 <- as.numeric(codes_NDCNUM_perampanel_2010)


codes_NDCNUM_stiripentol_2010 <- redbook_2010_data %>% 
  filter(
      grepl("stiripentol", GENNME, ignore.case=TRUE) |
      grepl("stiripentol", THRDTDS, ignore.case=TRUE) |
      grepl("stiripentol", PRODNME, ignore.case=TRUE) |
      grepl("diacomit", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_stiripentol_2010 <- as.numeric(codes_NDCNUM_stiripentol_2010)


codes_NDCNUM_topiramate_2010 <- redbook_2010_data %>% 
  filter(
      grepl("topiramate", GENNME, ignore.case=TRUE) |
      grepl("topiramate", THRDTDS, ignore.case=TRUE) |
      grepl("topiramate", PRODNME, ignore.case=TRUE) |
      grepl("eprontia", PRODNME, ignore.case=TRUE) |
      grepl("topamax", PRODNME, ignore.case=TRUE) |
      grepl("trokendi", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("/", GENNME, ignore.case=TRUE) &
    !grepl("/", PRODNME, ignore.case=TRUE) &
    !grepl("/", THRDTDS, ignore.case=TRUE) &
    !grepl("&", GENNME, ignore.case=TRUE) &
    !grepl("&", PRODNME, ignore.case=TRUE) &
    !grepl("&", THRDTDS, ignore.case=TRUE) &
    !grepl("-", GENNME, ignore.case=TRUE) &
    !grepl("-", PRODNME, ignore.case=TRUE) &
    !grepl("-", THRDTDS, ignore.case=TRUE) &
    !grepl("qudexy", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_topiramate_2010 <- as.numeric(codes_NDCNUM_topiramate_2010)


codes_NDCNUM_vigabatrin_2010 <- redbook_2010_data %>% 
  filter(
      grepl("vigabatrin", GENNME, ignore.case=TRUE) |
      grepl("vigabatrin", THRDTDS, ignore.case=TRUE) |
      grepl("vigabatrin", PRODNME, ignore.case=TRUE) |
      grepl("sabril", PRODNME, ignore.case=TRUE) |
      grepl("vigadrone", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_vigabatrin_2010 <- as.numeric(codes_NDCNUM_vigabatrin_2010)


codes_NDCNUM_zonisamide_2010 <- redbook_2010_data %>% 
  filter(
      grepl("zonisamide", GENNME, ignore.case=TRUE) |
      grepl("zonisamide", THRDTDS, ignore.case=TRUE) |
      grepl("zonisamide", PRODNME, ignore.case=TRUE) |
      grepl("zonegran", PRODNME, ignore.case=TRUE) |
      grepl("zonisade", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_zonisamide_2010 <- as.numeric(codes_NDCNUM_zonisamide_2010)


codes_NDCNUM_felbamate_2010 <- redbook_2010_data %>% 
  filter(
      grepl("felbamate", GENNME, ignore.case=TRUE) |
      grepl("felbamate", THRDTDS, ignore.case=TRUE) |
      grepl("felbamate", PRODNME, ignore.case=TRUE) |
      grepl("felbatol", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_felbamate_2010 <- as.numeric(codes_NDCNUM_felbamate_2010)


codes_NDCNUM_pregabalin_2010 <- redbook_2010_data %>% 
  filter(
      grepl("pregabalin", GENNME, ignore.case=TRUE) |
      grepl("pregabalin", THRDTDS, ignore.case=TRUE) |
      grepl("pregabalin", PRODNME, ignore.case=TRUE) |
      grepl("lyrica", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_pregabalin_2010 <- as.numeric(codes_NDCNUM_pregabalin_2010)


codes_NDCNUM_tiagabine_2010 <- redbook_2010_data %>% 
  filter(
      grepl("tiagabine", GENNME, ignore.case=TRUE) |
      grepl("tiagabine", THRDTDS, ignore.case=TRUE) |
      grepl("tiagabine", PRODNME, ignore.case=TRUE) |
      grepl("gabitril", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_tiagabine_2010 <- as.numeric(codes_NDCNUM_tiagabine_2010)


codes_NDCNUM_cannabidiol_2010 <- redbook_2010_data %>% 
  filter(
      grepl("epidiolex", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_cannabidiol_2010 <- as.numeric(codes_NDCNUM_cannabidiol_2010)


codes_NDCNUM_gabapentin_2010 <- redbook_2010_data %>% 
  filter(
      grepl("gabapentin", GENNME, ignore.case=TRUE) |
      grepl("gabapentin", THRDTDS, ignore.case=TRUE) |
      grepl("gabapentin", PRODNME, ignore.case=TRUE) |
      grepl("gralise", PRODNME, ignore.case=TRUE) |
      grepl("neurontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl(";", GENNME, ignore.case=TRUE) &
    !grepl("enacarbil", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_gabapentin_2010 <- as.numeric(codes_NDCNUM_gabapentin_2010)


codes_NDCNUM_fenfluramine_2010 <- redbook_2010_data %>% 
  filter(
      grepl("fenfluramine", GENNME, ignore.case=TRUE) |
      grepl("fenfluramine", THRDTDS, ignore.case=TRUE) |
      grepl("fenfluramine", PRODNME, ignore.case=TRUE) |
      grepl("fintepla", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("dex", GENNME, ignore.case=TRUE) &
    !grepl("dex", THRDTDS, ignore.case=TRUE) &
    !grepl("hydrochloride", GENNME, ignore.case=TRUE) &    
    !grepl("hydrochloride", THRDTDS, ignore.case=TRUE) &
    !grepl("pondimin", PRODNME, ignore.case=TRUE) &
    !grepl("redux", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_fenfluramine_2010 <- as.numeric(codes_NDCNUM_fenfluramine_2010)


codes_NDCNUM_methsuximide_2010 <- redbook_2010_data %>% 
  filter(
      grepl("methsuximide", GENNME, ignore.case=TRUE) |
      grepl("methsuximide", THRDTDS, ignore.case=TRUE) |
      grepl("methsuximide", PRODNME, ignore.case=TRUE) |
      grepl("celontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_methsuximide_2010 <- as.numeric(codes_NDCNUM_methsuximide_2010)


codes_NDCNUM_ASM_2010 <- c(
  codes_NDCNUM_phenobarbital_2010,
  codes_NDCNUM_phenytoin_2010,
  codes_NDCNUM_valproate_2010,
  codes_NDCNUM_carbamazepine_2010,
  codes_NDCNUM_oxcarbazepine_2010,
  codes_NDCNUM_rufinamide_2010,
  codes_NDCNUM_levetiracetam_2010,
  codes_NDCNUM_lamotrigine_2010,
  codes_NDCNUM_brivaracetam_2010,
  codes_NDCNUM_cenobamate_2010,
  codes_NDCNUM_clobazam_2010,
  codes_NDCNUM_eslicarbazepine_2010,
  codes_NDCNUM_ethosuximide_2010,
  codes_NDCNUM_lacosamide_2010,
  codes_NDCNUM_perampanel_2010,
  codes_NDCNUM_stiripentol_2010,
  codes_NDCNUM_topiramate_2010,
  codes_NDCNUM_vigabatrin_2010,
  codes_NDCNUM_zonisamide_2010,
  codes_NDCNUM_felbamate_2010,
  codes_NDCNUM_pregabalin_2010,
  codes_NDCNUM_tiagabine_2010,
  codes_NDCNUM_cannabidiol_2010,
  codes_NDCNUM_gabapentin_2010,
  codes_NDCNUM_fenfluramine_2010,
  codes_NDCNUM_methsuximide_2010
)




############################################2011############################################
codes_NDCNUM_phenobarbital_2011 <- redbook_2011_data %>% 
  filter(
      grepl("phenobarb", GENNME, ignore.case=TRUE) |
      grepl("phenobarb", THRDTDS, ignore.case=TRUE) |
      grepl("phenobarb", PRODNME, ignore.case=TRUE) |
      grepl("luminal", PRODNME, ignore.case=TRUE) |
      grepl("solfoton", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("/", GENNME, ignore.case=TRUE) &
    !grepl("/", PRODNME, ignore.case=TRUE) &
    !grepl("/", THRDTDS, ignore.case=TRUE) &
    !grepl("&", GENNME, ignore.case=TRUE) &
    !grepl("&", PRODNME, ignore.case=TRUE) &
    !grepl("&", THRDTDS, ignore.case=TRUE) &
    !grepl("-", GENNME, ignore.case=TRUE) &
    !grepl("-", PRODNME, ignore.case=TRUE) &
    !grepl("-", THRDTDS, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_phenobarbital_2011 <- as.numeric(codes_NDCNUM_phenobarbital_2011)


codes_NDCNUM_phenytoin_2011 <- redbook_2011_data %>% 
  filter(
      grepl("phenytoin", GENNME, ignore.case=TRUE) |
      grepl("phenytoin", THRDTDS, ignore.case=TRUE) |
      grepl("phenytoin", PRODNME, ignore.case=TRUE) |
      grepl("dilantin", PRODNME, ignore.case=TRUE) |
      grepl("phenytek", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_phenytoin_2011 <- as.numeric(codes_NDCNUM_phenytoin_2011)


codes_NDCNUM_valproate_2011 <- redbook_2011_data %>% 
  filter(
      grepl("valpro", GENNME, ignore.case=TRUE) |
      grepl("valpro", THRDTDS, ignore.case=TRUE) |
      grepl("valpro", PRODNME, ignore.case=TRUE) |
      grepl("depakene", PRODNME, ignore.case=TRUE) |
      grepl("depakote", PRODNME, ignore.case=TRUE) |
      grepl("depacon", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_valproate_2011 <- as.numeric(codes_NDCNUM_valproate_2011)


codes_NDCNUM_carbamazepine_2011 <- redbook_2011_data %>% 
  filter(
      grepl("carbamazepine", GENNME, ignore.case=TRUE) |
      grepl("carbamazepine", THRDTDS, ignore.case=TRUE) |
      grepl("carbamazepine", PRODNME, ignore.case=TRUE) |
      grepl("tegretol", PRODNME, ignore.case=TRUE) |
      grepl("carbatrol", PRODNME, ignore.case=TRUE) |
      grepl("epitol", PRODNME, ignore.case=TRUE) |
      grepl("equetro", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("atretol", PRODNME, ignore.case=TRUE)
    ) %>%   
  pull(NDCNUM)
codes_NDCNUM_carbamazepine_2011 <- as.numeric(codes_NDCNUM_carbamazepine_2011)


codes_NDCNUM_oxcarbazepine_2011 <- redbook_2011_data %>% 
  filter(
      grepl("oxcarbazepine", GENNME, ignore.case=TRUE) |
      grepl("oxcarbazepine", THRDTDS, ignore.case=TRUE) |
      grepl("oxcarbazepine", PRODNME, ignore.case=TRUE) |
      grepl("oxtellar", PRODNME, ignore.case=TRUE) |
      grepl("trileptal", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_oxcarbazepine_2011 <- as.numeric(codes_NDCNUM_oxcarbazepine_2011)


codes_NDCNUM_rufinamide_2011 <- redbook_2011_data %>% 
  filter(
      grepl("rufinamide", GENNME, ignore.case=TRUE) |
      grepl("rufinamide", THRDTDS, ignore.case=TRUE) |
      grepl("rufinamide", PRODNME, ignore.case=TRUE) |
      grepl("banzel", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_rufinamide_2011 <- as.numeric(codes_NDCNUM_rufinamide_2011)


codes_NDCNUM_levetiracetam_2011 <- redbook_2011_data %>% 
  filter(
      grepl("levetiracetam", GENNME, ignore.case=TRUE) |
      grepl("levetiracetam", THRDTDS, ignore.case=TRUE) |
      grepl("levetiracetam", PRODNME, ignore.case=TRUE) |
      grepl("elepsia", PRODNME, ignore.case=TRUE) |
      grepl("keppra", PRODNME, ignore.case=TRUE) |
      grepl("roweepra", PRODNME, ignore.case=TRUE) |
      grepl("spritam", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_levetiracetam_2011 <- as.numeric(codes_NDCNUM_levetiracetam_2011)


codes_NDCNUM_lamotrigine_2011 <- redbook_2011_data %>% 
  filter(
      grepl("lamotrigine", GENNME, ignore.case=TRUE) |
      grepl("lamotrigine", THRDTDS, ignore.case=TRUE) |
      grepl("lamotrigine", PRODNME, ignore.case=TRUE) |
      grepl("lamictal", PRODNME, ignore.case=TRUE) |
      grepl("subvenite", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_lamotrigine_2011 <- as.numeric(codes_NDCNUM_lamotrigine_2011)


codes_NDCNUM_brivaracetam_2011 <- redbook_2011_data %>% 
  filter(
      grepl("brivaracetam", GENNME, ignore.case=TRUE) |
      grepl("brivaracetam", THRDTDS, ignore.case=TRUE) |
      grepl("brivaracetam", PRODNME, ignore.case=TRUE) |
      grepl("briviact", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_brivaracetam_2011 <- as.numeric(codes_NDCNUM_brivaracetam_2011)


codes_NDCNUM_cenobamate_2011 <- redbook_2011_data %>% 
  filter(
      grepl("cenobamate", GENNME, ignore.case=TRUE) |
      grepl("cenobamate", THRDTDS, ignore.case=TRUE) |
      grepl("cenobamate", PRODNME, ignore.case=TRUE) |
      grepl("xcopri", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_cenobamate_2011 <- as.numeric(codes_NDCNUM_cenobamate_2011)


codes_NDCNUM_clobazam_2011 <- redbook_2011_data %>% 
  filter(
      grepl("clobazam", GENNME, ignore.case=TRUE) |
      grepl("clobazam", THRDTDS, ignore.case=TRUE) |
      grepl("clobazam", PRODNME, ignore.case=TRUE) |
      grepl("onfi", PRODNME, ignore.case=TRUE) |
      grepl("sympazan", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("HIV", GENNME, ignore.case=TRUE) &
    !grepl("pregnancy", GENNME, ignore.case=TRUE) &
    !grepl("denture", GENNME, ignore.case=TRUE) &
    !grepl("hyoscyamine", GENNME, ignore.case=TRUE) &
    !grepl("glucose", GENNME, ignore.case=TRUE) &
    !grepl("device", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_clobazam_2011 <- as.numeric(codes_NDCNUM_clobazam_2011)


codes_NDCNUM_eslicarbazepine_2011 <- redbook_2011_data %>% 
  filter(
      grepl("eslicarbazepine", GENNME, ignore.case=TRUE) |
      grepl("eslicarbazepine", THRDTDS, ignore.case=TRUE) |
      grepl("eslicarbazepine", PRODNME, ignore.case=TRUE) |
      grepl("aptiom", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_eslicarbazepine_2011 <- as.numeric(codes_NDCNUM_eslicarbazepine_2011)


codes_NDCNUM_ethosuximide_2011 <- redbook_2011_data %>% 
  filter(
      grepl("ethosuximide", GENNME, ignore.case=TRUE) |
      grepl("ethosuximide", THRDTDS, ignore.case=TRUE) |
      grepl("ethosuximide", PRODNME, ignore.case=TRUE) |
      grepl("zarontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_ethosuximide_2011 <- as.numeric(codes_NDCNUM_ethosuximide_2011)


codes_NDCNUM_lacosamide_2011 <- redbook_2011_data %>% 
  filter(
      grepl("lacosamide", GENNME, ignore.case=TRUE) |
      grepl("lacosamide", THRDTDS, ignore.case=TRUE) |
      grepl("lacosamide", PRODNME, ignore.case=TRUE) |
      grepl("vimpat", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_lacosamide_2011 <- as.numeric(codes_NDCNUM_lacosamide_2011)


codes_NDCNUM_perampanel_2011 <- redbook_2011_data %>% 
  filter(
      grepl("perampanel", GENNME, ignore.case=TRUE) |
      grepl("perampanel", THRDTDS, ignore.case=TRUE) |
      grepl("perampanel", PRODNME, ignore.case=TRUE) |
      grepl("fycompa", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_perampanel_2011 <- as.numeric(codes_NDCNUM_perampanel_2011)


codes_NDCNUM_stiripentol_2011 <- redbook_2011_data %>% 
  filter(
      grepl("stiripentol", GENNME, ignore.case=TRUE) |
      grepl("stiripentol", THRDTDS, ignore.case=TRUE) |
      grepl("stiripentol", PRODNME, ignore.case=TRUE) |
      grepl("diacomit", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_stiripentol_2011 <- as.numeric(codes_NDCNUM_stiripentol_2011)


codes_NDCNUM_topiramate_2011 <- redbook_2011_data %>% 
  filter(
      grepl("topiramate", GENNME, ignore.case=TRUE) |
      grepl("topiramate", THRDTDS, ignore.case=TRUE) |
      grepl("topiramate", PRODNME, ignore.case=TRUE) |
      grepl("eprontia", PRODNME, ignore.case=TRUE) |
      grepl("topamax", PRODNME, ignore.case=TRUE) |
      grepl("trokendi", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("/", GENNME, ignore.case=TRUE) &
    !grepl("/", PRODNME, ignore.case=TRUE) &
    !grepl("/", THRDTDS, ignore.case=TRUE) &
    !grepl("&", GENNME, ignore.case=TRUE) &
    !grepl("&", PRODNME, ignore.case=TRUE) &
    !grepl("&", THRDTDS, ignore.case=TRUE) &
    !grepl("-", GENNME, ignore.case=TRUE) &
    !grepl("-", PRODNME, ignore.case=TRUE) &
    !grepl("-", THRDTDS, ignore.case=TRUE) &
    !grepl("qudexy", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_topiramate_2011 <- as.numeric(codes_NDCNUM_topiramate_2011)


codes_NDCNUM_vigabatrin_2011 <- redbook_2011_data %>% 
  filter(
      grepl("vigabatrin", GENNME, ignore.case=TRUE) |
      grepl("vigabatrin", THRDTDS, ignore.case=TRUE) |
      grepl("vigabatrin", PRODNME, ignore.case=TRUE) |
      grepl("sabril", PRODNME, ignore.case=TRUE) |
      grepl("vigadrone", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_vigabatrin_2011 <- as.numeric(codes_NDCNUM_vigabatrin_2011)


codes_NDCNUM_zonisamide_2011 <- redbook_2011_data %>% 
  filter(
      grepl("zonisamide", GENNME, ignore.case=TRUE) |
      grepl("zonisamide", THRDTDS, ignore.case=TRUE) |
      grepl("zonisamide", PRODNME, ignore.case=TRUE) |
      grepl("zonegran", PRODNME, ignore.case=TRUE) |
      grepl("zonisade", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_zonisamide_2011 <- as.numeric(codes_NDCNUM_zonisamide_2011)


codes_NDCNUM_felbamate_2011 <- redbook_2011_data %>% 
  filter(
      grepl("felbamate", GENNME, ignore.case=TRUE) |
      grepl("felbamate", THRDTDS, ignore.case=TRUE) |
      grepl("felbamate", PRODNME, ignore.case=TRUE) |
      grepl("felbatol", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_felbamate_2011 <- as.numeric(codes_NDCNUM_felbamate_2011)


codes_NDCNUM_pregabalin_2011 <- redbook_2011_data %>% 
  filter(
      grepl("pregabalin", GENNME, ignore.case=TRUE) |
      grepl("pregabalin", THRDTDS, ignore.case=TRUE) |
      grepl("pregabalin", PRODNME, ignore.case=TRUE) |
      grepl("lyrica", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_pregabalin_2011 <- as.numeric(codes_NDCNUM_pregabalin_2011)


codes_NDCNUM_tiagabine_2011 <- redbook_2011_data %>% 
  filter(
      grepl("tiagabine", GENNME, ignore.case=TRUE) |
      grepl("tiagabine", THRDTDS, ignore.case=TRUE) |
      grepl("tiagabine", PRODNME, ignore.case=TRUE) |
      grepl("gabitril", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_tiagabine_2011 <- as.numeric(codes_NDCNUM_tiagabine_2011)


codes_NDCNUM_cannabidiol_2011 <- redbook_2011_data %>% 
  filter(
      grepl("epidiolex", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_cannabidiol_2011 <- as.numeric(codes_NDCNUM_cannabidiol_2011)


codes_NDCNUM_gabapentin_2011 <- redbook_2011_data %>% 
  filter(
      grepl("gabapentin", GENNME, ignore.case=TRUE) |
      grepl("gabapentin", THRDTDS, ignore.case=TRUE) |
      grepl("gabapentin", PRODNME, ignore.case=TRUE) |
      grepl("gralise", PRODNME, ignore.case=TRUE) |
      grepl("neurontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl(";", GENNME, ignore.case=TRUE) &
    !grepl("enacarbil", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_gabapentin_2011 <- as.numeric(codes_NDCNUM_gabapentin_2011)


codes_NDCNUM_fenfluramine_2011 <- redbook_2011_data %>% 
  filter(
      grepl("fenfluramine", GENNME, ignore.case=TRUE) |
      grepl("fenfluramine", THRDTDS, ignore.case=TRUE) |
      grepl("fenfluramine", PRODNME, ignore.case=TRUE) |
      grepl("fintepla", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("dex", GENNME, ignore.case=TRUE) &
    !grepl("dex", THRDTDS, ignore.case=TRUE) &
    !grepl("hydrochloride", GENNME, ignore.case=TRUE) &    
    !grepl("hydrochloride", THRDTDS, ignore.case=TRUE) &
    !grepl("pondimin", PRODNME, ignore.case=TRUE) &
    !grepl("redux", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_fenfluramine_2011 <- as.numeric(codes_NDCNUM_fenfluramine_2011)


codes_NDCNUM_methsuximide_2011 <- redbook_2011_data %>% 
  filter(
      grepl("methsuximide", GENNME, ignore.case=TRUE) |
      grepl("methsuximide", THRDTDS, ignore.case=TRUE) |
      grepl("methsuximide", PRODNME, ignore.case=TRUE) |
      grepl("celontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_methsuximide_2011 <- as.numeric(codes_NDCNUM_methsuximide_2011)


codes_NDCNUM_ASM_2011 <- c(
  codes_NDCNUM_phenobarbital_2011,
  codes_NDCNUM_phenytoin_2011,
  codes_NDCNUM_valproate_2011,
  codes_NDCNUM_carbamazepine_2011,
  codes_NDCNUM_oxcarbazepine_2011,
  codes_NDCNUM_rufinamide_2011,
  codes_NDCNUM_levetiracetam_2011,
  codes_NDCNUM_lamotrigine_2011,
  codes_NDCNUM_brivaracetam_2011,
  codes_NDCNUM_cenobamate_2011,
  codes_NDCNUM_clobazam_2011,
  codes_NDCNUM_eslicarbazepine_2011,
  codes_NDCNUM_ethosuximide_2011,
  codes_NDCNUM_lacosamide_2011,
  codes_NDCNUM_perampanel_2011,
  codes_NDCNUM_stiripentol_2011,
  codes_NDCNUM_topiramate_2011,
  codes_NDCNUM_vigabatrin_2011,
  codes_NDCNUM_zonisamide_2011,
  codes_NDCNUM_felbamate_2011,
  codes_NDCNUM_pregabalin_2011,
  codes_NDCNUM_tiagabine_2011,
  codes_NDCNUM_cannabidiol_2011,
  codes_NDCNUM_gabapentin_2011,
  codes_NDCNUM_fenfluramine_2011,
  codes_NDCNUM_methsuximide_2011
)




############################################2012############################################
codes_NDCNUM_phenobarbital_2012 <- redbook_2012_data %>% 
  filter(
      grepl("phenobarb", GENNME, ignore.case=TRUE) |
      grepl("phenobarb", THRDTDS, ignore.case=TRUE) |
      grepl("phenobarb", PRODNME, ignore.case=TRUE) |
      grepl("luminal", PRODNME, ignore.case=TRUE) |
      grepl("solfoton", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("/", GENNME, ignore.case=TRUE) &
    !grepl("/", PRODNME, ignore.case=TRUE) &
    !grepl("/", THRDTDS, ignore.case=TRUE) &
    !grepl("&", GENNME, ignore.case=TRUE) &
    !grepl("&", PRODNME, ignore.case=TRUE) &
    !grepl("&", THRDTDS, ignore.case=TRUE) &
    !grepl("-", GENNME, ignore.case=TRUE) &
    !grepl("-", PRODNME, ignore.case=TRUE) &
    !grepl("-", THRDTDS, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_phenobarbital_2012 <- as.numeric(codes_NDCNUM_phenobarbital_2012)


codes_NDCNUM_phenytoin_2012 <- redbook_2012_data %>% 
  filter(
      grepl("phenytoin", GENNME, ignore.case=TRUE) |
      grepl("phenytoin", THRDTDS, ignore.case=TRUE) |
      grepl("phenytoin", PRODNME, ignore.case=TRUE) |
      grepl("dilantin", PRODNME, ignore.case=TRUE) |
      grepl("phenytek", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_phenytoin_2012 <- as.numeric(codes_NDCNUM_phenytoin_2012)


codes_NDCNUM_valproate_2012 <- redbook_2012_data %>% 
  filter(
      grepl("valpro", GENNME, ignore.case=TRUE) |
      grepl("valpro", THRDTDS, ignore.case=TRUE) |
      grepl("valpro", PRODNME, ignore.case=TRUE) |
      grepl("depakene", PRODNME, ignore.case=TRUE) |
      grepl("depakote", PRODNME, ignore.case=TRUE) |
      grepl("depacon", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_valproate_2012 <- as.numeric(codes_NDCNUM_valproate_2012)


codes_NDCNUM_carbamazepine_2012 <- redbook_2012_data %>% 
  filter(
      grepl("carbamazepine", GENNME, ignore.case=TRUE) |
      grepl("carbamazepine", THRDTDS, ignore.case=TRUE) |
      grepl("carbamazepine", PRODNME, ignore.case=TRUE) |
      grepl("tegretol", PRODNME, ignore.case=TRUE) |
      grepl("carbatrol", PRODNME, ignore.case=TRUE) |
      grepl("epitol", PRODNME, ignore.case=TRUE) |
      grepl("equetro", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("atretol", PRODNME, ignore.case=TRUE)
    ) %>%   
  pull(NDCNUM)
codes_NDCNUM_carbamazepine_2012 <- as.numeric(codes_NDCNUM_carbamazepine_2012)


codes_NDCNUM_oxcarbazepine_2012 <- redbook_2012_data %>% 
  filter(
      grepl("oxcarbazepine", GENNME, ignore.case=TRUE) |
      grepl("oxcarbazepine", THRDTDS, ignore.case=TRUE) |
      grepl("oxcarbazepine", PRODNME, ignore.case=TRUE) |
      grepl("oxtellar", PRODNME, ignore.case=TRUE) |
      grepl("trileptal", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_oxcarbazepine_2012 <- as.numeric(codes_NDCNUM_oxcarbazepine_2012)


codes_NDCNUM_rufinamide_2012 <- redbook_2012_data %>% 
  filter(
      grepl("rufinamide", GENNME, ignore.case=TRUE) |
      grepl("rufinamide", THRDTDS, ignore.case=TRUE) |
      grepl("rufinamide", PRODNME, ignore.case=TRUE) |
      grepl("banzel", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_rufinamide_2012 <- as.numeric(codes_NDCNUM_rufinamide_2012)


codes_NDCNUM_levetiracetam_2012 <- redbook_2012_data %>% 
  filter(
      grepl("levetiracetam", GENNME, ignore.case=TRUE) |
      grepl("levetiracetam", THRDTDS, ignore.case=TRUE) |
      grepl("levetiracetam", PRODNME, ignore.case=TRUE) |
      grepl("elepsia", PRODNME, ignore.case=TRUE) |
      grepl("keppra", PRODNME, ignore.case=TRUE) |
      grepl("roweepra", PRODNME, ignore.case=TRUE) |
      grepl("spritam", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_levetiracetam_2012 <- as.numeric(codes_NDCNUM_levetiracetam_2012)


codes_NDCNUM_lamotrigine_2012 <- redbook_2012_data %>% 
  filter(
      grepl("lamotrigine", GENNME, ignore.case=TRUE) |
      grepl("lamotrigine", THRDTDS, ignore.case=TRUE) |
      grepl("lamotrigine", PRODNME, ignore.case=TRUE) |
      grepl("lamictal", PRODNME, ignore.case=TRUE) |
      grepl("subvenite", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_lamotrigine_2012 <- as.numeric(codes_NDCNUM_lamotrigine_2012)


codes_NDCNUM_brivaracetam_2012 <- redbook_2012_data %>% 
  filter(
      grepl("brivaracetam", GENNME, ignore.case=TRUE) |
      grepl("brivaracetam", THRDTDS, ignore.case=TRUE) |
      grepl("brivaracetam", PRODNME, ignore.case=TRUE) |
      grepl("briviact", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_brivaracetam_2012 <- as.numeric(codes_NDCNUM_brivaracetam_2012)


codes_NDCNUM_cenobamate_2012 <- redbook_2012_data %>% 
  filter(
      grepl("cenobamate", GENNME, ignore.case=TRUE) |
      grepl("cenobamate", THRDTDS, ignore.case=TRUE) |
      grepl("cenobamate", PRODNME, ignore.case=TRUE) |
      grepl("xcopri", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_cenobamate_2012 <- as.numeric(codes_NDCNUM_cenobamate_2012)


codes_NDCNUM_clobazam_2012 <- redbook_2012_data %>% 
  filter(
      grepl("clobazam", GENNME, ignore.case=TRUE) |
      grepl("clobazam", THRDTDS, ignore.case=TRUE) |
      grepl("clobazam", PRODNME, ignore.case=TRUE) |
      grepl("onfi", PRODNME, ignore.case=TRUE) |
      grepl("sympazan", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("HIV", GENNME, ignore.case=TRUE) &
    !grepl("pregnancy", GENNME, ignore.case=TRUE) &
    !grepl("denture", GENNME, ignore.case=TRUE) &
    !grepl("hyoscyamine", GENNME, ignore.case=TRUE) &
    !grepl("glucose", GENNME, ignore.case=TRUE) &
    !grepl("device", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_clobazam_2012 <- as.numeric(codes_NDCNUM_clobazam_2012)


codes_NDCNUM_eslicarbazepine_2012 <- redbook_2012_data %>% 
  filter(
      grepl("eslicarbazepine", GENNME, ignore.case=TRUE) |
      grepl("eslicarbazepine", THRDTDS, ignore.case=TRUE) |
      grepl("eslicarbazepine", PRODNME, ignore.case=TRUE) |
      grepl("aptiom", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_eslicarbazepine_2012 <- as.numeric(codes_NDCNUM_eslicarbazepine_2012)


codes_NDCNUM_ethosuximide_2012 <- redbook_2012_data %>% 
  filter(
      grepl("ethosuximide", GENNME, ignore.case=TRUE) |
      grepl("ethosuximide", THRDTDS, ignore.case=TRUE) |
      grepl("ethosuximide", PRODNME, ignore.case=TRUE) |
      grepl("zarontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_ethosuximide_2012 <- as.numeric(codes_NDCNUM_ethosuximide_2012)


codes_NDCNUM_lacosamide_2012 <- redbook_2012_data %>% 
  filter(
      grepl("lacosamide", GENNME, ignore.case=TRUE) |
      grepl("lacosamide", THRDTDS, ignore.case=TRUE) |
      grepl("lacosamide", PRODNME, ignore.case=TRUE) |
      grepl("vimpat", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_lacosamide_2012 <- as.numeric(codes_NDCNUM_lacosamide_2012)


codes_NDCNUM_perampanel_2012 <- redbook_2012_data %>% 
  filter(
      grepl("perampanel", GENNME, ignore.case=TRUE) |
      grepl("perampanel", THRDTDS, ignore.case=TRUE) |
      grepl("perampanel", PRODNME, ignore.case=TRUE) |
      grepl("fycompa", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_perampanel_2012 <- as.numeric(codes_NDCNUM_perampanel_2012)


codes_NDCNUM_stiripentol_2012 <- redbook_2012_data %>% 
  filter(
      grepl("stiripentol", GENNME, ignore.case=TRUE) |
      grepl("stiripentol", THRDTDS, ignore.case=TRUE) |
      grepl("stiripentol", PRODNME, ignore.case=TRUE) |
      grepl("diacomit", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_stiripentol_2012 <- as.numeric(codes_NDCNUM_stiripentol_2012)


codes_NDCNUM_topiramate_2012 <- redbook_2012_data %>% 
  filter(
      grepl("topiramate", GENNME, ignore.case=TRUE) |
      grepl("topiramate", THRDTDS, ignore.case=TRUE) |
      grepl("topiramate", PRODNME, ignore.case=TRUE) |
      grepl("eprontia", PRODNME, ignore.case=TRUE) |
      grepl("topamax", PRODNME, ignore.case=TRUE) |
      grepl("trokendi", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("/", GENNME, ignore.case=TRUE) &
    !grepl("/", PRODNME, ignore.case=TRUE) &
    !grepl("/", THRDTDS, ignore.case=TRUE) &
    !grepl("&", GENNME, ignore.case=TRUE) &
    !grepl("&", PRODNME, ignore.case=TRUE) &
    !grepl("&", THRDTDS, ignore.case=TRUE) &
    !grepl("-", GENNME, ignore.case=TRUE) &
    !grepl("-", PRODNME, ignore.case=TRUE) &
    !grepl("-", THRDTDS, ignore.case=TRUE) &
    !grepl("qudexy", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_topiramate_2012 <- as.numeric(codes_NDCNUM_topiramate_2012)


codes_NDCNUM_vigabatrin_2012 <- redbook_2012_data %>% 
  filter(
      grepl("vigabatrin", GENNME, ignore.case=TRUE) |
      grepl("vigabatrin", THRDTDS, ignore.case=TRUE) |
      grepl("vigabatrin", PRODNME, ignore.case=TRUE) |
      grepl("sabril", PRODNME, ignore.case=TRUE) |
      grepl("vigadrone", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_vigabatrin_2012 <- as.numeric(codes_NDCNUM_vigabatrin_2012)


codes_NDCNUM_zonisamide_2012 <- redbook_2012_data %>% 
  filter(
      grepl("zonisamide", GENNME, ignore.case=TRUE) |
      grepl("zonisamide", THRDTDS, ignore.case=TRUE) |
      grepl("zonisamide", PRODNME, ignore.case=TRUE) |
      grepl("zonegran", PRODNME, ignore.case=TRUE) |
      grepl("zonisade", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_zonisamide_2012 <- as.numeric(codes_NDCNUM_zonisamide_2012)


codes_NDCNUM_felbamate_2012 <- redbook_2012_data %>% 
  filter(
      grepl("felbamate", GENNME, ignore.case=TRUE) |
      grepl("felbamate", THRDTDS, ignore.case=TRUE) |
      grepl("felbamate", PRODNME, ignore.case=TRUE) |
      grepl("felbatol", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_felbamate_2012 <- as.numeric(codes_NDCNUM_felbamate_2012)


codes_NDCNUM_pregabalin_2012 <- redbook_2012_data %>% 
  filter(
      grepl("pregabalin", GENNME, ignore.case=TRUE) |
      grepl("pregabalin", THRDTDS, ignore.case=TRUE) |
      grepl("pregabalin", PRODNME, ignore.case=TRUE) |
      grepl("lyrica", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_pregabalin_2012 <- as.numeric(codes_NDCNUM_pregabalin_2012)


codes_NDCNUM_tiagabine_2012 <- redbook_2012_data %>% 
  filter(
      grepl("tiagabine", GENNME, ignore.case=TRUE) |
      grepl("tiagabine", THRDTDS, ignore.case=TRUE) |
      grepl("tiagabine", PRODNME, ignore.case=TRUE) |
      grepl("gabitril", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_tiagabine_2012 <- as.numeric(codes_NDCNUM_tiagabine_2012)


codes_NDCNUM_cannabidiol_2012 <- redbook_2012_data %>% 
  filter(
      grepl("epidiolex", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_cannabidiol_2012 <- as.numeric(codes_NDCNUM_cannabidiol_2012)


codes_NDCNUM_gabapentin_2012 <- redbook_2012_data %>% 
  filter(
      grepl("gabapentin", GENNME, ignore.case=TRUE) |
      grepl("gabapentin", THRDTDS, ignore.case=TRUE) |
      grepl("gabapentin", PRODNME, ignore.case=TRUE) |
      grepl("gralise", PRODNME, ignore.case=TRUE) |
      grepl("neurontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl(";", GENNME, ignore.case=TRUE) &
    !grepl("enacarbil", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_gabapentin_2012 <- as.numeric(codes_NDCNUM_gabapentin_2012)


codes_NDCNUM_fenfluramine_2012 <- redbook_2012_data %>% 
  filter(
      grepl("fenfluramine", GENNME, ignore.case=TRUE) |
      grepl("fenfluramine", THRDTDS, ignore.case=TRUE) |
      grepl("fenfluramine", PRODNME, ignore.case=TRUE) |
      grepl("fintepla", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("dex", GENNME, ignore.case=TRUE) &
    !grepl("dex", THRDTDS, ignore.case=TRUE) &
    !grepl("hydrochloride", GENNME, ignore.case=TRUE) &    
    !grepl("hydrochloride", THRDTDS, ignore.case=TRUE) &
    !grepl("pondimin", PRODNME, ignore.case=TRUE) &
    !grepl("redux", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_fenfluramine_2012 <- as.numeric(codes_NDCNUM_fenfluramine_2012)


codes_NDCNUM_methsuximide_2012 <- redbook_2012_data %>% 
  filter(
      grepl("methsuximide", GENNME, ignore.case=TRUE) |
      grepl("methsuximide", THRDTDS, ignore.case=TRUE) |
      grepl("methsuximide", PRODNME, ignore.case=TRUE) |
      grepl("celontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_methsuximide_2012 <- as.numeric(codes_NDCNUM_methsuximide_2012)


codes_NDCNUM_ASM_2012 <- c(
  codes_NDCNUM_phenobarbital_2012,
  codes_NDCNUM_phenytoin_2012,
  codes_NDCNUM_valproate_2012,
  codes_NDCNUM_carbamazepine_2012,
  codes_NDCNUM_oxcarbazepine_2012,
  codes_NDCNUM_rufinamide_2012,
  codes_NDCNUM_levetiracetam_2012,
  codes_NDCNUM_lamotrigine_2012,
  codes_NDCNUM_brivaracetam_2012,
  codes_NDCNUM_cenobamate_2012,
  codes_NDCNUM_clobazam_2012,
  codes_NDCNUM_eslicarbazepine_2012,
  codes_NDCNUM_ethosuximide_2012,
  codes_NDCNUM_lacosamide_2012,
  codes_NDCNUM_perampanel_2012,
  codes_NDCNUM_stiripentol_2012,
  codes_NDCNUM_topiramate_2012,
  codes_NDCNUM_vigabatrin_2012,
  codes_NDCNUM_zonisamide_2012,
  codes_NDCNUM_felbamate_2012,
  codes_NDCNUM_pregabalin_2012,
  codes_NDCNUM_tiagabine_2012,
  codes_NDCNUM_cannabidiol_2012,
  codes_NDCNUM_gabapentin_2012,
  codes_NDCNUM_fenfluramine_2012,
  codes_NDCNUM_methsuximide_2012
)




############################################2013############################################
codes_NDCNUM_phenobarbital_2013 <- redbook_2013_data %>% 
  filter(
      grepl("phenobarb", GENNME, ignore.case=TRUE) |
      grepl("phenobarb", THRDTDS, ignore.case=TRUE) |
      grepl("phenobarb", PRODNME, ignore.case=TRUE) |
      grepl("luminal", PRODNME, ignore.case=TRUE) |
      grepl("solfoton", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("/", GENNME, ignore.case=TRUE) &
    !grepl("/", PRODNME, ignore.case=TRUE) &
    !grepl("/", THRDTDS, ignore.case=TRUE) &
    !grepl("&", GENNME, ignore.case=TRUE) &
    !grepl("&", PRODNME, ignore.case=TRUE) &
    !grepl("&", THRDTDS, ignore.case=TRUE) &
    !grepl("-", GENNME, ignore.case=TRUE) &
    !grepl("-", PRODNME, ignore.case=TRUE) &
    !grepl("-", THRDTDS, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_phenobarbital_2013 <- as.numeric(codes_NDCNUM_phenobarbital_2013)


codes_NDCNUM_phenytoin_2013 <- redbook_2013_data %>% 
  filter(
      grepl("phenytoin", GENNME, ignore.case=TRUE) |
      grepl("phenytoin", THRDTDS, ignore.case=TRUE) |
      grepl("phenytoin", PRODNME, ignore.case=TRUE) |
      grepl("dilantin", PRODNME, ignore.case=TRUE) |
      grepl("phenytek", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_phenytoin_2013 <- as.numeric(codes_NDCNUM_phenytoin_2013)


codes_NDCNUM_valproate_2013 <- redbook_2013_data %>% 
  filter(
      grepl("valpro", GENNME, ignore.case=TRUE) |
      grepl("valpro", THRDTDS, ignore.case=TRUE) |
      grepl("valpro", PRODNME, ignore.case=TRUE) |
      grepl("depakene", PRODNME, ignore.case=TRUE) |
      grepl("depakote", PRODNME, ignore.case=TRUE) |
      grepl("depacon", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_valproate_2013 <- as.numeric(codes_NDCNUM_valproate_2013)


codes_NDCNUM_carbamazepine_2013 <- redbook_2013_data %>% 
  filter(
      grepl("carbamazepine", GENNME, ignore.case=TRUE) |
      grepl("carbamazepine", THRDTDS, ignore.case=TRUE) |
      grepl("carbamazepine", PRODNME, ignore.case=TRUE) |
      grepl("tegretol", PRODNME, ignore.case=TRUE) |
      grepl("carbatrol", PRODNME, ignore.case=TRUE) |
      grepl("epitol", PRODNME, ignore.case=TRUE) |
      grepl("equetro", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("atretol", PRODNME, ignore.case=TRUE)
    ) %>%   
  pull(NDCNUM)
codes_NDCNUM_carbamazepine_2013 <- as.numeric(codes_NDCNUM_carbamazepine_2013)


codes_NDCNUM_oxcarbazepine_2013 <- redbook_2013_data %>% 
  filter(
      grepl("oxcarbazepine", GENNME, ignore.case=TRUE) |
      grepl("oxcarbazepine", THRDTDS, ignore.case=TRUE) |
      grepl("oxcarbazepine", PRODNME, ignore.case=TRUE) |
      grepl("oxtellar", PRODNME, ignore.case=TRUE) |
      grepl("trileptal", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_oxcarbazepine_2013 <- as.numeric(codes_NDCNUM_oxcarbazepine_2013)


codes_NDCNUM_rufinamide_2013 <- redbook_2013_data %>% 
  filter(
      grepl("rufinamide", GENNME, ignore.case=TRUE) |
      grepl("rufinamide", THRDTDS, ignore.case=TRUE) |
      grepl("rufinamide", PRODNME, ignore.case=TRUE) |
      grepl("banzel", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_rufinamide_2013 <- as.numeric(codes_NDCNUM_rufinamide_2013)


codes_NDCNUM_levetiracetam_2013 <- redbook_2013_data %>% 
  filter(
      grepl("levetiracetam", GENNME, ignore.case=TRUE) |
      grepl("levetiracetam", THRDTDS, ignore.case=TRUE) |
      grepl("levetiracetam", PRODNME, ignore.case=TRUE) |
      grepl("elepsia", PRODNME, ignore.case=TRUE) |
      grepl("keppra", PRODNME, ignore.case=TRUE) |
      grepl("roweepra", PRODNME, ignore.case=TRUE) |
      grepl("spritam", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_levetiracetam_2013 <- as.numeric(codes_NDCNUM_levetiracetam_2013)


codes_NDCNUM_lamotrigine_2013 <- redbook_2013_data %>% 
  filter(
      grepl("lamotrigine", GENNME, ignore.case=TRUE) |
      grepl("lamotrigine", THRDTDS, ignore.case=TRUE) |
      grepl("lamotrigine", PRODNME, ignore.case=TRUE) |
      grepl("lamictal", PRODNME, ignore.case=TRUE) |
      grepl("subvenite", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_lamotrigine_2013 <- as.numeric(codes_NDCNUM_lamotrigine_2013)


codes_NDCNUM_brivaracetam_2013 <- redbook_2013_data %>% 
  filter(
      grepl("brivaracetam", GENNME, ignore.case=TRUE) |
      grepl("brivaracetam", THRDTDS, ignore.case=TRUE) |
      grepl("brivaracetam", PRODNME, ignore.case=TRUE) |
      grepl("briviact", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_brivaracetam_2013 <- as.numeric(codes_NDCNUM_brivaracetam_2013)


codes_NDCNUM_cenobamate_2013 <- redbook_2013_data %>% 
  filter(
      grepl("cenobamate", GENNME, ignore.case=TRUE) |
      grepl("cenobamate", THRDTDS, ignore.case=TRUE) |
      grepl("cenobamate", PRODNME, ignore.case=TRUE) |
      grepl("xcopri", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_cenobamate_2013 <- as.numeric(codes_NDCNUM_cenobamate_2013)


codes_NDCNUM_clobazam_2013 <- redbook_2013_data %>% 
  filter(
      grepl("clobazam", GENNME, ignore.case=TRUE) |
      grepl("clobazam", THRDTDS, ignore.case=TRUE) |
      grepl("clobazam", PRODNME, ignore.case=TRUE) |
      grepl("onfi", PRODNME, ignore.case=TRUE) |
      grepl("sympazan", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("HIV", GENNME, ignore.case=TRUE) &
    !grepl("pregnancy", GENNME, ignore.case=TRUE) &
    !grepl("denture", GENNME, ignore.case=TRUE) &
    !grepl("hyoscyamine", GENNME, ignore.case=TRUE) &
    !grepl("glucose", GENNME, ignore.case=TRUE) &
    !grepl("device", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_clobazam_2013 <- as.numeric(codes_NDCNUM_clobazam_2013)


codes_NDCNUM_eslicarbazepine_2013 <- redbook_2013_data %>% 
  filter(
      grepl("eslicarbazepine", GENNME, ignore.case=TRUE) |
      grepl("eslicarbazepine", THRDTDS, ignore.case=TRUE) |
      grepl("eslicarbazepine", PRODNME, ignore.case=TRUE) |
      grepl("aptiom", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_eslicarbazepine_2013 <- as.numeric(codes_NDCNUM_eslicarbazepine_2013)


codes_NDCNUM_ethosuximide_2013 <- redbook_2013_data %>% 
  filter(
      grepl("ethosuximide", GENNME, ignore.case=TRUE) |
      grepl("ethosuximide", THRDTDS, ignore.case=TRUE) |
      grepl("ethosuximide", PRODNME, ignore.case=TRUE) |
      grepl("zarontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_ethosuximide_2013 <- as.numeric(codes_NDCNUM_ethosuximide_2013)


codes_NDCNUM_lacosamide_2013 <- redbook_2013_data %>% 
  filter(
      grepl("lacosamide", GENNME, ignore.case=TRUE) |
      grepl("lacosamide", THRDTDS, ignore.case=TRUE) |
      grepl("lacosamide", PRODNME, ignore.case=TRUE) |
      grepl("vimpat", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_lacosamide_2013 <- as.numeric(codes_NDCNUM_lacosamide_2013)


codes_NDCNUM_perampanel_2013 <- redbook_2013_data %>% 
  filter(
      grepl("perampanel", GENNME, ignore.case=TRUE) |
      grepl("perampanel", THRDTDS, ignore.case=TRUE) |
      grepl("perampanel", PRODNME, ignore.case=TRUE) |
      grepl("fycompa", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_perampanel_2013 <- as.numeric(codes_NDCNUM_perampanel_2013)


codes_NDCNUM_stiripentol_2013 <- redbook_2013_data %>% 
  filter(
      grepl("stiripentol", GENNME, ignore.case=TRUE) |
      grepl("stiripentol", THRDTDS, ignore.case=TRUE) |
      grepl("stiripentol", PRODNME, ignore.case=TRUE) |
      grepl("diacomit", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_stiripentol_2013 <- as.numeric(codes_NDCNUM_stiripentol_2013)


codes_NDCNUM_topiramate_2013 <- redbook_2013_data %>% 
  filter(
      grepl("topiramate", GENNME, ignore.case=TRUE) |
      grepl("topiramate", THRDTDS, ignore.case=TRUE) |
      grepl("topiramate", PRODNME, ignore.case=TRUE) |
      grepl("eprontia", PRODNME, ignore.case=TRUE) |
      grepl("topamax", PRODNME, ignore.case=TRUE) |
      grepl("trokendi", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("/", GENNME, ignore.case=TRUE) &
    !grepl("/", PRODNME, ignore.case=TRUE) &
    !grepl("/", THRDTDS, ignore.case=TRUE) &
    !grepl("&", GENNME, ignore.case=TRUE) &
    !grepl("&", PRODNME, ignore.case=TRUE) &
    !grepl("&", THRDTDS, ignore.case=TRUE) &
    !grepl("-", GENNME, ignore.case=TRUE) &
    !grepl("-", PRODNME, ignore.case=TRUE) &
    !grepl("-", THRDTDS, ignore.case=TRUE) &
    !grepl("qudexy", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_topiramate_2013 <- as.numeric(codes_NDCNUM_topiramate_2013)


codes_NDCNUM_vigabatrin_2013 <- redbook_2013_data %>% 
  filter(
      grepl("vigabatrin", GENNME, ignore.case=TRUE) |
      grepl("vigabatrin", THRDTDS, ignore.case=TRUE) |
      grepl("vigabatrin", PRODNME, ignore.case=TRUE) |
      grepl("sabril", PRODNME, ignore.case=TRUE) |
      grepl("vigadrone", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_vigabatrin_2013 <- as.numeric(codes_NDCNUM_vigabatrin_2013)


codes_NDCNUM_zonisamide_2013 <- redbook_2013_data %>% 
  filter(
      grepl("zonisamide", GENNME, ignore.case=TRUE) |
      grepl("zonisamide", THRDTDS, ignore.case=TRUE) |
      grepl("zonisamide", PRODNME, ignore.case=TRUE) |
      grepl("zonegran", PRODNME, ignore.case=TRUE) |
      grepl("zonisade", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_zonisamide_2013 <- as.numeric(codes_NDCNUM_zonisamide_2013)


codes_NDCNUM_felbamate_2013 <- redbook_2013_data %>% 
  filter(
      grepl("felbamate", GENNME, ignore.case=TRUE) |
      grepl("felbamate", THRDTDS, ignore.case=TRUE) |
      grepl("felbamate", PRODNME, ignore.case=TRUE) |
      grepl("felbatol", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_felbamate_2013 <- as.numeric(codes_NDCNUM_felbamate_2013)


codes_NDCNUM_pregabalin_2013 <- redbook_2013_data %>% 
  filter(
      grepl("pregabalin", GENNME, ignore.case=TRUE) |
      grepl("pregabalin", THRDTDS, ignore.case=TRUE) |
      grepl("pregabalin", PRODNME, ignore.case=TRUE) |
      grepl("lyrica", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_pregabalin_2013 <- as.numeric(codes_NDCNUM_pregabalin_2013)


codes_NDCNUM_tiagabine_2013 <- redbook_2013_data %>% 
  filter(
      grepl("tiagabine", GENNME, ignore.case=TRUE) |
      grepl("tiagabine", THRDTDS, ignore.case=TRUE) |
      grepl("tiagabine", PRODNME, ignore.case=TRUE) |
      grepl("gabitril", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_tiagabine_2013 <- as.numeric(codes_NDCNUM_tiagabine_2013)


codes_NDCNUM_cannabidiol_2013 <- redbook_2013_data %>% 
  filter(
      grepl("epidiolex", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_cannabidiol_2013 <- as.numeric(codes_NDCNUM_cannabidiol_2013)


codes_NDCNUM_gabapentin_2013 <- redbook_2013_data %>% 
  filter(
      grepl("gabapentin", GENNME, ignore.case=TRUE) |
      grepl("gabapentin", THRDTDS, ignore.case=TRUE) |
      grepl("gabapentin", PRODNME, ignore.case=TRUE) |
      grepl("gralise", PRODNME, ignore.case=TRUE) |
      grepl("neurontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl(";", GENNME, ignore.case=TRUE) &
    !grepl("enacarbil", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_gabapentin_2013 <- as.numeric(codes_NDCNUM_gabapentin_2013)


codes_NDCNUM_fenfluramine_2013 <- redbook_2013_data %>% 
  filter(
      grepl("fenfluramine", GENNME, ignore.case=TRUE) |
      grepl("fenfluramine", THRDTDS, ignore.case=TRUE) |
      grepl("fenfluramine", PRODNME, ignore.case=TRUE) |
      grepl("fintepla", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("dex", GENNME, ignore.case=TRUE) &
    !grepl("dex", THRDTDS, ignore.case=TRUE) &
    !grepl("hydrochloride", GENNME, ignore.case=TRUE) &    
    !grepl("hydrochloride", THRDTDS, ignore.case=TRUE) &
    !grepl("pondimin", PRODNME, ignore.case=TRUE) &
    !grepl("redux", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_fenfluramine_2013 <- as.numeric(codes_NDCNUM_fenfluramine_2013)


codes_NDCNUM_methsuximide_2013 <- redbook_2013_data %>% 
  filter(
      grepl("methsuximide", GENNME, ignore.case=TRUE) |
      grepl("methsuximide", THRDTDS, ignore.case=TRUE) |
      grepl("methsuximide", PRODNME, ignore.case=TRUE) |
      grepl("celontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_methsuximide_2013 <- as.numeric(codes_NDCNUM_methsuximide_2013)


codes_NDCNUM_ASM_2013 <- c(
  codes_NDCNUM_phenobarbital_2013,
  codes_NDCNUM_phenytoin_2013,
  codes_NDCNUM_valproate_2013,
  codes_NDCNUM_carbamazepine_2013,
  codes_NDCNUM_oxcarbazepine_2013,
  codes_NDCNUM_rufinamide_2013,
  codes_NDCNUM_levetiracetam_2013,
  codes_NDCNUM_lamotrigine_2013,
  codes_NDCNUM_brivaracetam_2013,
  codes_NDCNUM_cenobamate_2013,
  codes_NDCNUM_clobazam_2013,
  codes_NDCNUM_eslicarbazepine_2013,
  codes_NDCNUM_ethosuximide_2013,
  codes_NDCNUM_lacosamide_2013,
  codes_NDCNUM_perampanel_2013,
  codes_NDCNUM_stiripentol_2013,
  codes_NDCNUM_topiramate_2013,
  codes_NDCNUM_vigabatrin_2013,
  codes_NDCNUM_zonisamide_2013,
  codes_NDCNUM_felbamate_2013,
  codes_NDCNUM_pregabalin_2013,
  codes_NDCNUM_tiagabine_2013,
  codes_NDCNUM_cannabidiol_2013,
  codes_NDCNUM_gabapentin_2013,
  codes_NDCNUM_fenfluramine_2013,
  codes_NDCNUM_methsuximide_2013
)




############################################2014############################################
codes_NDCNUM_phenobarbital_2014 <- redbook_2014_data %>% 
  filter(
      grepl("phenobarb", GENNME, ignore.case=TRUE) |
      grepl("phenobarb", THRDTDS, ignore.case=TRUE) |
      grepl("phenobarb", PRODNME, ignore.case=TRUE) |
      grepl("luminal", PRODNME, ignore.case=TRUE) |
      grepl("solfoton", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("/", GENNME, ignore.case=TRUE) &
    !grepl("/", PRODNME, ignore.case=TRUE) &
    !grepl("/", THRDTDS, ignore.case=TRUE) &
    !grepl("&", GENNME, ignore.case=TRUE) &
    !grepl("&", PRODNME, ignore.case=TRUE) &
    !grepl("&", THRDTDS, ignore.case=TRUE) &
    !grepl("-", GENNME, ignore.case=TRUE) &
    !grepl("-", PRODNME, ignore.case=TRUE) &
    !grepl("-", THRDTDS, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_phenobarbital_2014 <- as.numeric(codes_NDCNUM_phenobarbital_2014)


codes_NDCNUM_phenytoin_2014 <- redbook_2014_data %>% 
  filter(
      grepl("phenytoin", GENNME, ignore.case=TRUE) |
      grepl("phenytoin", THRDTDS, ignore.case=TRUE) |
      grepl("phenytoin", PRODNME, ignore.case=TRUE) |
      grepl("dilantin", PRODNME, ignore.case=TRUE) |
      grepl("phenytek", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_phenytoin_2014 <- as.numeric(codes_NDCNUM_phenytoin_2014)


codes_NDCNUM_valproate_2014 <- redbook_2014_data %>% 
  filter(
      grepl("valpro", GENNME, ignore.case=TRUE) |
      grepl("valpro", THRDTDS, ignore.case=TRUE) |
      grepl("valpro", PRODNME, ignore.case=TRUE) |
      grepl("depakene", PRODNME, ignore.case=TRUE) |
      grepl("depakote", PRODNME, ignore.case=TRUE) |
      grepl("depacon", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_valproate_2014 <- as.numeric(codes_NDCNUM_valproate_2014)


codes_NDCNUM_carbamazepine_2014 <- redbook_2014_data %>% 
  filter(
      grepl("carbamazepine", GENNME, ignore.case=TRUE) |
      grepl("carbamazepine", THRDTDS, ignore.case=TRUE) |
      grepl("carbamazepine", PRODNME, ignore.case=TRUE) |
      grepl("tegretol", PRODNME, ignore.case=TRUE) |
      grepl("carbatrol", PRODNME, ignore.case=TRUE) |
      grepl("epitol", PRODNME, ignore.case=TRUE) |
      grepl("equetro", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("atretol", PRODNME, ignore.case=TRUE)
    ) %>%   
  pull(NDCNUM)
codes_NDCNUM_carbamazepine_2014 <- as.numeric(codes_NDCNUM_carbamazepine_2014)


codes_NDCNUM_oxcarbazepine_2014 <- redbook_2014_data %>% 
  filter(
      grepl("oxcarbazepine", GENNME, ignore.case=TRUE) |
      grepl("oxcarbazepine", THRDTDS, ignore.case=TRUE) |
      grepl("oxcarbazepine", PRODNME, ignore.case=TRUE) |
      grepl("oxtellar", PRODNME, ignore.case=TRUE) |
      grepl("trileptal", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_oxcarbazepine_2014 <- as.numeric(codes_NDCNUM_oxcarbazepine_2014)


codes_NDCNUM_rufinamide_2014 <- redbook_2014_data %>% 
  filter(
      grepl("rufinamide", GENNME, ignore.case=TRUE) |
      grepl("rufinamide", THRDTDS, ignore.case=TRUE) |
      grepl("rufinamide", PRODNME, ignore.case=TRUE) |
      grepl("banzel", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_rufinamide_2014 <- as.numeric(codes_NDCNUM_rufinamide_2014)


codes_NDCNUM_levetiracetam_2014 <- redbook_2014_data %>% 
  filter(
      grepl("levetiracetam", GENNME, ignore.case=TRUE) |
      grepl("levetiracetam", THRDTDS, ignore.case=TRUE) |
      grepl("levetiracetam", PRODNME, ignore.case=TRUE) |
      grepl("elepsia", PRODNME, ignore.case=TRUE) |
      grepl("keppra", PRODNME, ignore.case=TRUE) |
      grepl("roweepra", PRODNME, ignore.case=TRUE) |
      grepl("spritam", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_levetiracetam_2014 <- as.numeric(codes_NDCNUM_levetiracetam_2014)


codes_NDCNUM_lamotrigine_2014 <- redbook_2014_data %>% 
  filter(
      grepl("lamotrigine", GENNME, ignore.case=TRUE) |
      grepl("lamotrigine", THRDTDS, ignore.case=TRUE) |
      grepl("lamotrigine", PRODNME, ignore.case=TRUE) |
      grepl("lamictal", PRODNME, ignore.case=TRUE) |
      grepl("subvenite", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_lamotrigine_2014 <- as.numeric(codes_NDCNUM_lamotrigine_2014)


codes_NDCNUM_brivaracetam_2014 <- redbook_2014_data %>% 
  filter(
      grepl("brivaracetam", GENNME, ignore.case=TRUE) |
      grepl("brivaracetam", THRDTDS, ignore.case=TRUE) |
      grepl("brivaracetam", PRODNME, ignore.case=TRUE) |
      grepl("briviact", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_brivaracetam_2014 <- as.numeric(codes_NDCNUM_brivaracetam_2014)


codes_NDCNUM_cenobamate_2014 <- redbook_2014_data %>% 
  filter(
      grepl("cenobamate", GENNME, ignore.case=TRUE) |
      grepl("cenobamate", THRDTDS, ignore.case=TRUE) |
      grepl("cenobamate", PRODNME, ignore.case=TRUE) |
      grepl("xcopri", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_cenobamate_2014 <- as.numeric(codes_NDCNUM_cenobamate_2014)


codes_NDCNUM_clobazam_2014 <- redbook_2014_data %>% 
  filter(
      grepl("clobazam", GENNME, ignore.case=TRUE) |
      grepl("clobazam", THRDTDS, ignore.case=TRUE) |
      grepl("clobazam", PRODNME, ignore.case=TRUE) |
      grepl("onfi", PRODNME, ignore.case=TRUE) |
      grepl("sympazan", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("HIV", GENNME, ignore.case=TRUE) &
    !grepl("pregnancy", GENNME, ignore.case=TRUE) &
    !grepl("denture", GENNME, ignore.case=TRUE) &
    !grepl("hyoscyamine", GENNME, ignore.case=TRUE) &
    !grepl("glucose", GENNME, ignore.case=TRUE) &
    !grepl("device", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_clobazam_2014 <- as.numeric(codes_NDCNUM_clobazam_2014)


codes_NDCNUM_eslicarbazepine_2014 <- redbook_2014_data %>% 
  filter(
      grepl("eslicarbazepine", GENNME, ignore.case=TRUE) |
      grepl("eslicarbazepine", THRDTDS, ignore.case=TRUE) |
      grepl("eslicarbazepine", PRODNME, ignore.case=TRUE) |
      grepl("aptiom", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_eslicarbazepine_2014 <- as.numeric(codes_NDCNUM_eslicarbazepine_2014)


codes_NDCNUM_ethosuximide_2014 <- redbook_2014_data %>% 
  filter(
      grepl("ethosuximide", GENNME, ignore.case=TRUE) |
      grepl("ethosuximide", THRDTDS, ignore.case=TRUE) |
      grepl("ethosuximide", PRODNME, ignore.case=TRUE) |
      grepl("zarontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_ethosuximide_2014 <- as.numeric(codes_NDCNUM_ethosuximide_2014)


codes_NDCNUM_lacosamide_2014 <- redbook_2014_data %>% 
  filter(
      grepl("lacosamide", GENNME, ignore.case=TRUE) |
      grepl("lacosamide", THRDTDS, ignore.case=TRUE) |
      grepl("lacosamide", PRODNME, ignore.case=TRUE) |
      grepl("vimpat", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_lacosamide_2014 <- as.numeric(codes_NDCNUM_lacosamide_2014)


codes_NDCNUM_perampanel_2014 <- redbook_2014_data %>% 
  filter(
      grepl("perampanel", GENNME, ignore.case=TRUE) |
      grepl("perampanel", THRDTDS, ignore.case=TRUE) |
      grepl("perampanel", PRODNME, ignore.case=TRUE) |
      grepl("fycompa", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_perampanel_2014 <- as.numeric(codes_NDCNUM_perampanel_2014)


codes_NDCNUM_stiripentol_2014 <- redbook_2014_data %>% 
  filter(
      grepl("stiripentol", GENNME, ignore.case=TRUE) |
      grepl("stiripentol", THRDTDS, ignore.case=TRUE) |
      grepl("stiripentol", PRODNME, ignore.case=TRUE) |
      grepl("diacomit", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_stiripentol_2014 <- as.numeric(codes_NDCNUM_stiripentol_2014)


codes_NDCNUM_topiramate_2014 <- redbook_2014_data %>% 
  filter(
      grepl("topiramate", GENNME, ignore.case=TRUE) |
      grepl("topiramate", THRDTDS, ignore.case=TRUE) |
      grepl("topiramate", PRODNME, ignore.case=TRUE) |
      grepl("eprontia", PRODNME, ignore.case=TRUE) |
      grepl("topamax", PRODNME, ignore.case=TRUE) |
      grepl("trokendi", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("/", GENNME, ignore.case=TRUE) &
    !grepl("/", PRODNME, ignore.case=TRUE) &
    !grepl("/", THRDTDS, ignore.case=TRUE) &
    !grepl("&", GENNME, ignore.case=TRUE) &
    !grepl("&", PRODNME, ignore.case=TRUE) &
    !grepl("&", THRDTDS, ignore.case=TRUE) &
    !grepl("-", GENNME, ignore.case=TRUE) &
    !grepl("-", PRODNME, ignore.case=TRUE) &
    !grepl("-", THRDTDS, ignore.case=TRUE) &
    !grepl("qudexy", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_topiramate_2014 <- as.numeric(codes_NDCNUM_topiramate_2014)


codes_NDCNUM_vigabatrin_2014 <- redbook_2014_data %>% 
  filter(
      grepl("vigabatrin", GENNME, ignore.case=TRUE) |
      grepl("vigabatrin", THRDTDS, ignore.case=TRUE) |
      grepl("vigabatrin", PRODNME, ignore.case=TRUE) |
      grepl("sabril", PRODNME, ignore.case=TRUE) |
      grepl("vigadrone", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_vigabatrin_2014 <- as.numeric(codes_NDCNUM_vigabatrin_2014)


codes_NDCNUM_zonisamide_2014 <- redbook_2014_data %>% 
  filter(
      grepl("zonisamide", GENNME, ignore.case=TRUE) |
      grepl("zonisamide", THRDTDS, ignore.case=TRUE) |
      grepl("zonisamide", PRODNME, ignore.case=TRUE) |
      grepl("zonegran", PRODNME, ignore.case=TRUE) |
      grepl("zonisade", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_zonisamide_2014 <- as.numeric(codes_NDCNUM_zonisamide_2014)


codes_NDCNUM_felbamate_2014 <- redbook_2014_data %>% 
  filter(
      grepl("felbamate", GENNME, ignore.case=TRUE) |
      grepl("felbamate", THRDTDS, ignore.case=TRUE) |
      grepl("felbamate", PRODNME, ignore.case=TRUE) |
      grepl("felbatol", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_felbamate_2014 <- as.numeric(codes_NDCNUM_felbamate_2014)


codes_NDCNUM_pregabalin_2014 <- redbook_2014_data %>% 
  filter(
      grepl("pregabalin", GENNME, ignore.case=TRUE) |
      grepl("pregabalin", THRDTDS, ignore.case=TRUE) |
      grepl("pregabalin", PRODNME, ignore.case=TRUE) |
      grepl("lyrica", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_pregabalin_2014 <- as.numeric(codes_NDCNUM_pregabalin_2014)


codes_NDCNUM_tiagabine_2014 <- redbook_2014_data %>% 
  filter(
      grepl("tiagabine", GENNME, ignore.case=TRUE) |
      grepl("tiagabine", THRDTDS, ignore.case=TRUE) |
      grepl("tiagabine", PRODNME, ignore.case=TRUE) |
      grepl("gabitril", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_tiagabine_2014 <- as.numeric(codes_NDCNUM_tiagabine_2014)


codes_NDCNUM_cannabidiol_2014 <- redbook_2014_data %>% 
  filter(
      grepl("epidiolex", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_cannabidiol_2014 <- as.numeric(codes_NDCNUM_cannabidiol_2014)


codes_NDCNUM_gabapentin_2014 <- redbook_2014_data %>% 
  filter(
      grepl("gabapentin", GENNME, ignore.case=TRUE) |
      grepl("gabapentin", THRDTDS, ignore.case=TRUE) |
      grepl("gabapentin", PRODNME, ignore.case=TRUE) |
      grepl("gralise", PRODNME, ignore.case=TRUE) |
      grepl("neurontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl(";", GENNME, ignore.case=TRUE) &
    !grepl("enacarbil", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_gabapentin_2014 <- as.numeric(codes_NDCNUM_gabapentin_2014)


codes_NDCNUM_fenfluramine_2014 <- redbook_2014_data %>% 
  filter(
      grepl("fenfluramine", GENNME, ignore.case=TRUE) |
      grepl("fenfluramine", THRDTDS, ignore.case=TRUE) |
      grepl("fenfluramine", PRODNME, ignore.case=TRUE) |
      grepl("fintepla", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("dex", GENNME, ignore.case=TRUE) &
    !grepl("dex", THRDTDS, ignore.case=TRUE) &
    !grepl("hydrochloride", GENNME, ignore.case=TRUE) &    
    !grepl("hydrochloride", THRDTDS, ignore.case=TRUE) &
    !grepl("pondimin", PRODNME, ignore.case=TRUE) &
    !grepl("redux", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_fenfluramine_2014 <- as.numeric(codes_NDCNUM_fenfluramine_2014)


codes_NDCNUM_methsuximide_2014 <- redbook_2014_data %>% 
  filter(
      grepl("methsuximide", GENNME, ignore.case=TRUE) |
      grepl("methsuximide", THRDTDS, ignore.case=TRUE) |
      grepl("methsuximide", PRODNME, ignore.case=TRUE) |
      grepl("celontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_methsuximide_2014 <- as.numeric(codes_NDCNUM_methsuximide_2014)


codes_NDCNUM_ASM_2014 <- c(
  codes_NDCNUM_phenobarbital_2014,
  codes_NDCNUM_phenytoin_2014,
  codes_NDCNUM_valproate_2014,
  codes_NDCNUM_carbamazepine_2014,
  codes_NDCNUM_oxcarbazepine_2014,
  codes_NDCNUM_rufinamide_2014,
  codes_NDCNUM_levetiracetam_2014,
  codes_NDCNUM_lamotrigine_2014,
  codes_NDCNUM_brivaracetam_2014,
  codes_NDCNUM_cenobamate_2014,
  codes_NDCNUM_clobazam_2014,
  codes_NDCNUM_eslicarbazepine_2014,
  codes_NDCNUM_ethosuximide_2014,
  codes_NDCNUM_lacosamide_2014,
  codes_NDCNUM_perampanel_2014,
  codes_NDCNUM_stiripentol_2014,
  codes_NDCNUM_topiramate_2014,
  codes_NDCNUM_vigabatrin_2014,
  codes_NDCNUM_zonisamide_2014,
  codes_NDCNUM_felbamate_2014,
  codes_NDCNUM_pregabalin_2014,
  codes_NDCNUM_tiagabine_2014,
  codes_NDCNUM_cannabidiol_2014,
  codes_NDCNUM_gabapentin_2014,
  codes_NDCNUM_fenfluramine_2014,
  codes_NDCNUM_methsuximide_2014
)




############################################2015############################################
codes_NDCNUM_phenobarbital_2015 <- redbook_2015_data %>% 
  filter(
      grepl("phenobarb", GENNME, ignore.case=TRUE) |
      grepl("phenobarb", THRDTDS, ignore.case=TRUE) |
      grepl("phenobarb", PRODNME, ignore.case=TRUE) |
      grepl("luminal", PRODNME, ignore.case=TRUE) |
      grepl("solfoton", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("/", GENNME, ignore.case=TRUE) &
    !grepl("/", PRODNME, ignore.case=TRUE) &
    !grepl("/", THRDTDS, ignore.case=TRUE) &
    !grepl("&", GENNME, ignore.case=TRUE) &
    !grepl("&", PRODNME, ignore.case=TRUE) &
    !grepl("&", THRDTDS, ignore.case=TRUE) &
    !grepl("-", GENNME, ignore.case=TRUE) &
    !grepl("-", PRODNME, ignore.case=TRUE) &
    !grepl("-", THRDTDS, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_phenobarbital_2015 <- as.numeric(codes_NDCNUM_phenobarbital_2015)


codes_NDCNUM_phenytoin_2015 <- redbook_2015_data %>% 
  filter(
      grepl("phenytoin", GENNME, ignore.case=TRUE) |
      grepl("phenytoin", THRDTDS, ignore.case=TRUE) |
      grepl("phenytoin", PRODNME, ignore.case=TRUE) |
      grepl("dilantin", PRODNME, ignore.case=TRUE) |
      grepl("phenytek", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_phenytoin_2015 <- as.numeric(codes_NDCNUM_phenytoin_2015)


codes_NDCNUM_valproate_2015 <- redbook_2015_data %>% 
  filter(
      grepl("valpro", GENNME, ignore.case=TRUE) |
      grepl("valpro", THRDTDS, ignore.case=TRUE) |
      grepl("valpro", PRODNME, ignore.case=TRUE) |
      grepl("depakene", PRODNME, ignore.case=TRUE) |
      grepl("depakote", PRODNME, ignore.case=TRUE) |
      grepl("depacon", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_valproate_2015 <- as.numeric(codes_NDCNUM_valproate_2015)


codes_NDCNUM_carbamazepine_2015 <- redbook_2015_data %>% 
  filter(
      grepl("carbamazepine", GENNME, ignore.case=TRUE) |
      grepl("carbamazepine", THRDTDS, ignore.case=TRUE) |
      grepl("carbamazepine", PRODNME, ignore.case=TRUE) |
      grepl("tegretol", PRODNME, ignore.case=TRUE) |
      grepl("carbatrol", PRODNME, ignore.case=TRUE) |
      grepl("epitol", PRODNME, ignore.case=TRUE) |
      grepl("equetro", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("atretol", PRODNME, ignore.case=TRUE)
    ) %>%   
  pull(NDCNUM)
codes_NDCNUM_carbamazepine_2015 <- as.numeric(codes_NDCNUM_carbamazepine_2015)


codes_NDCNUM_oxcarbazepine_2015 <- redbook_2015_data %>% 
  filter(
      grepl("oxcarbazepine", GENNME, ignore.case=TRUE) |
      grepl("oxcarbazepine", THRDTDS, ignore.case=TRUE) |
      grepl("oxcarbazepine", PRODNME, ignore.case=TRUE) |
      grepl("oxtellar", PRODNME, ignore.case=TRUE) |
      grepl("trileptal", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_oxcarbazepine_2015 <- as.numeric(codes_NDCNUM_oxcarbazepine_2015)


codes_NDCNUM_rufinamide_2015 <- redbook_2015_data %>% 
  filter(
      grepl("rufinamide", GENNME, ignore.case=TRUE) |
      grepl("rufinamide", THRDTDS, ignore.case=TRUE) |
      grepl("rufinamide", PRODNME, ignore.case=TRUE) |
      grepl("banzel", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_rufinamide_2015 <- as.numeric(codes_NDCNUM_rufinamide_2015)


codes_NDCNUM_levetiracetam_2015 <- redbook_2015_data %>% 
  filter(
      grepl("levetiracetam", GENNME, ignore.case=TRUE) |
      grepl("levetiracetam", THRDTDS, ignore.case=TRUE) |
      grepl("levetiracetam", PRODNME, ignore.case=TRUE) |
      grepl("elepsia", PRODNME, ignore.case=TRUE) |
      grepl("keppra", PRODNME, ignore.case=TRUE) |
      grepl("roweepra", PRODNME, ignore.case=TRUE) |
      grepl("spritam", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_levetiracetam_2015 <- as.numeric(codes_NDCNUM_levetiracetam_2015)


codes_NDCNUM_lamotrigine_2015 <- redbook_2015_data %>% 
  filter(
      grepl("lamotrigine", GENNME, ignore.case=TRUE) |
      grepl("lamotrigine", THRDTDS, ignore.case=TRUE) |
      grepl("lamotrigine", PRODNME, ignore.case=TRUE) |
      grepl("lamictal", PRODNME, ignore.case=TRUE) |
      grepl("subvenite", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_lamotrigine_2015 <- as.numeric(codes_NDCNUM_lamotrigine_2015)


codes_NDCNUM_brivaracetam_2015 <- redbook_2015_data %>% 
  filter(
      grepl("brivaracetam", GENNME, ignore.case=TRUE) |
      grepl("brivaracetam", THRDTDS, ignore.case=TRUE) |
      grepl("brivaracetam", PRODNME, ignore.case=TRUE) |
      grepl("briviact", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_brivaracetam_2015 <- as.numeric(codes_NDCNUM_brivaracetam_2015)


codes_NDCNUM_cenobamate_2015 <- redbook_2015_data %>% 
  filter(
      grepl("cenobamate", GENNME, ignore.case=TRUE) |
      grepl("cenobamate", THRDTDS, ignore.case=TRUE) |
      grepl("cenobamate", PRODNME, ignore.case=TRUE) |
      grepl("xcopri", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_cenobamate_2015 <- as.numeric(codes_NDCNUM_cenobamate_2015)


codes_NDCNUM_clobazam_2015 <- redbook_2015_data %>% 
  filter(
      grepl("clobazam", GENNME, ignore.case=TRUE) |
      grepl("clobazam", THRDTDS, ignore.case=TRUE) |
      grepl("clobazam", PRODNME, ignore.case=TRUE) |
      grepl("onfi", PRODNME, ignore.case=TRUE) |
      grepl("sympazan", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("HIV", GENNME, ignore.case=TRUE) &
    !grepl("pregnancy", GENNME, ignore.case=TRUE) &
    !grepl("denture", GENNME, ignore.case=TRUE) &
    !grepl("hyoscyamine", GENNME, ignore.case=TRUE) &
    !grepl("glucose", GENNME, ignore.case=TRUE) &
    !grepl("device", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_clobazam_2015 <- as.numeric(codes_NDCNUM_clobazam_2015)


codes_NDCNUM_eslicarbazepine_2015 <- redbook_2015_data %>% 
  filter(
      grepl("eslicarbazepine", GENNME, ignore.case=TRUE) |
      grepl("eslicarbazepine", THRDTDS, ignore.case=TRUE) |
      grepl("eslicarbazepine", PRODNME, ignore.case=TRUE) |
      grepl("aptiom", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_eslicarbazepine_2015 <- as.numeric(codes_NDCNUM_eslicarbazepine_2015)


codes_NDCNUM_ethosuximide_2015 <- redbook_2015_data %>% 
  filter(
      grepl("ethosuximide", GENNME, ignore.case=TRUE) |
      grepl("ethosuximide", THRDTDS, ignore.case=TRUE) |
      grepl("ethosuximide", PRODNME, ignore.case=TRUE) |
      grepl("zarontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_ethosuximide_2015 <- as.numeric(codes_NDCNUM_ethosuximide_2015)


codes_NDCNUM_lacosamide_2015 <- redbook_2015_data %>% 
  filter(
      grepl("lacosamide", GENNME, ignore.case=TRUE) |
      grepl("lacosamide", THRDTDS, ignore.case=TRUE) |
      grepl("lacosamide", PRODNME, ignore.case=TRUE) |
      grepl("vimpat", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_lacosamide_2015 <- as.numeric(codes_NDCNUM_lacosamide_2015)


codes_NDCNUM_perampanel_2015 <- redbook_2015_data %>% 
  filter(
      grepl("perampanel", GENNME, ignore.case=TRUE) |
      grepl("perampanel", THRDTDS, ignore.case=TRUE) |
      grepl("perampanel", PRODNME, ignore.case=TRUE) |
      grepl("fycompa", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_perampanel_2015 <- as.numeric(codes_NDCNUM_perampanel_2015)


codes_NDCNUM_stiripentol_2015 <- redbook_2015_data %>% 
  filter(
      grepl("stiripentol", GENNME, ignore.case=TRUE) |
      grepl("stiripentol", THRDTDS, ignore.case=TRUE) |
      grepl("stiripentol", PRODNME, ignore.case=TRUE) |
      grepl("diacomit", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_stiripentol_2015 <- as.numeric(codes_NDCNUM_stiripentol_2015)


codes_NDCNUM_topiramate_2015 <- redbook_2015_data %>% 
  filter(
      grepl("topiramate", GENNME, ignore.case=TRUE) |
      grepl("topiramate", THRDTDS, ignore.case=TRUE) |
      grepl("topiramate", PRODNME, ignore.case=TRUE) |
      grepl("eprontia", PRODNME, ignore.case=TRUE) |
      grepl("topamax", PRODNME, ignore.case=TRUE) |
      grepl("trokendi", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("/", GENNME, ignore.case=TRUE) &
    !grepl("/", PRODNME, ignore.case=TRUE) &
    !grepl("/", THRDTDS, ignore.case=TRUE) &
    !grepl("&", GENNME, ignore.case=TRUE) &
    !grepl("&", PRODNME, ignore.case=TRUE) &
    !grepl("&", THRDTDS, ignore.case=TRUE) &
    !grepl("-", GENNME, ignore.case=TRUE) &
    !grepl("-", PRODNME, ignore.case=TRUE) &
    !grepl("-", THRDTDS, ignore.case=TRUE) &
    !grepl("qudexy", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_topiramate_2015 <- as.numeric(codes_NDCNUM_topiramate_2015)


codes_NDCNUM_vigabatrin_2015 <- redbook_2015_data %>% 
  filter(
      grepl("vigabatrin", GENNME, ignore.case=TRUE) |
      grepl("vigabatrin", THRDTDS, ignore.case=TRUE) |
      grepl("vigabatrin", PRODNME, ignore.case=TRUE) |
      grepl("sabril", PRODNME, ignore.case=TRUE) |
      grepl("vigadrone", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_vigabatrin_2015 <- as.numeric(codes_NDCNUM_vigabatrin_2015)


codes_NDCNUM_zonisamide_2015 <- redbook_2015_data %>% 
  filter(
      grepl("zonisamide", GENNME, ignore.case=TRUE) |
      grepl("zonisamide", THRDTDS, ignore.case=TRUE) |
      grepl("zonisamide", PRODNME, ignore.case=TRUE) |
      grepl("zonegran", PRODNME, ignore.case=TRUE) |
      grepl("zonisade", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_zonisamide_2015 <- as.numeric(codes_NDCNUM_zonisamide_2015)


codes_NDCNUM_felbamate_2015 <- redbook_2015_data %>% 
  filter(
      grepl("felbamate", GENNME, ignore.case=TRUE) |
      grepl("felbamate", THRDTDS, ignore.case=TRUE) |
      grepl("felbamate", PRODNME, ignore.case=TRUE) |
      grepl("felbatol", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_felbamate_2015 <- as.numeric(codes_NDCNUM_felbamate_2015)


codes_NDCNUM_pregabalin_2015 <- redbook_2015_data %>% 
  filter(
      grepl("pregabalin", GENNME, ignore.case=TRUE) |
      grepl("pregabalin", THRDTDS, ignore.case=TRUE) |
      grepl("pregabalin", PRODNME, ignore.case=TRUE) |
      grepl("lyrica", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_pregabalin_2015 <- as.numeric(codes_NDCNUM_pregabalin_2015)


codes_NDCNUM_tiagabine_2015 <- redbook_2015_data %>% 
  filter(
      grepl("tiagabine", GENNME, ignore.case=TRUE) |
      grepl("tiagabine", THRDTDS, ignore.case=TRUE) |
      grepl("tiagabine", PRODNME, ignore.case=TRUE) |
      grepl("gabitril", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_tiagabine_2015 <- as.numeric(codes_NDCNUM_tiagabine_2015)


codes_NDCNUM_cannabidiol_2015 <- redbook_2015_data %>% 
  filter(
      grepl("epidiolex", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_cannabidiol_2015 <- as.numeric(codes_NDCNUM_cannabidiol_2015)


codes_NDCNUM_gabapentin_2015 <- redbook_2015_data %>% 
  filter(
      grepl("gabapentin", GENNME, ignore.case=TRUE) |
      grepl("gabapentin", THRDTDS, ignore.case=TRUE) |
      grepl("gabapentin", PRODNME, ignore.case=TRUE) |
      grepl("gralise", PRODNME, ignore.case=TRUE) |
      grepl("neurontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl(";", GENNME, ignore.case=TRUE) &
    !grepl("enacarbil", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_gabapentin_2015 <- as.numeric(codes_NDCNUM_gabapentin_2015)


codes_NDCNUM_fenfluramine_2015 <- redbook_2015_data %>% 
  filter(
      grepl("fenfluramine", GENNME, ignore.case=TRUE) |
      grepl("fenfluramine", THRDTDS, ignore.case=TRUE) |
      grepl("fenfluramine", PRODNME, ignore.case=TRUE) |
      grepl("fintepla", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("dex", GENNME, ignore.case=TRUE) &
    !grepl("dex", THRDTDS, ignore.case=TRUE) &
    !grepl("hydrochloride", GENNME, ignore.case=TRUE) &    
    !grepl("hydrochloride", THRDTDS, ignore.case=TRUE) &
    !grepl("pondimin", PRODNME, ignore.case=TRUE) &
    !grepl("redux", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_fenfluramine_2015 <- as.numeric(codes_NDCNUM_fenfluramine_2015)


codes_NDCNUM_methsuximide_2015 <- redbook_2015_data %>% 
  filter(
      grepl("methsuximide", GENNME, ignore.case=TRUE) |
      grepl("methsuximide", THRDTDS, ignore.case=TRUE) |
      grepl("methsuximide", PRODNME, ignore.case=TRUE) |
      grepl("celontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_methsuximide_2015 <- as.numeric(codes_NDCNUM_methsuximide_2015)


codes_NDCNUM_ASM_2015 <- c(
  codes_NDCNUM_phenobarbital_2015,
  codes_NDCNUM_phenytoin_2015,
  codes_NDCNUM_valproate_2015,
  codes_NDCNUM_carbamazepine_2015,
  codes_NDCNUM_oxcarbazepine_2015,
  codes_NDCNUM_rufinamide_2015,
  codes_NDCNUM_levetiracetam_2015,
  codes_NDCNUM_lamotrigine_2015,
  codes_NDCNUM_brivaracetam_2015,
  codes_NDCNUM_cenobamate_2015,
  codes_NDCNUM_clobazam_2015,
  codes_NDCNUM_eslicarbazepine_2015,
  codes_NDCNUM_ethosuximide_2015,
  codes_NDCNUM_lacosamide_2015,
  codes_NDCNUM_perampanel_2015,
  codes_NDCNUM_stiripentol_2015,
  codes_NDCNUM_topiramate_2015,
  codes_NDCNUM_vigabatrin_2015,
  codes_NDCNUM_zonisamide_2015,
  codes_NDCNUM_felbamate_2015,
  codes_NDCNUM_pregabalin_2015,
  codes_NDCNUM_tiagabine_2015,
  codes_NDCNUM_cannabidiol_2015,
  codes_NDCNUM_gabapentin_2015,
  codes_NDCNUM_fenfluramine_2015,
  codes_NDCNUM_methsuximide_2015
)




############################################2016############################################
codes_NDCNUM_phenobarbital_2016 <- redbook_2016_data %>% 
  filter(
      grepl("phenobarb", GENNME, ignore.case=TRUE) |
      grepl("phenobarb", THRDTDS, ignore.case=TRUE) |
      grepl("phenobarb", PRODNME, ignore.case=TRUE) |
      grepl("luminal", PRODNME, ignore.case=TRUE) |
      grepl("solfoton", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("/", GENNME, ignore.case=TRUE) &
    !grepl("/", PRODNME, ignore.case=TRUE) &
    !grepl("/", THRDTDS, ignore.case=TRUE) &
    !grepl("&", GENNME, ignore.case=TRUE) &
    !grepl("&", PRODNME, ignore.case=TRUE) &
    !grepl("&", THRDTDS, ignore.case=TRUE) &
    !grepl("-", GENNME, ignore.case=TRUE) &
    !grepl("-", PRODNME, ignore.case=TRUE) &
    !grepl("-", THRDTDS, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_phenobarbital_2016 <- as.numeric(codes_NDCNUM_phenobarbital_2016)


codes_NDCNUM_phenytoin_2016 <- redbook_2016_data %>% 
  filter(
      grepl("phenytoin", GENNME, ignore.case=TRUE) |
      grepl("phenytoin", THRDTDS, ignore.case=TRUE) |
      grepl("phenytoin", PRODNME, ignore.case=TRUE) |
      grepl("dilantin", PRODNME, ignore.case=TRUE) |
      grepl("phenytek", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_phenytoin_2016 <- as.numeric(codes_NDCNUM_phenytoin_2016)


codes_NDCNUM_valproate_2016 <- redbook_2016_data %>% 
  filter(
      grepl("valpro", GENNME, ignore.case=TRUE) |
      grepl("valpro", THRDTDS, ignore.case=TRUE) |
      grepl("valpro", PRODNME, ignore.case=TRUE) |
      grepl("depakene", PRODNME, ignore.case=TRUE) |
      grepl("depakote", PRODNME, ignore.case=TRUE) |
      grepl("depacon", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_valproate_2016 <- as.numeric(codes_NDCNUM_valproate_2016)


codes_NDCNUM_carbamazepine_2016 <- redbook_2016_data %>% 
  filter(
      grepl("carbamazepine", GENNME, ignore.case=TRUE) |
      grepl("carbamazepine", THRDTDS, ignore.case=TRUE) |
      grepl("carbamazepine", PRODNME, ignore.case=TRUE) |
      grepl("tegretol", PRODNME, ignore.case=TRUE) |
      grepl("carbatrol", PRODNME, ignore.case=TRUE) |
      grepl("epitol", PRODNME, ignore.case=TRUE) |
      grepl("equetro", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("atretol", PRODNME, ignore.case=TRUE)
    ) %>%   
  pull(NDCNUM)
codes_NDCNUM_carbamazepine_2016 <- as.numeric(codes_NDCNUM_carbamazepine_2016)


codes_NDCNUM_oxcarbazepine_2016 <- redbook_2016_data %>% 
  filter(
      grepl("oxcarbazepine", GENNME, ignore.case=TRUE) |
      grepl("oxcarbazepine", THRDTDS, ignore.case=TRUE) |
      grepl("oxcarbazepine", PRODNME, ignore.case=TRUE) |
      grepl("oxtellar", PRODNME, ignore.case=TRUE) |
      grepl("trileptal", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_oxcarbazepine_2016 <- as.numeric(codes_NDCNUM_oxcarbazepine_2016)


codes_NDCNUM_rufinamide_2016 <- redbook_2016_data %>% 
  filter(
      grepl("rufinamide", GENNME, ignore.case=TRUE) |
      grepl("rufinamide", THRDTDS, ignore.case=TRUE) |
      grepl("rufinamide", PRODNME, ignore.case=TRUE) |
      grepl("banzel", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_rufinamide_2016 <- as.numeric(codes_NDCNUM_rufinamide_2016)


codes_NDCNUM_levetiracetam_2016 <- redbook_2016_data %>% 
  filter(
      grepl("levetiracetam", GENNME, ignore.case=TRUE) |
      grepl("levetiracetam", THRDTDS, ignore.case=TRUE) |
      grepl("levetiracetam", PRODNME, ignore.case=TRUE) |
      grepl("elepsia", PRODNME, ignore.case=TRUE) |
      grepl("keppra", PRODNME, ignore.case=TRUE) |
      grepl("roweepra", PRODNME, ignore.case=TRUE) |
      grepl("spritam", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_levetiracetam_2016 <- as.numeric(codes_NDCNUM_levetiracetam_2016)


codes_NDCNUM_lamotrigine_2016 <- redbook_2016_data %>% 
  filter(
      grepl("lamotrigine", GENNME, ignore.case=TRUE) |
      grepl("lamotrigine", THRDTDS, ignore.case=TRUE) |
      grepl("lamotrigine", PRODNME, ignore.case=TRUE) |
      grepl("lamictal", PRODNME, ignore.case=TRUE) |
      grepl("subvenite", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_lamotrigine_2016 <- as.numeric(codes_NDCNUM_lamotrigine_2016)


codes_NDCNUM_brivaracetam_2016 <- redbook_2016_data %>% 
  filter(
      grepl("brivaracetam", GENNME, ignore.case=TRUE) |
      grepl("brivaracetam", THRDTDS, ignore.case=TRUE) |
      grepl("brivaracetam", PRODNME, ignore.case=TRUE) |
      grepl("briviact", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_brivaracetam_2016 <- as.numeric(codes_NDCNUM_brivaracetam_2016)


codes_NDCNUM_cenobamate_2016 <- redbook_2016_data %>% 
  filter(
      grepl("cenobamate", GENNME, ignore.case=TRUE) |
      grepl("cenobamate", THRDTDS, ignore.case=TRUE) |
      grepl("cenobamate", PRODNME, ignore.case=TRUE) |
      grepl("xcopri", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_cenobamate_2016 <- as.numeric(codes_NDCNUM_cenobamate_2016)


codes_NDCNUM_clobazam_2016 <- redbook_2016_data %>% 
  filter(
      grepl("clobazam", GENNME, ignore.case=TRUE) |
      grepl("clobazam", THRDTDS, ignore.case=TRUE) |
      grepl("clobazam", PRODNME, ignore.case=TRUE) |
      grepl("onfi", PRODNME, ignore.case=TRUE) |
      grepl("sympazan", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("HIV", GENNME, ignore.case=TRUE) &
    !grepl("pregnancy", GENNME, ignore.case=TRUE) &
    !grepl("denture", GENNME, ignore.case=TRUE) &
    !grepl("hyoscyamine", GENNME, ignore.case=TRUE) &
    !grepl("glucose", GENNME, ignore.case=TRUE) &
    !grepl("device", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_clobazam_2016 <- as.numeric(codes_NDCNUM_clobazam_2016)


codes_NDCNUM_eslicarbazepine_2016 <- redbook_2016_data %>% 
  filter(
      grepl("eslicarbazepine", GENNME, ignore.case=TRUE) |
      grepl("eslicarbazepine", THRDTDS, ignore.case=TRUE) |
      grepl("eslicarbazepine", PRODNME, ignore.case=TRUE) |
      grepl("aptiom", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_eslicarbazepine_2016 <- as.numeric(codes_NDCNUM_eslicarbazepine_2016)


codes_NDCNUM_ethosuximide_2016 <- redbook_2016_data %>% 
  filter(
      grepl("ethosuximide", GENNME, ignore.case=TRUE) |
      grepl("ethosuximide", THRDTDS, ignore.case=TRUE) |
      grepl("ethosuximide", PRODNME, ignore.case=TRUE) |
      grepl("zarontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_ethosuximide_2016 <- as.numeric(codes_NDCNUM_ethosuximide_2016)


codes_NDCNUM_lacosamide_2016 <- redbook_2016_data %>% 
  filter(
      grepl("lacosamide", GENNME, ignore.case=TRUE) |
      grepl("lacosamide", THRDTDS, ignore.case=TRUE) |
      grepl("lacosamide", PRODNME, ignore.case=TRUE) |
      grepl("vimpat", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_lacosamide_2016 <- as.numeric(codes_NDCNUM_lacosamide_2016)


codes_NDCNUM_perampanel_2016 <- redbook_2016_data %>% 
  filter(
      grepl("perampanel", GENNME, ignore.case=TRUE) |
      grepl("perampanel", THRDTDS, ignore.case=TRUE) |
      grepl("perampanel", PRODNME, ignore.case=TRUE) |
      grepl("fycompa", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_perampanel_2016 <- as.numeric(codes_NDCNUM_perampanel_2016)


codes_NDCNUM_stiripentol_2016 <- redbook_2016_data %>% 
  filter(
      grepl("stiripentol", GENNME, ignore.case=TRUE) |
      grepl("stiripentol", THRDTDS, ignore.case=TRUE) |
      grepl("stiripentol", PRODNME, ignore.case=TRUE) |
      grepl("diacomit", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_stiripentol_2016 <- as.numeric(codes_NDCNUM_stiripentol_2016)


codes_NDCNUM_topiramate_2016 <- redbook_2016_data %>% 
  filter(
      grepl("topiramate", GENNME, ignore.case=TRUE) |
      grepl("topiramate", THRDTDS, ignore.case=TRUE) |
      grepl("topiramate", PRODNME, ignore.case=TRUE) |
      grepl("eprontia", PRODNME, ignore.case=TRUE) |
      grepl("topamax", PRODNME, ignore.case=TRUE) |
      grepl("trokendi", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("/", GENNME, ignore.case=TRUE) &
    !grepl("/", PRODNME, ignore.case=TRUE) &
    !grepl("/", THRDTDS, ignore.case=TRUE) &
    !grepl("&", GENNME, ignore.case=TRUE) &
    !grepl("&", PRODNME, ignore.case=TRUE) &
    !grepl("&", THRDTDS, ignore.case=TRUE) &
    !grepl("-", GENNME, ignore.case=TRUE) &
    !grepl("-", PRODNME, ignore.case=TRUE) &
    !grepl("-", THRDTDS, ignore.case=TRUE) &
    !grepl("qudexy", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_topiramate_2016 <- as.numeric(codes_NDCNUM_topiramate_2016)


codes_NDCNUM_vigabatrin_2016 <- redbook_2016_data %>% 
  filter(
      grepl("vigabatrin", GENNME, ignore.case=TRUE) |
      grepl("vigabatrin", THRDTDS, ignore.case=TRUE) |
      grepl("vigabatrin", PRODNME, ignore.case=TRUE) |
      grepl("sabril", PRODNME, ignore.case=TRUE) |
      grepl("vigadrone", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_vigabatrin_2016 <- as.numeric(codes_NDCNUM_vigabatrin_2016)


codes_NDCNUM_zonisamide_2016 <- redbook_2016_data %>% 
  filter(
      grepl("zonisamide", GENNME, ignore.case=TRUE) |
      grepl("zonisamide", THRDTDS, ignore.case=TRUE) |
      grepl("zonisamide", PRODNME, ignore.case=TRUE) |
      grepl("zonegran", PRODNME, ignore.case=TRUE) |
      grepl("zonisade", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_zonisamide_2016 <- as.numeric(codes_NDCNUM_zonisamide_2016)


codes_NDCNUM_felbamate_2016 <- redbook_2016_data %>% 
  filter(
      grepl("felbamate", GENNME, ignore.case=TRUE) |
      grepl("felbamate", THRDTDS, ignore.case=TRUE) |
      grepl("felbamate", PRODNME, ignore.case=TRUE) |
      grepl("felbatol", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_felbamate_2016 <- as.numeric(codes_NDCNUM_felbamate_2016)


codes_NDCNUM_pregabalin_2016 <- redbook_2016_data %>% 
  filter(
      grepl("pregabalin", GENNME, ignore.case=TRUE) |
      grepl("pregabalin", THRDTDS, ignore.case=TRUE) |
      grepl("pregabalin", PRODNME, ignore.case=TRUE) |
      grepl("lyrica", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_pregabalin_2016 <- as.numeric(codes_NDCNUM_pregabalin_2016)


codes_NDCNUM_tiagabine_2016 <- redbook_2016_data %>% 
  filter(
      grepl("tiagabine", GENNME, ignore.case=TRUE) |
      grepl("tiagabine", THRDTDS, ignore.case=TRUE) |
      grepl("tiagabine", PRODNME, ignore.case=TRUE) |
      grepl("gabitril", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_tiagabine_2016 <- as.numeric(codes_NDCNUM_tiagabine_2016)


codes_NDCNUM_cannabidiol_2016 <- redbook_2016_data %>% 
  filter(
      grepl("epidiolex", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_cannabidiol_2016 <- as.numeric(codes_NDCNUM_cannabidiol_2016)


codes_NDCNUM_gabapentin_2016 <- redbook_2016_data %>% 
  filter(
      grepl("gabapentin", GENNME, ignore.case=TRUE) |
      grepl("gabapentin", THRDTDS, ignore.case=TRUE) |
      grepl("gabapentin", PRODNME, ignore.case=TRUE) |
      grepl("gralise", PRODNME, ignore.case=TRUE) |
      grepl("neurontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl(";", GENNME, ignore.case=TRUE) &
    !grepl("enacarbil", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_gabapentin_2016 <- as.numeric(codes_NDCNUM_gabapentin_2016)


codes_NDCNUM_fenfluramine_2016 <- redbook_2016_data %>% 
  filter(
      grepl("fenfluramine", GENNME, ignore.case=TRUE) |
      grepl("fenfluramine", THRDTDS, ignore.case=TRUE) |
      grepl("fenfluramine", PRODNME, ignore.case=TRUE) |
      grepl("fintepla", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("dex", GENNME, ignore.case=TRUE) &
    !grepl("dex", THRDTDS, ignore.case=TRUE) &
    !grepl("hydrochloride", GENNME, ignore.case=TRUE) &    
    !grepl("hydrochloride", THRDTDS, ignore.case=TRUE) &
    !grepl("pondimin", PRODNME, ignore.case=TRUE) &
    !grepl("redux", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_fenfluramine_2016 <- as.numeric(codes_NDCNUM_fenfluramine_2016)


codes_NDCNUM_methsuximide_2016 <- redbook_2016_data %>% 
  filter(
      grepl("methsuximide", GENNME, ignore.case=TRUE) |
      grepl("methsuximide", THRDTDS, ignore.case=TRUE) |
      grepl("methsuximide", PRODNME, ignore.case=TRUE) |
      grepl("celontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_methsuximide_2016 <- as.numeric(codes_NDCNUM_methsuximide_2016)


codes_NDCNUM_ASM_2016 <- c(
  codes_NDCNUM_phenobarbital_2016,
  codes_NDCNUM_phenytoin_2016,
  codes_NDCNUM_valproate_2016,
  codes_NDCNUM_carbamazepine_2016,
  codes_NDCNUM_oxcarbazepine_2016,
  codes_NDCNUM_rufinamide_2016,
  codes_NDCNUM_levetiracetam_2016,
  codes_NDCNUM_lamotrigine_2016,
  codes_NDCNUM_brivaracetam_2016,
  codes_NDCNUM_cenobamate_2016,
  codes_NDCNUM_clobazam_2016,
  codes_NDCNUM_eslicarbazepine_2016,
  codes_NDCNUM_ethosuximide_2016,
  codes_NDCNUM_lacosamide_2016,
  codes_NDCNUM_perampanel_2016,
  codes_NDCNUM_stiripentol_2016,
  codes_NDCNUM_topiramate_2016,
  codes_NDCNUM_vigabatrin_2016,
  codes_NDCNUM_zonisamide_2016,
  codes_NDCNUM_felbamate_2016,
  codes_NDCNUM_pregabalin_2016,
  codes_NDCNUM_tiagabine_2016,
  codes_NDCNUM_cannabidiol_2016,
  codes_NDCNUM_gabapentin_2016,
  codes_NDCNUM_fenfluramine_2016,
  codes_NDCNUM_methsuximide_2016
)




############################################2017############################################
codes_NDCNUM_phenobarbital_2017 <- redbook_2017_data %>% 
  filter(
      grepl("phenobarb", GENNME, ignore.case=TRUE) |
      grepl("phenobarb", THRDTDS, ignore.case=TRUE) |
      grepl("phenobarb", PRODNME, ignore.case=TRUE) |
      grepl("luminal", PRODNME, ignore.case=TRUE) |
      grepl("solfoton", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("/", GENNME, ignore.case=TRUE) &
    !grepl("/", PRODNME, ignore.case=TRUE) &
    !grepl("/", THRDTDS, ignore.case=TRUE) &
    !grepl("&", GENNME, ignore.case=TRUE) &
    !grepl("&", PRODNME, ignore.case=TRUE) &
    !grepl("&", THRDTDS, ignore.case=TRUE) &
    !grepl("-", GENNME, ignore.case=TRUE) &
    !grepl("-", PRODNME, ignore.case=TRUE) &
    !grepl("-", THRDTDS, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_phenobarbital_2017 <- as.numeric(codes_NDCNUM_phenobarbital_2017)


codes_NDCNUM_phenytoin_2017 <- redbook_2017_data %>% 
  filter(
      grepl("phenytoin", GENNME, ignore.case=TRUE) |
      grepl("phenytoin", THRDTDS, ignore.case=TRUE) |
      grepl("phenytoin", PRODNME, ignore.case=TRUE) |
      grepl("dilantin", PRODNME, ignore.case=TRUE) |
      grepl("phenytek", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_phenytoin_2017 <- as.numeric(codes_NDCNUM_phenytoin_2017)


codes_NDCNUM_valproate_2017 <- redbook_2017_data %>% 
  filter(
      grepl("valpro", GENNME, ignore.case=TRUE) |
      grepl("valpro", THRDTDS, ignore.case=TRUE) |
      grepl("valpro", PRODNME, ignore.case=TRUE) |
      grepl("depakene", PRODNME, ignore.case=TRUE) |
      grepl("depakote", PRODNME, ignore.case=TRUE) |
      grepl("depacon", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_valproate_2017 <- as.numeric(codes_NDCNUM_valproate_2017)


codes_NDCNUM_carbamazepine_2017 <- redbook_2017_data %>% 
  filter(
      grepl("carbamazepine", GENNME, ignore.case=TRUE) |
      grepl("carbamazepine", THRDTDS, ignore.case=TRUE) |
      grepl("carbamazepine", PRODNME, ignore.case=TRUE) |
      grepl("tegretol", PRODNME, ignore.case=TRUE) |
      grepl("carbatrol", PRODNME, ignore.case=TRUE) |
      grepl("epitol", PRODNME, ignore.case=TRUE) |
      grepl("equetro", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("atretol", PRODNME, ignore.case=TRUE)
    ) %>%   
  pull(NDCNUM)
codes_NDCNUM_carbamazepine_2017 <- as.numeric(codes_NDCNUM_carbamazepine_2017)


codes_NDCNUM_oxcarbazepine_2017 <- redbook_2017_data %>% 
  filter(
      grepl("oxcarbazepine", GENNME, ignore.case=TRUE) |
      grepl("oxcarbazepine", THRDTDS, ignore.case=TRUE) |
      grepl("oxcarbazepine", PRODNME, ignore.case=TRUE) |
      grepl("oxtellar", PRODNME, ignore.case=TRUE) |
      grepl("trileptal", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_oxcarbazepine_2017 <- as.numeric(codes_NDCNUM_oxcarbazepine_2017)


codes_NDCNUM_rufinamide_2017 <- redbook_2017_data %>% 
  filter(
      grepl("rufinamide", GENNME, ignore.case=TRUE) |
      grepl("rufinamide", THRDTDS, ignore.case=TRUE) |
      grepl("rufinamide", PRODNME, ignore.case=TRUE) |
      grepl("banzel", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_rufinamide_2017 <- as.numeric(codes_NDCNUM_rufinamide_2017)


codes_NDCNUM_levetiracetam_2017 <- redbook_2017_data %>% 
  filter(
      grepl("levetiracetam", GENNME, ignore.case=TRUE) |
      grepl("levetiracetam", THRDTDS, ignore.case=TRUE) |
      grepl("levetiracetam", PRODNME, ignore.case=TRUE) |
      grepl("elepsia", PRODNME, ignore.case=TRUE) |
      grepl("keppra", PRODNME, ignore.case=TRUE) |
      grepl("roweepra", PRODNME, ignore.case=TRUE) |
      grepl("spritam", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_levetiracetam_2017 <- as.numeric(codes_NDCNUM_levetiracetam_2017)


codes_NDCNUM_lamotrigine_2017 <- redbook_2017_data %>% 
  filter(
      grepl("lamotrigine", GENNME, ignore.case=TRUE) |
      grepl("lamotrigine", THRDTDS, ignore.case=TRUE) |
      grepl("lamotrigine", PRODNME, ignore.case=TRUE) |
      grepl("lamictal", PRODNME, ignore.case=TRUE) |
      grepl("subvenite", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_lamotrigine_2017 <- as.numeric(codes_NDCNUM_lamotrigine_2017)


codes_NDCNUM_brivaracetam_2017 <- redbook_2017_data %>% 
  filter(
      grepl("brivaracetam", GENNME, ignore.case=TRUE) |
      grepl("brivaracetam", THRDTDS, ignore.case=TRUE) |
      grepl("brivaracetam", PRODNME, ignore.case=TRUE) |
      grepl("briviact", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_brivaracetam_2017 <- as.numeric(codes_NDCNUM_brivaracetam_2017)


codes_NDCNUM_cenobamate_2017 <- redbook_2017_data %>% 
  filter(
      grepl("cenobamate", GENNME, ignore.case=TRUE) |
      grepl("cenobamate", THRDTDS, ignore.case=TRUE) |
      grepl("cenobamate", PRODNME, ignore.case=TRUE) |
      grepl("xcopri", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_cenobamate_2017 <- as.numeric(codes_NDCNUM_cenobamate_2017)


codes_NDCNUM_clobazam_2017 <- redbook_2017_data %>% 
  filter(
      grepl("clobazam", GENNME, ignore.case=TRUE) |
      grepl("clobazam", THRDTDS, ignore.case=TRUE) |
      grepl("clobazam", PRODNME, ignore.case=TRUE) |
      grepl("onfi", PRODNME, ignore.case=TRUE) |
      grepl("sympazan", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("HIV", GENNME, ignore.case=TRUE) &
    !grepl("pregnancy", GENNME, ignore.case=TRUE) &
    !grepl("denture", GENNME, ignore.case=TRUE) &
    !grepl("hyoscyamine", GENNME, ignore.case=TRUE) &
    !grepl("glucose", GENNME, ignore.case=TRUE) &
    !grepl("device", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_clobazam_2017 <- as.numeric(codes_NDCNUM_clobazam_2017)


codes_NDCNUM_eslicarbazepine_2017 <- redbook_2017_data %>% 
  filter(
      grepl("eslicarbazepine", GENNME, ignore.case=TRUE) |
      grepl("eslicarbazepine", THRDTDS, ignore.case=TRUE) |
      grepl("eslicarbazepine", PRODNME, ignore.case=TRUE) |
      grepl("aptiom", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_eslicarbazepine_2017 <- as.numeric(codes_NDCNUM_eslicarbazepine_2017)


codes_NDCNUM_ethosuximide_2017 <- redbook_2017_data %>% 
  filter(
      grepl("ethosuximide", GENNME, ignore.case=TRUE) |
      grepl("ethosuximide", THRDTDS, ignore.case=TRUE) |
      grepl("ethosuximide", PRODNME, ignore.case=TRUE) |
      grepl("zarontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_ethosuximide_2017 <- as.numeric(codes_NDCNUM_ethosuximide_2017)


codes_NDCNUM_lacosamide_2017 <- redbook_2017_data %>% 
  filter(
      grepl("lacosamide", GENNME, ignore.case=TRUE) |
      grepl("lacosamide", THRDTDS, ignore.case=TRUE) |
      grepl("lacosamide", PRODNME, ignore.case=TRUE) |
      grepl("vimpat", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_lacosamide_2017 <- as.numeric(codes_NDCNUM_lacosamide_2017)


codes_NDCNUM_perampanel_2017 <- redbook_2017_data %>% 
  filter(
      grepl("perampanel", GENNME, ignore.case=TRUE) |
      grepl("perampanel", THRDTDS, ignore.case=TRUE) |
      grepl("perampanel", PRODNME, ignore.case=TRUE) |
      grepl("fycompa", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_perampanel_2017 <- as.numeric(codes_NDCNUM_perampanel_2017)


codes_NDCNUM_stiripentol_2017 <- redbook_2017_data %>% 
  filter(
      grepl("stiripentol", GENNME, ignore.case=TRUE) |
      grepl("stiripentol", THRDTDS, ignore.case=TRUE) |
      grepl("stiripentol", PRODNME, ignore.case=TRUE) |
      grepl("diacomit", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_stiripentol_2017 <- as.numeric(codes_NDCNUM_stiripentol_2017)


codes_NDCNUM_topiramate_2017 <- redbook_2017_data %>% 
  filter(
      grepl("topiramate", GENNME, ignore.case=TRUE) |
      grepl("topiramate", THRDTDS, ignore.case=TRUE) |
      grepl("topiramate", PRODNME, ignore.case=TRUE) |
      grepl("eprontia", PRODNME, ignore.case=TRUE) |
      grepl("topamax", PRODNME, ignore.case=TRUE) |
      grepl("trokendi", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("/", GENNME, ignore.case=TRUE) &
    !grepl("/", PRODNME, ignore.case=TRUE) &
    !grepl("/", THRDTDS, ignore.case=TRUE) &
    !grepl("&", GENNME, ignore.case=TRUE) &
    !grepl("&", PRODNME, ignore.case=TRUE) &
    !grepl("&", THRDTDS, ignore.case=TRUE) &
    !grepl("-", GENNME, ignore.case=TRUE) &
    !grepl("-", PRODNME, ignore.case=TRUE) &
    !grepl("-", THRDTDS, ignore.case=TRUE) &
    !grepl("qudexy", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_topiramate_2017 <- as.numeric(codes_NDCNUM_topiramate_2017)


codes_NDCNUM_vigabatrin_2017 <- redbook_2017_data %>% 
  filter(
      grepl("vigabatrin", GENNME, ignore.case=TRUE) |
      grepl("vigabatrin", THRDTDS, ignore.case=TRUE) |
      grepl("vigabatrin", PRODNME, ignore.case=TRUE) |
      grepl("sabril", PRODNME, ignore.case=TRUE) |
      grepl("vigadrone", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_vigabatrin_2017 <- as.numeric(codes_NDCNUM_vigabatrin_2017)


codes_NDCNUM_zonisamide_2017 <- redbook_2017_data %>% 
  filter(
      grepl("zonisamide", GENNME, ignore.case=TRUE) |
      grepl("zonisamide", THRDTDS, ignore.case=TRUE) |
      grepl("zonisamide", PRODNME, ignore.case=TRUE) |
      grepl("zonegran", PRODNME, ignore.case=TRUE) |
      grepl("zonisade", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_zonisamide_2017 <- as.numeric(codes_NDCNUM_zonisamide_2017)


codes_NDCNUM_felbamate_2017 <- redbook_2017_data %>% 
  filter(
      grepl("felbamate", GENNME, ignore.case=TRUE) |
      grepl("felbamate", THRDTDS, ignore.case=TRUE) |
      grepl("felbamate", PRODNME, ignore.case=TRUE) |
      grepl("felbatol", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_felbamate_2017 <- as.numeric(codes_NDCNUM_felbamate_2017)


codes_NDCNUM_pregabalin_2017 <- redbook_2017_data %>% 
  filter(
      grepl("pregabalin", GENNME, ignore.case=TRUE) |
      grepl("pregabalin", THRDTDS, ignore.case=TRUE) |
      grepl("pregabalin", PRODNME, ignore.case=TRUE) |
      grepl("lyrica", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_pregabalin_2017 <- as.numeric(codes_NDCNUM_pregabalin_2017)


codes_NDCNUM_tiagabine_2017 <- redbook_2017_data %>% 
  filter(
      grepl("tiagabine", GENNME, ignore.case=TRUE) |
      grepl("tiagabine", THRDTDS, ignore.case=TRUE) |
      grepl("tiagabine", PRODNME, ignore.case=TRUE) |
      grepl("gabitril", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_tiagabine_2017 <- as.numeric(codes_NDCNUM_tiagabine_2017)


codes_NDCNUM_cannabidiol_2017 <- redbook_2017_data %>% 
  filter(
      grepl("epidiolex", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_cannabidiol_2017 <- as.numeric(codes_NDCNUM_cannabidiol_2017)


codes_NDCNUM_gabapentin_2017 <- redbook_2017_data %>% 
  filter(
      grepl("gabapentin", GENNME, ignore.case=TRUE) |
      grepl("gabapentin", THRDTDS, ignore.case=TRUE) |
      grepl("gabapentin", PRODNME, ignore.case=TRUE) |
      grepl("gralise", PRODNME, ignore.case=TRUE) |
      grepl("neurontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl(";", GENNME, ignore.case=TRUE) &
    !grepl("enacarbil", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_gabapentin_2017 <- as.numeric(codes_NDCNUM_gabapentin_2017)


codes_NDCNUM_fenfluramine_2017 <- redbook_2017_data %>% 
  filter(
      grepl("fenfluramine", GENNME, ignore.case=TRUE) |
      grepl("fenfluramine", THRDTDS, ignore.case=TRUE) |
      grepl("fenfluramine", PRODNME, ignore.case=TRUE) |
      grepl("fintepla", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("dex", GENNME, ignore.case=TRUE) &
    !grepl("dex", THRDTDS, ignore.case=TRUE) &
    !grepl("hydrochloride", GENNME, ignore.case=TRUE) &    
    !grepl("hydrochloride", THRDTDS, ignore.case=TRUE) &
    !grepl("pondimin", PRODNME, ignore.case=TRUE) &
    !grepl("redux", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_fenfluramine_2017 <- as.numeric(codes_NDCNUM_fenfluramine_2017)


codes_NDCNUM_methsuximide_2017 <- redbook_2017_data %>% 
  filter(
      grepl("methsuximide", GENNME, ignore.case=TRUE) |
      grepl("methsuximide", THRDTDS, ignore.case=TRUE) |
      grepl("methsuximide", PRODNME, ignore.case=TRUE) |
      grepl("celontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_methsuximide_2017 <- as.numeric(codes_NDCNUM_methsuximide_2017)


codes_NDCNUM_ASM_2017 <- c(
  codes_NDCNUM_phenobarbital_2017,
  codes_NDCNUM_phenytoin_2017,
  codes_NDCNUM_valproate_2017,
  codes_NDCNUM_carbamazepine_2017,
  codes_NDCNUM_oxcarbazepine_2017,
  codes_NDCNUM_rufinamide_2017,
  codes_NDCNUM_levetiracetam_2017,
  codes_NDCNUM_lamotrigine_2017,
  codes_NDCNUM_brivaracetam_2017,
  codes_NDCNUM_cenobamate_2017,
  codes_NDCNUM_clobazam_2017,
  codes_NDCNUM_eslicarbazepine_2017,
  codes_NDCNUM_ethosuximide_2017,
  codes_NDCNUM_lacosamide_2017,
  codes_NDCNUM_perampanel_2017,
  codes_NDCNUM_stiripentol_2017,
  codes_NDCNUM_topiramate_2017,
  codes_NDCNUM_vigabatrin_2017,
  codes_NDCNUM_zonisamide_2017,
  codes_NDCNUM_felbamate_2017,
  codes_NDCNUM_pregabalin_2017,
  codes_NDCNUM_tiagabine_2017,
  codes_NDCNUM_cannabidiol_2017,
  codes_NDCNUM_gabapentin_2017,
  codes_NDCNUM_fenfluramine_2017,
  codes_NDCNUM_methsuximide_2017
)




############################################2018############################################
codes_NDCNUM_phenobarbital_2018 <- redbook_2018_data %>% 
  filter(
      grepl("phenobarb", GENNME, ignore.case=TRUE) |
      grepl("phenobarb", THRDTDS, ignore.case=TRUE) |
      grepl("phenobarb", PRODNME, ignore.case=TRUE) |
      grepl("luminal", PRODNME, ignore.case=TRUE) |
      grepl("solfoton", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("/", GENNME, ignore.case=TRUE) &
    !grepl("/", PRODNME, ignore.case=TRUE) &
    !grepl("/", THRDTDS, ignore.case=TRUE) &
    !grepl("&", GENNME, ignore.case=TRUE) &
    !grepl("&", PRODNME, ignore.case=TRUE) &
    !grepl("&", THRDTDS, ignore.case=TRUE) &
    !grepl("-", GENNME, ignore.case=TRUE) &
    !grepl("-", PRODNME, ignore.case=TRUE) &
    !grepl("-", THRDTDS, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_phenobarbital_2018 <- as.numeric(codes_NDCNUM_phenobarbital_2018)


codes_NDCNUM_phenytoin_2018 <- redbook_2018_data %>% 
  filter(
      grepl("phenytoin", GENNME, ignore.case=TRUE) |
      grepl("phenytoin", THRDTDS, ignore.case=TRUE) |
      grepl("phenytoin", PRODNME, ignore.case=TRUE) |
      grepl("dilantin", PRODNME, ignore.case=TRUE) |
      grepl("phenytek", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_phenytoin_2018 <- as.numeric(codes_NDCNUM_phenytoin_2018)


codes_NDCNUM_valproate_2018 <- redbook_2018_data %>% 
  filter(
      grepl("valpro", GENNME, ignore.case=TRUE) |
      grepl("valpro", THRDTDS, ignore.case=TRUE) |
      grepl("valpro", PRODNME, ignore.case=TRUE) |
      grepl("depakene", PRODNME, ignore.case=TRUE) |
      grepl("depakote", PRODNME, ignore.case=TRUE) |
      grepl("depacon", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_valproate_2018 <- as.numeric(codes_NDCNUM_valproate_2018)


codes_NDCNUM_carbamazepine_2018 <- redbook_2018_data %>% 
  filter(
      grepl("carbamazepine", GENNME, ignore.case=TRUE) |
      grepl("carbamazepine", THRDTDS, ignore.case=TRUE) |
      grepl("carbamazepine", PRODNME, ignore.case=TRUE) |
      grepl("tegretol", PRODNME, ignore.case=TRUE) |
      grepl("carbatrol", PRODNME, ignore.case=TRUE) |
      grepl("epitol", PRODNME, ignore.case=TRUE) |
      grepl("equetro", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("atretol", PRODNME, ignore.case=TRUE)
    ) %>%   
  pull(NDCNUM)
codes_NDCNUM_carbamazepine_2018 <- as.numeric(codes_NDCNUM_carbamazepine_2018)


codes_NDCNUM_oxcarbazepine_2018 <- redbook_2018_data %>% 
  filter(
      grepl("oxcarbazepine", GENNME, ignore.case=TRUE) |
      grepl("oxcarbazepine", THRDTDS, ignore.case=TRUE) |
      grepl("oxcarbazepine", PRODNME, ignore.case=TRUE) |
      grepl("oxtellar", PRODNME, ignore.case=TRUE) |
      grepl("trileptal", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_oxcarbazepine_2018 <- as.numeric(codes_NDCNUM_oxcarbazepine_2018)


codes_NDCNUM_rufinamide_2018 <- redbook_2018_data %>% 
  filter(
      grepl("rufinamide", GENNME, ignore.case=TRUE) |
      grepl("rufinamide", THRDTDS, ignore.case=TRUE) |
      grepl("rufinamide", PRODNME, ignore.case=TRUE) |
      grepl("banzel", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_rufinamide_2018 <- as.numeric(codes_NDCNUM_rufinamide_2018)


codes_NDCNUM_levetiracetam_2018 <- redbook_2018_data %>% 
  filter(
      grepl("levetiracetam", GENNME, ignore.case=TRUE) |
      grepl("levetiracetam", THRDTDS, ignore.case=TRUE) |
      grepl("levetiracetam", PRODNME, ignore.case=TRUE) |
      grepl("elepsia", PRODNME, ignore.case=TRUE) |
      grepl("keppra", PRODNME, ignore.case=TRUE) |
      grepl("roweepra", PRODNME, ignore.case=TRUE) |
      grepl("spritam", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_levetiracetam_2018 <- as.numeric(codes_NDCNUM_levetiracetam_2018)


codes_NDCNUM_lamotrigine_2018 <- redbook_2018_data %>% 
  filter(
      grepl("lamotrigine", GENNME, ignore.case=TRUE) |
      grepl("lamotrigine", THRDTDS, ignore.case=TRUE) |
      grepl("lamotrigine", PRODNME, ignore.case=TRUE) |
      grepl("lamictal", PRODNME, ignore.case=TRUE) |
      grepl("subvenite", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_lamotrigine_2018 <- as.numeric(codes_NDCNUM_lamotrigine_2018)


codes_NDCNUM_brivaracetam_2018 <- redbook_2018_data %>% 
  filter(
      grepl("brivaracetam", GENNME, ignore.case=TRUE) |
      grepl("brivaracetam", THRDTDS, ignore.case=TRUE) |
      grepl("brivaracetam", PRODNME, ignore.case=TRUE) |
      grepl("briviact", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_brivaracetam_2018 <- as.numeric(codes_NDCNUM_brivaracetam_2018)


codes_NDCNUM_cenobamate_2018 <- redbook_2018_data %>% 
  filter(
      grepl("cenobamate", GENNME, ignore.case=TRUE) |
      grepl("cenobamate", THRDTDS, ignore.case=TRUE) |
      grepl("cenobamate", PRODNME, ignore.case=TRUE) |
      grepl("xcopri", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_cenobamate_2018 <- as.numeric(codes_NDCNUM_cenobamate_2018)


codes_NDCNUM_clobazam_2018 <- redbook_2018_data %>% 
  filter(
      grepl("clobazam", GENNME, ignore.case=TRUE) |
      grepl("clobazam", THRDTDS, ignore.case=TRUE) |
      grepl("clobazam", PRODNME, ignore.case=TRUE) |
      grepl("onfi", PRODNME, ignore.case=TRUE) |
      grepl("sympazan", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("HIV", GENNME, ignore.case=TRUE) &
    !grepl("pregnancy", GENNME, ignore.case=TRUE) &
    !grepl("denture", GENNME, ignore.case=TRUE) &
    !grepl("hyoscyamine", GENNME, ignore.case=TRUE) &
    !grepl("glucose", GENNME, ignore.case=TRUE) &
    !grepl("device", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_clobazam_2018 <- as.numeric(codes_NDCNUM_clobazam_2018)


codes_NDCNUM_eslicarbazepine_2018 <- redbook_2018_data %>% 
  filter(
      grepl("eslicarbazepine", GENNME, ignore.case=TRUE) |
      grepl("eslicarbazepine", THRDTDS, ignore.case=TRUE) |
      grepl("eslicarbazepine", PRODNME, ignore.case=TRUE) |
      grepl("aptiom", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_eslicarbazepine_2018 <- as.numeric(codes_NDCNUM_eslicarbazepine_2018)


codes_NDCNUM_ethosuximide_2018 <- redbook_2018_data %>% 
  filter(
      grepl("ethosuximide", GENNME, ignore.case=TRUE) |
      grepl("ethosuximide", THRDTDS, ignore.case=TRUE) |
      grepl("ethosuximide", PRODNME, ignore.case=TRUE) |
      grepl("zarontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_ethosuximide_2018 <- as.numeric(codes_NDCNUM_ethosuximide_2018)


codes_NDCNUM_lacosamide_2018 <- redbook_2018_data %>% 
  filter(
      grepl("lacosamide", GENNME, ignore.case=TRUE) |
      grepl("lacosamide", THRDTDS, ignore.case=TRUE) |
      grepl("lacosamide", PRODNME, ignore.case=TRUE) |
      grepl("vimpat", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_lacosamide_2018 <- as.numeric(codes_NDCNUM_lacosamide_2018)


codes_NDCNUM_perampanel_2018 <- redbook_2018_data %>% 
  filter(
      grepl("perampanel", GENNME, ignore.case=TRUE) |
      grepl("perampanel", THRDTDS, ignore.case=TRUE) |
      grepl("perampanel", PRODNME, ignore.case=TRUE) |
      grepl("fycompa", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_perampanel_2018 <- as.numeric(codes_NDCNUM_perampanel_2018)


codes_NDCNUM_stiripentol_2018 <- redbook_2018_data %>% 
  filter(
      grepl("stiripentol", GENNME, ignore.case=TRUE) |
      grepl("stiripentol", THRDTDS, ignore.case=TRUE) |
      grepl("stiripentol", PRODNME, ignore.case=TRUE) |
      grepl("diacomit", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_stiripentol_2018 <- as.numeric(codes_NDCNUM_stiripentol_2018)


codes_NDCNUM_topiramate_2018 <- redbook_2018_data %>% 
  filter(
      grepl("topiramate", GENNME, ignore.case=TRUE) |
      grepl("topiramate", THRDTDS, ignore.case=TRUE) |
      grepl("topiramate", PRODNME, ignore.case=TRUE) |
      grepl("eprontia", PRODNME, ignore.case=TRUE) |
      grepl("topamax", PRODNME, ignore.case=TRUE) |
      grepl("trokendi", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("/", GENNME, ignore.case=TRUE) &
    !grepl("/", PRODNME, ignore.case=TRUE) &
    !grepl("/", THRDTDS, ignore.case=TRUE) &
    !grepl("&", GENNME, ignore.case=TRUE) &
    !grepl("&", PRODNME, ignore.case=TRUE) &
    !grepl("&", THRDTDS, ignore.case=TRUE) &
    !grepl("-", GENNME, ignore.case=TRUE) &
    !grepl("-", PRODNME, ignore.case=TRUE) &
    !grepl("-", THRDTDS, ignore.case=TRUE) &
    !grepl("qudexy", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_topiramate_2018 <- as.numeric(codes_NDCNUM_topiramate_2018)


codes_NDCNUM_vigabatrin_2018 <- redbook_2018_data %>% 
  filter(
      grepl("vigabatrin", GENNME, ignore.case=TRUE) |
      grepl("vigabatrin", THRDTDS, ignore.case=TRUE) |
      grepl("vigabatrin", PRODNME, ignore.case=TRUE) |
      grepl("sabril", PRODNME, ignore.case=TRUE) |
      grepl("vigadrone", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_vigabatrin_2018 <- as.numeric(codes_NDCNUM_vigabatrin_2018)


codes_NDCNUM_zonisamide_2018 <- redbook_2018_data %>% 
  filter(
      grepl("zonisamide", GENNME, ignore.case=TRUE) |
      grepl("zonisamide", THRDTDS, ignore.case=TRUE) |
      grepl("zonisamide", PRODNME, ignore.case=TRUE) |
      grepl("zonegran", PRODNME, ignore.case=TRUE) |
      grepl("zonisade", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_zonisamide_2018 <- as.numeric(codes_NDCNUM_zonisamide_2018)


codes_NDCNUM_felbamate_2018 <- redbook_2018_data %>% 
  filter(
      grepl("felbamate", GENNME, ignore.case=TRUE) |
      grepl("felbamate", THRDTDS, ignore.case=TRUE) |
      grepl("felbamate", PRODNME, ignore.case=TRUE) |
      grepl("felbatol", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_felbamate_2018 <- as.numeric(codes_NDCNUM_felbamate_2018)


codes_NDCNUM_pregabalin_2018 <- redbook_2018_data %>% 
  filter(
      grepl("pregabalin", GENNME, ignore.case=TRUE) |
      grepl("pregabalin", THRDTDS, ignore.case=TRUE) |
      grepl("pregabalin", PRODNME, ignore.case=TRUE) |
      grepl("lyrica", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_pregabalin_2018 <- as.numeric(codes_NDCNUM_pregabalin_2018)


codes_NDCNUM_tiagabine_2018 <- redbook_2018_data %>% 
  filter(
      grepl("tiagabine", GENNME, ignore.case=TRUE) |
      grepl("tiagabine", THRDTDS, ignore.case=TRUE) |
      grepl("tiagabine", PRODNME, ignore.case=TRUE) |
      grepl("gabitril", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_tiagabine_2018 <- as.numeric(codes_NDCNUM_tiagabine_2018)


codes_NDCNUM_cannabidiol_2018 <- redbook_2018_data %>% 
  filter(
      grepl("epidiolex", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_cannabidiol_2018 <- as.numeric(codes_NDCNUM_cannabidiol_2018)


codes_NDCNUM_gabapentin_2018 <- redbook_2018_data %>% 
  filter(
      grepl("gabapentin", GENNME, ignore.case=TRUE) |
      grepl("gabapentin", THRDTDS, ignore.case=TRUE) |
      grepl("gabapentin", PRODNME, ignore.case=TRUE) |
      grepl("gralise", PRODNME, ignore.case=TRUE) |
      grepl("neurontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl(";", GENNME, ignore.case=TRUE) &
    !grepl("enacarbil", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_gabapentin_2018 <- as.numeric(codes_NDCNUM_gabapentin_2018)


codes_NDCNUM_fenfluramine_2018 <- redbook_2018_data %>% 
  filter(
      grepl("fenfluramine", GENNME, ignore.case=TRUE) |
      grepl("fenfluramine", THRDTDS, ignore.case=TRUE) |
      grepl("fenfluramine", PRODNME, ignore.case=TRUE) |
      grepl("fintepla", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("dex", GENNME, ignore.case=TRUE) &
    !grepl("dex", THRDTDS, ignore.case=TRUE) &
    !grepl("hydrochloride", GENNME, ignore.case=TRUE) &    
    !grepl("hydrochloride", THRDTDS, ignore.case=TRUE) &
    !grepl("pondimin", PRODNME, ignore.case=TRUE) &
    !grepl("redux", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_fenfluramine_2018 <- as.numeric(codes_NDCNUM_fenfluramine_2018)


codes_NDCNUM_methsuximide_2018 <- redbook_2018_data %>% 
  filter(
      grepl("methsuximide", GENNME, ignore.case=TRUE) |
      grepl("methsuximide", THRDTDS, ignore.case=TRUE) |
      grepl("methsuximide", PRODNME, ignore.case=TRUE) |
      grepl("celontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_methsuximide_2018 <- as.numeric(codes_NDCNUM_methsuximide_2018)


codes_NDCNUM_ASM_2018 <- c(
  codes_NDCNUM_phenobarbital_2018,
  codes_NDCNUM_phenytoin_2018,
  codes_NDCNUM_valproate_2018,
  codes_NDCNUM_carbamazepine_2018,
  codes_NDCNUM_oxcarbazepine_2018,
  codes_NDCNUM_rufinamide_2018,
  codes_NDCNUM_levetiracetam_2018,
  codes_NDCNUM_lamotrigine_2018,
  codes_NDCNUM_brivaracetam_2018,
  codes_NDCNUM_cenobamate_2018,
  codes_NDCNUM_clobazam_2018,
  codes_NDCNUM_eslicarbazepine_2018,
  codes_NDCNUM_ethosuximide_2018,
  codes_NDCNUM_lacosamide_2018,
  codes_NDCNUM_perampanel_2018,
  codes_NDCNUM_stiripentol_2018,
  codes_NDCNUM_topiramate_2018,
  codes_NDCNUM_vigabatrin_2018,
  codes_NDCNUM_zonisamide_2018,
  codes_NDCNUM_felbamate_2018,
  codes_NDCNUM_pregabalin_2018,
  codes_NDCNUM_tiagabine_2018,
  codes_NDCNUM_cannabidiol_2018,
  codes_NDCNUM_gabapentin_2018,
  codes_NDCNUM_fenfluramine_2018,
  codes_NDCNUM_methsuximide_2018
)




############################################2019############################################
codes_NDCNUM_phenobarbital_2019 <- redbook_2019_data %>% 
  filter(
      grepl("phenobarb", GENNME, ignore.case=TRUE) |
      grepl("phenobarb", THRDTDS, ignore.case=TRUE) |
      grepl("phenobarb", PRODNME, ignore.case=TRUE) |
      grepl("luminal", PRODNME, ignore.case=TRUE) |
      grepl("solfoton", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("/", GENNME, ignore.case=TRUE) &
    !grepl("/", PRODNME, ignore.case=TRUE) &
    !grepl("/", THRDTDS, ignore.case=TRUE) &
    !grepl("&", GENNME, ignore.case=TRUE) &
    !grepl("&", PRODNME, ignore.case=TRUE) &
    !grepl("&", THRDTDS, ignore.case=TRUE) &
    !grepl("-", GENNME, ignore.case=TRUE) &
    !grepl("-", PRODNME, ignore.case=TRUE) &
    !grepl("-", THRDTDS, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_phenobarbital_2019 <- as.numeric(codes_NDCNUM_phenobarbital_2019)


codes_NDCNUM_phenytoin_2019 <- redbook_2019_data %>% 
  filter(
      grepl("phenytoin", GENNME, ignore.case=TRUE) |
      grepl("phenytoin", THRDTDS, ignore.case=TRUE) |
      grepl("phenytoin", PRODNME, ignore.case=TRUE) |
      grepl("dilantin", PRODNME, ignore.case=TRUE) |
      grepl("phenytek", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_phenytoin_2019 <- as.numeric(codes_NDCNUM_phenytoin_2019)


codes_NDCNUM_valproate_2019 <- redbook_2019_data %>% 
  filter(
      grepl("valpro", GENNME, ignore.case=TRUE) |
      grepl("valpro", THRDTDS, ignore.case=TRUE) |
      grepl("valpro", PRODNME, ignore.case=TRUE) |
      grepl("depakene", PRODNME, ignore.case=TRUE) |
      grepl("depakote", PRODNME, ignore.case=TRUE) |
      grepl("depacon", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_valproate_2019 <- as.numeric(codes_NDCNUM_valproate_2019)


codes_NDCNUM_carbamazepine_2019 <- redbook_2019_data %>% 
  filter(
      grepl("carbamazepine", GENNME, ignore.case=TRUE) |
      grepl("carbamazepine", THRDTDS, ignore.case=TRUE) |
      grepl("carbamazepine", PRODNME, ignore.case=TRUE) |
      grepl("tegretol", PRODNME, ignore.case=TRUE) |
      grepl("carbatrol", PRODNME, ignore.case=TRUE) |
      grepl("epitol", PRODNME, ignore.case=TRUE) |
      grepl("equetro", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("atretol", PRODNME, ignore.case=TRUE)
    ) %>%   
  pull(NDCNUM)
codes_NDCNUM_carbamazepine_2019 <- as.numeric(codes_NDCNUM_carbamazepine_2019)


codes_NDCNUM_oxcarbazepine_2019 <- redbook_2019_data %>% 
  filter(
      grepl("oxcarbazepine", GENNME, ignore.case=TRUE) |
      grepl("oxcarbazepine", THRDTDS, ignore.case=TRUE) |
      grepl("oxcarbazepine", PRODNME, ignore.case=TRUE) |
      grepl("oxtellar", PRODNME, ignore.case=TRUE) |
      grepl("trileptal", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_oxcarbazepine_2019 <- as.numeric(codes_NDCNUM_oxcarbazepine_2019)


codes_NDCNUM_rufinamide_2019 <- redbook_2019_data %>% 
  filter(
      grepl("rufinamide", GENNME, ignore.case=TRUE) |
      grepl("rufinamide", THRDTDS, ignore.case=TRUE) |
      grepl("rufinamide", PRODNME, ignore.case=TRUE) |
      grepl("banzel", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_rufinamide_2019 <- as.numeric(codes_NDCNUM_rufinamide_2019)


codes_NDCNUM_levetiracetam_2019 <- redbook_2019_data %>% 
  filter(
      grepl("levetiracetam", GENNME, ignore.case=TRUE) |
      grepl("levetiracetam", THRDTDS, ignore.case=TRUE) |
      grepl("levetiracetam", PRODNME, ignore.case=TRUE) |
      grepl("elepsia", PRODNME, ignore.case=TRUE) |
      grepl("keppra", PRODNME, ignore.case=TRUE) |
      grepl("roweepra", PRODNME, ignore.case=TRUE) |
      grepl("spritam", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_levetiracetam_2019 <- as.numeric(codes_NDCNUM_levetiracetam_2019)


codes_NDCNUM_lamotrigine_2019 <- redbook_2019_data %>% 
  filter(
      grepl("lamotrigine", GENNME, ignore.case=TRUE) |
      grepl("lamotrigine", THRDTDS, ignore.case=TRUE) |
      grepl("lamotrigine", PRODNME, ignore.case=TRUE) |
      grepl("lamictal", PRODNME, ignore.case=TRUE) |
      grepl("subvenite", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_lamotrigine_2019 <- as.numeric(codes_NDCNUM_lamotrigine_2019)


codes_NDCNUM_brivaracetam_2019 <- redbook_2019_data %>% 
  filter(
      grepl("brivaracetam", GENNME, ignore.case=TRUE) |
      grepl("brivaracetam", THRDTDS, ignore.case=TRUE) |
      grepl("brivaracetam", PRODNME, ignore.case=TRUE) |
      grepl("briviact", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_brivaracetam_2019 <- as.numeric(codes_NDCNUM_brivaracetam_2019)


codes_NDCNUM_cenobamate_2019 <- redbook_2019_data %>% 
  filter(
      grepl("cenobamate", GENNME, ignore.case=TRUE) |
      grepl("cenobamate", THRDTDS, ignore.case=TRUE) |
      grepl("cenobamate", PRODNME, ignore.case=TRUE) |
      grepl("xcopri", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_cenobamate_2019 <- as.numeric(codes_NDCNUM_cenobamate_2019)


codes_NDCNUM_clobazam_2019 <- redbook_2019_data %>% 
  filter(
      grepl("clobazam", GENNME, ignore.case=TRUE) |
      grepl("clobazam", THRDTDS, ignore.case=TRUE) |
      grepl("clobazam", PRODNME, ignore.case=TRUE) |
      grepl("onfi", PRODNME, ignore.case=TRUE) |
      grepl("sympazan", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("HIV", GENNME, ignore.case=TRUE) &
    !grepl("pregnancy", GENNME, ignore.case=TRUE) &
    !grepl("denture", GENNME, ignore.case=TRUE) &
    !grepl("hyoscyamine", GENNME, ignore.case=TRUE) &
    !grepl("glucose", GENNME, ignore.case=TRUE) &
    !grepl("device", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_clobazam_2019 <- as.numeric(codes_NDCNUM_clobazam_2019)


codes_NDCNUM_eslicarbazepine_2019 <- redbook_2019_data %>% 
  filter(
      grepl("eslicarbazepine", GENNME, ignore.case=TRUE) |
      grepl("eslicarbazepine", THRDTDS, ignore.case=TRUE) |
      grepl("eslicarbazepine", PRODNME, ignore.case=TRUE) |
      grepl("aptiom", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_eslicarbazepine_2019 <- as.numeric(codes_NDCNUM_eslicarbazepine_2019)


codes_NDCNUM_ethosuximide_2019 <- redbook_2019_data %>% 
  filter(
      grepl("ethosuximide", GENNME, ignore.case=TRUE) |
      grepl("ethosuximide", THRDTDS, ignore.case=TRUE) |
      grepl("ethosuximide", PRODNME, ignore.case=TRUE) |
      grepl("zarontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_ethosuximide_2019 <- as.numeric(codes_NDCNUM_ethosuximide_2019)


codes_NDCNUM_lacosamide_2019 <- redbook_2019_data %>% 
  filter(
      grepl("lacosamide", GENNME, ignore.case=TRUE) |
      grepl("lacosamide", THRDTDS, ignore.case=TRUE) |
      grepl("lacosamide", PRODNME, ignore.case=TRUE) |
      grepl("vimpat", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_lacosamide_2019 <- as.numeric(codes_NDCNUM_lacosamide_2019)


codes_NDCNUM_perampanel_2019 <- redbook_2019_data %>% 
  filter(
      grepl("perampanel", GENNME, ignore.case=TRUE) |
      grepl("perampanel", THRDTDS, ignore.case=TRUE) |
      grepl("perampanel", PRODNME, ignore.case=TRUE) |
      grepl("fycompa", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_perampanel_2019 <- as.numeric(codes_NDCNUM_perampanel_2019)


codes_NDCNUM_stiripentol_2019 <- redbook_2019_data %>% 
  filter(
      grepl("stiripentol", GENNME, ignore.case=TRUE) |
      grepl("stiripentol", THRDTDS, ignore.case=TRUE) |
      grepl("stiripentol", PRODNME, ignore.case=TRUE) |
      grepl("diacomit", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_stiripentol_2019 <- as.numeric(codes_NDCNUM_stiripentol_2019)


codes_NDCNUM_topiramate_2019 <- redbook_2019_data %>% 
  filter(
      grepl("topiramate", GENNME, ignore.case=TRUE) |
      grepl("topiramate", THRDTDS, ignore.case=TRUE) |
      grepl("topiramate", PRODNME, ignore.case=TRUE) |
      grepl("eprontia", PRODNME, ignore.case=TRUE) |
      grepl("topamax", PRODNME, ignore.case=TRUE) |
      grepl("trokendi", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("/", GENNME, ignore.case=TRUE) &
    !grepl("/", PRODNME, ignore.case=TRUE) &
    !grepl("/", THRDTDS, ignore.case=TRUE) &
    !grepl("&", GENNME, ignore.case=TRUE) &
    !grepl("&", PRODNME, ignore.case=TRUE) &
    !grepl("&", THRDTDS, ignore.case=TRUE) &
    !grepl("-", GENNME, ignore.case=TRUE) &
    !grepl("-", PRODNME, ignore.case=TRUE) &
    !grepl("-", THRDTDS, ignore.case=TRUE) &
    !grepl("qudexy", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_topiramate_2019 <- as.numeric(codes_NDCNUM_topiramate_2019)


codes_NDCNUM_vigabatrin_2019 <- redbook_2019_data %>% 
  filter(
      grepl("vigabatrin", GENNME, ignore.case=TRUE) |
      grepl("vigabatrin", THRDTDS, ignore.case=TRUE) |
      grepl("vigabatrin", PRODNME, ignore.case=TRUE) |
      grepl("sabril", PRODNME, ignore.case=TRUE) |
      grepl("vigadrone", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_vigabatrin_2019 <- as.numeric(codes_NDCNUM_vigabatrin_2019)


codes_NDCNUM_zonisamide_2019 <- redbook_2019_data %>% 
  filter(
      grepl("zonisamide", GENNME, ignore.case=TRUE) |
      grepl("zonisamide", THRDTDS, ignore.case=TRUE) |
      grepl("zonisamide", PRODNME, ignore.case=TRUE) |
      grepl("zonegran", PRODNME, ignore.case=TRUE) |
      grepl("zonisade", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_zonisamide_2019 <- as.numeric(codes_NDCNUM_zonisamide_2019)


codes_NDCNUM_felbamate_2019 <- redbook_2019_data %>% 
  filter(
      grepl("felbamate", GENNME, ignore.case=TRUE) |
      grepl("felbamate", THRDTDS, ignore.case=TRUE) |
      grepl("felbamate", PRODNME, ignore.case=TRUE) |
      grepl("felbatol", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_felbamate_2019 <- as.numeric(codes_NDCNUM_felbamate_2019)


codes_NDCNUM_pregabalin_2019 <- redbook_2019_data %>% 
  filter(
      grepl("pregabalin", GENNME, ignore.case=TRUE) |
      grepl("pregabalin", THRDTDS, ignore.case=TRUE) |
      grepl("pregabalin", PRODNME, ignore.case=TRUE) |
      grepl("lyrica", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_pregabalin_2019 <- as.numeric(codes_NDCNUM_pregabalin_2019)


codes_NDCNUM_tiagabine_2019 <- redbook_2019_data %>% 
  filter(
      grepl("tiagabine", GENNME, ignore.case=TRUE) |
      grepl("tiagabine", THRDTDS, ignore.case=TRUE) |
      grepl("tiagabine", PRODNME, ignore.case=TRUE) |
      grepl("gabitril", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_tiagabine_2019 <- as.numeric(codes_NDCNUM_tiagabine_2019)


codes_NDCNUM_cannabidiol_2019 <- redbook_2019_data %>% 
  filter(
      grepl("epidiolex", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_cannabidiol_2019 <- as.numeric(codes_NDCNUM_cannabidiol_2019)


codes_NDCNUM_gabapentin_2019 <- redbook_2019_data %>% 
  filter(
      grepl("gabapentin", GENNME, ignore.case=TRUE) |
      grepl("gabapentin", THRDTDS, ignore.case=TRUE) |
      grepl("gabapentin", PRODNME, ignore.case=TRUE) |
      grepl("gralise", PRODNME, ignore.case=TRUE) |
      grepl("neurontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl(";", GENNME, ignore.case=TRUE) &
    !grepl("enacarbil", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_gabapentin_2019 <- as.numeric(codes_NDCNUM_gabapentin_2019)


codes_NDCNUM_fenfluramine_2019 <- redbook_2019_data %>% 
  filter(
      grepl("fenfluramine", GENNME, ignore.case=TRUE) |
      grepl("fenfluramine", THRDTDS, ignore.case=TRUE) |
      grepl("fenfluramine", PRODNME, ignore.case=TRUE) |
      grepl("fintepla", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("dex", GENNME, ignore.case=TRUE) &
    !grepl("dex", THRDTDS, ignore.case=TRUE) &
    !grepl("hydrochloride", GENNME, ignore.case=TRUE) &    
    !grepl("hydrochloride", THRDTDS, ignore.case=TRUE) &
    !grepl("pondimin", PRODNME, ignore.case=TRUE) &
    !grepl("redux", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_fenfluramine_2019 <- as.numeric(codes_NDCNUM_fenfluramine_2019)


codes_NDCNUM_methsuximide_2019 <- redbook_2019_data %>% 
  filter(
      grepl("methsuximide", GENNME, ignore.case=TRUE) |
      grepl("methsuximide", THRDTDS, ignore.case=TRUE) |
      grepl("methsuximide", PRODNME, ignore.case=TRUE) |
      grepl("celontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_methsuximide_2019 <- as.numeric(codes_NDCNUM_methsuximide_2019)


codes_NDCNUM_ASM_2019 <- c(
  codes_NDCNUM_phenobarbital_2019,
  codes_NDCNUM_phenytoin_2019,
  codes_NDCNUM_valproate_2019,
  codes_NDCNUM_carbamazepine_2019,
  codes_NDCNUM_oxcarbazepine_2019,
  codes_NDCNUM_rufinamide_2019,
  codes_NDCNUM_levetiracetam_2019,
  codes_NDCNUM_lamotrigine_2019,
  codes_NDCNUM_brivaracetam_2019,
  codes_NDCNUM_cenobamate_2019,
  codes_NDCNUM_clobazam_2019,
  codes_NDCNUM_eslicarbazepine_2019,
  codes_NDCNUM_ethosuximide_2019,
  codes_NDCNUM_lacosamide_2019,
  codes_NDCNUM_perampanel_2019,
  codes_NDCNUM_stiripentol_2019,
  codes_NDCNUM_topiramate_2019,
  codes_NDCNUM_vigabatrin_2019,
  codes_NDCNUM_zonisamide_2019,
  codes_NDCNUM_felbamate_2019,
  codes_NDCNUM_pregabalin_2019,
  codes_NDCNUM_tiagabine_2019,
  codes_NDCNUM_cannabidiol_2019,
  codes_NDCNUM_gabapentin_2019,
  codes_NDCNUM_fenfluramine_2019,
  codes_NDCNUM_methsuximide_2019
)




############################################2020############################################
codes_NDCNUM_phenobarbital_2020 <- redbook_2020_data %>% 
  filter(
      grepl("phenobarb", GENNME, ignore.case=TRUE) |
      grepl("phenobarb", THRDTDS, ignore.case=TRUE) |
      grepl("phenobarb", PRODNME, ignore.case=TRUE) |
      grepl("luminal", PRODNME, ignore.case=TRUE) |
      grepl("solfoton", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("/", GENNME, ignore.case=TRUE) &
    !grepl("/", PRODNME, ignore.case=TRUE) &
    !grepl("/", THRDTDS, ignore.case=TRUE) &
    !grepl("&", GENNME, ignore.case=TRUE) &
    !grepl("&", PRODNME, ignore.case=TRUE) &
    !grepl("&", THRDTDS, ignore.case=TRUE) &
    !grepl("-", GENNME, ignore.case=TRUE) &
    !grepl("-", PRODNME, ignore.case=TRUE) &
    !grepl("-", THRDTDS, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_phenobarbital_2020 <- as.numeric(codes_NDCNUM_phenobarbital_2020)


codes_NDCNUM_phenytoin_2020 <- redbook_2020_data %>% 
  filter(
      grepl("phenytoin", GENNME, ignore.case=TRUE) |
      grepl("phenytoin", THRDTDS, ignore.case=TRUE) |
      grepl("phenytoin", PRODNME, ignore.case=TRUE) |
      grepl("dilantin", PRODNME, ignore.case=TRUE) |
      grepl("phenytek", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_phenytoin_2020 <- as.numeric(codes_NDCNUM_phenytoin_2020)


codes_NDCNUM_valproate_2020 <- redbook_2020_data %>% 
  filter(
      grepl("valpro", GENNME, ignore.case=TRUE) |
      grepl("valpro", THRDTDS, ignore.case=TRUE) |
      grepl("valpro", PRODNME, ignore.case=TRUE) |
      grepl("depakene", PRODNME, ignore.case=TRUE) |
      grepl("depakote", PRODNME, ignore.case=TRUE) |
      grepl("depacon", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_valproate_2020 <- as.numeric(codes_NDCNUM_valproate_2020)


codes_NDCNUM_carbamazepine_2020 <- redbook_2020_data %>% 
  filter(
      grepl("carbamazepine", GENNME, ignore.case=TRUE) |
      grepl("carbamazepine", THRDTDS, ignore.case=TRUE) |
      grepl("carbamazepine", PRODNME, ignore.case=TRUE) |
      grepl("tegretol", PRODNME, ignore.case=TRUE) |
      grepl("carbatrol", PRODNME, ignore.case=TRUE) |
      grepl("epitol", PRODNME, ignore.case=TRUE) |
      grepl("equetro", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("atretol", PRODNME, ignore.case=TRUE)
    ) %>%   
  pull(NDCNUM)
codes_NDCNUM_carbamazepine_2020 <- as.numeric(codes_NDCNUM_carbamazepine_2020)


codes_NDCNUM_oxcarbazepine_2020 <- redbook_2020_data %>% 
  filter(
      grepl("oxcarbazepine", GENNME, ignore.case=TRUE) |
      grepl("oxcarbazepine", THRDTDS, ignore.case=TRUE) |
      grepl("oxcarbazepine", PRODNME, ignore.case=TRUE) |
      grepl("oxtellar", PRODNME, ignore.case=TRUE) |
      grepl("trileptal", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_oxcarbazepine_2020 <- as.numeric(codes_NDCNUM_oxcarbazepine_2020)


codes_NDCNUM_rufinamide_2020 <- redbook_2020_data %>% 
  filter(
      grepl("rufinamide", GENNME, ignore.case=TRUE) |
      grepl("rufinamide", THRDTDS, ignore.case=TRUE) |
      grepl("rufinamide", PRODNME, ignore.case=TRUE) |
      grepl("banzel", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_rufinamide_2020 <- as.numeric(codes_NDCNUM_rufinamide_2020)


codes_NDCNUM_levetiracetam_2020 <- redbook_2020_data %>% 
  filter(
      grepl("levetiracetam", GENNME, ignore.case=TRUE) |
      grepl("levetiracetam", THRDTDS, ignore.case=TRUE) |
      grepl("levetiracetam", PRODNME, ignore.case=TRUE) |
      grepl("elepsia", PRODNME, ignore.case=TRUE) |
      grepl("keppra", PRODNME, ignore.case=TRUE) |
      grepl("roweepra", PRODNME, ignore.case=TRUE) |
      grepl("spritam", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_levetiracetam_2020 <- as.numeric(codes_NDCNUM_levetiracetam_2020)


codes_NDCNUM_lamotrigine_2020 <- redbook_2020_data %>% 
  filter(
      grepl("lamotrigine", GENNME, ignore.case=TRUE) |
      grepl("lamotrigine", THRDTDS, ignore.case=TRUE) |
      grepl("lamotrigine", PRODNME, ignore.case=TRUE) |
      grepl("lamictal", PRODNME, ignore.case=TRUE) |
      grepl("subvenite", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_lamotrigine_2020 <- as.numeric(codes_NDCNUM_lamotrigine_2020)


codes_NDCNUM_brivaracetam_2020 <- redbook_2020_data %>% 
  filter(
      grepl("brivaracetam", GENNME, ignore.case=TRUE) |
      grepl("brivaracetam", THRDTDS, ignore.case=TRUE) |
      grepl("brivaracetam", PRODNME, ignore.case=TRUE) |
      grepl("briviact", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_brivaracetam_2020 <- as.numeric(codes_NDCNUM_brivaracetam_2020)


codes_NDCNUM_cenobamate_2020 <- redbook_2020_data %>% 
  filter(
      grepl("cenobamate", GENNME, ignore.case=TRUE) |
      grepl("cenobamate", THRDTDS, ignore.case=TRUE) |
      grepl("cenobamate", PRODNME, ignore.case=TRUE) |
      grepl("xcopri", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_cenobamate_2020 <- as.numeric(codes_NDCNUM_cenobamate_2020)


codes_NDCNUM_clobazam_2020 <- redbook_2020_data %>% 
  filter(
      grepl("clobazam", GENNME, ignore.case=TRUE) |
      grepl("clobazam", THRDTDS, ignore.case=TRUE) |
      grepl("clobazam", PRODNME, ignore.case=TRUE) |
      grepl("onfi", PRODNME, ignore.case=TRUE) |
      grepl("sympazan", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("HIV", GENNME, ignore.case=TRUE) &
    !grepl("pregnancy", GENNME, ignore.case=TRUE) &
    !grepl("denture", GENNME, ignore.case=TRUE) &
    !grepl("hyoscyamine", GENNME, ignore.case=TRUE) &
    !grepl("glucose", GENNME, ignore.case=TRUE) &
    !grepl("device", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_clobazam_2020 <- as.numeric(codes_NDCNUM_clobazam_2020)


codes_NDCNUM_eslicarbazepine_2020 <- redbook_2020_data %>% 
  filter(
      grepl("eslicarbazepine", GENNME, ignore.case=TRUE) |
      grepl("eslicarbazepine", THRDTDS, ignore.case=TRUE) |
      grepl("eslicarbazepine", PRODNME, ignore.case=TRUE) |
      grepl("aptiom", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_eslicarbazepine_2020 <- as.numeric(codes_NDCNUM_eslicarbazepine_2020)


codes_NDCNUM_ethosuximide_2020 <- redbook_2020_data %>% 
  filter(
      grepl("ethosuximide", GENNME, ignore.case=TRUE) |
      grepl("ethosuximide", THRDTDS, ignore.case=TRUE) |
      grepl("ethosuximide", PRODNME, ignore.case=TRUE) |
      grepl("zarontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_ethosuximide_2020 <- as.numeric(codes_NDCNUM_ethosuximide_2020)


codes_NDCNUM_lacosamide_2020 <- redbook_2020_data %>% 
  filter(
      grepl("lacosamide", GENNME, ignore.case=TRUE) |
      grepl("lacosamide", THRDTDS, ignore.case=TRUE) |
      grepl("lacosamide", PRODNME, ignore.case=TRUE) |
      grepl("vimpat", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_lacosamide_2020 <- as.numeric(codes_NDCNUM_lacosamide_2020)


codes_NDCNUM_perampanel_2020 <- redbook_2020_data %>% 
  filter(
      grepl("perampanel", GENNME, ignore.case=TRUE) |
      grepl("perampanel", THRDTDS, ignore.case=TRUE) |
      grepl("perampanel", PRODNME, ignore.case=TRUE) |
      grepl("fycompa", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_perampanel_2020 <- as.numeric(codes_NDCNUM_perampanel_2020)


codes_NDCNUM_stiripentol_2020 <- redbook_2020_data %>% 
  filter(
      grepl("stiripentol", GENNME, ignore.case=TRUE) |
      grepl("stiripentol", THRDTDS, ignore.case=TRUE) |
      grepl("stiripentol", PRODNME, ignore.case=TRUE) |
      grepl("diacomit", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_stiripentol_2020 <- as.numeric(codes_NDCNUM_stiripentol_2020)


codes_NDCNUM_topiramate_2020 <- redbook_2020_data %>% 
  filter(
      grepl("topiramate", GENNME, ignore.case=TRUE) |
      grepl("topiramate", THRDTDS, ignore.case=TRUE) |
      grepl("topiramate", PRODNME, ignore.case=TRUE) |
      grepl("eprontia", PRODNME, ignore.case=TRUE) |
      grepl("topamax", PRODNME, ignore.case=TRUE) |
      grepl("trokendi", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("/", GENNME, ignore.case=TRUE) &
    !grepl("/", PRODNME, ignore.case=TRUE) &
    !grepl("/", THRDTDS, ignore.case=TRUE) &
    !grepl("&", GENNME, ignore.case=TRUE) &
    !grepl("&", PRODNME, ignore.case=TRUE) &
    !grepl("&", THRDTDS, ignore.case=TRUE) &
    !grepl("-", GENNME, ignore.case=TRUE) &
    !grepl("-", PRODNME, ignore.case=TRUE) &
    !grepl("-", THRDTDS, ignore.case=TRUE) &
    !grepl("qudexy", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_topiramate_2020 <- as.numeric(codes_NDCNUM_topiramate_2020)


codes_NDCNUM_vigabatrin_2020 <- redbook_2020_data %>% 
  filter(
      grepl("vigabatrin", GENNME, ignore.case=TRUE) |
      grepl("vigabatrin", THRDTDS, ignore.case=TRUE) |
      grepl("vigabatrin", PRODNME, ignore.case=TRUE) |
      grepl("sabril", PRODNME, ignore.case=TRUE) |
      grepl("vigadrone", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_vigabatrin_2020 <- as.numeric(codes_NDCNUM_vigabatrin_2020)


codes_NDCNUM_zonisamide_2020 <- redbook_2020_data %>% 
  filter(
      grepl("zonisamide", GENNME, ignore.case=TRUE) |
      grepl("zonisamide", THRDTDS, ignore.case=TRUE) |
      grepl("zonisamide", PRODNME, ignore.case=TRUE) |
      grepl("zonegran", PRODNME, ignore.case=TRUE) |
      grepl("zonisade", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_zonisamide_2020 <- as.numeric(codes_NDCNUM_zonisamide_2020)


codes_NDCNUM_felbamate_2020 <- redbook_2020_data %>% 
  filter(
      grepl("felbamate", GENNME, ignore.case=TRUE) |
      grepl("felbamate", THRDTDS, ignore.case=TRUE) |
      grepl("felbamate", PRODNME, ignore.case=TRUE) |
      grepl("felbatol", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_felbamate_2020 <- as.numeric(codes_NDCNUM_felbamate_2020)


codes_NDCNUM_pregabalin_2020 <- redbook_2020_data %>% 
  filter(
      grepl("pregabalin", GENNME, ignore.case=TRUE) |
      grepl("pregabalin", THRDTDS, ignore.case=TRUE) |
      grepl("pregabalin", PRODNME, ignore.case=TRUE) |
      grepl("lyrica", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_pregabalin_2020 <- as.numeric(codes_NDCNUM_pregabalin_2020)


codes_NDCNUM_tiagabine_2020 <- redbook_2020_data %>% 
  filter(
      grepl("tiagabine", GENNME, ignore.case=TRUE) |
      grepl("tiagabine", THRDTDS, ignore.case=TRUE) |
      grepl("tiagabine", PRODNME, ignore.case=TRUE) |
      grepl("gabitril", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_tiagabine_2020 <- as.numeric(codes_NDCNUM_tiagabine_2020)


codes_NDCNUM_cannabidiol_2020 <- redbook_2020_data %>% 
  filter(
      grepl("epidiolex", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_cannabidiol_2020 <- as.numeric(codes_NDCNUM_cannabidiol_2020)


codes_NDCNUM_gabapentin_2020 <- redbook_2020_data %>% 
  filter(
      grepl("gabapentin", GENNME, ignore.case=TRUE) |
      grepl("gabapentin", THRDTDS, ignore.case=TRUE) |
      grepl("gabapentin", PRODNME, ignore.case=TRUE) |
      grepl("gralise", PRODNME, ignore.case=TRUE) |
      grepl("neurontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl(";", GENNME, ignore.case=TRUE) &
    !grepl("enacarbil", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_gabapentin_2020 <- as.numeric(codes_NDCNUM_gabapentin_2020)


codes_NDCNUM_fenfluramine_2020 <- redbook_2020_data %>% 
  filter(
      grepl("fenfluramine", GENNME, ignore.case=TRUE) |
      grepl("fenfluramine", THRDTDS, ignore.case=TRUE) |
      grepl("fenfluramine", PRODNME, ignore.case=TRUE) |
      grepl("fintepla", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("dex", GENNME, ignore.case=TRUE) &
    !grepl("dex", THRDTDS, ignore.case=TRUE) &
    !grepl("hydrochloride", GENNME, ignore.case=TRUE) &    
    !grepl("hydrochloride", THRDTDS, ignore.case=TRUE) &
    !grepl("pondimin", PRODNME, ignore.case=TRUE) &
    !grepl("redux", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_fenfluramine_2020 <- as.numeric(codes_NDCNUM_fenfluramine_2020)


codes_NDCNUM_methsuximide_2020 <- redbook_2020_data %>% 
  filter(
      grepl("methsuximide", GENNME, ignore.case=TRUE) |
      grepl("methsuximide", THRDTDS, ignore.case=TRUE) |
      grepl("methsuximide", PRODNME, ignore.case=TRUE) |
      grepl("celontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_methsuximide_2020 <- as.numeric(codes_NDCNUM_methsuximide_2020)


codes_NDCNUM_ASM_2020 <- c(
  codes_NDCNUM_phenobarbital_2020,
  codes_NDCNUM_phenytoin_2020,
  codes_NDCNUM_valproate_2020,
  codes_NDCNUM_carbamazepine_2020,
  codes_NDCNUM_oxcarbazepine_2020,
  codes_NDCNUM_rufinamide_2020,
  codes_NDCNUM_levetiracetam_2020,
  codes_NDCNUM_lamotrigine_2020,
  codes_NDCNUM_brivaracetam_2020,
  codes_NDCNUM_cenobamate_2020,
  codes_NDCNUM_clobazam_2020,
  codes_NDCNUM_eslicarbazepine_2020,
  codes_NDCNUM_ethosuximide_2020,
  codes_NDCNUM_lacosamide_2020,
  codes_NDCNUM_perampanel_2020,
  codes_NDCNUM_stiripentol_2020,
  codes_NDCNUM_topiramate_2020,
  codes_NDCNUM_vigabatrin_2020,
  codes_NDCNUM_zonisamide_2020,
  codes_NDCNUM_felbamate_2020,
  codes_NDCNUM_pregabalin_2020,
  codes_NDCNUM_tiagabine_2020,
  codes_NDCNUM_cannabidiol_2020,
  codes_NDCNUM_gabapentin_2020,
  codes_NDCNUM_fenfluramine_2020,
  codes_NDCNUM_methsuximide_2020
)




############################################2021############################################
codes_NDCNUM_phenobarbital_2021 <- redbook_2021_data %>% 
  filter(
      grepl("phenobarb", GENNME, ignore.case=TRUE) |
      grepl("phenobarb", THRDTDS, ignore.case=TRUE) |
      grepl("phenobarb", PRODNME, ignore.case=TRUE) |
      grepl("luminal", PRODNME, ignore.case=TRUE) |
      grepl("solfoton", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("/", GENNME, ignore.case=TRUE) &
    !grepl("/", PRODNME, ignore.case=TRUE) &
    !grepl("/", THRDTDS, ignore.case=TRUE) &
    !grepl("&", GENNME, ignore.case=TRUE) &
    !grepl("&", PRODNME, ignore.case=TRUE) &
    !grepl("&", THRDTDS, ignore.case=TRUE) &
    !grepl("-", GENNME, ignore.case=TRUE) &
    !grepl("-", PRODNME, ignore.case=TRUE) &
    !grepl("-", THRDTDS, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_phenobarbital_2021 <- as.numeric(codes_NDCNUM_phenobarbital_2021)


codes_NDCNUM_phenytoin_2021 <- redbook_2021_data %>% 
  filter(
      grepl("phenytoin", GENNME, ignore.case=TRUE) |
      grepl("phenytoin", THRDTDS, ignore.case=TRUE) |
      grepl("phenytoin", PRODNME, ignore.case=TRUE) |
      grepl("dilantin", PRODNME, ignore.case=TRUE) |
      grepl("phenytek", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_phenytoin_2021 <- as.numeric(codes_NDCNUM_phenytoin_2021)


codes_NDCNUM_valproate_2021 <- redbook_2021_data %>% 
  filter(
      grepl("valpro", GENNME, ignore.case=TRUE) |
      grepl("valpro", THRDTDS, ignore.case=TRUE) |
      grepl("valpro", PRODNME, ignore.case=TRUE) |
      grepl("depakene", PRODNME, ignore.case=TRUE) |
      grepl("depakote", PRODNME, ignore.case=TRUE) |
      grepl("depacon", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_valproate_2021 <- as.numeric(codes_NDCNUM_valproate_2021)


codes_NDCNUM_carbamazepine_2021 <- redbook_2021_data %>% 
  filter(
      grepl("carbamazepine", GENNME, ignore.case=TRUE) |
      grepl("carbamazepine", THRDTDS, ignore.case=TRUE) |
      grepl("carbamazepine", PRODNME, ignore.case=TRUE) |
      grepl("tegretol", PRODNME, ignore.case=TRUE) |
      grepl("carbatrol", PRODNME, ignore.case=TRUE) |
      grepl("epitol", PRODNME, ignore.case=TRUE) |
      grepl("equetro", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("atretol", PRODNME, ignore.case=TRUE)
    ) %>%   
  pull(NDCNUM)
codes_NDCNUM_carbamazepine_2021 <- as.numeric(codes_NDCNUM_carbamazepine_2021)


codes_NDCNUM_oxcarbazepine_2021 <- redbook_2021_data %>% 
  filter(
      grepl("oxcarbazepine", GENNME, ignore.case=TRUE) |
      grepl("oxcarbazepine", THRDTDS, ignore.case=TRUE) |
      grepl("oxcarbazepine", PRODNME, ignore.case=TRUE) |
      grepl("oxtellar", PRODNME, ignore.case=TRUE) |
      grepl("trileptal", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_oxcarbazepine_2021 <- as.numeric(codes_NDCNUM_oxcarbazepine_2021)


codes_NDCNUM_rufinamide_2021 <- redbook_2021_data %>% 
  filter(
      grepl("rufinamide", GENNME, ignore.case=TRUE) |
      grepl("rufinamide", THRDTDS, ignore.case=TRUE) |
      grepl("rufinamide", PRODNME, ignore.case=TRUE) |
      grepl("banzel", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_rufinamide_2021 <- as.numeric(codes_NDCNUM_rufinamide_2021)


codes_NDCNUM_levetiracetam_2021 <- redbook_2021_data %>% 
  filter(
      grepl("levetiracetam", GENNME, ignore.case=TRUE) |
      grepl("levetiracetam", THRDTDS, ignore.case=TRUE) |
      grepl("levetiracetam", PRODNME, ignore.case=TRUE) |
      grepl("elepsia", PRODNME, ignore.case=TRUE) |
      grepl("keppra", PRODNME, ignore.case=TRUE) |
      grepl("roweepra", PRODNME, ignore.case=TRUE) |
      grepl("spritam", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_levetiracetam_2021 <- as.numeric(codes_NDCNUM_levetiracetam_2021)


codes_NDCNUM_lamotrigine_2021 <- redbook_2021_data %>% 
  filter(
      grepl("lamotrigine", GENNME, ignore.case=TRUE) |
      grepl("lamotrigine", THRDTDS, ignore.case=TRUE) |
      grepl("lamotrigine", PRODNME, ignore.case=TRUE) |
      grepl("lamictal", PRODNME, ignore.case=TRUE) |
      grepl("subvenite", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_lamotrigine_2021 <- as.numeric(codes_NDCNUM_lamotrigine_2021)


codes_NDCNUM_brivaracetam_2021 <- redbook_2021_data %>% 
  filter(
      grepl("brivaracetam", GENNME, ignore.case=TRUE) |
      grepl("brivaracetam", THRDTDS, ignore.case=TRUE) |
      grepl("brivaracetam", PRODNME, ignore.case=TRUE) |
      grepl("briviact", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_brivaracetam_2021 <- as.numeric(codes_NDCNUM_brivaracetam_2021)


codes_NDCNUM_cenobamate_2021 <- redbook_2021_data %>% 
  filter(
      grepl("cenobamate", GENNME, ignore.case=TRUE) |
      grepl("cenobamate", THRDTDS, ignore.case=TRUE) |
      grepl("cenobamate", PRODNME, ignore.case=TRUE) |
      grepl("xcopri", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_cenobamate_2021 <- as.numeric(codes_NDCNUM_cenobamate_2021)


codes_NDCNUM_clobazam_2021 <- redbook_2021_data %>% 
  filter(
      grepl("clobazam", GENNME, ignore.case=TRUE) |
      grepl("clobazam", THRDTDS, ignore.case=TRUE) |
      grepl("clobazam", PRODNME, ignore.case=TRUE) |
      grepl("onfi", PRODNME, ignore.case=TRUE) |
      grepl("sympazan", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("HIV", GENNME, ignore.case=TRUE) &
    !grepl("pregnancy", GENNME, ignore.case=TRUE) &
    !grepl("denture", GENNME, ignore.case=TRUE) &
    !grepl("hyoscyamine", GENNME, ignore.case=TRUE) &
    !grepl("glucose", GENNME, ignore.case=TRUE) &
    !grepl("device", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_clobazam_2021 <- as.numeric(codes_NDCNUM_clobazam_2021)


codes_NDCNUM_eslicarbazepine_2021 <- redbook_2021_data %>% 
  filter(
      grepl("eslicarbazepine", GENNME, ignore.case=TRUE) |
      grepl("eslicarbazepine", THRDTDS, ignore.case=TRUE) |
      grepl("eslicarbazepine", PRODNME, ignore.case=TRUE) |
      grepl("aptiom", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_eslicarbazepine_2021 <- as.numeric(codes_NDCNUM_eslicarbazepine_2021)


codes_NDCNUM_ethosuximide_2021 <- redbook_2021_data %>% 
  filter(
      grepl("ethosuximide", GENNME, ignore.case=TRUE) |
      grepl("ethosuximide", THRDTDS, ignore.case=TRUE) |
      grepl("ethosuximide", PRODNME, ignore.case=TRUE) |
      grepl("zarontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_ethosuximide_2021 <- as.numeric(codes_NDCNUM_ethosuximide_2021)


codes_NDCNUM_lacosamide_2021 <- redbook_2021_data %>% 
  filter(
      grepl("lacosamide", GENNME, ignore.case=TRUE) |
      grepl("lacosamide", THRDTDS, ignore.case=TRUE) |
      grepl("lacosamide", PRODNME, ignore.case=TRUE) |
      grepl("vimpat", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_lacosamide_2021 <- as.numeric(codes_NDCNUM_lacosamide_2021)


codes_NDCNUM_perampanel_2021 <- redbook_2021_data %>% 
  filter(
      grepl("perampanel", GENNME, ignore.case=TRUE) |
      grepl("perampanel", THRDTDS, ignore.case=TRUE) |
      grepl("perampanel", PRODNME, ignore.case=TRUE) |
      grepl("fycompa", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_perampanel_2021 <- as.numeric(codes_NDCNUM_perampanel_2021)


codes_NDCNUM_stiripentol_2021 <- redbook_2021_data %>% 
  filter(
      grepl("stiripentol", GENNME, ignore.case=TRUE) |
      grepl("stiripentol", THRDTDS, ignore.case=TRUE) |
      grepl("stiripentol", PRODNME, ignore.case=TRUE) |
      grepl("diacomit", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_stiripentol_2021 <- as.numeric(codes_NDCNUM_stiripentol_2021)


codes_NDCNUM_topiramate_2021 <- redbook_2021_data %>% 
  filter(
      grepl("topiramate", GENNME, ignore.case=TRUE) |
      grepl("topiramate", THRDTDS, ignore.case=TRUE) |
      grepl("topiramate", PRODNME, ignore.case=TRUE) |
      grepl("eprontia", PRODNME, ignore.case=TRUE) |
      grepl("topamax", PRODNME, ignore.case=TRUE) |
      grepl("trokendi", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("/", GENNME, ignore.case=TRUE) &
    !grepl("/", PRODNME, ignore.case=TRUE) &
    !grepl("/", THRDTDS, ignore.case=TRUE) &
    !grepl("&", GENNME, ignore.case=TRUE) &
    !grepl("&", PRODNME, ignore.case=TRUE) &
    !grepl("&", THRDTDS, ignore.case=TRUE) &
    !grepl("-", GENNME, ignore.case=TRUE) &
    !grepl("-", PRODNME, ignore.case=TRUE) &
    !grepl("-", THRDTDS, ignore.case=TRUE) &
    !grepl("qudexy", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_topiramate_2021 <- as.numeric(codes_NDCNUM_topiramate_2021)


codes_NDCNUM_vigabatrin_2021 <- redbook_2021_data %>% 
  filter(
      grepl("vigabatrin", GENNME, ignore.case=TRUE) |
      grepl("vigabatrin", THRDTDS, ignore.case=TRUE) |
      grepl("vigabatrin", PRODNME, ignore.case=TRUE) |
      grepl("sabril", PRODNME, ignore.case=TRUE) |
      grepl("vigadrone", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_vigabatrin_2021 <- as.numeric(codes_NDCNUM_vigabatrin_2021)


codes_NDCNUM_zonisamide_2021 <- redbook_2021_data %>% 
  filter(
      grepl("zonisamide", GENNME, ignore.case=TRUE) |
      grepl("zonisamide", THRDTDS, ignore.case=TRUE) |
      grepl("zonisamide", PRODNME, ignore.case=TRUE) |
      grepl("zonegran", PRODNME, ignore.case=TRUE) |
      grepl("zonisade", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_zonisamide_2021 <- as.numeric(codes_NDCNUM_zonisamide_2021)


codes_NDCNUM_felbamate_2021 <- redbook_2021_data %>% 
  filter(
      grepl("felbamate", GENNME, ignore.case=TRUE) |
      grepl("felbamate", THRDTDS, ignore.case=TRUE) |
      grepl("felbamate", PRODNME, ignore.case=TRUE) |
      grepl("felbatol", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_felbamate_2021 <- as.numeric(codes_NDCNUM_felbamate_2021)


codes_NDCNUM_pregabalin_2021 <- redbook_2021_data %>% 
  filter(
      grepl("pregabalin", GENNME, ignore.case=TRUE) |
      grepl("pregabalin", THRDTDS, ignore.case=TRUE) |
      grepl("pregabalin", PRODNME, ignore.case=TRUE) |
      grepl("lyrica", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_pregabalin_2021 <- as.numeric(codes_NDCNUM_pregabalin_2021)


codes_NDCNUM_tiagabine_2021 <- redbook_2021_data %>% 
  filter(
      grepl("tiagabine", GENNME, ignore.case=TRUE) |
      grepl("tiagabine", THRDTDS, ignore.case=TRUE) |
      grepl("tiagabine", PRODNME, ignore.case=TRUE) |
      grepl("gabitril", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_tiagabine_2021 <- as.numeric(codes_NDCNUM_tiagabine_2021)


codes_NDCNUM_cannabidiol_2021 <- redbook_2021_data %>% 
  filter(
      grepl("epidiolex", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_cannabidiol_2021 <- as.numeric(codes_NDCNUM_cannabidiol_2021)


codes_NDCNUM_gabapentin_2021 <- redbook_2021_data %>% 
  filter(
      grepl("gabapentin", GENNME, ignore.case=TRUE) |
      grepl("gabapentin", THRDTDS, ignore.case=TRUE) |
      grepl("gabapentin", PRODNME, ignore.case=TRUE) |
      grepl("gralise", PRODNME, ignore.case=TRUE) |
      grepl("neurontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl(";", GENNME, ignore.case=TRUE) &
    !grepl("enacarbil", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_gabapentin_2021 <- as.numeric(codes_NDCNUM_gabapentin_2021)


codes_NDCNUM_fenfluramine_2021 <- redbook_2021_data %>% 
  filter(
      grepl("fenfluramine", GENNME, ignore.case=TRUE) |
      grepl("fenfluramine", THRDTDS, ignore.case=TRUE) |
      grepl("fenfluramine", PRODNME, ignore.case=TRUE) |
      grepl("fintepla", PRODNME, ignore.case=TRUE)
    ) %>% 
  filter(
    !grepl("dex", GENNME, ignore.case=TRUE) &
    !grepl("dex", THRDTDS, ignore.case=TRUE) &
    !grepl("hydrochloride", GENNME, ignore.case=TRUE) &    
    !grepl("hydrochloride", THRDTDS, ignore.case=TRUE) &
    !grepl("pondimin", PRODNME, ignore.case=TRUE) &
    !grepl("redux", GENNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_fenfluramine_2021 <- as.numeric(codes_NDCNUM_fenfluramine_2021)


codes_NDCNUM_methsuximide_2021 <- redbook_2021_data %>% 
  filter(
      grepl("methsuximide", GENNME, ignore.case=TRUE) |
      grepl("methsuximide", THRDTDS, ignore.case=TRUE) |
      grepl("methsuximide", PRODNME, ignore.case=TRUE) |
      grepl("celontin", PRODNME, ignore.case=TRUE)
    ) %>% 
  pull(NDCNUM)
codes_NDCNUM_methsuximide_2021 <- as.numeric(codes_NDCNUM_methsuximide_2021)


codes_NDCNUM_ASM_2021 <- c(
  codes_NDCNUM_phenobarbital_2021,
  codes_NDCNUM_phenytoin_2021,
  codes_NDCNUM_valproate_2021,
  codes_NDCNUM_carbamazepine_2021,
  codes_NDCNUM_oxcarbazepine_2021,
  codes_NDCNUM_rufinamide_2021,
  codes_NDCNUM_levetiracetam_2021,
  codes_NDCNUM_lamotrigine_2021,
  codes_NDCNUM_brivaracetam_2021,
  codes_NDCNUM_cenobamate_2021,
  codes_NDCNUM_clobazam_2021,
  codes_NDCNUM_eslicarbazepine_2021,
  codes_NDCNUM_ethosuximide_2021,
  codes_NDCNUM_lacosamide_2021,
  codes_NDCNUM_perampanel_2021,
  codes_NDCNUM_stiripentol_2021,
  codes_NDCNUM_topiramate_2021,
  codes_NDCNUM_vigabatrin_2021,
  codes_NDCNUM_zonisamide_2021,
  codes_NDCNUM_felbamate_2021,
  codes_NDCNUM_pregabalin_2021,
  codes_NDCNUM_tiagabine_2021,
  codes_NDCNUM_cannabidiol_2021,
  codes_NDCNUM_gabapentin_2021,
  codes_NDCNUM_fenfluramine_2021,
  codes_NDCNUM_methsuximide_2021
)
```




Antiseizure medications in patients with epilepsy
```{r}
# Antiseizure medications in patients with epilepsy
############################################2006############################################
ASM_epilepsy_2006 <- ms_d_2006 %>% 
  filter(ENROLID %in% !!epilepsy$ENROLID) %>% 
  filter(NDCNUM %in% codes_NDCNUM_ASM_2006) %>%
  select(ENROLID, SVCDATE, AWP, COB, COINS, COPAY, DEDUCT, DISPFEE, GENERID, INGCOST, NETPAY, PAY, SALETAX, GENIND, DAYSUPP, RXMR, NDCNUM) %>% 
  mutate(across(c(ENROLID, AWP, COB, COINS, COPAY, DEDUCT, DISPFEE, GENERID, INGCOST, NETPAY, PAY, SALETAX, GENIND, DAYSUPP, RXMR, NDCNUM), as.numeric)) %>%
  collect() %>% 
  mutate(across(SVCDATE, mdy)) %>% 
  mutate(ASM = case_when(
    NDCNUM %in% codes_NDCNUM_phenobarbital_2006 ~ "phenobarbital",
    NDCNUM %in% codes_NDCNUM_phenytoin_2006 ~ "phenytoin",
    NDCNUM %in% codes_NDCNUM_valproate_2006 ~ "valproate",
    NDCNUM %in% codes_NDCNUM_carbamazepine_2006 ~ "carbamazepine",
    NDCNUM %in% codes_NDCNUM_oxcarbazepine_2006 ~ "oxcarbazepine",                                    NDCNUM %in% codes_NDCNUM_rufinamide_2006 ~ "rufinamide",       
    NDCNUM %in% codes_NDCNUM_levetiracetam_2006 ~ "levetiracetam",
    NDCNUM %in% codes_NDCNUM_lamotrigine_2006 ~ "lamotrigine",
    NDCNUM %in% codes_NDCNUM_brivaracetam_2006 ~ "brivaracetam",                                      NDCNUM %in% codes_NDCNUM_cenobamate_2006 ~ "cenobamate", 
    NDCNUM %in% codes_NDCNUM_clobazam_2006 ~ "clobazam",
    NDCNUM %in% codes_NDCNUM_eslicarbazepine_2006 ~ "eslicarbazepine",
    NDCNUM %in% codes_NDCNUM_ethosuximide_2006 ~ "ethosuximide",
    NDCNUM %in% codes_NDCNUM_lacosamide_2006 ~ "lacosamide",    
    NDCNUM %in% codes_NDCNUM_perampanel_2006 ~ "perampanel",
    NDCNUM %in% codes_NDCNUM_stiripentol_2006 ~ "stiripentol",
    NDCNUM %in% codes_NDCNUM_topiramate_2006 ~ "topiramate",
    NDCNUM %in% codes_NDCNUM_vigabatrin_2006 ~ "vigabatrin",
    NDCNUM %in% codes_NDCNUM_zonisamide_2006 ~ "zonisamide",
    NDCNUM %in% codes_NDCNUM_felbamate_2006 ~ "felbamate",
    NDCNUM %in% codes_NDCNUM_pregabalin_2006 ~ "pregabalin",
    NDCNUM %in% codes_NDCNUM_tiagabine_2006 ~ "tiagabine",                                     
    NDCNUM %in% codes_NDCNUM_cannabidiol_2006 ~ "cannabidiol",
    NDCNUM %in% codes_NDCNUM_gabapentin_2006 ~ "gabapentin",
    NDCNUM %in% codes_NDCNUM_fenfluramine_2006 ~ "fenfluramine",
    NDCNUM %in% codes_NDCNUM_methsuximide_2006 ~ "methsuximide"
  ))


############################################2007############################################
ASM_epilepsy_2007 <- ms_d_2007 %>% 
  filter(ENROLID %in% !!epilepsy$ENROLID) %>% 
  filter(NDCNUM %in% codes_NDCNUM_ASM_2007) %>%
  select(ENROLID, SVCDATE, AWP, COB, COINS, COPAY, DEDUCT, DISPFEE, GENERID, INGCOST, NETPAY, PAY, SALETAX, GENIND, DAYSUPP, RXMR, NDCNUM) %>% 
  mutate(across(c(ENROLID, AWP, COB, COINS, COPAY, DEDUCT, DISPFEE, GENERID, INGCOST, NETPAY, PAY, SALETAX, GENIND, DAYSUPP, RXMR, NDCNUM), as.numeric)) %>%
  collect() %>% 
  mutate(across(SVCDATE, mdy)) %>% 
  mutate(ASM = case_when(
    NDCNUM %in% codes_NDCNUM_phenobarbital_2007 ~ "phenobarbital",
    NDCNUM %in% codes_NDCNUM_phenytoin_2007 ~ "phenytoin",
    NDCNUM %in% codes_NDCNUM_valproate_2007 ~ "valproate",
    NDCNUM %in% codes_NDCNUM_carbamazepine_2007 ~ "carbamazepine",
    NDCNUM %in% codes_NDCNUM_oxcarbazepine_2007 ~ "oxcarbazepine",                                    NDCNUM %in% codes_NDCNUM_rufinamide_2007 ~ "rufinamide",       
    NDCNUM %in% codes_NDCNUM_levetiracetam_2007 ~ "levetiracetam",
    NDCNUM %in% codes_NDCNUM_lamotrigine_2007 ~ "lamotrigine",
    NDCNUM %in% codes_NDCNUM_brivaracetam_2007 ~ "brivaracetam",                                      NDCNUM %in% codes_NDCNUM_cenobamate_2007 ~ "cenobamate", 
    NDCNUM %in% codes_NDCNUM_clobazam_2007 ~ "clobazam",
    NDCNUM %in% codes_NDCNUM_eslicarbazepine_2007 ~ "eslicarbazepine",
    NDCNUM %in% codes_NDCNUM_ethosuximide_2007 ~ "ethosuximide",
    NDCNUM %in% codes_NDCNUM_lacosamide_2007 ~ "lacosamide",    
    NDCNUM %in% codes_NDCNUM_perampanel_2007 ~ "perampanel",
    NDCNUM %in% codes_NDCNUM_stiripentol_2007 ~ "stiripentol",
    NDCNUM %in% codes_NDCNUM_topiramate_2007 ~ "topiramate",
    NDCNUM %in% codes_NDCNUM_vigabatrin_2007 ~ "vigabatrin",
    NDCNUM %in% codes_NDCNUM_zonisamide_2007 ~ "zonisamide",
    NDCNUM %in% codes_NDCNUM_felbamate_2007 ~ "felbamate",
    NDCNUM %in% codes_NDCNUM_pregabalin_2007 ~ "pregabalin",
    NDCNUM %in% codes_NDCNUM_tiagabine_2007 ~ "tiagabine",                                     
    NDCNUM %in% codes_NDCNUM_cannabidiol_2007 ~ "cannabidiol",
    NDCNUM %in% codes_NDCNUM_gabapentin_2007 ~ "gabapentin",
    NDCNUM %in% codes_NDCNUM_fenfluramine_2007 ~ "fenfluramine",
    NDCNUM %in% codes_NDCNUM_methsuximide_2007 ~ "methsuximide"
  ))


############################################2008############################################
ASM_epilepsy_2008 <- ms_d_2008 %>% 
  filter(ENROLID %in% !!epilepsy$ENROLID) %>% 
  filter(NDCNUM %in% codes_NDCNUM_ASM_2008) %>%
  select(ENROLID, SVCDATE, AWP, COB, COINS, COPAY, DEDUCT, DISPFEE, GENERID, INGCOST, NETPAY, PAY, SALETAX, GENIND, DAYSUPP, RXMR, NDCNUM) %>% 
  mutate(across(c(ENROLID, AWP, COB, COINS, COPAY, DEDUCT, DISPFEE, GENERID, INGCOST, NETPAY, PAY, SALETAX, GENIND, DAYSUPP, RXMR, NDCNUM), as.numeric)) %>%
  collect() %>% 
  mutate(across(SVCDATE, mdy)) %>% 
  mutate(ASM = case_when(
    NDCNUM %in% codes_NDCNUM_phenobarbital_2008 ~ "phenobarbital",
    NDCNUM %in% codes_NDCNUM_phenytoin_2008 ~ "phenytoin",
    NDCNUM %in% codes_NDCNUM_valproate_2008 ~ "valproate",
    NDCNUM %in% codes_NDCNUM_carbamazepine_2008 ~ "carbamazepine",
    NDCNUM %in% codes_NDCNUM_oxcarbazepine_2008 ~ "oxcarbazepine",                                    NDCNUM %in% codes_NDCNUM_rufinamide_2008 ~ "rufinamide",       
    NDCNUM %in% codes_NDCNUM_levetiracetam_2008 ~ "levetiracetam",
    NDCNUM %in% codes_NDCNUM_lamotrigine_2008 ~ "lamotrigine",
    NDCNUM %in% codes_NDCNUM_brivaracetam_2008 ~ "brivaracetam",                                      NDCNUM %in% codes_NDCNUM_cenobamate_2008 ~ "cenobamate", 
    NDCNUM %in% codes_NDCNUM_clobazam_2008 ~ "clobazam",
    NDCNUM %in% codes_NDCNUM_eslicarbazepine_2008 ~ "eslicarbazepine",
    NDCNUM %in% codes_NDCNUM_ethosuximide_2008 ~ "ethosuximide",
    NDCNUM %in% codes_NDCNUM_lacosamide_2008 ~ "lacosamide",    
    NDCNUM %in% codes_NDCNUM_perampanel_2008 ~ "perampanel",
    NDCNUM %in% codes_NDCNUM_stiripentol_2008 ~ "stiripentol",
    NDCNUM %in% codes_NDCNUM_topiramate_2008 ~ "topiramate",
    NDCNUM %in% codes_NDCNUM_vigabatrin_2008 ~ "vigabatrin",
    NDCNUM %in% codes_NDCNUM_zonisamide_2008 ~ "zonisamide",
    NDCNUM %in% codes_NDCNUM_felbamate_2008 ~ "felbamate",
    NDCNUM %in% codes_NDCNUM_pregabalin_2008 ~ "pregabalin",
    NDCNUM %in% codes_NDCNUM_tiagabine_2008 ~ "tiagabine",                                     
    NDCNUM %in% codes_NDCNUM_cannabidiol_2008 ~ "cannabidiol",
    NDCNUM %in% codes_NDCNUM_gabapentin_2008 ~ "gabapentin",
    NDCNUM %in% codes_NDCNUM_fenfluramine_2008 ~ "fenfluramine",
    NDCNUM %in% codes_NDCNUM_methsuximide_2008 ~ "methsuximide"
  ))


############################################2009############################################
ASM_epilepsy_2009 <- ms_d_2009 %>% 
  filter(ENROLID %in% !!epilepsy$ENROLID) %>% 
  filter(NDCNUM %in% codes_NDCNUM_ASM_2009) %>%
  select(ENROLID, SVCDATE, AWP, COB, COINS, COPAY, DEDUCT, DISPFEE, GENERID, INGCOST, NETPAY, PAY, SALETAX, GENIND, DAYSUPP, RXMR, NDCNUM) %>% 
  mutate(across(c(ENROLID, AWP, COB, COINS, COPAY, DEDUCT, DISPFEE, GENERID, INGCOST, NETPAY, PAY, SALETAX, GENIND, DAYSUPP, RXMR, NDCNUM), as.numeric)) %>%
  collect() %>% 
  mutate(across(SVCDATE, mdy)) %>% 
  mutate(ASM = case_when(
    NDCNUM %in% codes_NDCNUM_phenobarbital_2009 ~ "phenobarbital",
    NDCNUM %in% codes_NDCNUM_phenytoin_2009 ~ "phenytoin",
    NDCNUM %in% codes_NDCNUM_valproate_2009 ~ "valproate",
    NDCNUM %in% codes_NDCNUM_carbamazepine_2009 ~ "carbamazepine",
    NDCNUM %in% codes_NDCNUM_oxcarbazepine_2009 ~ "oxcarbazepine",                                    NDCNUM %in% codes_NDCNUM_rufinamide_2009 ~ "rufinamide",       
    NDCNUM %in% codes_NDCNUM_levetiracetam_2009 ~ "levetiracetam",
    NDCNUM %in% codes_NDCNUM_lamotrigine_2009 ~ "lamotrigine",
    NDCNUM %in% codes_NDCNUM_brivaracetam_2009 ~ "brivaracetam",                                      NDCNUM %in% codes_NDCNUM_cenobamate_2009 ~ "cenobamate", 
    NDCNUM %in% codes_NDCNUM_clobazam_2009 ~ "clobazam",
    NDCNUM %in% codes_NDCNUM_eslicarbazepine_2009 ~ "eslicarbazepine",
    NDCNUM %in% codes_NDCNUM_ethosuximide_2009 ~ "ethosuximide",
    NDCNUM %in% codes_NDCNUM_lacosamide_2009 ~ "lacosamide",    
    NDCNUM %in% codes_NDCNUM_perampanel_2009 ~ "perampanel",
    NDCNUM %in% codes_NDCNUM_stiripentol_2009 ~ "stiripentol",
    NDCNUM %in% codes_NDCNUM_topiramate_2009 ~ "topiramate",
    NDCNUM %in% codes_NDCNUM_vigabatrin_2009 ~ "vigabatrin",
    NDCNUM %in% codes_NDCNUM_zonisamide_2009 ~ "zonisamide",
    NDCNUM %in% codes_NDCNUM_felbamate_2009 ~ "felbamate",
    NDCNUM %in% codes_NDCNUM_pregabalin_2009 ~ "pregabalin",
    NDCNUM %in% codes_NDCNUM_tiagabine_2009 ~ "tiagabine",                                     
    NDCNUM %in% codes_NDCNUM_cannabidiol_2009 ~ "cannabidiol",
    NDCNUM %in% codes_NDCNUM_gabapentin_2009 ~ "gabapentin",
    NDCNUM %in% codes_NDCNUM_fenfluramine_2009 ~ "fenfluramine",
    NDCNUM %in% codes_NDCNUM_methsuximide_2009 ~ "methsuximide"
  ))


############################################2010############################################
ASM_epilepsy_2010 <- ms_d_2010 %>% 
  filter(ENROLID %in% !!epilepsy$ENROLID) %>% 
  filter(NDCNUM %in% codes_NDCNUM_ASM_2010) %>%
  select(ENROLID, SVCDATE, AWP, COB, COINS, COPAY, DEDUCT, DISPFEE, GENERID, INGCOST, NETPAY, PAY, SALETAX, GENIND, DAYSUPP, RXMR, NDCNUM) %>% 
  mutate(across(c(ENROLID, AWP, COB, COINS, COPAY, DEDUCT, DISPFEE, GENERID, INGCOST, NETPAY, PAY, SALETAX, GENIND, DAYSUPP, RXMR, NDCNUM), as.numeric)) %>%
  collect() %>% 
  mutate(across(SVCDATE, mdy)) %>% 
  mutate(ASM = case_when(
    NDCNUM %in% codes_NDCNUM_phenobarbital_2010 ~ "phenobarbital",
    NDCNUM %in% codes_NDCNUM_phenytoin_2010 ~ "phenytoin",
    NDCNUM %in% codes_NDCNUM_valproate_2010 ~ "valproate",
    NDCNUM %in% codes_NDCNUM_carbamazepine_2010 ~ "carbamazepine",
    NDCNUM %in% codes_NDCNUM_oxcarbazepine_2010 ~ "oxcarbazepine",                                    NDCNUM %in% codes_NDCNUM_rufinamide_2010 ~ "rufinamide",       
    NDCNUM %in% codes_NDCNUM_levetiracetam_2010 ~ "levetiracetam",
    NDCNUM %in% codes_NDCNUM_lamotrigine_2010 ~ "lamotrigine",
    NDCNUM %in% codes_NDCNUM_brivaracetam_2010 ~ "brivaracetam",                                      NDCNUM %in% codes_NDCNUM_cenobamate_2010 ~ "cenobamate", 
    NDCNUM %in% codes_NDCNUM_clobazam_2010 ~ "clobazam",
    NDCNUM %in% codes_NDCNUM_eslicarbazepine_2010 ~ "eslicarbazepine",
    NDCNUM %in% codes_NDCNUM_ethosuximide_2010 ~ "ethosuximide",
    NDCNUM %in% codes_NDCNUM_lacosamide_2010 ~ "lacosamide",    
    NDCNUM %in% codes_NDCNUM_perampanel_2010 ~ "perampanel",
    NDCNUM %in% codes_NDCNUM_stiripentol_2010 ~ "stiripentol",
    NDCNUM %in% codes_NDCNUM_topiramate_2010 ~ "topiramate",
    NDCNUM %in% codes_NDCNUM_vigabatrin_2010 ~ "vigabatrin",
    NDCNUM %in% codes_NDCNUM_zonisamide_2010 ~ "zonisamide",
    NDCNUM %in% codes_NDCNUM_felbamate_2010 ~ "felbamate",
    NDCNUM %in% codes_NDCNUM_pregabalin_2010 ~ "pregabalin",
    NDCNUM %in% codes_NDCNUM_tiagabine_2010 ~ "tiagabine",                                     
    NDCNUM %in% codes_NDCNUM_cannabidiol_2010 ~ "cannabidiol",
    NDCNUM %in% codes_NDCNUM_gabapentin_2010 ~ "gabapentin",
    NDCNUM %in% codes_NDCNUM_fenfluramine_2010 ~ "fenfluramine",
    NDCNUM %in% codes_NDCNUM_methsuximide_2010 ~ "methsuximide"
  ))


############################################2011############################################
ASM_epilepsy_2011 <- ms_d_2011 %>% 
  filter(ENROLID %in% !!epilepsy$ENROLID) %>% 
  filter(NDCNUM %in% codes_NDCNUM_ASM_2011) %>%
  select(ENROLID, SVCDATE, AWP, COB, COINS, COPAY, DEDUCT, DISPFEE, GENERID, INGCOST, NETPAY, PAY, SALETAX, GENIND, DAYSUPP, RXMR, NDCNUM) %>% 
  mutate(across(c(ENROLID, AWP, COB, COINS, COPAY, DEDUCT, DISPFEE, GENERID, INGCOST, NETPAY, PAY, SALETAX, GENIND, DAYSUPP, RXMR, NDCNUM), as.numeric)) %>%
  collect() %>% 
  mutate(across(SVCDATE, mdy)) %>% 
  mutate(ASM = case_when(
    NDCNUM %in% codes_NDCNUM_phenobarbital_2011 ~ "phenobarbital",
    NDCNUM %in% codes_NDCNUM_phenytoin_2011 ~ "phenytoin",
    NDCNUM %in% codes_NDCNUM_valproate_2011 ~ "valproate",
    NDCNUM %in% codes_NDCNUM_carbamazepine_2011 ~ "carbamazepine",
    NDCNUM %in% codes_NDCNUM_oxcarbazepine_2011 ~ "oxcarbazepine",                                    NDCNUM %in% codes_NDCNUM_rufinamide_2011 ~ "rufinamide",       
    NDCNUM %in% codes_NDCNUM_levetiracetam_2011 ~ "levetiracetam",
    NDCNUM %in% codes_NDCNUM_lamotrigine_2011 ~ "lamotrigine",
    NDCNUM %in% codes_NDCNUM_brivaracetam_2011 ~ "brivaracetam",                                      NDCNUM %in% codes_NDCNUM_cenobamate_2011 ~ "cenobamate", 
    NDCNUM %in% codes_NDCNUM_clobazam_2011 ~ "clobazam",
    NDCNUM %in% codes_NDCNUM_eslicarbazepine_2011 ~ "eslicarbazepine",
    NDCNUM %in% codes_NDCNUM_ethosuximide_2011 ~ "ethosuximide",
    NDCNUM %in% codes_NDCNUM_lacosamide_2011 ~ "lacosamide",    
    NDCNUM %in% codes_NDCNUM_perampanel_2011 ~ "perampanel",
    NDCNUM %in% codes_NDCNUM_stiripentol_2011 ~ "stiripentol",
    NDCNUM %in% codes_NDCNUM_topiramate_2011 ~ "topiramate",
    NDCNUM %in% codes_NDCNUM_vigabatrin_2011 ~ "vigabatrin",
    NDCNUM %in% codes_NDCNUM_zonisamide_2011 ~ "zonisamide",
    NDCNUM %in% codes_NDCNUM_felbamate_2011 ~ "felbamate",
    NDCNUM %in% codes_NDCNUM_pregabalin_2011 ~ "pregabalin",
    NDCNUM %in% codes_NDCNUM_tiagabine_2011 ~ "tiagabine",                                     
    NDCNUM %in% codes_NDCNUM_cannabidiol_2011 ~ "cannabidiol",
    NDCNUM %in% codes_NDCNUM_gabapentin_2011 ~ "gabapentin",
    NDCNUM %in% codes_NDCNUM_fenfluramine_2011 ~ "fenfluramine",
    NDCNUM %in% codes_NDCNUM_methsuximide_2011 ~ "methsuximide"
  ))


############################################2012############################################
ASM_epilepsy_2012 <- ms_d_2012 %>% 
  filter(ENROLID %in% !!epilepsy$ENROLID) %>% 
  filter(NDCNUM %in% codes_NDCNUM_ASM_2012) %>%
  select(ENROLID, SVCDATE, AWP, COB, COINS, COPAY, DEDUCT, DISPFEE, GENERID, INGCOST, NETPAY, PAY, SALETAX, GENIND, DAYSUPP, RXMR, NDCNUM) %>% 
  mutate(across(c(ENROLID, AWP, COB, COINS, COPAY, DEDUCT, DISPFEE, GENERID, INGCOST, NETPAY, PAY, SALETAX, GENIND, DAYSUPP, RXMR, NDCNUM), as.numeric)) %>%
  collect() %>% 
  mutate(across(SVCDATE, mdy)) %>% 
  mutate(ASM = case_when(
    NDCNUM %in% codes_NDCNUM_phenobarbital_2012 ~ "phenobarbital",
    NDCNUM %in% codes_NDCNUM_phenytoin_2012 ~ "phenytoin",
    NDCNUM %in% codes_NDCNUM_valproate_2012 ~ "valproate",
    NDCNUM %in% codes_NDCNUM_carbamazepine_2012 ~ "carbamazepine",
    NDCNUM %in% codes_NDCNUM_oxcarbazepine_2012 ~ "oxcarbazepine",                                    NDCNUM %in% codes_NDCNUM_rufinamide_2012 ~ "rufinamide",       
    NDCNUM %in% codes_NDCNUM_levetiracetam_2012 ~ "levetiracetam",
    NDCNUM %in% codes_NDCNUM_lamotrigine_2012 ~ "lamotrigine",
    NDCNUM %in% codes_NDCNUM_brivaracetam_2012 ~ "brivaracetam",                                      NDCNUM %in% codes_NDCNUM_cenobamate_2012 ~ "cenobamate", 
    NDCNUM %in% codes_NDCNUM_clobazam_2012 ~ "clobazam",
    NDCNUM %in% codes_NDCNUM_eslicarbazepine_2012 ~ "eslicarbazepine",
    NDCNUM %in% codes_NDCNUM_ethosuximide_2012 ~ "ethosuximide",
    NDCNUM %in% codes_NDCNUM_lacosamide_2012 ~ "lacosamide",    
    NDCNUM %in% codes_NDCNUM_perampanel_2012 ~ "perampanel",
    NDCNUM %in% codes_NDCNUM_stiripentol_2012 ~ "stiripentol",
    NDCNUM %in% codes_NDCNUM_topiramate_2012 ~ "topiramate",
    NDCNUM %in% codes_NDCNUM_vigabatrin_2012 ~ "vigabatrin",
    NDCNUM %in% codes_NDCNUM_zonisamide_2012 ~ "zonisamide",
    NDCNUM %in% codes_NDCNUM_felbamate_2012 ~ "felbamate",
    NDCNUM %in% codes_NDCNUM_pregabalin_2012 ~ "pregabalin",
    NDCNUM %in% codes_NDCNUM_tiagabine_2012 ~ "tiagabine",                                     
    NDCNUM %in% codes_NDCNUM_cannabidiol_2012 ~ "cannabidiol",
    NDCNUM %in% codes_NDCNUM_gabapentin_2012 ~ "gabapentin",
    NDCNUM %in% codes_NDCNUM_fenfluramine_2012 ~ "fenfluramine",
    NDCNUM %in% codes_NDCNUM_methsuximide_2012 ~ "methsuximide"
  ))


############################################2013############################################
ASM_epilepsy_2013 <- ms_d_2013 %>% 
  filter(ENROLID %in% !!epilepsy$ENROLID) %>% 
  filter(NDCNUM %in% codes_NDCNUM_ASM_2013) %>%
  select(ENROLID, SVCDATE, AWP, COB, COINS, COPAY, DEDUCT, DISPFEE, GENERID, INGCOST, NETPAY, PAY, SALETAX, GENIND, DAYSUPP, RXMR, NDCNUM) %>% 
  mutate(across(c(ENROLID, AWP, COB, COINS, COPAY, DEDUCT, DISPFEE, GENERID, INGCOST, NETPAY, PAY, SALETAX, GENIND, DAYSUPP, RXMR, NDCNUM), as.numeric)) %>%
  collect() %>% 
  mutate(across(SVCDATE, mdy)) %>% 
  mutate(ASM = case_when(
    NDCNUM %in% codes_NDCNUM_phenobarbital_2013 ~ "phenobarbital",
    NDCNUM %in% codes_NDCNUM_phenytoin_2013 ~ "phenytoin",
    NDCNUM %in% codes_NDCNUM_valproate_2013 ~ "valproate",
    NDCNUM %in% codes_NDCNUM_carbamazepine_2013 ~ "carbamazepine",
    NDCNUM %in% codes_NDCNUM_oxcarbazepine_2013 ~ "oxcarbazepine",                                    NDCNUM %in% codes_NDCNUM_rufinamide_2013 ~ "rufinamide",       
    NDCNUM %in% codes_NDCNUM_levetiracetam_2013 ~ "levetiracetam",
    NDCNUM %in% codes_NDCNUM_lamotrigine_2013 ~ "lamotrigine",
    NDCNUM %in% codes_NDCNUM_brivaracetam_2013 ~ "brivaracetam",                                      NDCNUM %in% codes_NDCNUM_cenobamate_2013 ~ "cenobamate", 
    NDCNUM %in% codes_NDCNUM_clobazam_2013 ~ "clobazam",
    NDCNUM %in% codes_NDCNUM_eslicarbazepine_2013 ~ "eslicarbazepine",
    NDCNUM %in% codes_NDCNUM_ethosuximide_2013 ~ "ethosuximide",
    NDCNUM %in% codes_NDCNUM_lacosamide_2013 ~ "lacosamide",    
    NDCNUM %in% codes_NDCNUM_perampanel_2013 ~ "perampanel",
    NDCNUM %in% codes_NDCNUM_stiripentol_2013 ~ "stiripentol",
    NDCNUM %in% codes_NDCNUM_topiramate_2013 ~ "topiramate",
    NDCNUM %in% codes_NDCNUM_vigabatrin_2013 ~ "vigabatrin",
    NDCNUM %in% codes_NDCNUM_zonisamide_2013 ~ "zonisamide",
    NDCNUM %in% codes_NDCNUM_felbamate_2013 ~ "felbamate",
    NDCNUM %in% codes_NDCNUM_pregabalin_2013 ~ "pregabalin",
    NDCNUM %in% codes_NDCNUM_tiagabine_2013 ~ "tiagabine",                                     
    NDCNUM %in% codes_NDCNUM_cannabidiol_2013 ~ "cannabidiol",
    NDCNUM %in% codes_NDCNUM_gabapentin_2013 ~ "gabapentin",
    NDCNUM %in% codes_NDCNUM_fenfluramine_2013 ~ "fenfluramine",
    NDCNUM %in% codes_NDCNUM_methsuximide_2013 ~ "methsuximide"
  ))


############################################2014############################################
ASM_epilepsy_2014 <- ms_d_2014 %>% 
  filter(ENROLID %in% !!epilepsy$ENROLID) %>% 
  filter(NDCNUM %in% codes_NDCNUM_ASM_2014) %>%
  select(ENROLID, SVCDATE, AWP, COB, COINS, COPAY, DEDUCT, DISPFEE, GENERID, INGCOST, NETPAY, PAY, SALETAX, GENIND, DAYSUPP, RXMR, NDCNUM) %>% 
  mutate(across(c(ENROLID, AWP, COB, COINS, COPAY, DEDUCT, DISPFEE, GENERID, INGCOST, NETPAY, PAY, SALETAX, GENIND, DAYSUPP, RXMR, NDCNUM), as.numeric)) %>%
  collect() %>% 
  mutate(across(SVCDATE, mdy)) %>% 
  mutate(ASM = case_when(
    NDCNUM %in% codes_NDCNUM_phenobarbital_2014 ~ "phenobarbital",
    NDCNUM %in% codes_NDCNUM_phenytoin_2014 ~ "phenytoin",
    NDCNUM %in% codes_NDCNUM_valproate_2014 ~ "valproate",
    NDCNUM %in% codes_NDCNUM_carbamazepine_2014 ~ "carbamazepine",
    NDCNUM %in% codes_NDCNUM_oxcarbazepine_2014 ~ "oxcarbazepine",                                    NDCNUM %in% codes_NDCNUM_rufinamide_2014 ~ "rufinamide",       
    NDCNUM %in% codes_NDCNUM_levetiracetam_2014 ~ "levetiracetam",
    NDCNUM %in% codes_NDCNUM_lamotrigine_2014 ~ "lamotrigine",
    NDCNUM %in% codes_NDCNUM_brivaracetam_2014 ~ "brivaracetam",                                      NDCNUM %in% codes_NDCNUM_cenobamate_2014 ~ "cenobamate", 
    NDCNUM %in% codes_NDCNUM_clobazam_2014 ~ "clobazam",
    NDCNUM %in% codes_NDCNUM_eslicarbazepine_2014 ~ "eslicarbazepine",
    NDCNUM %in% codes_NDCNUM_ethosuximide_2014 ~ "ethosuximide",
    NDCNUM %in% codes_NDCNUM_lacosamide_2014 ~ "lacosamide",    
    NDCNUM %in% codes_NDCNUM_perampanel_2014 ~ "perampanel",
    NDCNUM %in% codes_NDCNUM_stiripentol_2014 ~ "stiripentol",
    NDCNUM %in% codes_NDCNUM_topiramate_2014 ~ "topiramate",
    NDCNUM %in% codes_NDCNUM_vigabatrin_2014 ~ "vigabatrin",
    NDCNUM %in% codes_NDCNUM_zonisamide_2014 ~ "zonisamide",
    NDCNUM %in% codes_NDCNUM_felbamate_2014 ~ "felbamate",
    NDCNUM %in% codes_NDCNUM_pregabalin_2014 ~ "pregabalin",
    NDCNUM %in% codes_NDCNUM_tiagabine_2014 ~ "tiagabine",                                     
    NDCNUM %in% codes_NDCNUM_cannabidiol_2014 ~ "cannabidiol",
    NDCNUM %in% codes_NDCNUM_gabapentin_2014 ~ "gabapentin",
    NDCNUM %in% codes_NDCNUM_fenfluramine_2014 ~ "fenfluramine",
    NDCNUM %in% codes_NDCNUM_methsuximide_2014 ~ "methsuximide"
  ))


############################################2015############################################
ASM_epilepsy_2015 <- ms_d_2015 %>% 
  filter(ENROLID %in% !!epilepsy$ENROLID) %>% 
  filter(NDCNUM %in% codes_NDCNUM_ASM_2015) %>%
  select(ENROLID, SVCDATE, AWP, COB, COINS, COPAY, DEDUCT, DISPFEE, GENERID, INGCOST, NETPAY, PAY, SALETAX, GENIND, DAYSUPP, RXMR, NDCNUM) %>% 
  mutate(across(c(ENROLID, AWP, COB, COINS, COPAY, DEDUCT, DISPFEE, GENERID, INGCOST, NETPAY, PAY, SALETAX, GENIND, DAYSUPP, RXMR, NDCNUM), as.numeric)) %>%
  collect() %>% 
  mutate(across(SVCDATE, mdy)) %>% 
  mutate(ASM = case_when(
    NDCNUM %in% codes_NDCNUM_phenobarbital_2015 ~ "phenobarbital",
    NDCNUM %in% codes_NDCNUM_phenytoin_2015 ~ "phenytoin",
    NDCNUM %in% codes_NDCNUM_valproate_2015 ~ "valproate",
    NDCNUM %in% codes_NDCNUM_carbamazepine_2015 ~ "carbamazepine",
    NDCNUM %in% codes_NDCNUM_oxcarbazepine_2015 ~ "oxcarbazepine",                                    NDCNUM %in% codes_NDCNUM_rufinamide_2015 ~ "rufinamide",       
    NDCNUM %in% codes_NDCNUM_levetiracetam_2015 ~ "levetiracetam",
    NDCNUM %in% codes_NDCNUM_lamotrigine_2015 ~ "lamotrigine",
    NDCNUM %in% codes_NDCNUM_brivaracetam_2015 ~ "brivaracetam",                                      NDCNUM %in% codes_NDCNUM_cenobamate_2015 ~ "cenobamate", 
    NDCNUM %in% codes_NDCNUM_clobazam_2015 ~ "clobazam",
    NDCNUM %in% codes_NDCNUM_eslicarbazepine_2015 ~ "eslicarbazepine",
    NDCNUM %in% codes_NDCNUM_ethosuximide_2015 ~ "ethosuximide",
    NDCNUM %in% codes_NDCNUM_lacosamide_2015 ~ "lacosamide",    
    NDCNUM %in% codes_NDCNUM_perampanel_2015 ~ "perampanel",
    NDCNUM %in% codes_NDCNUM_stiripentol_2015 ~ "stiripentol",
    NDCNUM %in% codes_NDCNUM_topiramate_2015 ~ "topiramate",
    NDCNUM %in% codes_NDCNUM_vigabatrin_2015 ~ "vigabatrin",
    NDCNUM %in% codes_NDCNUM_zonisamide_2015 ~ "zonisamide",
    NDCNUM %in% codes_NDCNUM_felbamate_2015 ~ "felbamate",
    NDCNUM %in% codes_NDCNUM_pregabalin_2015 ~ "pregabalin",
    NDCNUM %in% codes_NDCNUM_tiagabine_2015 ~ "tiagabine",                                     
    NDCNUM %in% codes_NDCNUM_cannabidiol_2015 ~ "cannabidiol",
    NDCNUM %in% codes_NDCNUM_gabapentin_2015 ~ "gabapentin",
    NDCNUM %in% codes_NDCNUM_fenfluramine_2015 ~ "fenfluramine",
    NDCNUM %in% codes_NDCNUM_methsuximide_2015 ~ "methsuximide"
  ))


############################################2016############################################
ASM_epilepsy_2016 <- ms_d_2016 %>% 
  filter(ENROLID %in% !!epilepsy$ENROLID) %>% 
  filter(NDCNUM %in% codes_NDCNUM_ASM_2016) %>%
  select(ENROLID, SVCDATE, AWP, COB, COINS, COPAY, DEDUCT, DISPFEE, GENERID, INGCOST, NETPAY, PAY, SALETAX, GENIND, DAYSUPP, RXMR, NDCNUM) %>% 
  mutate(across(c(ENROLID, AWP, COB, COINS, COPAY, DEDUCT, DISPFEE, GENERID, INGCOST, NETPAY, PAY, SALETAX, GENIND, DAYSUPP, RXMR, NDCNUM), as.numeric)) %>%
  collect() %>% 
  mutate(across(SVCDATE, mdy)) %>% 
  mutate(ASM = case_when(
    NDCNUM %in% codes_NDCNUM_phenobarbital_2016 ~ "phenobarbital",
    NDCNUM %in% codes_NDCNUM_phenytoin_2016 ~ "phenytoin",
    NDCNUM %in% codes_NDCNUM_valproate_2016 ~ "valproate",
    NDCNUM %in% codes_NDCNUM_carbamazepine_2016 ~ "carbamazepine",
    NDCNUM %in% codes_NDCNUM_oxcarbazepine_2016 ~ "oxcarbazepine",                                    NDCNUM %in% codes_NDCNUM_rufinamide_2016 ~ "rufinamide",       
    NDCNUM %in% codes_NDCNUM_levetiracetam_2016 ~ "levetiracetam",
    NDCNUM %in% codes_NDCNUM_lamotrigine_2016 ~ "lamotrigine",
    NDCNUM %in% codes_NDCNUM_brivaracetam_2016 ~ "brivaracetam",                                      NDCNUM %in% codes_NDCNUM_cenobamate_2016 ~ "cenobamate", 
    NDCNUM %in% codes_NDCNUM_clobazam_2016 ~ "clobazam",
    NDCNUM %in% codes_NDCNUM_eslicarbazepine_2016 ~ "eslicarbazepine",
    NDCNUM %in% codes_NDCNUM_ethosuximide_2016 ~ "ethosuximide",
    NDCNUM %in% codes_NDCNUM_lacosamide_2016 ~ "lacosamide",    
    NDCNUM %in% codes_NDCNUM_perampanel_2016 ~ "perampanel",
    NDCNUM %in% codes_NDCNUM_stiripentol_2016 ~ "stiripentol",
    NDCNUM %in% codes_NDCNUM_topiramate_2016 ~ "topiramate",
    NDCNUM %in% codes_NDCNUM_vigabatrin_2016 ~ "vigabatrin",
    NDCNUM %in% codes_NDCNUM_zonisamide_2016 ~ "zonisamide",
    NDCNUM %in% codes_NDCNUM_felbamate_2016 ~ "felbamate",
    NDCNUM %in% codes_NDCNUM_pregabalin_2016 ~ "pregabalin",
    NDCNUM %in% codes_NDCNUM_tiagabine_2016 ~ "tiagabine",                                     
    NDCNUM %in% codes_NDCNUM_cannabidiol_2016 ~ "cannabidiol",
    NDCNUM %in% codes_NDCNUM_gabapentin_2016 ~ "gabapentin",
    NDCNUM %in% codes_NDCNUM_fenfluramine_2016 ~ "fenfluramine",
    NDCNUM %in% codes_NDCNUM_methsuximide_2016 ~ "methsuximide"
  ))


############################################2017############################################
ASM_epilepsy_2017 <- ms_d_2017 %>% 
  filter(ENROLID %in% !!epilepsy$ENROLID) %>% 
  filter(NDCNUM %in% codes_NDCNUM_ASM_2017) %>%
  select(ENROLID, SVCDATE, AWP, COB, COINS, COPAY, DEDUCT, DISPFEE, GENERID, INGCOST, NETPAY, PAY, SALETAX, GENIND, DAYSUPP, RXMR, NDCNUM) %>% 
  mutate(across(c(ENROLID, AWP, COB, COINS, COPAY, DEDUCT, DISPFEE, GENERID, INGCOST, NETPAY, PAY, SALETAX, GENIND, DAYSUPP, RXMR, NDCNUM), as.numeric)) %>%
  collect() %>% 
  mutate(across(SVCDATE, mdy)) %>% 
  mutate(ASM = case_when(
    NDCNUM %in% codes_NDCNUM_phenobarbital_2017 ~ "phenobarbital",
    NDCNUM %in% codes_NDCNUM_phenytoin_2017 ~ "phenytoin",
    NDCNUM %in% codes_NDCNUM_valproate_2017 ~ "valproate",
    NDCNUM %in% codes_NDCNUM_carbamazepine_2017 ~ "carbamazepine",
    NDCNUM %in% codes_NDCNUM_oxcarbazepine_2017 ~ "oxcarbazepine",                                    NDCNUM %in% codes_NDCNUM_rufinamide_2017 ~ "rufinamide",       
    NDCNUM %in% codes_NDCNUM_levetiracetam_2017 ~ "levetiracetam",
    NDCNUM %in% codes_NDCNUM_lamotrigine_2017 ~ "lamotrigine",
    NDCNUM %in% codes_NDCNUM_brivaracetam_2017 ~ "brivaracetam",                                      NDCNUM %in% codes_NDCNUM_cenobamate_2017 ~ "cenobamate", 
    NDCNUM %in% codes_NDCNUM_clobazam_2017 ~ "clobazam",
    NDCNUM %in% codes_NDCNUM_eslicarbazepine_2017 ~ "eslicarbazepine",
    NDCNUM %in% codes_NDCNUM_ethosuximide_2017 ~ "ethosuximide",
    NDCNUM %in% codes_NDCNUM_lacosamide_2017 ~ "lacosamide",    
    NDCNUM %in% codes_NDCNUM_perampanel_2017 ~ "perampanel",
    NDCNUM %in% codes_NDCNUM_stiripentol_2017 ~ "stiripentol",
    NDCNUM %in% codes_NDCNUM_topiramate_2017 ~ "topiramate",
    NDCNUM %in% codes_NDCNUM_vigabatrin_2017 ~ "vigabatrin",
    NDCNUM %in% codes_NDCNUM_zonisamide_2017 ~ "zonisamide",
    NDCNUM %in% codes_NDCNUM_felbamate_2017 ~ "felbamate",
    NDCNUM %in% codes_NDCNUM_pregabalin_2017 ~ "pregabalin",
    NDCNUM %in% codes_NDCNUM_tiagabine_2017 ~ "tiagabine",                                     
    NDCNUM %in% codes_NDCNUM_cannabidiol_2017 ~ "cannabidiol",
    NDCNUM %in% codes_NDCNUM_gabapentin_2017 ~ "gabapentin",
    NDCNUM %in% codes_NDCNUM_fenfluramine_2017 ~ "fenfluramine",
    NDCNUM %in% codes_NDCNUM_methsuximide_2017 ~ "methsuximide"
  ))


############################################2018############################################
ASM_epilepsy_2018 <- ms_d_2018 %>% 
  filter(ENROLID %in% !!epilepsy$ENROLID) %>% 
  filter(NDCNUM %in% codes_NDCNUM_ASM_2018) %>%
  select(ENROLID, SVCDATE, AWP, COB, COINS, COPAY, DEDUCT, DISPFEE, GENERID, INGCOST, NETPAY, PAY, SALETAX, GENIND, DAYSUPP, RXMR, NDCNUM) %>% 
  mutate(across(c(ENROLID, AWP, COB, COINS, COPAY, DEDUCT, DISPFEE, GENERID, INGCOST, NETPAY, PAY, SALETAX, GENIND, DAYSUPP, RXMR, NDCNUM), as.numeric)) %>%
  collect() %>% 
  mutate(across(SVCDATE, mdy)) %>% 
  mutate(ASM = case_when(
    NDCNUM %in% codes_NDCNUM_phenobarbital_2018 ~ "phenobarbital",
    NDCNUM %in% codes_NDCNUM_phenytoin_2018 ~ "phenytoin",
    NDCNUM %in% codes_NDCNUM_valproate_2018 ~ "valproate",
    NDCNUM %in% codes_NDCNUM_carbamazepine_2018 ~ "carbamazepine",
    NDCNUM %in% codes_NDCNUM_oxcarbazepine_2018 ~ "oxcarbazepine",                                    NDCNUM %in% codes_NDCNUM_rufinamide_2018 ~ "rufinamide",       
    NDCNUM %in% codes_NDCNUM_levetiracetam_2018 ~ "levetiracetam",
    NDCNUM %in% codes_NDCNUM_lamotrigine_2018 ~ "lamotrigine",
    NDCNUM %in% codes_NDCNUM_brivaracetam_2018 ~ "brivaracetam",                                      NDCNUM %in% codes_NDCNUM_cenobamate_2018 ~ "cenobamate", 
    NDCNUM %in% codes_NDCNUM_clobazam_2018 ~ "clobazam",
    NDCNUM %in% codes_NDCNUM_eslicarbazepine_2018 ~ "eslicarbazepine",
    NDCNUM %in% codes_NDCNUM_ethosuximide_2018 ~ "ethosuximide",
    NDCNUM %in% codes_NDCNUM_lacosamide_2018 ~ "lacosamide",    
    NDCNUM %in% codes_NDCNUM_perampanel_2018 ~ "perampanel",
    NDCNUM %in% codes_NDCNUM_stiripentol_2018 ~ "stiripentol",
    NDCNUM %in% codes_NDCNUM_topiramate_2018 ~ "topiramate",
    NDCNUM %in% codes_NDCNUM_vigabatrin_2018 ~ "vigabatrin",
    NDCNUM %in% codes_NDCNUM_zonisamide_2018 ~ "zonisamide",
    NDCNUM %in% codes_NDCNUM_felbamate_2018 ~ "felbamate",
    NDCNUM %in% codes_NDCNUM_pregabalin_2018 ~ "pregabalin",
    NDCNUM %in% codes_NDCNUM_tiagabine_2018 ~ "tiagabine",                                     
    NDCNUM %in% codes_NDCNUM_cannabidiol_2018 ~ "cannabidiol",
    NDCNUM %in% codes_NDCNUM_gabapentin_2018 ~ "gabapentin",
    NDCNUM %in% codes_NDCNUM_fenfluramine_2018 ~ "fenfluramine",
    NDCNUM %in% codes_NDCNUM_methsuximide_2018 ~ "methsuximide"
  ))


############################################2019############################################
ASM_epilepsy_2019 <- ms_d_2019 %>% 
  filter(ENROLID %in% !!epilepsy$ENROLID) %>% 
  filter(NDCNUM %in% codes_NDCNUM_ASM_2019) %>%
  select(ENROLID, SVCDATE, AWP, COB, COINS, COPAY, DEDUCT, DISPFEE, GENERID, INGCOST, NETPAY, PAY, SALETAX, GENIND, DAYSUPP, RXMR, NDCNUM) %>% 
  mutate(across(c(ENROLID, AWP, COB, COINS, COPAY, DEDUCT, DISPFEE, GENERID, INGCOST, NETPAY, PAY, SALETAX, GENIND, DAYSUPP, RXMR, NDCNUM), as.numeric)) %>%
  collect() %>% 
  mutate(across(SVCDATE, mdy)) %>% 
  mutate(ASM = case_when(
    NDCNUM %in% codes_NDCNUM_phenobarbital_2019 ~ "phenobarbital",
    NDCNUM %in% codes_NDCNUM_phenytoin_2019 ~ "phenytoin",
    NDCNUM %in% codes_NDCNUM_valproate_2019 ~ "valproate",
    NDCNUM %in% codes_NDCNUM_carbamazepine_2019 ~ "carbamazepine",
    NDCNUM %in% codes_NDCNUM_oxcarbazepine_2019 ~ "oxcarbazepine",                                    NDCNUM %in% codes_NDCNUM_rufinamide_2019 ~ "rufinamide",       
    NDCNUM %in% codes_NDCNUM_levetiracetam_2019 ~ "levetiracetam",
    NDCNUM %in% codes_NDCNUM_lamotrigine_2019 ~ "lamotrigine",
    NDCNUM %in% codes_NDCNUM_brivaracetam_2019 ~ "brivaracetam",                                      NDCNUM %in% codes_NDCNUM_cenobamate_2019 ~ "cenobamate", 
    NDCNUM %in% codes_NDCNUM_clobazam_2019 ~ "clobazam",
    NDCNUM %in% codes_NDCNUM_eslicarbazepine_2019 ~ "eslicarbazepine",
    NDCNUM %in% codes_NDCNUM_ethosuximide_2019 ~ "ethosuximide",
    NDCNUM %in% codes_NDCNUM_lacosamide_2019 ~ "lacosamide",    
    NDCNUM %in% codes_NDCNUM_perampanel_2019 ~ "perampanel",
    NDCNUM %in% codes_NDCNUM_stiripentol_2019 ~ "stiripentol",
    NDCNUM %in% codes_NDCNUM_topiramate_2019 ~ "topiramate",
    NDCNUM %in% codes_NDCNUM_vigabatrin_2019 ~ "vigabatrin",
    NDCNUM %in% codes_NDCNUM_zonisamide_2019 ~ "zonisamide",
    NDCNUM %in% codes_NDCNUM_felbamate_2019 ~ "felbamate",
    NDCNUM %in% codes_NDCNUM_pregabalin_2019 ~ "pregabalin",
    NDCNUM %in% codes_NDCNUM_tiagabine_2019 ~ "tiagabine",                                     
    NDCNUM %in% codes_NDCNUM_cannabidiol_2019 ~ "cannabidiol",
    NDCNUM %in% codes_NDCNUM_gabapentin_2019 ~ "gabapentin",
    NDCNUM %in% codes_NDCNUM_fenfluramine_2019 ~ "fenfluramine",
    NDCNUM %in% codes_NDCNUM_methsuximide_2019 ~ "methsuximide"
  ))


############################################2020############################################
ASM_epilepsy_2020 <- ms_d_2020 %>% 
  filter(ENROLID %in% !!epilepsy$ENROLID) %>% 
  filter(NDCNUM %in% codes_NDCNUM_ASM_2020) %>%
  select(ENROLID, SVCDATE, AWP, COB, COINS, COPAY, DEDUCT, DISPFEE, GENERID, INGCOST, NETPAY, PAY, SALETAX, GENIND, DAYSUPP, RXMR, NDCNUM) %>% 
  mutate(across(c(ENROLID, AWP, COB, COINS, COPAY, DEDUCT, DISPFEE, GENERID, INGCOST, NETPAY, PAY, SALETAX, GENIND, DAYSUPP, RXMR, NDCNUM), as.numeric)) %>%
  collect() %>% 
  mutate(across(SVCDATE, mdy)) %>% 
  mutate(ASM = case_when(
    NDCNUM %in% codes_NDCNUM_phenobarbital_2020 ~ "phenobarbital",
    NDCNUM %in% codes_NDCNUM_phenytoin_2020 ~ "phenytoin",
    NDCNUM %in% codes_NDCNUM_valproate_2020 ~ "valproate",
    NDCNUM %in% codes_NDCNUM_carbamazepine_2020 ~ "carbamazepine",
    NDCNUM %in% codes_NDCNUM_oxcarbazepine_2020 ~ "oxcarbazepine",                                    NDCNUM %in% codes_NDCNUM_rufinamide_2020 ~ "rufinamide",       
    NDCNUM %in% codes_NDCNUM_levetiracetam_2020 ~ "levetiracetam",
    NDCNUM %in% codes_NDCNUM_lamotrigine_2020 ~ "lamotrigine",
    NDCNUM %in% codes_NDCNUM_brivaracetam_2020 ~ "brivaracetam",                                      NDCNUM %in% codes_NDCNUM_cenobamate_2020 ~ "cenobamate", 
    NDCNUM %in% codes_NDCNUM_clobazam_2020 ~ "clobazam",
    NDCNUM %in% codes_NDCNUM_eslicarbazepine_2020 ~ "eslicarbazepine",
    NDCNUM %in% codes_NDCNUM_ethosuximide_2020 ~ "ethosuximide",
    NDCNUM %in% codes_NDCNUM_lacosamide_2020 ~ "lacosamide",    
    NDCNUM %in% codes_NDCNUM_perampanel_2020 ~ "perampanel",
    NDCNUM %in% codes_NDCNUM_stiripentol_2020 ~ "stiripentol",
    NDCNUM %in% codes_NDCNUM_topiramate_2020 ~ "topiramate",
    NDCNUM %in% codes_NDCNUM_vigabatrin_2020 ~ "vigabatrin",
    NDCNUM %in% codes_NDCNUM_zonisamide_2020 ~ "zonisamide",
    NDCNUM %in% codes_NDCNUM_felbamate_2020 ~ "felbamate",
    NDCNUM %in% codes_NDCNUM_pregabalin_2020 ~ "pregabalin",
    NDCNUM %in% codes_NDCNUM_tiagabine_2020 ~ "tiagabine",                                     
    NDCNUM %in% codes_NDCNUM_cannabidiol_2020 ~ "cannabidiol",
    NDCNUM %in% codes_NDCNUM_gabapentin_2020 ~ "gabapentin",
    NDCNUM %in% codes_NDCNUM_fenfluramine_2020 ~ "fenfluramine",
    NDCNUM %in% codes_NDCNUM_methsuximide_2020 ~ "methsuximide"
  ))


############################################2021############################################
ASM_epilepsy_2021 <- ms_d_2021 %>% 
  filter(ENROLID %in% !!epilepsy$ENROLID) %>% 
  filter(NDCNUM %in% codes_NDCNUM_ASM_2021) %>%
  select(ENROLID, SVCDATE, AWP, COB, COINS, COPAY, DEDUCT, DISPFEE, GENERID, INGCOST, NETPAY, PAY, SALETAX, GENIND, DAYSUPP, RXMR, NDCNUM) %>% 
  mutate(across(c(ENROLID, AWP, COB, COINS, COPAY, DEDUCT, DISPFEE, GENERID, INGCOST, NETPAY, PAY, SALETAX, GENIND, DAYSUPP, RXMR, NDCNUM), as.numeric)) %>%
  collect() %>% 
  mutate(across(SVCDATE, mdy)) %>% 
  mutate(ASM = case_when(
    NDCNUM %in% codes_NDCNUM_phenobarbital_2021 ~ "phenobarbital",
    NDCNUM %in% codes_NDCNUM_phenytoin_2021 ~ "phenytoin",
    NDCNUM %in% codes_NDCNUM_valproate_2021 ~ "valproate",
    NDCNUM %in% codes_NDCNUM_carbamazepine_2021 ~ "carbamazepine",
    NDCNUM %in% codes_NDCNUM_oxcarbazepine_2021 ~ "oxcarbazepine",                                    NDCNUM %in% codes_NDCNUM_rufinamide_2021 ~ "rufinamide",       
    NDCNUM %in% codes_NDCNUM_levetiracetam_2021 ~ "levetiracetam",
    NDCNUM %in% codes_NDCNUM_lamotrigine_2021 ~ "lamotrigine",
    NDCNUM %in% codes_NDCNUM_brivaracetam_2021 ~ "brivaracetam",                                      NDCNUM %in% codes_NDCNUM_cenobamate_2021 ~ "cenobamate", 
    NDCNUM %in% codes_NDCNUM_clobazam_2021 ~ "clobazam",
    NDCNUM %in% codes_NDCNUM_eslicarbazepine_2021 ~ "eslicarbazepine",
    NDCNUM %in% codes_NDCNUM_ethosuximide_2021 ~ "ethosuximide",
    NDCNUM %in% codes_NDCNUM_lacosamide_2021 ~ "lacosamide",    
    NDCNUM %in% codes_NDCNUM_perampanel_2021 ~ "perampanel",
    NDCNUM %in% codes_NDCNUM_stiripentol_2021 ~ "stiripentol",
    NDCNUM %in% codes_NDCNUM_topiramate_2021 ~ "topiramate",
    NDCNUM %in% codes_NDCNUM_vigabatrin_2021 ~ "vigabatrin",
    NDCNUM %in% codes_NDCNUM_zonisamide_2021 ~ "zonisamide",
    NDCNUM %in% codes_NDCNUM_felbamate_2021 ~ "felbamate",
    NDCNUM %in% codes_NDCNUM_pregabalin_2021 ~ "pregabalin",
    NDCNUM %in% codes_NDCNUM_tiagabine_2021 ~ "tiagabine",                                     
    NDCNUM %in% codes_NDCNUM_cannabidiol_2021 ~ "cannabidiol",
    NDCNUM %in% codes_NDCNUM_gabapentin_2021 ~ "gabapentin",
    NDCNUM %in% codes_NDCNUM_fenfluramine_2021 ~ "fenfluramine",
    NDCNUM %in% codes_NDCNUM_methsuximide_2021 ~ "methsuximide"
  ))




# Antiseizure medications
ASM_epilepsy <- bind_rows(ASM_epilepsy_2006, ASM_epilepsy_2007, ASM_epilepsy_2008, ASM_epilepsy_2009, ASM_epilepsy_2010, ASM_epilepsy_2011, ASM_epilepsy_2012, ASM_epilepsy_2013, ASM_epilepsy_2014, ASM_epilepsy_2015, ASM_epilepsy_2016, ASM_epilepsy_2017, ASM_epilepsy_2018, ASM_epilepsy_2019, ASM_epilepsy_2020, ASM_epilepsy_2021) %>% 
  filter(DAYSUPP > 0) %>% 
  group_by(ENROLID) %>% 
  mutate(total_DAYSUPP_per_patient = sum(DAYSUPP)) %>% 
  filter(total_DAYSUPP_per_patient >= 180) %>% 
  ungroup() %>% 
  mutate(ASM = factor(ASM)) %>%    
  mutate(GENIND = factor(GENIND)) %>% 
  mutate(RXMR = factor(RXMR)) %>%           
  arrange(ENROLID, SVCDATE) %>% 
  collect()
```




Adjustment for inflation
```{r}
# Inflation calculations (https://apps.bea.gov/iTable/?reqid=19&step=2&isuri=1&categories=survey#eyJhcHBpZCI6MTksInN0ZXBzIjpbMSwyLDMsM10sImRhdGEiOltbImNhdGVnb3JpZXMiLCJTdXJ2ZXkiXSxbIk5JUEFfVGFibGVfTGlzdCIsIjEzIl0sWyJGaXJzdF9ZZWFyIiwiMjAwNiJdLFsiTGFzdF9ZZWFyIiwiMjAyMiJdLFsiU2NhbGUiLCIwIl0sWyJTZXJpZXMiLCJRIl1dfQ== Last accessed 4/9/2023)
# https://meps.ahrq.gov/about_meps/Price_Index.shtml
inflation_2006_Q1 <- 0.89209
inflation_2006_Q2 <- 0.90000	
inflation_2006_Q3 <- 0.90628	
inflation_2006_Q4 <- 0.90967
inflation_2007_Q1 <- 0.91839
inflation_2007_Q2 <- 0.92453	
inflation_2007_Q3 <- 0.92933	
inflation_2007_Q4 <- 0.93327	
inflation_2008_Q1 <- 0.93655
inflation_2008_Q2 <- 0.94130	
inflation_2008_Q3 <- 0.94840	
inflation_2008_Q4 <- 0.95065
inflation_2009_Q1 <- 0.95018
inflation_2009_Q2 <- 0.94852	
inflation_2009_Q3 <- 0.94954	
inflation_2009_Q4 <- 0.95267	
inflation_2010_Q1 <- 0.95526
inflation_2010_Q2 <- 0.95992	
inflation_2010_Q3 <- 0.96282		
inflation_2010_Q4 <- 0.96846		
inflation_2011_Q1 <- 0.97346
inflation_2011_Q2 <- 0.97989	
inflation_2011_Q3 <- 0.98595	
inflation_2011_Q4 <- 0.98714	
inflation_2012_Q1 <- 0.99313	
inflation_2012_Q2 <- 0.99713	
inflation_2012_Q3 <- 1.00230
inflation_2012_Q4 <- 1.00738	
inflation_2013_Q1 <- 1.01141
inflation_2013_Q2 <- 1.01428		
inflation_2013_Q3 <- 1.01906
inflation_2013_Q4 <- 1.02515		
inflation_2014_Q1 <- 1.02942
inflation_2014_Q2 <- 1.03525	
inflation_2014_Q3 <- 1.03977
inflation_2014_Q4 <- 1.04150		
inflation_2015_Q1 <- 1.04113
inflation_2015_Q2 <- 1.04677	
inflation_2015_Q3 <- 1.04989
inflation_2015_Q4 <- 1.04979
inflation_2016_Q1 <- 1.04895
inflation_2016_Q2 <- 1.05636	
inflation_2016_Q3 <- 1.05929
inflation_2016_Q4 <- 1.06487
inflation_2017_Q1 <- 1.07038
inflation_2017_Q2 <- 1.07371		
inflation_2017_Q3 <- 1.07910
inflation_2017_Q4 <- 1.08653	
inflation_2018_Q1 <- 1.09320
inflation_2018_Q2 <- 1.10258		
inflation_2018_Q3 <- 1.10629
inflation_2018_Q4 <- 1.11132		
inflation_2019_Q1 <- 1.11562
inflation_2019_Q2 <- 1.12184		
inflation_2019_Q3 <- 1.12550
inflation_2019_Q4 <- 1.12963	
inflation_2020_Q1 <- 1.13418
inflation_2020_Q2 <- 1.12993		
inflation_2020_Q3 <- 1.13971
inflation_2020_Q4 <- 1.14692
inflation_2021_Q1 <- 1.16120	
inflation_2021_Q2 <- 1.17922		
inflation_2021_Q3 <- 1.19712
inflation_2021_Q4 <- 1.21708
inflation_2022_Q1 <- 1.24174	
inflation_2022_Q2 <- 1.26907		
inflation_2022_Q3 <- 1.28269
inflation_2022_Q4 <- 1.29508


# Cost adjusted for inflation (to Q4 2022 year, the most recent available quarter at the time of writing)
inflation_adjusted_ASM_epilepsy <- ASM_epilepsy %>% 
  mutate(year_quarter = quarter(SVCDATE, with_year=TRUE)) %>%
  mutate(
    AWP = case_when(
  year_quarter == 2006.1 ~ AWP*(inflation_2022_Q4/inflation_2006_Q1), 
  year_quarter == 2006.2 ~ AWP*(inflation_2022_Q4/inflation_2006_Q2),
  year_quarter == 2006.3 ~ AWP*(inflation_2022_Q4/inflation_2006_Q3),
  year_quarter == 2006.4 ~ AWP*(inflation_2022_Q4/inflation_2006_Q4),  
  year_quarter == 2007.1 ~ AWP*(inflation_2022_Q4/inflation_2007_Q1), 
  year_quarter == 2007.2 ~ AWP*(inflation_2022_Q4/inflation_2007_Q2),
  year_quarter == 2007.3 ~ AWP*(inflation_2022_Q4/inflation_2007_Q3),
  year_quarter == 2007.4 ~ AWP*(inflation_2022_Q4/inflation_2007_Q4),  
  year_quarter == 2008.1 ~ AWP*(inflation_2022_Q4/inflation_2008_Q1), 
  year_quarter == 2008.2 ~ AWP*(inflation_2022_Q4/inflation_2008_Q2),
  year_quarter == 2008.3 ~ AWP*(inflation_2022_Q4/inflation_2008_Q3),
  year_quarter == 2008.4 ~ AWP*(inflation_2022_Q4/inflation_2008_Q4), 
  year_quarter == 2009.1 ~ AWP*(inflation_2022_Q4/inflation_2009_Q1), 
  year_quarter == 2009.2 ~ AWP*(inflation_2022_Q4/inflation_2009_Q2),
  year_quarter == 2009.3 ~ AWP*(inflation_2022_Q4/inflation_2009_Q3),
  year_quarter == 2009.4 ~ AWP*(inflation_2022_Q4/inflation_2009_Q4), 
  year_quarter == 2010.1 ~ AWP*(inflation_2022_Q4/inflation_2010_Q1), 
  year_quarter == 2010.2 ~ AWP*(inflation_2022_Q4/inflation_2010_Q2),
  year_quarter == 2010.3 ~ AWP*(inflation_2022_Q4/inflation_2010_Q3),
  year_quarter == 2010.4 ~ AWP*(inflation_2022_Q4/inflation_2010_Q4), 
  year_quarter == 2011.1 ~ AWP*(inflation_2022_Q4/inflation_2011_Q1), 
  year_quarter == 2011.2 ~ AWP*(inflation_2022_Q4/inflation_2011_Q2),
  year_quarter == 2011.3 ~ AWP*(inflation_2022_Q4/inflation_2011_Q3),
  year_quarter == 2011.4 ~ AWP*(inflation_2022_Q4/inflation_2011_Q4), 
  year_quarter == 2012.1 ~ AWP*(inflation_2022_Q4/inflation_2012_Q1), 
  year_quarter == 2012.2 ~ AWP*(inflation_2022_Q4/inflation_2012_Q2),
  year_quarter == 2012.3 ~ AWP*(inflation_2022_Q4/inflation_2012_Q3),
  year_quarter == 2012.4 ~ AWP*(inflation_2022_Q4/inflation_2012_Q4), 
  year_quarter == 2013.1 ~ AWP*(inflation_2022_Q4/inflation_2013_Q1), 
  year_quarter == 2013.2 ~ AWP*(inflation_2022_Q4/inflation_2013_Q2),
  year_quarter == 2013.3 ~ AWP*(inflation_2022_Q4/inflation_2013_Q3),
  year_quarter == 2013.4 ~ AWP*(inflation_2022_Q4/inflation_2013_Q4), 
  year_quarter == 2014.1 ~ AWP*(inflation_2022_Q4/inflation_2014_Q1), 
  year_quarter == 2014.2 ~ AWP*(inflation_2022_Q4/inflation_2014_Q2),
  year_quarter == 2014.3 ~ AWP*(inflation_2022_Q4/inflation_2014_Q3),
  year_quarter == 2014.4 ~ AWP*(inflation_2022_Q4/inflation_2014_Q4),  
  year_quarter == 2015.1 ~ AWP*(inflation_2022_Q4/inflation_2015_Q1), 
  year_quarter == 2015.2 ~ AWP*(inflation_2022_Q4/inflation_2015_Q2),
  year_quarter == 2015.3 ~ AWP*(inflation_2022_Q4/inflation_2015_Q3),
  year_quarter == 2015.4 ~ AWP*(inflation_2022_Q4/inflation_2015_Q4),  
  year_quarter == 2016.1 ~ AWP*(inflation_2022_Q4/inflation_2016_Q1), 
  year_quarter == 2016.2 ~ AWP*(inflation_2022_Q4/inflation_2016_Q2),
  year_quarter == 2016.3 ~ AWP*(inflation_2022_Q4/inflation_2016_Q3),
  year_quarter == 2016.4 ~ AWP*(inflation_2022_Q4/inflation_2016_Q4), 
  year_quarter == 2017.1 ~ AWP*(inflation_2022_Q4/inflation_2017_Q1), 
  year_quarter == 2017.2 ~ AWP*(inflation_2022_Q4/inflation_2017_Q2),
  year_quarter == 2017.3 ~ AWP*(inflation_2022_Q4/inflation_2017_Q3),
  year_quarter == 2017.4 ~ AWP*(inflation_2022_Q4/inflation_2017_Q4), 
  year_quarter == 2018.1 ~ AWP*(inflation_2022_Q4/inflation_2018_Q1), 
  year_quarter == 2018.2 ~ AWP*(inflation_2022_Q4/inflation_2018_Q2),
  year_quarter == 2018.3 ~ AWP*(inflation_2022_Q4/inflation_2018_Q3),
  year_quarter == 2018.4 ~ AWP*(inflation_2022_Q4/inflation_2018_Q4), 
  year_quarter == 2019.1 ~ AWP*(inflation_2022_Q4/inflation_2019_Q1), 
  year_quarter == 2019.2 ~ AWP*(inflation_2022_Q4/inflation_2019_Q2),
  year_quarter == 2019.3 ~ AWP*(inflation_2022_Q4/inflation_2019_Q3),
  year_quarter == 2019.4 ~ AWP*(inflation_2022_Q4/inflation_2019_Q4),
  year_quarter == 2020.1 ~ AWP*(inflation_2022_Q4/inflation_2020_Q1), 
  year_quarter == 2020.2 ~ AWP*(inflation_2022_Q4/inflation_2020_Q2),
  year_quarter == 2020.3 ~ AWP*(inflation_2022_Q4/inflation_2020_Q3),
  year_quarter == 2020.4 ~ AWP*(inflation_2022_Q4/inflation_2020_Q4),
  year_quarter == 2021.1 ~ AWP*(inflation_2022_Q4/inflation_2021_Q1), 
  year_quarter == 2021.2 ~ AWP*(inflation_2022_Q4/inflation_2021_Q2),
  year_quarter == 2021.3 ~ AWP*(inflation_2022_Q4/inflation_2021_Q3),
  year_quarter == 2021.4 ~ AWP*(inflation_2022_Q4/inflation_2021_Q4),
  year_quarter == 2022.1 ~ AWP*(inflation_2022_Q4/inflation_2022_Q1), 
  year_quarter == 2022.2 ~ AWP*(inflation_2022_Q4/inflation_2022_Q2),
  year_quarter == 2022.3 ~ AWP*(inflation_2022_Q4/inflation_2022_Q3),
  year_quarter == 2022.4 ~ AWP*(inflation_2022_Q4/inflation_2022_Q4)),
    COB = case_when(
  year_quarter == 2006.1 ~ COB*(inflation_2022_Q4/inflation_2006_Q1), 
  year_quarter == 2006.2 ~ COB*(inflation_2022_Q4/inflation_2006_Q2),
  year_quarter == 2006.3 ~ COB*(inflation_2022_Q4/inflation_2006_Q3),
  year_quarter == 2006.4 ~ COB*(inflation_2022_Q4/inflation_2006_Q4),  
  year_quarter == 2007.1 ~ COB*(inflation_2022_Q4/inflation_2007_Q1), 
  year_quarter == 2007.2 ~ COB*(inflation_2022_Q4/inflation_2007_Q2),
  year_quarter == 2007.3 ~ COB*(inflation_2022_Q4/inflation_2007_Q3),
  year_quarter == 2007.4 ~ COB*(inflation_2022_Q4/inflation_2007_Q4),  
  year_quarter == 2008.1 ~ COB*(inflation_2022_Q4/inflation_2008_Q1), 
  year_quarter == 2008.2 ~ COB*(inflation_2022_Q4/inflation_2008_Q2),
  year_quarter == 2008.3 ~ COB*(inflation_2022_Q4/inflation_2008_Q3),
  year_quarter == 2008.4 ~ COB*(inflation_2022_Q4/inflation_2008_Q4), 
  year_quarter == 2009.1 ~ COB*(inflation_2022_Q4/inflation_2009_Q1), 
  year_quarter == 2009.2 ~ COB*(inflation_2022_Q4/inflation_2009_Q2),
  year_quarter == 2009.3 ~ COB*(inflation_2022_Q4/inflation_2009_Q3),
  year_quarter == 2009.4 ~ COB*(inflation_2022_Q4/inflation_2009_Q4), 
  year_quarter == 2010.1 ~ COB*(inflation_2022_Q4/inflation_2010_Q1), 
  year_quarter == 2010.2 ~ COB*(inflation_2022_Q4/inflation_2010_Q2),
  year_quarter == 2010.3 ~ COB*(inflation_2022_Q4/inflation_2010_Q3),
  year_quarter == 2010.4 ~ COB*(inflation_2022_Q4/inflation_2010_Q4), 
  year_quarter == 2011.1 ~ COB*(inflation_2022_Q4/inflation_2011_Q1), 
  year_quarter == 2011.2 ~ COB*(inflation_2022_Q4/inflation_2011_Q2),
  year_quarter == 2011.3 ~ COB*(inflation_2022_Q4/inflation_2011_Q3),
  year_quarter == 2011.4 ~ COB*(inflation_2022_Q4/inflation_2011_Q4), 
  year_quarter == 2012.1 ~ COB*(inflation_2022_Q4/inflation_2012_Q1), 
  year_quarter == 2012.2 ~ COB*(inflation_2022_Q4/inflation_2012_Q2),
  year_quarter == 2012.3 ~ COB*(inflation_2022_Q4/inflation_2012_Q3),
  year_quarter == 2012.4 ~ COB*(inflation_2022_Q4/inflation_2012_Q4), 
  year_quarter == 2013.1 ~ COB*(inflation_2022_Q4/inflation_2013_Q1), 
  year_quarter == 2013.2 ~ COB*(inflation_2022_Q4/inflation_2013_Q2),
  year_quarter == 2013.3 ~ COB*(inflation_2022_Q4/inflation_2013_Q3),
  year_quarter == 2013.4 ~ COB*(inflation_2022_Q4/inflation_2013_Q4), 
  year_quarter == 2014.1 ~ COB*(inflation_2022_Q4/inflation_2014_Q1), 
  year_quarter == 2014.2 ~ COB*(inflation_2022_Q4/inflation_2014_Q2),
  year_quarter == 2014.3 ~ COB*(inflation_2022_Q4/inflation_2014_Q3),
  year_quarter == 2014.4 ~ COB*(inflation_2022_Q4/inflation_2014_Q4),  
  year_quarter == 2015.1 ~ COB*(inflation_2022_Q4/inflation_2015_Q1), 
  year_quarter == 2015.2 ~ COB*(inflation_2022_Q4/inflation_2015_Q2),
  year_quarter == 2015.3 ~ COB*(inflation_2022_Q4/inflation_2015_Q3),
  year_quarter == 2015.4 ~ COB*(inflation_2022_Q4/inflation_2015_Q4),  
  year_quarter == 2016.1 ~ COB*(inflation_2022_Q4/inflation_2016_Q1), 
  year_quarter == 2016.2 ~ COB*(inflation_2022_Q4/inflation_2016_Q2),
  year_quarter == 2016.3 ~ COB*(inflation_2022_Q4/inflation_2016_Q3),
  year_quarter == 2016.4 ~ COB*(inflation_2022_Q4/inflation_2016_Q4), 
  year_quarter == 2017.1 ~ COB*(inflation_2022_Q4/inflation_2017_Q1), 
  year_quarter == 2017.2 ~ COB*(inflation_2022_Q4/inflation_2017_Q2),
  year_quarter == 2017.3 ~ COB*(inflation_2022_Q4/inflation_2017_Q3),
  year_quarter == 2017.4 ~ COB*(inflation_2022_Q4/inflation_2017_Q4), 
  year_quarter == 2018.1 ~ COB*(inflation_2022_Q4/inflation_2018_Q1), 
  year_quarter == 2018.2 ~ COB*(inflation_2022_Q4/inflation_2018_Q2),
  year_quarter == 2018.3 ~ COB*(inflation_2022_Q4/inflation_2018_Q3),
  year_quarter == 2018.4 ~ COB*(inflation_2022_Q4/inflation_2018_Q4), 
  year_quarter == 2019.1 ~ COB*(inflation_2022_Q4/inflation_2019_Q1), 
  year_quarter == 2019.2 ~ COB*(inflation_2022_Q4/inflation_2019_Q2),
  year_quarter == 2019.3 ~ COB*(inflation_2022_Q4/inflation_2019_Q3),
  year_quarter == 2019.4 ~ COB*(inflation_2022_Q4/inflation_2019_Q4),
  year_quarter == 2020.1 ~ COB*(inflation_2022_Q4/inflation_2020_Q1), 
  year_quarter == 2020.2 ~ COB*(inflation_2022_Q4/inflation_2020_Q2),
  year_quarter == 2020.3 ~ COB*(inflation_2022_Q4/inflation_2020_Q3),
  year_quarter == 2020.4 ~ COB*(inflation_2022_Q4/inflation_2020_Q4),
  year_quarter == 2021.1 ~ COB*(inflation_2022_Q4/inflation_2021_Q1), 
  year_quarter == 2021.2 ~ COB*(inflation_2022_Q4/inflation_2021_Q2),
  year_quarter == 2021.3 ~ COB*(inflation_2022_Q4/inflation_2021_Q3),
  year_quarter == 2021.4 ~ COB*(inflation_2022_Q4/inflation_2021_Q4),
  year_quarter == 2022.1 ~ COB*(inflation_2022_Q4/inflation_2022_Q1), 
  year_quarter == 2022.2 ~ COB*(inflation_2022_Q4/inflation_2022_Q2),
  year_quarter == 2022.3 ~ COB*(inflation_2022_Q4/inflation_2022_Q3),
  year_quarter == 2022.4 ~ COB*(inflation_2022_Q4/inflation_2022_Q4)),
    COINS = case_when(
  year_quarter == 2006.1 ~ COINS*(inflation_2022_Q4/inflation_2006_Q1), 
  year_quarter == 2006.2 ~ COINS*(inflation_2022_Q4/inflation_2006_Q2),
  year_quarter == 2006.3 ~ COINS*(inflation_2022_Q4/inflation_2006_Q3),
  year_quarter == 2006.4 ~ COINS*(inflation_2022_Q4/inflation_2006_Q4),  
  year_quarter == 2007.1 ~ COINS*(inflation_2022_Q4/inflation_2007_Q1), 
  year_quarter == 2007.2 ~ COINS*(inflation_2022_Q4/inflation_2007_Q2),
  year_quarter == 2007.3 ~ COINS*(inflation_2022_Q4/inflation_2007_Q3),
  year_quarter == 2007.4 ~ COINS*(inflation_2022_Q4/inflation_2007_Q4),  
  year_quarter == 2008.1 ~ COINS*(inflation_2022_Q4/inflation_2008_Q1), 
  year_quarter == 2008.2 ~ COINS*(inflation_2022_Q4/inflation_2008_Q2),
  year_quarter == 2008.3 ~ COINS*(inflation_2022_Q4/inflation_2008_Q3),
  year_quarter == 2008.4 ~ COINS*(inflation_2022_Q4/inflation_2008_Q4), 
  year_quarter == 2009.1 ~ COINS*(inflation_2022_Q4/inflation_2009_Q1), 
  year_quarter == 2009.2 ~ COINS*(inflation_2022_Q4/inflation_2009_Q2),
  year_quarter == 2009.3 ~ COINS*(inflation_2022_Q4/inflation_2009_Q3),
  year_quarter == 2009.4 ~ COINS*(inflation_2022_Q4/inflation_2009_Q4), 
  year_quarter == 2010.1 ~ COINS*(inflation_2022_Q4/inflation_2010_Q1), 
  year_quarter == 2010.2 ~ COINS*(inflation_2022_Q4/inflation_2010_Q2),
  year_quarter == 2010.3 ~ COINS*(inflation_2022_Q4/inflation_2010_Q3),
  year_quarter == 2010.4 ~ COINS*(inflation_2022_Q4/inflation_2010_Q4), 
  year_quarter == 2011.1 ~ COINS*(inflation_2022_Q4/inflation_2011_Q1), 
  year_quarter == 2011.2 ~ COINS*(inflation_2022_Q4/inflation_2011_Q2),
  year_quarter == 2011.3 ~ COINS*(inflation_2022_Q4/inflation_2011_Q3),
  year_quarter == 2011.4 ~ COINS*(inflation_2022_Q4/inflation_2011_Q4), 
  year_quarter == 2012.1 ~ COINS*(inflation_2022_Q4/inflation_2012_Q1), 
  year_quarter == 2012.2 ~ COINS*(inflation_2022_Q4/inflation_2012_Q2),
  year_quarter == 2012.3 ~ COINS*(inflation_2022_Q4/inflation_2012_Q3),
  year_quarter == 2012.4 ~ COINS*(inflation_2022_Q4/inflation_2012_Q4), 
  year_quarter == 2013.1 ~ COINS*(inflation_2022_Q4/inflation_2013_Q1), 
  year_quarter == 2013.2 ~ COINS*(inflation_2022_Q4/inflation_2013_Q2),
  year_quarter == 2013.3 ~ COINS*(inflation_2022_Q4/inflation_2013_Q3),
  year_quarter == 2013.4 ~ COINS*(inflation_2022_Q4/inflation_2013_Q4), 
  year_quarter == 2014.1 ~ COINS*(inflation_2022_Q4/inflation_2014_Q1), 
  year_quarter == 2014.2 ~ COINS*(inflation_2022_Q4/inflation_2014_Q2),
  year_quarter == 2014.3 ~ COINS*(inflation_2022_Q4/inflation_2014_Q3),
  year_quarter == 2014.4 ~ COINS*(inflation_2022_Q4/inflation_2014_Q4),  
  year_quarter == 2015.1 ~ COINS*(inflation_2022_Q4/inflation_2015_Q1), 
  year_quarter == 2015.2 ~ COINS*(inflation_2022_Q4/inflation_2015_Q2),
  year_quarter == 2015.3 ~ COINS*(inflation_2022_Q4/inflation_2015_Q3),
  year_quarter == 2015.4 ~ COINS*(inflation_2022_Q4/inflation_2015_Q4),  
  year_quarter == 2016.1 ~ COINS*(inflation_2022_Q4/inflation_2016_Q1), 
  year_quarter == 2016.2 ~ COINS*(inflation_2022_Q4/inflation_2016_Q2),
  year_quarter == 2016.3 ~ COINS*(inflation_2022_Q4/inflation_2016_Q3),
  year_quarter == 2016.4 ~ COINS*(inflation_2022_Q4/inflation_2016_Q4), 
  year_quarter == 2017.1 ~ COINS*(inflation_2022_Q4/inflation_2017_Q1), 
  year_quarter == 2017.2 ~ COINS*(inflation_2022_Q4/inflation_2017_Q2),
  year_quarter == 2017.3 ~ COINS*(inflation_2022_Q4/inflation_2017_Q3),
  year_quarter == 2017.4 ~ COINS*(inflation_2022_Q4/inflation_2017_Q4), 
  year_quarter == 2018.1 ~ COINS*(inflation_2022_Q4/inflation_2018_Q1), 
  year_quarter == 2018.2 ~ COINS*(inflation_2022_Q4/inflation_2018_Q2),
  year_quarter == 2018.3 ~ COINS*(inflation_2022_Q4/inflation_2018_Q3),
  year_quarter == 2018.4 ~ COINS*(inflation_2022_Q4/inflation_2018_Q4), 
  year_quarter == 2019.1 ~ COINS*(inflation_2022_Q4/inflation_2019_Q1), 
  year_quarter == 2019.2 ~ COINS*(inflation_2022_Q4/inflation_2019_Q2),
  year_quarter == 2019.3 ~ COINS*(inflation_2022_Q4/inflation_2019_Q3),
  year_quarter == 2019.4 ~ COINS*(inflation_2022_Q4/inflation_2019_Q4),
  year_quarter == 2020.1 ~ COINS*(inflation_2022_Q4/inflation_2020_Q1), 
  year_quarter == 2020.2 ~ COINS*(inflation_2022_Q4/inflation_2020_Q2),
  year_quarter == 2020.3 ~ COINS*(inflation_2022_Q4/inflation_2020_Q3),
  year_quarter == 2020.4 ~ COINS*(inflation_2022_Q4/inflation_2020_Q4),
  year_quarter == 2021.1 ~ COINS*(inflation_2022_Q4/inflation_2021_Q1), 
  year_quarter == 2021.2 ~ COINS*(inflation_2022_Q4/inflation_2021_Q2),
  year_quarter == 2021.3 ~ COINS*(inflation_2022_Q4/inflation_2021_Q3),
  year_quarter == 2021.4 ~ COINS*(inflation_2022_Q4/inflation_2021_Q4),
  year_quarter == 2022.1 ~ COINS*(inflation_2022_Q4/inflation_2022_Q1), 
  year_quarter == 2022.2 ~ COINS*(inflation_2022_Q4/inflation_2022_Q2),
  year_quarter == 2022.3 ~ COINS*(inflation_2022_Q4/inflation_2022_Q3),
  year_quarter == 2022.4 ~ COINS*(inflation_2022_Q4/inflation_2022_Q4)),
    COPAY = case_when(
  year_quarter == 2006.1 ~ COPAY*(inflation_2022_Q4/inflation_2006_Q1), 
  year_quarter == 2006.2 ~ COPAY*(inflation_2022_Q4/inflation_2006_Q2),
  year_quarter == 2006.3 ~ COPAY*(inflation_2022_Q4/inflation_2006_Q3),
  year_quarter == 2006.4 ~ COPAY*(inflation_2022_Q4/inflation_2006_Q4),  
  year_quarter == 2007.1 ~ COPAY*(inflation_2022_Q4/inflation_2007_Q1), 
  year_quarter == 2007.2 ~ COPAY*(inflation_2022_Q4/inflation_2007_Q2),
  year_quarter == 2007.3 ~ COPAY*(inflation_2022_Q4/inflation_2007_Q3),
  year_quarter == 2007.4 ~ COPAY*(inflation_2022_Q4/inflation_2007_Q4),  
  year_quarter == 2008.1 ~ COPAY*(inflation_2022_Q4/inflation_2008_Q1), 
  year_quarter == 2008.2 ~ COPAY*(inflation_2022_Q4/inflation_2008_Q2),
  year_quarter == 2008.3 ~ COPAY*(inflation_2022_Q4/inflation_2008_Q3),
  year_quarter == 2008.4 ~ COPAY*(inflation_2022_Q4/inflation_2008_Q4), 
  year_quarter == 2009.1 ~ COPAY*(inflation_2022_Q4/inflation_2009_Q1), 
  year_quarter == 2009.2 ~ COPAY*(inflation_2022_Q4/inflation_2009_Q2),
  year_quarter == 2009.3 ~ COPAY*(inflation_2022_Q4/inflation_2009_Q3),
  year_quarter == 2009.4 ~ COPAY*(inflation_2022_Q4/inflation_2009_Q4), 
  year_quarter == 2010.1 ~ COPAY*(inflation_2022_Q4/inflation_2010_Q1), 
  year_quarter == 2010.2 ~ COPAY*(inflation_2022_Q4/inflation_2010_Q2),
  year_quarter == 2010.3 ~ COPAY*(inflation_2022_Q4/inflation_2010_Q3),
  year_quarter == 2010.4 ~ COPAY*(inflation_2022_Q4/inflation_2010_Q4), 
  year_quarter == 2011.1 ~ COPAY*(inflation_2022_Q4/inflation_2011_Q1), 
  year_quarter == 2011.2 ~ COPAY*(inflation_2022_Q4/inflation_2011_Q2),
  year_quarter == 2011.3 ~ COPAY*(inflation_2022_Q4/inflation_2011_Q3),
  year_quarter == 2011.4 ~ COPAY*(inflation_2022_Q4/inflation_2011_Q4), 
  year_quarter == 2012.1 ~ COPAY*(inflation_2022_Q4/inflation_2012_Q1), 
  year_quarter == 2012.2 ~ COPAY*(inflation_2022_Q4/inflation_2012_Q2),
  year_quarter == 2012.3 ~ COPAY*(inflation_2022_Q4/inflation_2012_Q3),
  year_quarter == 2012.4 ~ COPAY*(inflation_2022_Q4/inflation_2012_Q4), 
  year_quarter == 2013.1 ~ COPAY*(inflation_2022_Q4/inflation_2013_Q1), 
  year_quarter == 2013.2 ~ COPAY*(inflation_2022_Q4/inflation_2013_Q2),
  year_quarter == 2013.3 ~ COPAY*(inflation_2022_Q4/inflation_2013_Q3),
  year_quarter == 2013.4 ~ COPAY*(inflation_2022_Q4/inflation_2013_Q4), 
  year_quarter == 2014.1 ~ COPAY*(inflation_2022_Q4/inflation_2014_Q1), 
  year_quarter == 2014.2 ~ COPAY*(inflation_2022_Q4/inflation_2014_Q2),
  year_quarter == 2014.3 ~ COPAY*(inflation_2022_Q4/inflation_2014_Q3),
  year_quarter == 2014.4 ~ COPAY*(inflation_2022_Q4/inflation_2014_Q4),  
  year_quarter == 2015.1 ~ COPAY*(inflation_2022_Q4/inflation_2015_Q1), 
  year_quarter == 2015.2 ~ COPAY*(inflation_2022_Q4/inflation_2015_Q2),
  year_quarter == 2015.3 ~ COPAY*(inflation_2022_Q4/inflation_2015_Q3),
  year_quarter == 2015.4 ~ COPAY*(inflation_2022_Q4/inflation_2015_Q4),  
  year_quarter == 2016.1 ~ COPAY*(inflation_2022_Q4/inflation_2016_Q1), 
  year_quarter == 2016.2 ~ COPAY*(inflation_2022_Q4/inflation_2016_Q2),
  year_quarter == 2016.3 ~ COPAY*(inflation_2022_Q4/inflation_2016_Q3),
  year_quarter == 2016.4 ~ COPAY*(inflation_2022_Q4/inflation_2016_Q4), 
  year_quarter == 2017.1 ~ COPAY*(inflation_2022_Q4/inflation_2017_Q1), 
  year_quarter == 2017.2 ~ COPAY*(inflation_2022_Q4/inflation_2017_Q2),
  year_quarter == 2017.3 ~ COPAY*(inflation_2022_Q4/inflation_2017_Q3),
  year_quarter == 2017.4 ~ COPAY*(inflation_2022_Q4/inflation_2017_Q4), 
  year_quarter == 2018.1 ~ COPAY*(inflation_2022_Q4/inflation_2018_Q1), 
  year_quarter == 2018.2 ~ COPAY*(inflation_2022_Q4/inflation_2018_Q2),
  year_quarter == 2018.3 ~ COPAY*(inflation_2022_Q4/inflation_2018_Q3),
  year_quarter == 2018.4 ~ COPAY*(inflation_2022_Q4/inflation_2018_Q4), 
  year_quarter == 2019.1 ~ COPAY*(inflation_2022_Q4/inflation_2019_Q1), 
  year_quarter == 2019.2 ~ COPAY*(inflation_2022_Q4/inflation_2019_Q2),
  year_quarter == 2019.3 ~ COPAY*(inflation_2022_Q4/inflation_2019_Q3),
  year_quarter == 2019.4 ~ COPAY*(inflation_2022_Q4/inflation_2019_Q4),
  year_quarter == 2020.1 ~ COPAY*(inflation_2022_Q4/inflation_2020_Q1), 
  year_quarter == 2020.2 ~ COPAY*(inflation_2022_Q4/inflation_2020_Q2),
  year_quarter == 2020.3 ~ COPAY*(inflation_2022_Q4/inflation_2020_Q3),
  year_quarter == 2020.4 ~ COPAY*(inflation_2022_Q4/inflation_2020_Q4),
  year_quarter == 2021.1 ~ COPAY*(inflation_2022_Q4/inflation_2021_Q1), 
  year_quarter == 2021.2 ~ COPAY*(inflation_2022_Q4/inflation_2021_Q2),
  year_quarter == 2021.3 ~ COPAY*(inflation_2022_Q4/inflation_2021_Q3),
  year_quarter == 2021.4 ~ COPAY*(inflation_2022_Q4/inflation_2021_Q4),
  year_quarter == 2022.1 ~ COPAY*(inflation_2022_Q4/inflation_2022_Q1), 
  year_quarter == 2022.2 ~ COPAY*(inflation_2022_Q4/inflation_2022_Q2),
  year_quarter == 2022.3 ~ COPAY*(inflation_2022_Q4/inflation_2022_Q3),
  year_quarter == 2022.4 ~ COPAY*(inflation_2022_Q4/inflation_2022_Q4)),
    DEDUCT = case_when(
  year_quarter == 2006.1 ~ DEDUCT*(inflation_2022_Q4/inflation_2006_Q1), 
  year_quarter == 2006.2 ~ DEDUCT*(inflation_2022_Q4/inflation_2006_Q2),
  year_quarter == 2006.3 ~ DEDUCT*(inflation_2022_Q4/inflation_2006_Q3),
  year_quarter == 2006.4 ~ DEDUCT*(inflation_2022_Q4/inflation_2006_Q4),  
  year_quarter == 2007.1 ~ DEDUCT*(inflation_2022_Q4/inflation_2007_Q1), 
  year_quarter == 2007.2 ~ DEDUCT*(inflation_2022_Q4/inflation_2007_Q2),
  year_quarter == 2007.3 ~ DEDUCT*(inflation_2022_Q4/inflation_2007_Q3),
  year_quarter == 2007.4 ~ DEDUCT*(inflation_2022_Q4/inflation_2007_Q4),  
  year_quarter == 2008.1 ~ DEDUCT*(inflation_2022_Q4/inflation_2008_Q1), 
  year_quarter == 2008.2 ~ DEDUCT*(inflation_2022_Q4/inflation_2008_Q2),
  year_quarter == 2008.3 ~ DEDUCT*(inflation_2022_Q4/inflation_2008_Q3),
  year_quarter == 2008.4 ~ DEDUCT*(inflation_2022_Q4/inflation_2008_Q4), 
  year_quarter == 2009.1 ~ DEDUCT*(inflation_2022_Q4/inflation_2009_Q1), 
  year_quarter == 2009.2 ~ DEDUCT*(inflation_2022_Q4/inflation_2009_Q2),
  year_quarter == 2009.3 ~ DEDUCT*(inflation_2022_Q4/inflation_2009_Q3),
  year_quarter == 2009.4 ~ DEDUCT*(inflation_2022_Q4/inflation_2009_Q4), 
  year_quarter == 2010.1 ~ DEDUCT*(inflation_2022_Q4/inflation_2010_Q1), 
  year_quarter == 2010.2 ~ DEDUCT*(inflation_2022_Q4/inflation_2010_Q2),
  year_quarter == 2010.3 ~ DEDUCT*(inflation_2022_Q4/inflation_2010_Q3),
  year_quarter == 2010.4 ~ DEDUCT*(inflation_2022_Q4/inflation_2010_Q4), 
  year_quarter == 2011.1 ~ DEDUCT*(inflation_2022_Q4/inflation_2011_Q1), 
  year_quarter == 2011.2 ~ DEDUCT*(inflation_2022_Q4/inflation_2011_Q2),
  year_quarter == 2011.3 ~ DEDUCT*(inflation_2022_Q4/inflation_2011_Q3),
  year_quarter == 2011.4 ~ DEDUCT*(inflation_2022_Q4/inflation_2011_Q4), 
  year_quarter == 2012.1 ~ DEDUCT*(inflation_2022_Q4/inflation_2012_Q1), 
  year_quarter == 2012.2 ~ DEDUCT*(inflation_2022_Q4/inflation_2012_Q2),
  year_quarter == 2012.3 ~ DEDUCT*(inflation_2022_Q4/inflation_2012_Q3),
  year_quarter == 2012.4 ~ DEDUCT*(inflation_2022_Q4/inflation_2012_Q4), 
  year_quarter == 2013.1 ~ DEDUCT*(inflation_2022_Q4/inflation_2013_Q1), 
  year_quarter == 2013.2 ~ DEDUCT*(inflation_2022_Q4/inflation_2013_Q2),
  year_quarter == 2013.3 ~ DEDUCT*(inflation_2022_Q4/inflation_2013_Q3),
  year_quarter == 2013.4 ~ DEDUCT*(inflation_2022_Q4/inflation_2013_Q4), 
  year_quarter == 2014.1 ~ DEDUCT*(inflation_2022_Q4/inflation_2014_Q1), 
  year_quarter == 2014.2 ~ DEDUCT*(inflation_2022_Q4/inflation_2014_Q2),
  year_quarter == 2014.3 ~ DEDUCT*(inflation_2022_Q4/inflation_2014_Q3),
  year_quarter == 2014.4 ~ DEDUCT*(inflation_2022_Q4/inflation_2014_Q4),  
  year_quarter == 2015.1 ~ DEDUCT*(inflation_2022_Q4/inflation_2015_Q1), 
  year_quarter == 2015.2 ~ DEDUCT*(inflation_2022_Q4/inflation_2015_Q2),
  year_quarter == 2015.3 ~ DEDUCT*(inflation_2022_Q4/inflation_2015_Q3),
  year_quarter == 2015.4 ~ DEDUCT*(inflation_2022_Q4/inflation_2015_Q4),  
  year_quarter == 2016.1 ~ DEDUCT*(inflation_2022_Q4/inflation_2016_Q1), 
  year_quarter == 2016.2 ~ DEDUCT*(inflation_2022_Q4/inflation_2016_Q2),
  year_quarter == 2016.3 ~ DEDUCT*(inflation_2022_Q4/inflation_2016_Q3),
  year_quarter == 2016.4 ~ DEDUCT*(inflation_2022_Q4/inflation_2016_Q4), 
  year_quarter == 2017.1 ~ DEDUCT*(inflation_2022_Q4/inflation_2017_Q1), 
  year_quarter == 2017.2 ~ DEDUCT*(inflation_2022_Q4/inflation_2017_Q2),
  year_quarter == 2017.3 ~ DEDUCT*(inflation_2022_Q4/inflation_2017_Q3),
  year_quarter == 2017.4 ~ DEDUCT*(inflation_2022_Q4/inflation_2017_Q4), 
  year_quarter == 2018.1 ~ DEDUCT*(inflation_2022_Q4/inflation_2018_Q1), 
  year_quarter == 2018.2 ~ DEDUCT*(inflation_2022_Q4/inflation_2018_Q2),
  year_quarter == 2018.3 ~ DEDUCT*(inflation_2022_Q4/inflation_2018_Q3),
  year_quarter == 2018.4 ~ DEDUCT*(inflation_2022_Q4/inflation_2018_Q4), 
  year_quarter == 2019.1 ~ DEDUCT*(inflation_2022_Q4/inflation_2019_Q1), 
  year_quarter == 2019.2 ~ DEDUCT*(inflation_2022_Q4/inflation_2019_Q2),
  year_quarter == 2019.3 ~ DEDUCT*(inflation_2022_Q4/inflation_2019_Q3),
  year_quarter == 2019.4 ~ DEDUCT*(inflation_2022_Q4/inflation_2019_Q4),
  year_quarter == 2020.1 ~ DEDUCT*(inflation_2022_Q4/inflation_2020_Q1), 
  year_quarter == 2020.2 ~ DEDUCT*(inflation_2022_Q4/inflation_2020_Q2),
  year_quarter == 2020.3 ~ DEDUCT*(inflation_2022_Q4/inflation_2020_Q3),
  year_quarter == 2020.4 ~ DEDUCT*(inflation_2022_Q4/inflation_2020_Q4),
  year_quarter == 2021.1 ~ DEDUCT*(inflation_2022_Q4/inflation_2021_Q1), 
  year_quarter == 2021.2 ~ DEDUCT*(inflation_2022_Q4/inflation_2021_Q2),
  year_quarter == 2021.3 ~ DEDUCT*(inflation_2022_Q4/inflation_2021_Q3),
  year_quarter == 2021.4 ~ DEDUCT*(inflation_2022_Q4/inflation_2021_Q4),
  year_quarter == 2022.1 ~ DEDUCT*(inflation_2022_Q4/inflation_2022_Q1), 
  year_quarter == 2022.2 ~ DEDUCT*(inflation_2022_Q4/inflation_2022_Q2),
  year_quarter == 2022.3 ~ DEDUCT*(inflation_2022_Q4/inflation_2022_Q3),
  year_quarter == 2022.4 ~ DEDUCT*(inflation_2022_Q4/inflation_2022_Q4)),
    DISPFEE = case_when(
  year_quarter == 2006.1 ~ DISPFEE*(inflation_2022_Q4/inflation_2006_Q1), 
  year_quarter == 2006.2 ~ DISPFEE*(inflation_2022_Q4/inflation_2006_Q2),
  year_quarter == 2006.3 ~ DISPFEE*(inflation_2022_Q4/inflation_2006_Q3),
  year_quarter == 2006.4 ~ DISPFEE*(inflation_2022_Q4/inflation_2006_Q4),  
  year_quarter == 2007.1 ~ DISPFEE*(inflation_2022_Q4/inflation_2007_Q1), 
  year_quarter == 2007.2 ~ DISPFEE*(inflation_2022_Q4/inflation_2007_Q2),
  year_quarter == 2007.3 ~ DISPFEE*(inflation_2022_Q4/inflation_2007_Q3),
  year_quarter == 2007.4 ~ DISPFEE*(inflation_2022_Q4/inflation_2007_Q4),  
  year_quarter == 2008.1 ~ DISPFEE*(inflation_2022_Q4/inflation_2008_Q1), 
  year_quarter == 2008.2 ~ DISPFEE*(inflation_2022_Q4/inflation_2008_Q2),
  year_quarter == 2008.3 ~ DISPFEE*(inflation_2022_Q4/inflation_2008_Q3),
  year_quarter == 2008.4 ~ DISPFEE*(inflation_2022_Q4/inflation_2008_Q4), 
  year_quarter == 2009.1 ~ DISPFEE*(inflation_2022_Q4/inflation_2009_Q1), 
  year_quarter == 2009.2 ~ DISPFEE*(inflation_2022_Q4/inflation_2009_Q2),
  year_quarter == 2009.3 ~ DISPFEE*(inflation_2022_Q4/inflation_2009_Q3),
  year_quarter == 2009.4 ~ DISPFEE*(inflation_2022_Q4/inflation_2009_Q4), 
  year_quarter == 2010.1 ~ DISPFEE*(inflation_2022_Q4/inflation_2010_Q1), 
  year_quarter == 2010.2 ~ DISPFEE*(inflation_2022_Q4/inflation_2010_Q2),
  year_quarter == 2010.3 ~ DISPFEE*(inflation_2022_Q4/inflation_2010_Q3),
  year_quarter == 2010.4 ~ DISPFEE*(inflation_2022_Q4/inflation_2010_Q4), 
  year_quarter == 2011.1 ~ DISPFEE*(inflation_2022_Q4/inflation_2011_Q1), 
  year_quarter == 2011.2 ~ DISPFEE*(inflation_2022_Q4/inflation_2011_Q2),
  year_quarter == 2011.3 ~ DISPFEE*(inflation_2022_Q4/inflation_2011_Q3),
  year_quarter == 2011.4 ~ DISPFEE*(inflation_2022_Q4/inflation_2011_Q4), 
  year_quarter == 2012.1 ~ DISPFEE*(inflation_2022_Q4/inflation_2012_Q1), 
  year_quarter == 2012.2 ~ DISPFEE*(inflation_2022_Q4/inflation_2012_Q2),
  year_quarter == 2012.3 ~ DISPFEE*(inflation_2022_Q4/inflation_2012_Q3),
  year_quarter == 2012.4 ~ DISPFEE*(inflation_2022_Q4/inflation_2012_Q4), 
  year_quarter == 2013.1 ~ DISPFEE*(inflation_2022_Q4/inflation_2013_Q1), 
  year_quarter == 2013.2 ~ DISPFEE*(inflation_2022_Q4/inflation_2013_Q2),
  year_quarter == 2013.3 ~ DISPFEE*(inflation_2022_Q4/inflation_2013_Q3),
  year_quarter == 2013.4 ~ DISPFEE*(inflation_2022_Q4/inflation_2013_Q4), 
  year_quarter == 2014.1 ~ DISPFEE*(inflation_2022_Q4/inflation_2014_Q1), 
  year_quarter == 2014.2 ~ DISPFEE*(inflation_2022_Q4/inflation_2014_Q2),
  year_quarter == 2014.3 ~ DISPFEE*(inflation_2022_Q4/inflation_2014_Q3),
  year_quarter == 2014.4 ~ DISPFEE*(inflation_2022_Q4/inflation_2014_Q4),  
  year_quarter == 2015.1 ~ DISPFEE*(inflation_2022_Q4/inflation_2015_Q1), 
  year_quarter == 2015.2 ~ DISPFEE*(inflation_2022_Q4/inflation_2015_Q2),
  year_quarter == 2015.3 ~ DISPFEE*(inflation_2022_Q4/inflation_2015_Q3),
  year_quarter == 2015.4 ~ DISPFEE*(inflation_2022_Q4/inflation_2015_Q4),  
  year_quarter == 2016.1 ~ DISPFEE*(inflation_2022_Q4/inflation_2016_Q1), 
  year_quarter == 2016.2 ~ DISPFEE*(inflation_2022_Q4/inflation_2016_Q2),
  year_quarter == 2016.3 ~ DISPFEE*(inflation_2022_Q4/inflation_2016_Q3),
  year_quarter == 2016.4 ~ DISPFEE*(inflation_2022_Q4/inflation_2016_Q4), 
  year_quarter == 2017.1 ~ DISPFEE*(inflation_2022_Q4/inflation_2017_Q1), 
  year_quarter == 2017.2 ~ DISPFEE*(inflation_2022_Q4/inflation_2017_Q2),
  year_quarter == 2017.3 ~ DISPFEE*(inflation_2022_Q4/inflation_2017_Q3),
  year_quarter == 2017.4 ~ DISPFEE*(inflation_2022_Q4/inflation_2017_Q4), 
  year_quarter == 2018.1 ~ DISPFEE*(inflation_2022_Q4/inflation_2018_Q1), 
  year_quarter == 2018.2 ~ DISPFEE*(inflation_2022_Q4/inflation_2018_Q2),
  year_quarter == 2018.3 ~ DISPFEE*(inflation_2022_Q4/inflation_2018_Q3),
  year_quarter == 2018.4 ~ DISPFEE*(inflation_2022_Q4/inflation_2018_Q4), 
  year_quarter == 2019.1 ~ DISPFEE*(inflation_2022_Q4/inflation_2019_Q1), 
  year_quarter == 2019.2 ~ DISPFEE*(inflation_2022_Q4/inflation_2019_Q2),
  year_quarter == 2019.3 ~ DISPFEE*(inflation_2022_Q4/inflation_2019_Q3),
  year_quarter == 2019.4 ~ DISPFEE*(inflation_2022_Q4/inflation_2019_Q4),
  year_quarter == 2020.1 ~ DISPFEE*(inflation_2022_Q4/inflation_2020_Q1), 
  year_quarter == 2020.2 ~ DISPFEE*(inflation_2022_Q4/inflation_2020_Q2),
  year_quarter == 2020.3 ~ DISPFEE*(inflation_2022_Q4/inflation_2020_Q3),
  year_quarter == 2020.4 ~ DISPFEE*(inflation_2022_Q4/inflation_2020_Q4),
  year_quarter == 2021.1 ~ DISPFEE*(inflation_2022_Q4/inflation_2021_Q1), 
  year_quarter == 2021.2 ~ DISPFEE*(inflation_2022_Q4/inflation_2021_Q2),
  year_quarter == 2021.3 ~ DISPFEE*(inflation_2022_Q4/inflation_2021_Q3),
  year_quarter == 2021.4 ~ DISPFEE*(inflation_2022_Q4/inflation_2021_Q4),
  year_quarter == 2022.1 ~ DISPFEE*(inflation_2022_Q4/inflation_2022_Q1), 
  year_quarter == 2022.2 ~ DISPFEE*(inflation_2022_Q4/inflation_2022_Q2),
  year_quarter == 2022.3 ~ DISPFEE*(inflation_2022_Q4/inflation_2022_Q3),
  year_quarter == 2022.4 ~ DISPFEE*(inflation_2022_Q4/inflation_2022_Q4)),
    INGCOST = case_when(
  year_quarter == 2006.1 ~ INGCOST*(inflation_2022_Q4/inflation_2006_Q1), 
  year_quarter == 2006.2 ~ INGCOST*(inflation_2022_Q4/inflation_2006_Q2),
  year_quarter == 2006.3 ~ INGCOST*(inflation_2022_Q4/inflation_2006_Q3),
  year_quarter == 2006.4 ~ INGCOST*(inflation_2022_Q4/inflation_2006_Q4),  
  year_quarter == 2007.1 ~ INGCOST*(inflation_2022_Q4/inflation_2007_Q1), 
  year_quarter == 2007.2 ~ INGCOST*(inflation_2022_Q4/inflation_2007_Q2),
  year_quarter == 2007.3 ~ INGCOST*(inflation_2022_Q4/inflation_2007_Q3),
  year_quarter == 2007.4 ~ INGCOST*(inflation_2022_Q4/inflation_2007_Q4),  
  year_quarter == 2008.1 ~ INGCOST*(inflation_2022_Q4/inflation_2008_Q1), 
  year_quarter == 2008.2 ~ INGCOST*(inflation_2022_Q4/inflation_2008_Q2),
  year_quarter == 2008.3 ~ INGCOST*(inflation_2022_Q4/inflation_2008_Q3),
  year_quarter == 2008.4 ~ INGCOST*(inflation_2022_Q4/inflation_2008_Q4), 
  year_quarter == 2009.1 ~ INGCOST*(inflation_2022_Q4/inflation_2009_Q1), 
  year_quarter == 2009.2 ~ INGCOST*(inflation_2022_Q4/inflation_2009_Q2),
  year_quarter == 2009.3 ~ INGCOST*(inflation_2022_Q4/inflation_2009_Q3),
  year_quarter == 2009.4 ~ INGCOST*(inflation_2022_Q4/inflation_2009_Q4), 
  year_quarter == 2010.1 ~ INGCOST*(inflation_2022_Q4/inflation_2010_Q1), 
  year_quarter == 2010.2 ~ INGCOST*(inflation_2022_Q4/inflation_2010_Q2),
  year_quarter == 2010.3 ~ INGCOST*(inflation_2022_Q4/inflation_2010_Q3),
  year_quarter == 2010.4 ~ INGCOST*(inflation_2022_Q4/inflation_2010_Q4), 
  year_quarter == 2011.1 ~ INGCOST*(inflation_2022_Q4/inflation_2011_Q1), 
  year_quarter == 2011.2 ~ INGCOST*(inflation_2022_Q4/inflation_2011_Q2),
  year_quarter == 2011.3 ~ INGCOST*(inflation_2022_Q4/inflation_2011_Q3),
  year_quarter == 2011.4 ~ INGCOST*(inflation_2022_Q4/inflation_2011_Q4), 
  year_quarter == 2012.1 ~ INGCOST*(inflation_2022_Q4/inflation_2012_Q1), 
  year_quarter == 2012.2 ~ INGCOST*(inflation_2022_Q4/inflation_2012_Q2),
  year_quarter == 2012.3 ~ INGCOST*(inflation_2022_Q4/inflation_2012_Q3),
  year_quarter == 2012.4 ~ INGCOST*(inflation_2022_Q4/inflation_2012_Q4), 
  year_quarter == 2013.1 ~ INGCOST*(inflation_2022_Q4/inflation_2013_Q1), 
  year_quarter == 2013.2 ~ INGCOST*(inflation_2022_Q4/inflation_2013_Q2),
  year_quarter == 2013.3 ~ INGCOST*(inflation_2022_Q4/inflation_2013_Q3),
  year_quarter == 2013.4 ~ INGCOST*(inflation_2022_Q4/inflation_2013_Q4), 
  year_quarter == 2014.1 ~ INGCOST*(inflation_2022_Q4/inflation_2014_Q1), 
  year_quarter == 2014.2 ~ INGCOST*(inflation_2022_Q4/inflation_2014_Q2),
  year_quarter == 2014.3 ~ INGCOST*(inflation_2022_Q4/inflation_2014_Q3),
  year_quarter == 2014.4 ~ INGCOST*(inflation_2022_Q4/inflation_2014_Q4),  
  year_quarter == 2015.1 ~ INGCOST*(inflation_2022_Q4/inflation_2015_Q1), 
  year_quarter == 2015.2 ~ INGCOST*(inflation_2022_Q4/inflation_2015_Q2),
  year_quarter == 2015.3 ~ INGCOST*(inflation_2022_Q4/inflation_2015_Q3),
  year_quarter == 2015.4 ~ INGCOST*(inflation_2022_Q4/inflation_2015_Q4),  
  year_quarter == 2016.1 ~ INGCOST*(inflation_2022_Q4/inflation_2016_Q1), 
  year_quarter == 2016.2 ~ INGCOST*(inflation_2022_Q4/inflation_2016_Q2),
  year_quarter == 2016.3 ~ INGCOST*(inflation_2022_Q4/inflation_2016_Q3),
  year_quarter == 2016.4 ~ INGCOST*(inflation_2022_Q4/inflation_2016_Q4), 
  year_quarter == 2017.1 ~ INGCOST*(inflation_2022_Q4/inflation_2017_Q1), 
  year_quarter == 2017.2 ~ INGCOST*(inflation_2022_Q4/inflation_2017_Q2),
  year_quarter == 2017.3 ~ INGCOST*(inflation_2022_Q4/inflation_2017_Q3),
  year_quarter == 2017.4 ~ INGCOST*(inflation_2022_Q4/inflation_2017_Q4), 
  year_quarter == 2018.1 ~ INGCOST*(inflation_2022_Q4/inflation_2018_Q1), 
  year_quarter == 2018.2 ~ INGCOST*(inflation_2022_Q4/inflation_2018_Q2),
  year_quarter == 2018.3 ~ INGCOST*(inflation_2022_Q4/inflation_2018_Q3),
  year_quarter == 2018.4 ~ INGCOST*(inflation_2022_Q4/inflation_2018_Q4), 
  year_quarter == 2019.1 ~ INGCOST*(inflation_2022_Q4/inflation_2019_Q1), 
  year_quarter == 2019.2 ~ INGCOST*(inflation_2022_Q4/inflation_2019_Q2),
  year_quarter == 2019.3 ~ INGCOST*(inflation_2022_Q4/inflation_2019_Q3),
  year_quarter == 2019.4 ~ INGCOST*(inflation_2022_Q4/inflation_2019_Q4),
  year_quarter == 2020.1 ~ INGCOST*(inflation_2022_Q4/inflation_2020_Q1), 
  year_quarter == 2020.2 ~ INGCOST*(inflation_2022_Q4/inflation_2020_Q2),
  year_quarter == 2020.3 ~ INGCOST*(inflation_2022_Q4/inflation_2020_Q3),
  year_quarter == 2020.4 ~ INGCOST*(inflation_2022_Q4/inflation_2020_Q4),
  year_quarter == 2021.1 ~ INGCOST*(inflation_2022_Q4/inflation_2021_Q1), 
  year_quarter == 2021.2 ~ INGCOST*(inflation_2022_Q4/inflation_2021_Q2),
  year_quarter == 2021.3 ~ INGCOST*(inflation_2022_Q4/inflation_2021_Q3),
  year_quarter == 2021.4 ~ INGCOST*(inflation_2022_Q4/inflation_2021_Q4),
  year_quarter == 2022.1 ~ INGCOST*(inflation_2022_Q4/inflation_2022_Q1), 
  year_quarter == 2022.2 ~ INGCOST*(inflation_2022_Q4/inflation_2022_Q2),
  year_quarter == 2022.3 ~ INGCOST*(inflation_2022_Q4/inflation_2022_Q3),
  year_quarter == 2022.4 ~ INGCOST*(inflation_2022_Q4/inflation_2022_Q4)),
    NETPAY = case_when(
  year_quarter == 2006.1 ~ NETPAY*(inflation_2022_Q4/inflation_2006_Q1), 
  year_quarter == 2006.2 ~ NETPAY*(inflation_2022_Q4/inflation_2006_Q2),
  year_quarter == 2006.3 ~ NETPAY*(inflation_2022_Q4/inflation_2006_Q3),
  year_quarter == 2006.4 ~ NETPAY*(inflation_2022_Q4/inflation_2006_Q4),  
  year_quarter == 2007.1 ~ NETPAY*(inflation_2022_Q4/inflation_2007_Q1), 
  year_quarter == 2007.2 ~ NETPAY*(inflation_2022_Q4/inflation_2007_Q2),
  year_quarter == 2007.3 ~ NETPAY*(inflation_2022_Q4/inflation_2007_Q3),
  year_quarter == 2007.4 ~ NETPAY*(inflation_2022_Q4/inflation_2007_Q4),  
  year_quarter == 2008.1 ~ NETPAY*(inflation_2022_Q4/inflation_2008_Q1), 
  year_quarter == 2008.2 ~ NETPAY*(inflation_2022_Q4/inflation_2008_Q2),
  year_quarter == 2008.3 ~ NETPAY*(inflation_2022_Q4/inflation_2008_Q3),
  year_quarter == 2008.4 ~ NETPAY*(inflation_2022_Q4/inflation_2008_Q4), 
  year_quarter == 2009.1 ~ NETPAY*(inflation_2022_Q4/inflation_2009_Q1), 
  year_quarter == 2009.2 ~ NETPAY*(inflation_2022_Q4/inflation_2009_Q2),
  year_quarter == 2009.3 ~ NETPAY*(inflation_2022_Q4/inflation_2009_Q3),
  year_quarter == 2009.4 ~ NETPAY*(inflation_2022_Q4/inflation_2009_Q4), 
  year_quarter == 2010.1 ~ NETPAY*(inflation_2022_Q4/inflation_2010_Q1), 
  year_quarter == 2010.2 ~ NETPAY*(inflation_2022_Q4/inflation_2010_Q2),
  year_quarter == 2010.3 ~ NETPAY*(inflation_2022_Q4/inflation_2010_Q3),
  year_quarter == 2010.4 ~ NETPAY*(inflation_2022_Q4/inflation_2010_Q4), 
  year_quarter == 2011.1 ~ NETPAY*(inflation_2022_Q4/inflation_2011_Q1), 
  year_quarter == 2011.2 ~ NETPAY*(inflation_2022_Q4/inflation_2011_Q2),
  year_quarter == 2011.3 ~ NETPAY*(inflation_2022_Q4/inflation_2011_Q3),
  year_quarter == 2011.4 ~ NETPAY*(inflation_2022_Q4/inflation_2011_Q4), 
  year_quarter == 2012.1 ~ NETPAY*(inflation_2022_Q4/inflation_2012_Q1), 
  year_quarter == 2012.2 ~ NETPAY*(inflation_2022_Q4/inflation_2012_Q2),
  year_quarter == 2012.3 ~ NETPAY*(inflation_2022_Q4/inflation_2012_Q3),
  year_quarter == 2012.4 ~ NETPAY*(inflation_2022_Q4/inflation_2012_Q4), 
  year_quarter == 2013.1 ~ NETPAY*(inflation_2022_Q4/inflation_2013_Q1), 
  year_quarter == 2013.2 ~ NETPAY*(inflation_2022_Q4/inflation_2013_Q2),
  year_quarter == 2013.3 ~ NETPAY*(inflation_2022_Q4/inflation_2013_Q3),
  year_quarter == 2013.4 ~ NETPAY*(inflation_2022_Q4/inflation_2013_Q4), 
  year_quarter == 2014.1 ~ NETPAY*(inflation_2022_Q4/inflation_2014_Q1), 
  year_quarter == 2014.2 ~ NETPAY*(inflation_2022_Q4/inflation_2014_Q2),
  year_quarter == 2014.3 ~ NETPAY*(inflation_2022_Q4/inflation_2014_Q3),
  year_quarter == 2014.4 ~ NETPAY*(inflation_2022_Q4/inflation_2014_Q4),  
  year_quarter == 2015.1 ~ NETPAY*(inflation_2022_Q4/inflation_2015_Q1), 
  year_quarter == 2015.2 ~ NETPAY*(inflation_2022_Q4/inflation_2015_Q2),
  year_quarter == 2015.3 ~ NETPAY*(inflation_2022_Q4/inflation_2015_Q3),
  year_quarter == 2015.4 ~ NETPAY*(inflation_2022_Q4/inflation_2015_Q4),  
  year_quarter == 2016.1 ~ NETPAY*(inflation_2022_Q4/inflation_2016_Q1), 
  year_quarter == 2016.2 ~ NETPAY*(inflation_2022_Q4/inflation_2016_Q2),
  year_quarter == 2016.3 ~ NETPAY*(inflation_2022_Q4/inflation_2016_Q3),
  year_quarter == 2016.4 ~ NETPAY*(inflation_2022_Q4/inflation_2016_Q4), 
  year_quarter == 2017.1 ~ NETPAY*(inflation_2022_Q4/inflation_2017_Q1), 
  year_quarter == 2017.2 ~ NETPAY*(inflation_2022_Q4/inflation_2017_Q2),
  year_quarter == 2017.3 ~ NETPAY*(inflation_2022_Q4/inflation_2017_Q3),
  year_quarter == 2017.4 ~ NETPAY*(inflation_2022_Q4/inflation_2017_Q4), 
  year_quarter == 2018.1 ~ NETPAY*(inflation_2022_Q4/inflation_2018_Q1), 
  year_quarter == 2018.2 ~ NETPAY*(inflation_2022_Q4/inflation_2018_Q2),
  year_quarter == 2018.3 ~ NETPAY*(inflation_2022_Q4/inflation_2018_Q3),
  year_quarter == 2018.4 ~ NETPAY*(inflation_2022_Q4/inflation_2018_Q4), 
  year_quarter == 2019.1 ~ NETPAY*(inflation_2022_Q4/inflation_2019_Q1), 
  year_quarter == 2019.2 ~ NETPAY*(inflation_2022_Q4/inflation_2019_Q2),
  year_quarter == 2019.3 ~ NETPAY*(inflation_2022_Q4/inflation_2019_Q3),
  year_quarter == 2019.4 ~ NETPAY*(inflation_2022_Q4/inflation_2019_Q4),
  year_quarter == 2020.1 ~ NETPAY*(inflation_2022_Q4/inflation_2020_Q1), 
  year_quarter == 2020.2 ~ NETPAY*(inflation_2022_Q4/inflation_2020_Q2),
  year_quarter == 2020.3 ~ NETPAY*(inflation_2022_Q4/inflation_2020_Q3),
  year_quarter == 2020.4 ~ NETPAY*(inflation_2022_Q4/inflation_2020_Q4),
  year_quarter == 2021.1 ~ NETPAY*(inflation_2022_Q4/inflation_2021_Q1), 
  year_quarter == 2021.2 ~ NETPAY*(inflation_2022_Q4/inflation_2021_Q2),
  year_quarter == 2021.3 ~ NETPAY*(inflation_2022_Q4/inflation_2021_Q3),
  year_quarter == 2021.4 ~ NETPAY*(inflation_2022_Q4/inflation_2021_Q4),
  year_quarter == 2022.1 ~ NETPAY*(inflation_2022_Q4/inflation_2022_Q1), 
  year_quarter == 2022.2 ~ NETPAY*(inflation_2022_Q4/inflation_2022_Q2),
  year_quarter == 2022.3 ~ NETPAY*(inflation_2022_Q4/inflation_2022_Q3),
  year_quarter == 2022.4 ~ NETPAY*(inflation_2022_Q4/inflation_2022_Q4)),
    PAY = case_when(
  year_quarter == 2006.1 ~ PAY*(inflation_2022_Q4/inflation_2006_Q1), 
  year_quarter == 2006.2 ~ PAY*(inflation_2022_Q4/inflation_2006_Q2),
  year_quarter == 2006.3 ~ PAY*(inflation_2022_Q4/inflation_2006_Q3),
  year_quarter == 2006.4 ~ PAY*(inflation_2022_Q4/inflation_2006_Q4),  
  year_quarter == 2007.1 ~ PAY*(inflation_2022_Q4/inflation_2007_Q1), 
  year_quarter == 2007.2 ~ PAY*(inflation_2022_Q4/inflation_2007_Q2),
  year_quarter == 2007.3 ~ PAY*(inflation_2022_Q4/inflation_2007_Q3),
  year_quarter == 2007.4 ~ PAY*(inflation_2022_Q4/inflation_2007_Q4),  
  year_quarter == 2008.1 ~ PAY*(inflation_2022_Q4/inflation_2008_Q1), 
  year_quarter == 2008.2 ~ PAY*(inflation_2022_Q4/inflation_2008_Q2),
  year_quarter == 2008.3 ~ PAY*(inflation_2022_Q4/inflation_2008_Q3),
  year_quarter == 2008.4 ~ PAY*(inflation_2022_Q4/inflation_2008_Q4), 
  year_quarter == 2009.1 ~ PAY*(inflation_2022_Q4/inflation_2009_Q1), 
  year_quarter == 2009.2 ~ PAY*(inflation_2022_Q4/inflation_2009_Q2),
  year_quarter == 2009.3 ~ PAY*(inflation_2022_Q4/inflation_2009_Q3),
  year_quarter == 2009.4 ~ PAY*(inflation_2022_Q4/inflation_2009_Q4), 
  year_quarter == 2010.1 ~ PAY*(inflation_2022_Q4/inflation_2010_Q1), 
  year_quarter == 2010.2 ~ PAY*(inflation_2022_Q4/inflation_2010_Q2),
  year_quarter == 2010.3 ~ PAY*(inflation_2022_Q4/inflation_2010_Q3),
  year_quarter == 2010.4 ~ PAY*(inflation_2022_Q4/inflation_2010_Q4), 
  year_quarter == 2011.1 ~ PAY*(inflation_2022_Q4/inflation_2011_Q1), 
  year_quarter == 2011.2 ~ PAY*(inflation_2022_Q4/inflation_2011_Q2),
  year_quarter == 2011.3 ~ PAY*(inflation_2022_Q4/inflation_2011_Q3),
  year_quarter == 2011.4 ~ PAY*(inflation_2022_Q4/inflation_2011_Q4), 
  year_quarter == 2012.1 ~ PAY*(inflation_2022_Q4/inflation_2012_Q1), 
  year_quarter == 2012.2 ~ PAY*(inflation_2022_Q4/inflation_2012_Q2),
  year_quarter == 2012.3 ~ PAY*(inflation_2022_Q4/inflation_2012_Q3),
  year_quarter == 2012.4 ~ PAY*(inflation_2022_Q4/inflation_2012_Q4), 
  year_quarter == 2013.1 ~ PAY*(inflation_2022_Q4/inflation_2013_Q1), 
  year_quarter == 2013.2 ~ PAY*(inflation_2022_Q4/inflation_2013_Q2),
  year_quarter == 2013.3 ~ PAY*(inflation_2022_Q4/inflation_2013_Q3),
  year_quarter == 2013.4 ~ PAY*(inflation_2022_Q4/inflation_2013_Q4), 
  year_quarter == 2014.1 ~ PAY*(inflation_2022_Q4/inflation_2014_Q1), 
  year_quarter == 2014.2 ~ PAY*(inflation_2022_Q4/inflation_2014_Q2),
  year_quarter == 2014.3 ~ PAY*(inflation_2022_Q4/inflation_2014_Q3),
  year_quarter == 2014.4 ~ PAY*(inflation_2022_Q4/inflation_2014_Q4),  
  year_quarter == 2015.1 ~ PAY*(inflation_2022_Q4/inflation_2015_Q1), 
  year_quarter == 2015.2 ~ PAY*(inflation_2022_Q4/inflation_2015_Q2),
  year_quarter == 2015.3 ~ PAY*(inflation_2022_Q4/inflation_2015_Q3),
  year_quarter == 2015.4 ~ PAY*(inflation_2022_Q4/inflation_2015_Q4),  
  year_quarter == 2016.1 ~ PAY*(inflation_2022_Q4/inflation_2016_Q1), 
  year_quarter == 2016.2 ~ PAY*(inflation_2022_Q4/inflation_2016_Q2),
  year_quarter == 2016.3 ~ PAY*(inflation_2022_Q4/inflation_2016_Q3),
  year_quarter == 2016.4 ~ PAY*(inflation_2022_Q4/inflation_2016_Q4), 
  year_quarter == 2017.1 ~ PAY*(inflation_2022_Q4/inflation_2017_Q1), 
  year_quarter == 2017.2 ~ PAY*(inflation_2022_Q4/inflation_2017_Q2),
  year_quarter == 2017.3 ~ PAY*(inflation_2022_Q4/inflation_2017_Q3),
  year_quarter == 2017.4 ~ PAY*(inflation_2022_Q4/inflation_2017_Q4), 
  year_quarter == 2018.1 ~ PAY*(inflation_2022_Q4/inflation_2018_Q1), 
  year_quarter == 2018.2 ~ PAY*(inflation_2022_Q4/inflation_2018_Q2),
  year_quarter == 2018.3 ~ PAY*(inflation_2022_Q4/inflation_2018_Q3),
  year_quarter == 2018.4 ~ PAY*(inflation_2022_Q4/inflation_2018_Q4), 
  year_quarter == 2019.1 ~ PAY*(inflation_2022_Q4/inflation_2019_Q1), 
  year_quarter == 2019.2 ~ PAY*(inflation_2022_Q4/inflation_2019_Q2),
  year_quarter == 2019.3 ~ PAY*(inflation_2022_Q4/inflation_2019_Q3),
  year_quarter == 2019.4 ~ PAY*(inflation_2022_Q4/inflation_2019_Q4),
  year_quarter == 2020.1 ~ PAY*(inflation_2022_Q4/inflation_2020_Q1), 
  year_quarter == 2020.2 ~ PAY*(inflation_2022_Q4/inflation_2020_Q2),
  year_quarter == 2020.3 ~ PAY*(inflation_2022_Q4/inflation_2020_Q3),
  year_quarter == 2020.4 ~ PAY*(inflation_2022_Q4/inflation_2020_Q4),
  year_quarter == 2021.1 ~ PAY*(inflation_2022_Q4/inflation_2021_Q1), 
  year_quarter == 2021.2 ~ PAY*(inflation_2022_Q4/inflation_2021_Q2),
  year_quarter == 2021.3 ~ PAY*(inflation_2022_Q4/inflation_2021_Q3),
  year_quarter == 2021.4 ~ PAY*(inflation_2022_Q4/inflation_2021_Q4),
  year_quarter == 2022.1 ~ PAY*(inflation_2022_Q4/inflation_2022_Q1), 
  year_quarter == 2022.2 ~ PAY*(inflation_2022_Q4/inflation_2022_Q2),
  year_quarter == 2022.3 ~ PAY*(inflation_2022_Q4/inflation_2022_Q3),
  year_quarter == 2022.4 ~ PAY*(inflation_2022_Q4/inflation_2022_Q4)),  
    SALETAX = case_when(
  year_quarter == 2006.1 ~ SALETAX*(inflation_2022_Q4/inflation_2006_Q1), 
  year_quarter == 2006.2 ~ SALETAX*(inflation_2022_Q4/inflation_2006_Q2),
  year_quarter == 2006.3 ~ SALETAX*(inflation_2022_Q4/inflation_2006_Q3),
  year_quarter == 2006.4 ~ SALETAX*(inflation_2022_Q4/inflation_2006_Q4),  
  year_quarter == 2007.1 ~ SALETAX*(inflation_2022_Q4/inflation_2007_Q1), 
  year_quarter == 2007.2 ~ SALETAX*(inflation_2022_Q4/inflation_2007_Q2),
  year_quarter == 2007.3 ~ SALETAX*(inflation_2022_Q4/inflation_2007_Q3),
  year_quarter == 2007.4 ~ SALETAX*(inflation_2022_Q4/inflation_2007_Q4),  
  year_quarter == 2008.1 ~ SALETAX*(inflation_2022_Q4/inflation_2008_Q1), 
  year_quarter == 2008.2 ~ SALETAX*(inflation_2022_Q4/inflation_2008_Q2),
  year_quarter == 2008.3 ~ SALETAX*(inflation_2022_Q4/inflation_2008_Q3),
  year_quarter == 2008.4 ~ SALETAX*(inflation_2022_Q4/inflation_2008_Q4), 
  year_quarter == 2009.1 ~ SALETAX*(inflation_2022_Q4/inflation_2009_Q1), 
  year_quarter == 2009.2 ~ SALETAX*(inflation_2022_Q4/inflation_2009_Q2),
  year_quarter == 2009.3 ~ SALETAX*(inflation_2022_Q4/inflation_2009_Q3),
  year_quarter == 2009.4 ~ SALETAX*(inflation_2022_Q4/inflation_2009_Q4), 
  year_quarter == 2010.1 ~ SALETAX*(inflation_2022_Q4/inflation_2010_Q1), 
  year_quarter == 2010.2 ~ SALETAX*(inflation_2022_Q4/inflation_2010_Q2),
  year_quarter == 2010.3 ~ SALETAX*(inflation_2022_Q4/inflation_2010_Q3),
  year_quarter == 2010.4 ~ SALETAX*(inflation_2022_Q4/inflation_2010_Q4), 
  year_quarter == 2011.1 ~ SALETAX*(inflation_2022_Q4/inflation_2011_Q1), 
  year_quarter == 2011.2 ~ SALETAX*(inflation_2022_Q4/inflation_2011_Q2),
  year_quarter == 2011.3 ~ SALETAX*(inflation_2022_Q4/inflation_2011_Q3),
  year_quarter == 2011.4 ~ SALETAX*(inflation_2022_Q4/inflation_2011_Q4), 
  year_quarter == 2012.1 ~ SALETAX*(inflation_2022_Q4/inflation_2012_Q1), 
  year_quarter == 2012.2 ~ SALETAX*(inflation_2022_Q4/inflation_2012_Q2),
  year_quarter == 2012.3 ~ SALETAX*(inflation_2022_Q4/inflation_2012_Q3),
  year_quarter == 2012.4 ~ SALETAX*(inflation_2022_Q4/inflation_2012_Q4), 
  year_quarter == 2013.1 ~ SALETAX*(inflation_2022_Q4/inflation_2013_Q1), 
  year_quarter == 2013.2 ~ SALETAX*(inflation_2022_Q4/inflation_2013_Q2),
  year_quarter == 2013.3 ~ SALETAX*(inflation_2022_Q4/inflation_2013_Q3),
  year_quarter == 2013.4 ~ SALETAX*(inflation_2022_Q4/inflation_2013_Q4), 
  year_quarter == 2014.1 ~ SALETAX*(inflation_2022_Q4/inflation_2014_Q1), 
  year_quarter == 2014.2 ~ SALETAX*(inflation_2022_Q4/inflation_2014_Q2),
  year_quarter == 2014.3 ~ SALETAX*(inflation_2022_Q4/inflation_2014_Q3),
  year_quarter == 2014.4 ~ SALETAX*(inflation_2022_Q4/inflation_2014_Q4),  
  year_quarter == 2015.1 ~ SALETAX*(inflation_2022_Q4/inflation_2015_Q1), 
  year_quarter == 2015.2 ~ SALETAX*(inflation_2022_Q4/inflation_2015_Q2),
  year_quarter == 2015.3 ~ SALETAX*(inflation_2022_Q4/inflation_2015_Q3),
  year_quarter == 2015.4 ~ SALETAX*(inflation_2022_Q4/inflation_2015_Q4),  
  year_quarter == 2016.1 ~ SALETAX*(inflation_2022_Q4/inflation_2016_Q1), 
  year_quarter == 2016.2 ~ SALETAX*(inflation_2022_Q4/inflation_2016_Q2),
  year_quarter == 2016.3 ~ SALETAX*(inflation_2022_Q4/inflation_2016_Q3),
  year_quarter == 2016.4 ~ SALETAX*(inflation_2022_Q4/inflation_2016_Q4), 
  year_quarter == 2017.1 ~ SALETAX*(inflation_2022_Q4/inflation_2017_Q1), 
  year_quarter == 2017.2 ~ SALETAX*(inflation_2022_Q4/inflation_2017_Q2),
  year_quarter == 2017.3 ~ SALETAX*(inflation_2022_Q4/inflation_2017_Q3),
  year_quarter == 2017.4 ~ SALETAX*(inflation_2022_Q4/inflation_2017_Q4), 
  year_quarter == 2018.1 ~ SALETAX*(inflation_2022_Q4/inflation_2018_Q1), 
  year_quarter == 2018.2 ~ SALETAX*(inflation_2022_Q4/inflation_2018_Q2),
  year_quarter == 2018.3 ~ SALETAX*(inflation_2022_Q4/inflation_2018_Q3),
  year_quarter == 2018.4 ~ SALETAX*(inflation_2022_Q4/inflation_2018_Q4), 
  year_quarter == 2019.1 ~ SALETAX*(inflation_2022_Q4/inflation_2019_Q1), 
  year_quarter == 2019.2 ~ SALETAX*(inflation_2022_Q4/inflation_2019_Q2),
  year_quarter == 2019.3 ~ SALETAX*(inflation_2022_Q4/inflation_2019_Q3),
  year_quarter == 2019.4 ~ SALETAX*(inflation_2022_Q4/inflation_2019_Q4),
  year_quarter == 2020.1 ~ SALETAX*(inflation_2022_Q4/inflation_2020_Q1), 
  year_quarter == 2020.2 ~ SALETAX*(inflation_2022_Q4/inflation_2020_Q2),
  year_quarter == 2020.3 ~ SALETAX*(inflation_2022_Q4/inflation_2020_Q3),
  year_quarter == 2020.4 ~ SALETAX*(inflation_2022_Q4/inflation_2020_Q4),
  year_quarter == 2021.1 ~ SALETAX*(inflation_2022_Q4/inflation_2021_Q1), 
  year_quarter == 2021.2 ~ SALETAX*(inflation_2022_Q4/inflation_2021_Q2),
  year_quarter == 2021.3 ~ SALETAX*(inflation_2022_Q4/inflation_2021_Q3),
  year_quarter == 2021.4 ~ SALETAX*(inflation_2022_Q4/inflation_2021_Q4),
  year_quarter == 2022.1 ~ SALETAX*(inflation_2022_Q4/inflation_2022_Q1), 
  year_quarter == 2022.2 ~ SALETAX*(inflation_2022_Q4/inflation_2022_Q2),
  year_quarter == 2022.3 ~ SALETAX*(inflation_2022_Q4/inflation_2022_Q3),
  year_quarter == 2022.4 ~ SALETAX*(inflation_2022_Q4/inflation_2022_Q4))    
  ) %>% 
    collect()
inflation_adjusted_ASM_epilepsy
```




Extract information for demographics
```{r}
# Extract information from demographics 
#################################2006#################################
demographics_2006 <- ms_t_2006 %>% 
  filter(ENROLID %in% !!inflation_adjusted_ASM_epilepsy$ENROLID) %>%
  select(ENROLID, SEX, DOBYR, REGION, EECLASS, EESTATU, EMPREL, EGEOLOC, DTSTART, DTEND, MEMDAYS, INDSTRY) %>% 
  mutate(across(c(ENROLID, SEX, REGION, EECLASS, EESTATU, EMPREL, EGEOLOC, MEMDAYS), as.numeric)) %>% 
  collect()

#################################2007#################################
demographics_2007 <- ms_t_2007 %>% 
  filter(ENROLID %in% !!inflation_adjusted_ASM_epilepsy$ENROLID) %>%
  select(ENROLID, SEX, DOBYR, REGION, EECLASS, EESTATU, EMPREL, EGEOLOC, DTSTART, DTEND, MEMDAYS, INDSTRY) %>% 
  mutate(across(c(ENROLID, SEX, REGION, EECLASS, EESTATU, EMPREL, EGEOLOC, MEMDAYS), as.numeric)) %>% 
  collect()

#################################2008#################################
demographics_2008 <- ms_t_2008 %>% 
  filter(ENROLID %in% !!inflation_adjusted_ASM_epilepsy$ENROLID) %>%
  select(ENROLID, SEX, DOBYR, REGION, EECLASS, EESTATU, EMPREL, EGEOLOC, DTSTART, DTEND, MEMDAYS, INDSTRY) %>% 
  mutate(across(c(ENROLID, SEX, REGION, EECLASS, EESTATU, EMPREL, EGEOLOC, MEMDAYS), as.numeric)) %>% 
  collect()

#################################2009#################################
demographics_2009 <- ms_t_2009 %>% 
  filter(ENROLID %in% !!inflation_adjusted_ASM_epilepsy$ENROLID) %>%
  select(ENROLID, SEX, DOBYR, REGION, EECLASS, EESTATU, EMPREL, EGEOLOC, DTSTART, DTEND, MEMDAYS, INDSTRY) %>% 
  mutate(across(c(ENROLID, SEX, REGION, EECLASS, EESTATU, EMPREL, EGEOLOC, MEMDAYS), as.numeric)) %>% 
  collect()

#################################2010#################################
demographics_2010 <- ms_t_2010 %>% 
  filter(ENROLID %in% !!inflation_adjusted_ASM_epilepsy$ENROLID) %>%
  select(ENROLID, SEX, DOBYR, REGION, EECLASS, EESTATU, EMPREL, EGEOLOC, DTSTART, DTEND, MEMDAYS, INDSTRY) %>% 
  mutate(across(c(ENROLID, SEX, REGION, EECLASS, EESTATU, EMPREL, EGEOLOC, MEMDAYS), as.numeric)) %>%
  collect()

#################################2011#################################
demographics_2011 <- ms_t_2011 %>% 
  filter(ENROLID %in% !!inflation_adjusted_ASM_epilepsy$ENROLID) %>%
  select(ENROLID, SEX, DOBYR, REGION, EECLASS, EESTATU, EMPREL, EGEOLOC, DTSTART, DTEND, MEMDAYS, INDSTRY) %>% 
  mutate(across(c(ENROLID, SEX, REGION, EECLASS, EESTATU, EMPREL, EGEOLOC, MEMDAYS), as.numeric)) %>% 
  collect()

#################################2012#################################
demographics_2012 <- ms_t_2012 %>% 
  filter(ENROLID %in% !!inflation_adjusted_ASM_epilepsy$ENROLID) %>%
  select(ENROLID, SEX, DOBYR, REGION, EECLASS, EESTATU, EMPREL, EGEOLOC, DTSTART, DTEND, MEMDAYS, INDSTRY) %>% 
  mutate(across(c(ENROLID, SEX, REGION, EECLASS, EESTATU, EMPREL, EGEOLOC, MEMDAYS), as.numeric)) %>% 
  collect()

#################################2013#################################
demographics_2013 <- ms_t_2013 %>% 
  filter(ENROLID %in% !!inflation_adjusted_ASM_epilepsy$ENROLID) %>%
  select(ENROLID, SEX, DOBYR, REGION, EECLASS, EESTATU, EMPREL, EGEOLOC, DTSTART, DTEND, MEMDAYS, INDSTRY) %>% 
  mutate(across(c(ENROLID, SEX, REGION, EECLASS, EESTATU, EMPREL, EGEOLOC, MEMDAYS), as.numeric)) %>% 
  collect()

#################################2014#################################
demographics_2014 <- ms_t_2014 %>% 
  filter(ENROLID %in% !!inflation_adjusted_ASM_epilepsy$ENROLID) %>%
  select(ENROLID, SEX, DOBYR, REGION, EECLASS, EESTATU, EMPREL, EGEOLOC, DTSTART, DTEND, MEMDAYS, INDSTRY) %>% 
  mutate(across(c(ENROLID, SEX, REGION, EECLASS, EESTATU, EMPREL, EGEOLOC, MEMDAYS), as.numeric)) %>% 
  collect()

#################################2015#################################
demographics_2015 <- ms_t_2015 %>% 
  filter(ENROLID %in% !!inflation_adjusted_ASM_epilepsy$ENROLID) %>%
  select(ENROLID, SEX, DOBYR, REGION, EECLASS, EESTATU, EMPREL, EGEOLOC, DTSTART, DTEND, MEMDAYS, INDSTRY) %>% 
  mutate(across(c(ENROLID, SEX, REGION, EECLASS, EESTATU, EMPREL, EGEOLOC, MEMDAYS), as.numeric)) %>% 
  collect()

#################################2016#################################
demographics_2016 <- ms_t_2016 %>% 
  filter(ENROLID %in% !!inflation_adjusted_ASM_epilepsy$ENROLID) %>%
  select(ENROLID, SEX, DOBYR, REGION, EECLASS, EESTATU, EMPREL, EGEOLOC, DTSTART, DTEND, MEMDAYS, INDSTRY) %>% 
  mutate(across(c(ENROLID, SEX, REGION, EECLASS, EESTATU, EMPREL, EGEOLOC, MEMDAYS), as.numeric)) %>% 
  collect()

#################################2017#################################
demographics_2017 <- ms_t_2017 %>% 
  filter(ENROLID %in% !!inflation_adjusted_ASM_epilepsy$ENROLID) %>%
  select(ENROLID, SEX, DOBYR, REGION, EECLASS, EESTATU, EMPREL, EGEOLOC, DTSTART, DTEND, MEMDAYS, INDSTRY) %>% 
  mutate(across(c(ENROLID, SEX, REGION, EECLASS, EESTATU, EMPREL, EGEOLOC, MEMDAYS), as.numeric)) %>% 
  collect()

#################################2018#################################
demographics_2018 <- ms_t_2018 %>% 
  filter(ENROLID %in% !!inflation_adjusted_ASM_epilepsy$ENROLID) %>%
  select(ENROLID, SEX, DOBYR, REGION, EECLASS, EESTATU, EMPREL, EGEOLOC, DTSTART, DTEND, MEMDAYS, INDSTRY) %>% 
  mutate(across(c(ENROLID, SEX, REGION, EECLASS, EESTATU, EMPREL, EGEOLOC, MEMDAYS), as.numeric)) %>% 
  collect()

#################################2019#################################
demographics_2019 <- ms_t_2019 %>% 
  filter(ENROLID %in% !!inflation_adjusted_ASM_epilepsy$ENROLID) %>%
  select(ENROLID, SEX, DOBYR, REGION, EECLASS, EESTATU, EMPREL, EGEOLOC, DTSTART, DTEND, MEMDAYS, INDSTRY) %>% 
  mutate(across(c(ENROLID, SEX, REGION, EECLASS, EESTATU, EMPREL, EGEOLOC, MEMDAYS), as.numeric)) %>% 
  collect()

#################################2020#################################
demographics_2020 <- ms_t_2020 %>% 
  filter(ENROLID %in% !!inflation_adjusted_ASM_epilepsy$ENROLID) %>%
  select(ENROLID, SEX, DOBYR, REGION, EECLASS, EESTATU, EMPREL, EGEOLOC, DTSTART, DTEND, MEMDAYS, INDSTRY) %>% 
  mutate(across(c(ENROLID, SEX, REGION, EECLASS, EESTATU, EMPREL, EGEOLOC, MEMDAYS), as.numeric)) %>% 
  collect()

#################################2021#################################
demographics_2021 <- ms_t_2021 %>% 
  filter(ENROLID %in% !!inflation_adjusted_ASM_epilepsy$ENROLID) %>%
  select(ENROLID, SEX, DOBYR, REGION, EECLASS, EESTATU, EMPREL, EGEOLOC, DTSTART, DTEND, MEMDAYS, INDSTRY) %>% 
  mutate(across(c(ENROLID, SEX, REGION, EECLASS, EESTATU, EMPREL, EGEOLOC, MEMDAYS), as.numeric)) %>% 
  collect()


# Add demographic data to the database
inflation_adjusted_ASM_epilepsy <- bind_rows(demographics_2006, demographics_2007, demographics_2008, demographics_2009, demographics_2010, demographics_2011, demographics_2012, demographics_2013, demographics_2014, demographics_2015, demographics_2016, demographics_2017, demographics_2018, demographics_2019, demographics_2020, demographics_2021) %>% 
  mutate(across(ENROLID, as.numeric)) %>% 
  filter(ENROLID>0) %>%    
  distinct(ENROLID, .keep_all=TRUE) %>% 
  left_join(inflation_adjusted_ASM_epilepsy, by="ENROLID") %>% 
  mutate(age_first_ASM_prescription = year(SVCDATE) - DOBYR) %>% 
  collect()


# Division into pediatric (<= 18 years at first ASM prescription) and adult patients
pediatric <- inflation_adjusted_ASM_epilepsy %>% 
  arrange(ENROLID, SVCDATE) %>% 
  distinct(ENROLID, .keep_all=TRUE) %>% 
  filter(age_first_ASM_prescription<=18) %>% 
  collect()

inflation_adjusted_ASM_epilepsy <- inflation_adjusted_ASM_epilepsy %>% 
  mutate(pediatric_or_adult = case_when(
    ENROLID %in% !!pediatric$ENROLID ~ "pediatric",
    TRUE ~ "adult"
  )) %>% 
  collect()
```




Transform variable for generic antiseizure medication
```{r}
# Create variable generic binary
inflation_adjusted_ASM_epilepsy <- inflation_adjusted_ASM_epilepsy %>% 
  mutate(generic_binary = case_when(
    GENIND=="1" | GENIND=="3" ~ "brand name",
    GENIND=="4" | GENIND=="5" ~ "generic",
    TRUE ~ "other / no data"
  )) %>% 
  collect()
inflation_adjusted_ASM_epilepsy


# Create variable generic
inflation_adjusted_ASM_epilepsy <- inflation_adjusted_ASM_epilepsy %>% 
  mutate(generic = case_when(
    GENIND=="1" ~ "single source brand",
    GENIND=="3" ~ "brand name, generic available",
    GENIND=="4" ~ "multisource generic",
    GENIND=="5" ~ "single source generic",
    TRUE ~ "other / no data"
  )) %>% 
  collect()
inflation_adjusted_ASM_epilepsy
```




Create variable person years
```{r}
# Create variable person years
inflation_adjusted_ASM_epilepsy <- inflation_adjusted_ASM_epilepsy %>% 
  group_by(ENROLID) %>% 
  arrange(ENROLID, SVCDATE) %>% 
  mutate(person_years = as.numeric((dplyr::last(SVCDATE) + days(dplyr::last(DAYSUPP))) - dplyr::first(SVCDATE)) / 365.24219) %>% 
  ungroup() %>% 
  collect() 
inflation_adjusted_ASM_epilepsy 


# Create variable person years per year
inflation_adjusted_ASM_epilepsy <- inflation_adjusted_ASM_epilepsy %>% 
  group_by(ENROLID, year(SVCDATE)) %>% 
  arrange(ENROLID, SVCDATE) %>% 
  mutate(person_years_per_year = as.numeric((dplyr::last(SVCDATE) + days(dplyr::last(DAYSUPP))) - dplyr::first(SVCDATE)) / 365.24219) %>% 
  ungroup() %>% 
  collect() 
inflation_adjusted_ASM_epilepsy 
```








## 3. Demographic and clinical features




Demographics
```{r}
# Total patients
total_patients <- inflation_adjusted_ASM_epilepsy %>% 
  distinct(ENROLID) %>% 
  nrow()
total_patients

# Total pediatric patients
total_pediatric_patients <- inflation_adjusted_ASM_epilepsy %>% 
  distinct(ENROLID, .keep_all=TRUE) %>% 
  filter(pediatric_or_adult=="pediatric") %>% 
  nrow()
total_pediatric_patients
total_pediatric_patients/total_patients

# Total adult patients
total_adult_patients <- inflation_adjusted_ASM_epilepsy %>% 
  distinct(ENROLID, .keep_all=TRUE) %>% 
  filter(pediatric_or_adult=="adult") %>% 
  nrow()
total_adult_patients
total_adult_patients/total_patients




# Total person years
total_person_years <- inflation_adjusted_ASM_epilepsy %>% 
  distinct(ENROLID, .keep_all=TRUE) %>% 
  summarize(total_person_years = sum(person_years)) %>% 
  pull()
total_person_years

# Total person years pediatrics
total_person_years_pediatric <- inflation_adjusted_ASM_epilepsy %>% 
  filter(pediatric_or_adult=="pediatric") %>% 
  distinct(ENROLID, .keep_all=TRUE) %>% 
  summarize(total_person_years = sum(person_years)) %>% 
  pull()
total_person_years_pediatric

# Total person years adults
total_person_years_adult <- inflation_adjusted_ASM_epilepsy %>% 
  filter(pediatric_or_adult=="adult") %>% 
  distinct(ENROLID, .keep_all=TRUE) %>% 
  summarize(total_person_years = sum(person_years)) %>% 
  pull()
total_person_years_adult




# Total prescription days
total_DAYSUPP <- inflation_adjusted_ASM_epilepsy %>% 
  summarize(total_days = sum(DAYSUPP)) %>% 
  pull()
total_DAYSUPP
total_years <- total_DAYSUPP / 365.24219
total_years

# Total prescription days pediatrics
total_DAYSUPP_pediatric <- inflation_adjusted_ASM_epilepsy %>% 
  filter(pediatric_or_adult=="pediatric") %>% 
  summarize(total_days = sum(DAYSUPP)) %>% 
  pull()
total_DAYSUPP_pediatric
total_years_pediatric <- total_DAYSUPP / 365.24219
total_years_pediatric

# Total prescription days adult
total_DAYSUPP_adult <- inflation_adjusted_ASM_epilepsy %>% 
  filter(pediatric_or_adult=="adult") %>% 
  summarize(total_days = sum(DAYSUPP)) %>% 
  pull()
total_DAYSUPP_adult
total_years_adult <- total_DAYSUPP / 365.24219
total_years_adult




# Age
age_first_ASM <- inflation_adjusted_ASM_epilepsy %>% 
  arrange(ENROLID, SVCDATE) %>% 
  distinct(ENROLID, .keep_all=TRUE) %>% 
  summarize(
    median_age = median(age_first_ASM_prescription),
    p25_age = quantile(age_first_ASM_prescription, 0.25),
    p75_age = quantile(age_first_ASM_prescription, 0.75),
    mean_age = mean(age_first_ASM_prescription),
    SD_age = sd(age_first_ASM_prescription)
  ) %>% collect()
age_first_ASM

# Age pediatrics
age_first_ASM_pediatric <- inflation_adjusted_ASM_epilepsy %>% 
  arrange(ENROLID, SVCDATE) %>% 
  distinct(ENROLID, .keep_all=TRUE) %>% 
  filter(pediatric_or_adult=="pediatric") %>% 
  summarize(
    median_age = median(age_first_ASM_prescription),
    p25_age = quantile(age_first_ASM_prescription, 0.25),
    p75_age = quantile(age_first_ASM_prescription, 0.75),
    mean_age = mean(age_first_ASM_prescription),
    SD_age = sd(age_first_ASM_prescription)
  ) %>% collect()
age_first_ASM_pediatric

# Age adult
age_first_ASM_adult <- inflation_adjusted_ASM_epilepsy %>% 
  arrange(ENROLID, SVCDATE) %>% 
  distinct(ENROLID, .keep_all=TRUE) %>% 
  filter(pediatric_or_adult=="adult") %>% 
  summarize(
    median_age = median(age_first_ASM_prescription),
    p25_age = quantile(age_first_ASM_prescription, 0.25),
    p75_age = quantile(age_first_ASM_prescription, 0.75),
    mean_age = mean(age_first_ASM_prescription),
    SD_age = sd(age_first_ASM_prescription)
  ) %>% collect()
age_first_ASM_adult




# Sex
sex <- inflation_adjusted_ASM_epilepsy %>% 
  arrange(ENROLID, SVCDATE) %>% 
  distinct(ENROLID, .keep_all=TRUE) %>% 
  reframe(
    sex = CrossTable(SEX)
  )

# Sex pediatric
sex_pediatric <- inflation_adjusted_ASM_epilepsy %>% 
  arrange(ENROLID, SVCDATE) %>% 
  distinct(ENROLID, .keep_all=TRUE) %>% 
  filter(pediatric_or_adult=="pediatric") %>% 
  reframe(
    sex = CrossTable(SEX)
  )

# Sex adult
sex_adult <- inflation_adjusted_ASM_epilepsy %>% 
  arrange(ENROLID, SVCDATE) %>% 
  distinct(ENROLID, .keep_all=TRUE) %>% 
  filter(pediatric_or_adult=="adult") %>% 
  reframe(
    sex = CrossTable(SEX)
  )




# Region of patient residence
region <- inflation_adjusted_ASM_epilepsy %>% 
  arrange(ENROLID, SVCDATE) %>% 
  distinct(ENROLID, .keep_all=TRUE) %>% 
  reframe(
    region = CrossTable(REGION)
  )

# Region of patient residence pediatric
region_pediatric <- inflation_adjusted_ASM_epilepsy %>% 
  arrange(ENROLID, SVCDATE) %>% 
  distinct(ENROLID, .keep_all=TRUE) %>% 
  filter(pediatric_or_adult=="pediatric") %>% 
  reframe(
    region = CrossTable(REGION)
  )

# Region of patient residence adult
region_adult <- inflation_adjusted_ASM_epilepsy %>% 
  arrange(ENROLID, SVCDATE) %>% 
  distinct(ENROLID, .keep_all=TRUE) %>% 
  filter(pediatric_or_adult=="adult") %>% 
  reframe(
    region = CrossTable(REGION)
  )




# Relationship of the patient to the main beneficiary
relationship_employee <- inflation_adjusted_ASM_epilepsy %>% 
  arrange(ENROLID, SVCDATE) %>% 
  distinct(ENROLID, .keep_all=TRUE) %>% 
  reframe(
    relationship_employee = CrossTable(EMPREL)
  )

# Relationship of the patient to the main beneficiary pediatric
relationship_employee_pediatric <- inflation_adjusted_ASM_epilepsy %>% 
  arrange(ENROLID, SVCDATE) %>% 
  distinct(ENROLID, .keep_all=TRUE) %>% 
  filter(pediatric_or_adult=="pediatric") %>% 
  reframe(
    relationship_employee = CrossTable(EMPREL)
  )

# Relationship of the patient to the main beneficiary adult
relationship_employee_adult <- inflation_adjusted_ASM_epilepsy %>% 
  arrange(ENROLID, SVCDATE) %>% 
  distinct(ENROLID, .keep_all=TRUE) %>% 
  filter(pediatric_or_adult=="adult") %>% 
  reframe(
    relationship_employee = CrossTable(EMPREL)
  )




# Working status of the main beneficiary
employment_status <- inflation_adjusted_ASM_epilepsy %>% 
  arrange(ENROLID, SVCDATE) %>% 
  distinct(ENROLID, .keep_all=TRUE) %>% 
  reframe(
    employment_status = CrossTable(EESTATU)
  )

# Working status of the main beneficiary pediatric
employment_status_pediatric <- inflation_adjusted_ASM_epilepsy %>% 
  arrange(ENROLID, SVCDATE) %>% 
  distinct(ENROLID, .keep_all=TRUE) %>% 
  filter(pediatric_or_adult=="pediatric") %>% 
  reframe(
    employment_status = CrossTable(EESTATU)
  )

# Working status of the main beneficiary adult
employment_status_adult <- inflation_adjusted_ASM_epilepsy %>% 
  arrange(ENROLID, SVCDATE) %>% 
  distinct(ENROLID, .keep_all=TRUE) %>% 
  filter(pediatric_or_adult=="adult") %>% 
  reframe(
    employment_status = CrossTable(EESTATU)
  )




# Industry of the main beneficiary
industry <- inflation_adjusted_ASM_epilepsy %>% 
  arrange(ENROLID, SVCDATE) %>% 
  distinct(ENROLID, .keep_all=TRUE) %>% 
  reframe(
    industry = CrossTable(INDSTRY)
  )

# Industry of the main beneficiary pediatric
industry_pediatric <- inflation_adjusted_ASM_epilepsy %>% 
  arrange(ENROLID, SVCDATE) %>% 
  distinct(ENROLID, .keep_all=TRUE) %>% 
  filter(pediatric_or_adult=="pediatric") %>%
  reframe(
    industry = CrossTable(INDSTRY)
  )

# Industry of the main beneficiary adult
industry_adult <- inflation_adjusted_ASM_epilepsy %>% 
  arrange(ENROLID, SVCDATE) %>% 
  distinct(ENROLID, .keep_all=TRUE) %>% 
  filter(pediatric_or_adult=="adult") %>%
  reframe(
    industry = CrossTable(INDSTRY)
  )
```




Antiseizure medication type
```{r}
####################Pediatric and adult######################
# Use of ASM in the period 2006-2021
ASM_use_total <- inflation_adjusted_ASM_epilepsy %>% 
  mutate(total_DAYSUPP = sum(DAYSUPP)) %>% 
  group_by(ASM) %>% 
  summarize(
    proportion_use = sum(DAYSUPP) / total_DAYSUPP,
    total_prescription_years = total_DAYSUPP / 365.24219
  ) %>% 
  distinct(ASM, .keep_all=TRUE) %>% 
  arrange(desc(proportion_use)) %>% 
  collect()
ASM_use_total




# Use of antiseizure medications per year
ASM_use_per_year  <- inflation_adjusted_ASM_epilepsy %>% 
  group_by(year(SVCDATE)) %>% 
  mutate(total_DAYSUPP_per_year = sum(DAYSUPP)) %>% 
  ungroup() %>% 
  group_by(year(SVCDATE), ASM) %>% 
  summarize(
    proportion_use_per_year = sum(DAYSUPP) / total_DAYSUPP_per_year,
    total_prescription_years_per_year = total_DAYSUPP_per_year / 365.24219
  ) %>% 
  distinct(`year(SVCDATE)`, ASM, .keep_all=TRUE) %>% 
  ungroup() %>% 
  group_by(`year(SVCDATE)`) %>% 
  arrange(desc(proportion_use_per_year), .by_group=TRUE) %>% 
  collect()
ASM_use_per_year


ASM_use_per_year_top_10  <- inflation_adjusted_ASM_epilepsy %>% 
  group_by(year(SVCDATE)) %>% 
  mutate(total_DAYSUPP_per_year = sum(DAYSUPP)) %>% 
  ungroup() %>% 
  group_by(year(SVCDATE), ASM) %>% 
  summarize(
    proportion_use_per_year = sum(DAYSUPP) / total_DAYSUPP_per_year
  ) %>% 
  distinct(`year(SVCDATE)`, ASM, .keep_all=TRUE) %>% 
  ungroup() %>% 
  group_by(`year(SVCDATE)`) %>% 
  arrange(desc(proportion_use_per_year), .by_group=TRUE) %>% 
  top_n(10) %>% 
  collect()
ASM_use_per_year_top_10


ASM_use_per_year_top_5  <- inflation_adjusted_ASM_epilepsy %>% 
  group_by(year(SVCDATE)) %>% 
  mutate(total_DAYSUPP_per_year = sum(DAYSUPP)) %>% 
  ungroup() %>% 
  group_by(year(SVCDATE), ASM) %>% 
  summarize(
    proportion_use_per_year = sum(DAYSUPP) / total_DAYSUPP_per_year
  ) %>% 
  distinct(`year(SVCDATE)`, ASM, .keep_all=TRUE) %>% 
  ungroup() %>% 
  group_by(`year(SVCDATE)`) %>% 
  arrange(desc(proportion_use_per_year), .by_group=TRUE) %>% 
  top_n(5) %>% 
  collect()
ASM_use_per_year_top_5




# Use of antiseizure medication per year figure
ASM_use_per_year_plot <- ggplot(data=ASM_use_per_year_top_5,
                                aes(x=`year(SVCDATE)`, y=proportion_use_per_year, color=ASM)) + 
  scale_color_manual(values = c("phenytoin" = "black",
                                "carbamazepine"="darkorange",
                                "lamotrigine"="red",
                                "valproate"="darkblue",
                                "levetiracetam"="darkgreen",
                                "topiramate"="chartreuse1",
                                "oxcarbazepine"="deeppink")) +
  geom_line(lwd=1.5) + 
  theme(legend.position="none", panel.background=element_blank(), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), axis.ticks=element_blank(),
        axis.text=element_text(size=14, face="bold"), axis.text.x=element_text(angle=45, hjust=1),
        axis.title=element_text(size=20, face="bold")) +
  scale_x_continuous(name="Year", breaks=2006:2021) +
  scale_y_continuous(name="Proportion", breaks=seq(0, 0.3, 0.05), limits = c(0, 0.3))
ASM_use_per_year_plot






####################Pediatric######################
# Use of ASM in the period 2006-2021
ASM_use_total_pediatric <- inflation_adjusted_ASM_epilepsy %>% 
  filter(pediatric_or_adult=="pediatric") %>%
  mutate(total_DAYSUPP = sum(DAYSUPP)) %>% 
  group_by(ASM) %>% 
  summarize(
    proportion_use = sum(DAYSUPP) / total_DAYSUPP,
    total_prescription_years = total_DAYSUPP / 365.24219
  ) %>% 
  distinct(ASM, .keep_all=TRUE) %>% 
  arrange(desc(proportion_use)) %>% 
  collect()
ASM_use_total_pediatric




# Use of antiseizure medications per year
ASM_use_per_year_pediatric  <- inflation_adjusted_ASM_epilepsy %>% 
  filter(pediatric_or_adult=="pediatric") %>%
  group_by(year(SVCDATE)) %>% 
  mutate(total_DAYSUPP_per_year = sum(DAYSUPP)) %>% 
  ungroup() %>% 
  group_by(year(SVCDATE), ASM) %>% 
  summarize(
    proportion_use_per_year = sum(DAYSUPP) / total_DAYSUPP_per_year,
    total_prescription_years_per_year = total_DAYSUPP_per_year / 365.24219
  ) %>% 
  distinct(`year(SVCDATE)`, ASM, .keep_all=TRUE) %>% 
  ungroup() %>% 
  group_by(`year(SVCDATE)`) %>% 
  arrange(desc(proportion_use_per_year), .by_group=TRUE) %>% 
  collect()
ASM_use_per_year_pediatric


ASM_use_per_year_pediatric_top_10  <- inflation_adjusted_ASM_epilepsy %>% 
  filter(pediatric_or_adult=="pediatric") %>%
  group_by(year(SVCDATE)) %>% 
  mutate(total_DAYSUPP_per_year = sum(DAYSUPP)) %>% 
  ungroup() %>% 
  group_by(year(SVCDATE), ASM) %>% 
  summarize(
    proportion_use_per_year = sum(DAYSUPP) / total_DAYSUPP_per_year
  ) %>% 
  distinct(`year(SVCDATE)`, ASM, .keep_all=TRUE) %>% 
  ungroup() %>% 
  group_by(`year(SVCDATE)`) %>% 
  arrange(desc(proportion_use_per_year), .by_group=TRUE) %>% 
  top_n(10) %>% 
  collect()
ASM_use_per_year_pediatric_top_10


ASM_use_per_year_pediatric_top_5  <- inflation_adjusted_ASM_epilepsy %>% 
  filter(pediatric_or_adult=="pediatric") %>%
  group_by(year(SVCDATE)) %>% 
  mutate(total_DAYSUPP_per_year = sum(DAYSUPP)) %>% 
  ungroup() %>% 
  group_by(year(SVCDATE), ASM) %>% 
  summarize(
    proportion_use_per_year = sum(DAYSUPP) / total_DAYSUPP_per_year
  ) %>% 
  distinct(`year(SVCDATE)`, ASM, .keep_all=TRUE) %>% 
  ungroup() %>% 
  group_by(`year(SVCDATE)`) %>% 
  arrange(desc(proportion_use_per_year), .by_group=TRUE) %>% 
  top_n(5) %>% 
  collect()
ASM_use_per_year_pediatric_top_5




# Use of antiseizure medication per year figure
ASM_use_per_year_pediatric_plot <- ggplot(data=ASM_use_per_year_pediatric_top_5,
                                aes(x=`year(SVCDATE)`, y=proportion_use_per_year, color=ASM)) + 
    scale_color_manual(values = c("phenytoin" = "black",
                                "carbamazepine"="darkorange",
                                "lamotrigine"="red",
                                "valproate"="darkblue",
                                "levetiracetam"="darkgreen",
                                "topiramate"="chartreuse1",
                                "oxcarbazepine"="deeppink",
                                "clobazam"="purple")) +

  geom_line(lwd=1.5) + 
  theme(legend.position="none", panel.background=element_blank(), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), axis.ticks=element_blank(),
        axis.text=element_text(size=14, face="bold"), axis.text.x=element_text(angle=45, hjust=1),
        axis.title=element_text(size=20, face="bold")) +
  scale_x_continuous(name="Year", breaks=2006:2021) +
  scale_y_continuous(name="Proportion", breaks=seq(0, 0.3, 0.05), limits = c(0, 0.3))
ASM_use_per_year_pediatric_plot






####################Adult######################
# Use of ASM in the period 2006-2021
ASM_use_total_adult <- inflation_adjusted_ASM_epilepsy %>% 
  filter(pediatric_or_adult=="adult") %>%
  mutate(total_DAYSUPP = sum(DAYSUPP)) %>% 
  group_by(ASM) %>% 
  summarize(
    proportion_use = sum(DAYSUPP) / total_DAYSUPP,
    total_prescription_years = total_DAYSUPP / 365.24219
  ) %>% 
  distinct(ASM, .keep_all=TRUE) %>% 
  arrange(desc(proportion_use)) %>% 
  collect()
ASM_use_total_adult




# Use of antiseizure medications per year
ASM_use_per_year_adult  <- inflation_adjusted_ASM_epilepsy %>% 
  filter(pediatric_or_adult=="adult") %>%
  group_by(year(SVCDATE)) %>% 
  mutate(total_DAYSUPP_per_year = sum(DAYSUPP)) %>% 
  ungroup() %>% 
  group_by(year(SVCDATE), ASM) %>% 
  summarize(
    proportion_use_per_year = sum(DAYSUPP) / total_DAYSUPP_per_year,
    total_prescription_years_per_year = total_DAYSUPP_per_year / 365.24219
  ) %>% 
  distinct(`year(SVCDATE)`, ASM, .keep_all=TRUE) %>% 
  ungroup() %>% 
  group_by(`year(SVCDATE)`) %>% 
  arrange(desc(proportion_use_per_year), .by_group=TRUE) %>% 
  collect()
ASM_use_per_year_adult


ASM_use_per_year_adult_top_10  <- inflation_adjusted_ASM_epilepsy %>% 
  filter(pediatric_or_adult=="adult") %>%
  group_by(year(SVCDATE)) %>% 
  mutate(total_DAYSUPP_per_year = sum(DAYSUPP)) %>% 
  ungroup() %>% 
  group_by(year(SVCDATE), ASM) %>% 
  summarize(
    proportion_use_per_year = sum(DAYSUPP) / total_DAYSUPP_per_year
  ) %>% 
  distinct(`year(SVCDATE)`, ASM, .keep_all=TRUE) %>% 
  ungroup() %>% 
  group_by(`year(SVCDATE)`) %>% 
  arrange(desc(proportion_use_per_year), .by_group=TRUE) %>% 
  top_n(10) %>% 
  collect()
ASM_use_per_year_adult_top_10


ASM_use_per_year_adult_top_5  <- inflation_adjusted_ASM_epilepsy %>% 
  filter(pediatric_or_adult=="adult") %>%
  group_by(year(SVCDATE)) %>% 
  mutate(total_DAYSUPP_per_year = sum(DAYSUPP)) %>% 
  ungroup() %>% 
  group_by(year(SVCDATE), ASM) %>% 
  summarize(
    proportion_use_per_year = sum(DAYSUPP) / total_DAYSUPP_per_year
  ) %>% 
  distinct(`year(SVCDATE)`, ASM, .keep_all=TRUE) %>% 
  ungroup() %>% 
  group_by(`year(SVCDATE)`) %>% 
  arrange(desc(proportion_use_per_year), .by_group=TRUE) %>% 
  top_n(5) %>% 
  collect()
ASM_use_per_year_adult_top_5




# Use of antiseizure medication per year figure
ASM_use_per_year_adult_plot <- ggplot(data=ASM_use_per_year_adult_top_5,
                                aes(x=`year(SVCDATE)`, y=proportion_use_per_year, color=ASM)) + 
    scale_color_manual(values = c("phenytoin" = "black",
                                "carbamazepine"="darkorange",
                                "lamotrigine"="red",
                                "valproate"="darkblue",
                                "levetiracetam"="darkgreen",
                                "topiramate"="chartreuse1")) +

  geom_line(lwd=1.5) + 
  theme(legend.position="none", panel.background=element_blank(), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), axis.ticks=element_blank(),
        axis.text=element_text(size=14, face="bold"), axis.text.x=element_text(angle=45, hjust=1),
        axis.title=element_text(size=20, face="bold")) +
  scale_x_continuous(name="Year", breaks=2006:2021) +
  scale_y_continuous(name="Proportion", breaks=seq(0, 0.3, 0.05), limits = c(0, 0.3))
ASM_use_per_year_adult_plot
```








## 4. Clinical outcomes




Generic binary use
```{r}
####################Pediatric and adult######################
# Use of generic binary ASM in the period 2006-2021
generic_binary_use_total <- inflation_adjusted_ASM_epilepsy %>% 
  mutate(total_DAYSUPP = sum(DAYSUPP)) %>% 
  group_by(generic_binary) %>% 
  summarize(
    proportion_use = sum(DAYSUPP) / total_DAYSUPP,
    total_prescription_years = total_DAYSUPP / 365.24219
  ) %>% 
  distinct(generic_binary, .keep_all=TRUE) %>% 
  arrange(desc(proportion_use)) %>% 
  collect()
generic_binary_use_total




# Use of generic binary ASM per year
generic_binary_use_per_year  <- inflation_adjusted_ASM_epilepsy %>% 
  group_by(year(SVCDATE)) %>% 
  mutate(total_DAYSUPP_per_year = sum(DAYSUPP)) %>% 
  ungroup() %>% 
  group_by(year(SVCDATE), generic_binary) %>% 
  summarize(
    proportion_use_per_year = sum(DAYSUPP) / total_DAYSUPP_per_year,
    total_prescription_years_per_year = total_DAYSUPP_per_year / 365.24219
  ) %>% 
  distinct(`year(SVCDATE)`, generic_binary, .keep_all=TRUE) %>% 
  ungroup() %>% 
  group_by(`year(SVCDATE)`) %>% 
  arrange(desc(proportion_use_per_year), .by_group=TRUE) %>% 
  collect()
generic_binary_use_per_year




# Use of generic binary antiseizure medication per year figure
generic_binary_use_per_year_plot <- ggplot(data=generic_binary_use_per_year,
                                aes(x=`year(SVCDATE)`, y=proportion_use_per_year, color=generic_binary)) + 
  scale_color_manual(values = c("brand name" = "red",
                                "generic"="forestgreen",
                                "other / no data"="gray50")) +
  geom_line(lwd=1.5) + 
  theme(legend.position="none", panel.background=element_blank(), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), axis.ticks=element_blank(),
        axis.text=element_text(size=14, face="bold"), axis.text.x=element_text(angle=45, hjust=1),
        axis.title=element_text(size=20, face="bold")) +
  scale_x_continuous(name="Year", breaks=2006:2021) +
  scale_y_continuous(name="Proportion", breaks=seq(0, 1, 0.2), limits = c(0, 1))
generic_binary_use_per_year_plot






####################Pediatric######################
# Use of generic binary ASM in the period 2006-2021 in pediatric onset epilepsy
generic_binary_use_total_pediatric <- inflation_adjusted_ASM_epilepsy %>% 
  filter(pediatric_or_adult=="pediatric") %>%
  mutate(total_DAYSUPP = sum(DAYSUPP)) %>% 
  group_by(generic_binary) %>% 
  summarize(
    proportion_use = sum(DAYSUPP) / total_DAYSUPP,
    total_prescription_years = total_DAYSUPP / 365.24219
  ) %>% 
  distinct(generic_binary, .keep_all=TRUE) %>% 
  arrange(desc(proportion_use)) %>% 
  collect()
generic_binary_use_total_pediatric




# Use of generic binary ASM per year in pediatric onset epilepsy
generic_binary_use_per_year_pediatric  <- inflation_adjusted_ASM_epilepsy %>%
  filter(pediatric_or_adult=="pediatric") %>%
  group_by(year(SVCDATE)) %>% 
  mutate(total_DAYSUPP_per_year = sum(DAYSUPP)) %>% 
  ungroup() %>% 
  group_by(year(SVCDATE), generic_binary) %>% 
  summarize(
    proportion_use_per_year = sum(DAYSUPP) / total_DAYSUPP_per_year,
    total_prescription_years_per_year = total_DAYSUPP_per_year / 365.24219
  ) %>% 
  distinct(`year(SVCDATE)`, generic_binary, .keep_all=TRUE) %>% 
  ungroup() %>% 
  group_by(`year(SVCDATE)`) %>% 
  arrange(desc(proportion_use_per_year), .by_group=TRUE) %>% 
  collect()
generic_binary_use_per_year_pediatric




# Use of generic binary antiseizure medication per year in pediatric onset epilepsy figure
generic_binary_use_per_year_pediatric_plot <- ggplot(data=generic_binary_use_per_year_pediatric,
                                aes(x=`year(SVCDATE)`, y=proportion_use_per_year, color=generic_binary)) + 
  scale_color_manual(values = c("brand name" = "red",
                                "generic"="forestgreen",
                                "other / no data"="gray50")) +
  geom_line(lwd=1.5) + 
  theme(legend.position="none", panel.background=element_blank(), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), axis.ticks=element_blank(),
        axis.text=element_text(size=14, face="bold"), axis.text.x=element_text(angle=45, hjust=1),
        axis.title=element_text(size=20, face="bold")) +
  scale_x_continuous(name="Year", breaks=2006:2021) +
  scale_y_continuous(name="Proportion", breaks=seq(0, 1, 0.2), limits = c(0, 1))
generic_binary_use_per_year_pediatric_plot  
  





####################Adult######################
# Use of generic binary ASM in the period 2006-2021 in adult onset epilepsy
generic_binary_use_total_adult <- inflation_adjusted_ASM_epilepsy %>% 
  filter(pediatric_or_adult=="adult") %>%
  mutate(total_DAYSUPP = sum(DAYSUPP)) %>% 
  group_by(generic_binary) %>% 
  summarize(
    proportion_use = sum(DAYSUPP) / total_DAYSUPP,
    total_prescription_years = total_DAYSUPP / 365.24219
  ) %>% 
  distinct(generic_binary, .keep_all=TRUE) %>% 
  arrange(desc(proportion_use)) %>% 
  collect()
generic_binary_use_total_adult




# Use of generic binary ASM per year in adult onset epilepsy
generic_binary_use_per_year_adult  <- inflation_adjusted_ASM_epilepsy %>%
  filter(pediatric_or_adult=="adult") %>%
  group_by(year(SVCDATE)) %>% 
  mutate(total_DAYSUPP_per_year = sum(DAYSUPP)) %>% 
  ungroup() %>% 
  group_by(year(SVCDATE), generic_binary) %>% 
  summarize(
    proportion_use_per_year = sum(DAYSUPP) / total_DAYSUPP_per_year,
    total_prescription_years_per_year = total_DAYSUPP_per_year / 365.24219
  ) %>% 
  distinct(`year(SVCDATE)`, generic_binary, .keep_all=TRUE) %>% 
  ungroup() %>% 
  group_by(`year(SVCDATE)`) %>% 
  arrange(desc(proportion_use_per_year), .by_group=TRUE) %>% 
  collect()
generic_binary_use_per_year_adult




# Use of generic binary antiseizure medication per year in adult onset epilepsy figure
generic_binary_use_per_year_adult_plot <- ggplot(data=generic_binary_use_per_year_adult,
                                aes(x=`year(SVCDATE)`, y=proportion_use_per_year, color=generic_binary)) + 
  scale_color_manual(values = c("brand name" = "red",
                                "generic"="forestgreen",
                                "other / no data"="gray50")) +
  geom_line(lwd=1.5) + 
  theme(legend.position="none", panel.background=element_blank(), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), axis.ticks=element_blank(),
        axis.text=element_text(size=14, face="bold"), axis.text.x=element_text(angle=45, hjust=1),
        axis.title=element_text(size=20, face="bold")) +
  scale_x_continuous(name="Year", breaks=2006:2021) +
  scale_y_continuous(name="Proportion", breaks=seq(0, 1, 0.2), limits = c(0, 1))
generic_binary_use_per_year_adult_plot  
```




Mail order
```{r}
####################Pediatric and adult######################
# Mail order ASM in the period 2006-2021
mail_order_total <- inflation_adjusted_ASM_epilepsy %>% 
  mutate(total_DAYSUPP = sum(DAYSUPP)) %>% 
  group_by(RXMR) %>% 
  summarize(
    proportion_use = sum(DAYSUPP) / total_DAYSUPP
  ) %>% 
  distinct(RXMR, .keep_all=TRUE) %>% 
  arrange(desc(proportion_use)) %>% 
  collect()
mail_order_total




# Mail order ASM per year
mail_order_per_year  <- inflation_adjusted_ASM_epilepsy %>% 
  group_by(year(SVCDATE)) %>% 
  mutate(total_DAYSUPP_per_year = sum(DAYSUPP)) %>% 
  ungroup() %>% 
  group_by(year(SVCDATE), RXMR) %>% 
  summarize(
    proportion_use_per_year = sum(DAYSUPP) / total_DAYSUPP_per_year
  ) %>% 
  distinct(`year(SVCDATE)`, RXMR, .keep_all=TRUE) %>% 
  ungroup() %>% 
  group_by(`year(SVCDATE)`) %>% 
  arrange(desc(proportion_use_per_year), .by_group=TRUE) %>% 
  collect()
mail_order_per_year




mail_order_per_year_categories  <- inflation_adjusted_ASM_epilepsy %>% 
  group_by(year(SVCDATE)) %>% 
  mutate(total_DAYSUPP_per_year = sum(DAYSUPP)) %>% 
  ungroup() %>% 
  group_by(year(SVCDATE), RXMR) %>% 
  summarize(
    proportion_use_per_year = sum(DAYSUPP) / total_DAYSUPP_per_year
  ) %>% 
  distinct(`year(SVCDATE)`, RXMR, .keep_all=TRUE) %>% 
  ungroup() %>% 
  group_by(`year(SVCDATE)`) %>% 
  arrange(desc(proportion_use_per_year), .by_group=TRUE) %>% 
  collect() %>% 
  filter(RXMR==1 | RXMR==2)
mail_order_per_year_categories




# Mail order antiseizure medication per year figure
mail_order_per_year_plot <- ggplot(data=mail_order_per_year_categories,
                                aes(x=`year(SVCDATE)`, y=proportion_use_per_year, color=RXMR)) + 
  scale_color_manual(values = c("1" = "forestgreen",
                                "2"="red")) +
  geom_line(lwd=1.5) + 
  theme(legend.position="none", panel.background=element_blank(), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), axis.ticks=element_blank(),
        axis.text=element_text(size=14, face="bold"), axis.text.x=element_text(angle=45, hjust=1),
        axis.title=element_text(size=20, face="bold")) +
  scale_x_continuous(name="Year", breaks=2006:2021) +
  scale_y_continuous(name="Proportion", breaks=seq(0, 1, 0.2), limits = c(0, 1))
mail_order_per_year_plot






####################Pediatric######################
# Mail order ASM in the period 2006-2021 in pediatric onset epilepsy
mail_order_total_pediatric <- inflation_adjusted_ASM_epilepsy %>% 
  filter(pediatric_or_adult=="pediatric") %>%
  mutate(total_DAYSUPP = sum(DAYSUPP)) %>% 
  group_by(RXMR) %>% 
  summarize(
    proportion_use = sum(DAYSUPP) / total_DAYSUPP
  ) %>% 
  distinct(RXMR, .keep_all=TRUE) %>% 
  arrange(desc(proportion_use)) %>% 
  collect()
mail_order_total_pediatric




# Mail order ASM per year in pediatric onset epilepsy
mail_order_per_year_pediatric  <- inflation_adjusted_ASM_epilepsy %>% 
  filter(pediatric_or_adult=="pediatric") %>%
  group_by(year(SVCDATE)) %>% 
  mutate(total_DAYSUPP_per_year = sum(DAYSUPP)) %>% 
  ungroup() %>% 
  group_by(year(SVCDATE), RXMR) %>% 
  summarize(
    proportion_use_per_year = sum(DAYSUPP) / total_DAYSUPP_per_year
  ) %>% 
  distinct(`year(SVCDATE)`, RXMR, .keep_all=TRUE) %>% 
  ungroup() %>% 
  group_by(`year(SVCDATE)`) %>% 
  arrange(desc(proportion_use_per_year), .by_group=TRUE) %>% 
  collect()
mail_order_per_year_pediatric




mail_order_per_year_pediatric_categories  <- inflation_adjusted_ASM_epilepsy %>% 
  filter(pediatric_or_adult=="pediatric") %>%
  group_by(year(SVCDATE)) %>% 
  mutate(total_DAYSUPP_per_year = sum(DAYSUPP)) %>% 
  ungroup() %>% 
  group_by(year(SVCDATE), RXMR) %>% 
  summarize(
    proportion_use_per_year = sum(DAYSUPP) / total_DAYSUPP_per_year
  ) %>% 
  distinct(`year(SVCDATE)`, RXMR, .keep_all=TRUE) %>% 
  ungroup() %>% 
  group_by(`year(SVCDATE)`) %>% 
  arrange(desc(proportion_use_per_year), .by_group=TRUE) %>% 
  collect() %>% 
  filter(RXMR==1 | RXMR==2)
mail_order_per_year_pediatric_categories




# Mail order antiseizure medication per year in pediatric onset epilepsy figure
mail_order_per_year_pediatric_plot <- ggplot(data=mail_order_per_year_pediatric_categories,
                                aes(x=`year(SVCDATE)`, y=proportion_use_per_year, color=RXMR)) + 
  scale_color_manual(values = c("1" = "forestgreen",
                                "2"="red")) +
  geom_line(lwd=1.5) + 
  theme(legend.position="none", panel.background=element_blank(), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), axis.ticks=element_blank(),
        axis.text=element_text(size=14, face="bold"), axis.text.x=element_text(angle=45, hjust=1),
        axis.title=element_text(size=20, face="bold")) +
  scale_x_continuous(name="Year", breaks=2006:2021) +
  scale_y_continuous(name="Proportion", breaks=seq(0, 1, 0.2), limits = c(0, 1))
mail_order_per_year_pediatric_plot






####################Adult######################
# Mail order ASM in the period 2006-2021 in adult onset epilepsy
mail_order_total_adult <- inflation_adjusted_ASM_epilepsy %>% 
  filter(pediatric_or_adult=="adult") %>%
  mutate(total_DAYSUPP = sum(DAYSUPP)) %>% 
  group_by(RXMR) %>% 
  summarize(
    proportion_use = sum(DAYSUPP) / total_DAYSUPP
  ) %>% 
  distinct(RXMR, .keep_all=TRUE) %>% 
  arrange(desc(proportion_use)) %>% 
  collect()
mail_order_total_adult




# Mail order ASM per year in adult onset epilepsy
mail_order_per_year_adult  <- inflation_adjusted_ASM_epilepsy %>% 
  filter(pediatric_or_adult=="adult") %>%
  group_by(year(SVCDATE)) %>% 
  mutate(total_DAYSUPP_per_year = sum(DAYSUPP)) %>% 
  ungroup() %>% 
  group_by(year(SVCDATE), RXMR) %>% 
  summarize(
    proportion_use_per_year = sum(DAYSUPP) / total_DAYSUPP_per_year
  ) %>% 
  distinct(`year(SVCDATE)`, RXMR, .keep_all=TRUE) %>% 
  ungroup() %>% 
  group_by(`year(SVCDATE)`) %>% 
  arrange(desc(proportion_use_per_year), .by_group=TRUE) %>% 
  collect()
mail_order_per_year_adult




mail_order_per_year_adult_categories  <- inflation_adjusted_ASM_epilepsy %>% 
  filter(pediatric_or_adult=="adult") %>%
  group_by(year(SVCDATE)) %>% 
  mutate(total_DAYSUPP_per_year = sum(DAYSUPP)) %>% 
  ungroup() %>% 
  group_by(year(SVCDATE), RXMR) %>% 
  summarize(
    proportion_use_per_year = sum(DAYSUPP) / total_DAYSUPP_per_year
  ) %>% 
  distinct(`year(SVCDATE)`, RXMR, .keep_all=TRUE) %>% 
  ungroup() %>% 
  group_by(`year(SVCDATE)`) %>% 
  arrange(desc(proportion_use_per_year), .by_group=TRUE) %>% 
  collect() %>% 
  filter(RXMR==1 | RXMR==2)
mail_order_per_year_adult_categories




# Mail order antiseizure medication per year in adult onset epilepsy figure
mail_order_per_year_adult_plot <- ggplot(data=mail_order_per_year_adult_categories,
                                aes(x=`year(SVCDATE)`, y=proportion_use_per_year, color=RXMR)) + 
  scale_color_manual(values = c("1" = "forestgreen",
                                "2"="red")) +
  geom_line(lwd=1.5) + 
  theme(legend.position="none", panel.background=element_blank(), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), axis.ticks=element_blank(),
        axis.text=element_text(size=14, face="bold"), axis.text.x=element_text(angle=45, hjust=1),
        axis.title=element_text(size=20, face="bold")) +
  scale_x_continuous(name="Year", breaks=2006:2021) +
  scale_y_continuous(name="Proportion", breaks=seq(0, 1, 0.2), limits = c(0, 1))
mail_order_per_year_adult_plot
```




Cost of antiseizure medication per patient-year
```{r}
####################Pediatric and adult######################
# Total annual cost of antiseizure medication
ASM_cost_per_person_year <- inflation_adjusted_ASM_epilepsy %>% 
  group_by(ENROLID) %>%
  mutate(
  total_AWP = sum(AWP), 
  total_patient_cost = sum(sum(COINS), sum(COPAY), sum(DEDUCT), sum(DISPFEE))
  ) %>% 
  distinct(ENROLID, .keep_all=TRUE) %>% 
  mutate(
    AWP_per_person_year = total_AWP / person_years,
    patient_cost_per_person_year = total_patient_cost / person_years
  ) %>% 
  ungroup() %>% 
  summarize(
    total_person_years = sum(person_years),
    median_AWPPPY = median(AWP_per_person_year, na.rm=TRUE),
    p25_AWPPPY = quantile(AWP_per_person_year, 0.25, na.rm=TRUE),
    p75_AWPPPY = quantile(AWP_per_person_year, 0.75, na.rm=TRUE),
    median_PCPPY = median(patient_cost_per_person_year, na.rm=TRUE),
    p25_PCPPY = quantile(patient_cost_per_person_year, 0.25, na.rm=TRUE),
    p75_PCPPY = quantile(patient_cost_per_person_year, 0.75, na.rm=TRUE)   
  ) %>% 
  collect()
ASM_cost_per_person_year


# Total annual cost of antiseizure medication per year
ASM_cost_per_person_year_per_year <- inflation_adjusted_ASM_epilepsy %>% 
  group_by(ENROLID, year(SVCDATE)) %>%
  mutate(
  total_AWP = sum(AWP), 
  total_patient_cost = sum(sum(COINS), sum(COPAY), sum(DEDUCT), sum(DISPFEE))
  ) %>% 
  distinct(ENROLID, `year(SVCDATE)`, .keep_all=TRUE) %>% 
  mutate(
    AWP_per_person_year = total_AWP / person_years_per_year,
    patient_cost_per_person_year = total_patient_cost / person_years_per_year
  ) %>% 
  ungroup() %>% 
  group_by(`year(SVCDATE)`) %>% 
  summarize(
    total_person_years = sum(person_years_per_year),
    median_AWPPPY = median(AWP_per_person_year, na.rm=TRUE),
    p25_AWPPPY = quantile(AWP_per_person_year, 0.25, na.rm=TRUE),
    p75_AWPPPY = quantile(AWP_per_person_year, 0.75, na.rm=TRUE),
    median_PCPPY = median(patient_cost_per_person_year, na.rm=TRUE),
    p25_PCPPY = quantile(patient_cost_per_person_year, 0.25, na.rm=TRUE),
    p75_PCPPY = quantile(patient_cost_per_person_year, 0.75, na.rm=TRUE)   
  ) %>% 
  collect()
ASM_cost_per_person_year_per_year


# Figure total cost per person year per year
ASM_cost_per_person_year_per_year_plot <- ggplot(data=ASM_cost_per_person_year_per_year) + 
  geom_line(aes(x=`year(SVCDATE)`, y=median_AWPPPY), color="purple2", lwd=1.5) + 
  geom_line(aes(x=`year(SVCDATE)`, y=p25_AWPPPY), color="darkblue", lwd=1.5) + 
  geom_line(aes(x=`year(SVCDATE)`, y=p75_AWPPPY), color="darkblue", lwd=1.5) + 
  theme(legend.position="none", panel.background=element_blank(), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), axis.ticks=element_blank(),
        axis.text=element_text(size=14, face="bold"), axis.text.x=element_text(angle=45, hjust=1),
        axis.title=element_text(size=20, face="bold")) +
  scale_x_continuous(name="Year", breaks=2006:2021) +
  scale_y_continuous(name="Median (p25-p75) cost per person-year", breaks=seq(0, 16000, 2000), limits = c(0, 16001))
ASM_cost_per_person_year_per_year_plot






####################Pediatric######################
# Total annual cost of antiseizure medication in pediatric onset epilepsy
ASM_cost_per_person_year_pediatric <- inflation_adjusted_ASM_epilepsy %>% 
  filter(pediatric_or_adult=="pediatric") %>%
  group_by(ENROLID) %>%
  mutate(
  total_AWP = sum(AWP), 
  total_patient_cost = sum(sum(COINS), sum(COPAY), sum(DEDUCT), sum(DISPFEE))
  ) %>% 
  distinct(ENROLID, .keep_all=TRUE) %>% 
  mutate(
    AWP_per_person_year = total_AWP / person_years,
    patient_cost_per_person_year = total_patient_cost / person_years
  ) %>% 
  ungroup() %>% 
  summarize(
    total_person_years = sum(person_years),
    median_AWPPPY = median(AWP_per_person_year, na.rm=TRUE),
    p25_AWPPPY = quantile(AWP_per_person_year, 0.25, na.rm=TRUE),
    p75_AWPPPY = quantile(AWP_per_person_year, 0.75, na.rm=TRUE),
    median_PCPPY = median(patient_cost_per_person_year, na.rm=TRUE),
    p25_PCPPY = quantile(patient_cost_per_person_year, 0.25, na.rm=TRUE),
    p75_PCPPY = quantile(patient_cost_per_person_year, 0.75, na.rm=TRUE)   
  ) %>% 
  collect()
ASM_cost_per_person_year_pediatric


# Total annual cost of antiseizure medication per year in pediatric onset epilepsy
ASM_cost_per_person_year_per_year_pediatric <- inflation_adjusted_ASM_epilepsy %>% 
  filter(pediatric_or_adult=="pediatric") %>%
  group_by(ENROLID, year(SVCDATE)) %>%
  mutate(
  total_AWP = sum(AWP), 
  total_patient_cost = sum(sum(COINS), sum(COPAY), sum(DEDUCT), sum(DISPFEE))
  ) %>% 
  distinct(ENROLID, `year(SVCDATE)`, .keep_all=TRUE) %>% 
  mutate(
    AWP_per_person_year = total_AWP / person_years_per_year,
    patient_cost_per_person_year = total_patient_cost / person_years_per_year
  ) %>% 
  ungroup() %>% 
  group_by(`year(SVCDATE)`) %>% 
  summarize(
    total_person_years = sum(person_years_per_year),
    median_AWPPPY = median(AWP_per_person_year, na.rm=TRUE),
    p25_AWPPPY = quantile(AWP_per_person_year, 0.25, na.rm=TRUE),
    p75_AWPPPY = quantile(AWP_per_person_year, 0.75, na.rm=TRUE),
    median_PCPPY = median(patient_cost_per_person_year, na.rm=TRUE),
    p25_PCPPY = quantile(patient_cost_per_person_year, 0.25, na.rm=TRUE),
    p75_PCPPY = quantile(patient_cost_per_person_year, 0.75, na.rm=TRUE)   
  ) %>% 
  collect()
ASM_cost_per_person_year_per_year_pediatric


# Figure total cost per person year per year in pediatric onset epilepsy
ASM_cost_per_person_year_per_year_pediatric_plot <- ggplot(data=ASM_cost_per_person_year_per_year_pediatric) + 
  geom_line(aes(x=`year(SVCDATE)`, y=median_AWPPPY), color="purple2", lwd=1.5) + 
  geom_line(aes(x=`year(SVCDATE)`, y=p25_AWPPPY), color="darkblue", lwd=1.5) + 
  geom_line(aes(x=`year(SVCDATE)`, y=p75_AWPPPY), color="darkblue", lwd=1.5) + 
  theme(legend.position="none", panel.background=element_blank(), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), axis.ticks=element_blank(),
        axis.text=element_text(size=14, face="bold"), axis.text.x=element_text(angle=45, hjust=1),
        axis.title=element_text(size=20, face="bold")) +
  scale_x_continuous(name="Year", breaks=2006:2021) +
  scale_y_continuous(name="Median (p25-p75) cost per person-year", breaks=seq(0, 16000, 2000), limits = c(0, 16001))
ASM_cost_per_person_year_per_year_pediatric_plot






####################Adult######################
# Total annual cost of antiseizure medication in adult onset epilepsy
ASM_cost_per_person_year_adult <- inflation_adjusted_ASM_epilepsy %>% 
  filter(pediatric_or_adult=="adult") %>%
  group_by(ENROLID) %>%
  mutate(
  total_AWP = sum(AWP), 
  total_patient_cost = sum(sum(COINS), sum(COPAY), sum(DEDUCT), sum(DISPFEE))
  ) %>% 
  distinct(ENROLID, .keep_all=TRUE) %>% 
  mutate(
    AWP_per_person_year = total_AWP / person_years,
    patient_cost_per_person_year = total_patient_cost / person_years
  ) %>% 
  ungroup() %>% 
  summarize(
    total_person_years = sum(person_years),
    median_AWPPPY = median(AWP_per_person_year, na.rm=TRUE),
    p25_AWPPPY = quantile(AWP_per_person_year, 0.25, na.rm=TRUE),
    p75_AWPPPY = quantile(AWP_per_person_year, 0.75, na.rm=TRUE),
    median_PCPPY = median(patient_cost_per_person_year, na.rm=TRUE),
    p25_PCPPY = quantile(patient_cost_per_person_year, 0.25, na.rm=TRUE),
    p75_PCPPY = quantile(patient_cost_per_person_year, 0.75, na.rm=TRUE)   
  ) %>% 
  collect()
ASM_cost_per_person_year_adult


# Total annual cost of antiseizure medication per year in adult onset epilepsy
ASM_cost_per_person_year_per_year_adult <- inflation_adjusted_ASM_epilepsy %>% 
  filter(pediatric_or_adult=="adult") %>%
  group_by(ENROLID, year(SVCDATE)) %>%
  mutate(
  total_AWP = sum(AWP), 
  total_patient_cost = sum(sum(COINS), sum(COPAY), sum(DEDUCT), sum(DISPFEE))
  ) %>% 
  distinct(ENROLID, `year(SVCDATE)`, .keep_all=TRUE) %>% 
  mutate(
    AWP_per_person_year = total_AWP / person_years_per_year,
    patient_cost_per_person_year = total_patient_cost / person_years_per_year
  ) %>% 
  ungroup() %>% 
  group_by(`year(SVCDATE)`) %>% 
  summarize(
    total_person_years = sum(person_years_per_year),
    median_AWPPPY = median(AWP_per_person_year, na.rm=TRUE),
    p25_AWPPPY = quantile(AWP_per_person_year, 0.25, na.rm=TRUE),
    p75_AWPPPY = quantile(AWP_per_person_year, 0.75, na.rm=TRUE),
    median_PCPPY = median(patient_cost_per_person_year, na.rm=TRUE),
    p25_PCPPY = quantile(patient_cost_per_person_year, 0.25, na.rm=TRUE),
    p75_PCPPY = quantile(patient_cost_per_person_year, 0.75, na.rm=TRUE)   
  ) %>% 
  collect()
ASM_cost_per_person_year_per_year_adult


# Figure total cost per person year per year in adult onset epilepsy
ASM_cost_per_person_year_per_year_adult_plot <- ggplot(data=ASM_cost_per_person_year_per_year_adult) + 
  geom_line(aes(x=`year(SVCDATE)`, y=median_AWPPPY), color="purple2", lwd=1.5) + 
  geom_line(aes(x=`year(SVCDATE)`, y=p25_AWPPPY), color="darkblue", lwd=1.5) + 
  geom_line(aes(x=`year(SVCDATE)`, y=p75_AWPPPY), color="darkblue", lwd=1.5) + 
  theme(legend.position="none", panel.background=element_blank(), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), axis.ticks=element_blank(),
        axis.text=element_text(size=14, face="bold"), axis.text.x=element_text(angle=45, hjust=1),
        axis.title=element_text(size=20, face="bold")) +
  scale_x_continuous(name="Year", breaks=2006:2021) +
  scale_y_continuous(name="Median (p25-p75) cost per person-year", breaks=seq(0, 16000, 2000), limits = c(0, 16001))
ASM_cost_per_person_year_per_year_adult_plot
```




Cost of antiseizure medication per prescription year
```{r}
####################Pediatric and adult######################
# Total annual cost of antiseizure medication
ASM_cost_total <- inflation_adjusted_ASM_epilepsy %>% 
  group_by(ENROLID) %>%
  mutate(
  sum_AWP = sum(AWP), 
  sum_DAYSUPP = sum(DAYSUPP), 
  AWP_per_DAYSUPP = sum_AWP / sum_DAYSUPP,
  sum_patient_cost = sum(sum(COINS), sum(COPAY), sum(DEDUCT), sum(DISPFEE)),
  patient_cost_per_DAYSUPP = sum_patient_cost / sum_DAYSUPP
  ) %>% 
  distinct(ENROLID, .keep_all=TRUE) %>% 
  ungroup() %>% 
  summarize(
    median_AWP = median(sum_AWP, na.rm=TRUE),
    p25_AWP = quantile(sum_AWP, 0.25, na.rm=TRUE),
    p75_AWP = quantile(sum_AWP, 0.75, na.rm=TRUE),    
    median_DAYSUPP = median(sum_DAYSUPP, na.rm=TRUE),
    p25_DAYSUPP = quantile(sum_DAYSUPP, 0.25, na.rm=TRUE),
    p75_DAYSUPP = quantile(sum_DAYSUPP, 0.75, na.rm=TRUE),   
    median_AWP_per_prescription_year = median(AWP_per_DAYSUPP, na.rm=TRUE) * 365.24219,
    p25_AWP_per_prescription_year = quantile(AWP_per_DAYSUPP, 0.25, na.rm=TRUE) * 365.24219,
    p75_AWP_per_prescription_year = quantile(AWP_per_DAYSUPP, 0.75, na.rm=TRUE) * 365.24219, 
    median_patient_cost = median(sum_patient_cost, na.rm=TRUE),
    p25_patient_cost = quantile(sum_patient_cost, 0.25, na.rm=TRUE),
    p75_patient_cost = quantile(sum_patient_cost, 0.75, na.rm=TRUE), 
    median_patient_cost_per_prescription_year = median(patient_cost_per_DAYSUPP, na.rm=TRUE) * 365.24219,
    p25_patient_cost_per_prescription_year = quantile(patient_cost_per_DAYSUPP, 0.25, na.rm=TRUE) * 365.24219,
    p75_patient_cost_per_prescription_year = quantile(patient_cost_per_DAYSUPP, 0.75, na.rm=TRUE) * 365.24219
  ) %>% 
  collect()
ASM_cost_total




# Total annual cost of antiseizure medication per year
ASM_cost_total_per_year <- inflation_adjusted_ASM_epilepsy %>% 
  group_by(year(SVCDATE), ENROLID) %>% 
  mutate(
  sum_AWP = sum(AWP), 
  sum_DAYSUPP = sum(DAYSUPP), 
  AWP_per_DAYSUPP = sum_AWP / sum_DAYSUPP,
  sum_patient_cost = sum(sum(COINS), sum(COPAY), sum(DEDUCT), sum(DISPFEE)),
  patient_cost_per_DAYSUPP = sum_patient_cost / sum_DAYSUPP    
  ) %>% 
  distinct(`year(SVCDATE)`, ENROLID, .keep_all=TRUE) %>%  
  ungroup() %>% 
  group_by(`year(SVCDATE)`) %>% 
  summarize(
    median_AWP = median(sum_AWP, na.rm=TRUE),
    p25_AWP = quantile(sum_AWP, 0.25, na.rm=TRUE),
    p75_AWP = quantile(sum_AWP, 0.75, na.rm=TRUE),    
    median_DAYSUPP = median(sum_DAYSUPP, na.rm=TRUE),
    p25_DAYSUPP = quantile(sum_DAYSUPP, 0.25, na.rm=TRUE),
    p75_DAYSUPP = quantile(sum_DAYSUPP, 0.75, na.rm=TRUE),   
    median_AWP_per_prescription_year = median(AWP_per_DAYSUPP, na.rm=TRUE) * 365.24219,
    p25_AWP_per_prescription_year = quantile(AWP_per_DAYSUPP, 0.25, na.rm=TRUE) * 365.24219,
    p75_AWP_per_prescription_year = quantile(AWP_per_DAYSUPP, 0.75, na.rm=TRUE) * 365.24219, 
    median_patient_cost = median(sum_patient_cost, na.rm=TRUE),
    p25_patient_cost = quantile(sum_patient_cost, 0.25, na.rm=TRUE),
    p75_patient_cost = quantile(sum_patient_cost, 0.75, na.rm=TRUE), 
    median_patient_cost_per_prescription_year = median(patient_cost_per_DAYSUPP, na.rm=TRUE) * 365.24219,
    p25_patient_cost_per_prescription_year = quantile(patient_cost_per_DAYSUPP, 0.25, na.rm=TRUE) * 365.24219,
    p75_patient_cost_per_prescription_year = quantile(patient_cost_per_DAYSUPP, 0.75, na.rm=TRUE) * 365.24219
  ) %>% 
  collect()
ASM_cost_total_per_year




ASM_cost_AWP_per_year_plot <- ggplot(data=ASM_cost_total_per_year) + 
  geom_line(aes(x=`year(SVCDATE)`, y=median_AWP_per_prescription_year), color="purple2", lwd=1.5) + 
  geom_line(aes(x=`year(SVCDATE)`, y=p25_AWP_per_prescription_year), color="darkblue", lwd=1.5) + 
  geom_line(aes(x=`year(SVCDATE)`, y=p75_AWP_per_prescription_year), color="darkblue", lwd=1.5) + 
  theme(legend.position="none", panel.background=element_blank(), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), axis.ticks=element_blank(),
        axis.text=element_text(size=14, face="bold"), axis.text.x=element_text(angle=45, hjust=1),
        axis.title=element_text(size=20, face="bold")) +
  scale_x_continuous(name="Year", breaks=2006:2021) +
  scale_y_continuous(name="Median (p25-p75) cost ($)", breaks=seq(0, 10000, 1000), limits = c(0, 10001))
ASM_cost_AWP_per_year_plot




ASM_cost_patient_cost_per_year_plot <- ggplot(data=ASM_cost_total_per_year) + 
  geom_line(aes(x=`year(SVCDATE)`, y=median_patient_cost_per_prescription_year), color="purple2", lwd=1.5) + 
  geom_line(aes(x=`year(SVCDATE)`, y=p25_patient_cost_per_prescription_year), color="darkblue", lwd=1.5) + 
  geom_line(aes(x=`year(SVCDATE)`, y=p75_patient_cost_per_prescription_year), color="darkblue", lwd=1.5) + 
  theme(legend.position="none", panel.background=element_blank(), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), axis.ticks=element_blank(),
        axis.text=element_text(size=14, face="bold"), axis.text.x=element_text(angle=45, hjust=1),
        axis.title=element_text(size=20, face="bold")) +
  scale_x_continuous(name="Year", breaks=2006:2021) +
  scale_y_continuous(name="Median (p25-p75) cost ($)", breaks=seq(0, 600, 100), limits = c(0, 601))
ASM_cost_patient_cost_per_year_plot






####################Pediatric######################
# Total annual cost of antiseizure medication in pediatric onset epilepsy
ASM_cost_total_pediatric <- inflation_adjusted_ASM_epilepsy %>% 
  filter(pediatric_or_adult=="pediatric") %>%
  group_by(ENROLID) %>%
  mutate(
  sum_AWP = sum(AWP), 
  sum_DAYSUPP = sum(DAYSUPP), 
  AWP_per_DAYSUPP = sum_AWP / sum_DAYSUPP,
  sum_patient_cost = sum(sum(COINS), sum(COPAY), sum(DEDUCT), sum(DISPFEE)),
  patient_cost_per_DAYSUPP = sum_patient_cost / sum_DAYSUPP
  ) %>% 
  distinct(ENROLID, .keep_all=TRUE) %>% 
  ungroup() %>% 
  summarize(
    median_AWP = median(sum_AWP, na.rm=TRUE),
    p25_AWP = quantile(sum_AWP, 0.25, na.rm=TRUE),
    p75_AWP = quantile(sum_AWP, 0.75, na.rm=TRUE),    
    median_DAYSUPP = median(sum_DAYSUPP, na.rm=TRUE),
    p25_DAYSUPP = quantile(sum_DAYSUPP, 0.25, na.rm=TRUE),
    p75_DAYSUPP = quantile(sum_DAYSUPP, 0.75, na.rm=TRUE),   
    median_AWP_per_prescription_year = median(AWP_per_DAYSUPP, na.rm=TRUE) * 365.24219,
    p25_AWP_per_prescription_year = quantile(AWP_per_DAYSUPP, 0.25, na.rm=TRUE) * 365.24219,
    p75_AWP_per_prescription_year = quantile(AWP_per_DAYSUPP, 0.75, na.rm=TRUE) * 365.24219, 
    median_patient_cost = median(sum_patient_cost, na.rm=TRUE),
    p25_patient_cost = quantile(sum_patient_cost, 0.25, na.rm=TRUE),
    p75_patient_cost = quantile(sum_patient_cost, 0.75, na.rm=TRUE), 
    median_patient_cost_per_prescription_year = median(patient_cost_per_DAYSUPP, na.rm=TRUE) * 365.24219,
    p25_patient_cost_per_prescription_year = quantile(patient_cost_per_DAYSUPP, 0.25, na.rm=TRUE) * 365.24219,
    p75_patient_cost_per_prescription_year = quantile(patient_cost_per_DAYSUPP, 0.75, na.rm=TRUE) * 365.24219
  ) %>% 
  collect()
ASM_cost_total_pediatric




# Total annual cost of antiseizure medication per year in pediatric onset epilepsy
ASM_cost_total_per_year_pediatric <- inflation_adjusted_ASM_epilepsy %>% 
  filter(pediatric_or_adult=="pediatric") %>%
  group_by(year(SVCDATE), ENROLID) %>% 
  mutate(
  sum_AWP = sum(AWP), 
  sum_DAYSUPP = sum(DAYSUPP), 
  AWP_per_DAYSUPP = sum_AWP / sum_DAYSUPP,
  sum_patient_cost = sum(sum(COINS), sum(COPAY), sum(DEDUCT), sum(DISPFEE)),
  patient_cost_per_DAYSUPP = sum_patient_cost / sum_DAYSUPP    
  ) %>% 
  distinct(`year(SVCDATE)`, ENROLID, .keep_all=TRUE) %>%  
  ungroup() %>% 
  group_by(`year(SVCDATE)`) %>% 
  summarize(
    median_AWP = median(sum_AWP, na.rm=TRUE),
    p25_AWP = quantile(sum_AWP, 0.25, na.rm=TRUE),
    p75_AWP = quantile(sum_AWP, 0.75, na.rm=TRUE),    
    median_DAYSUPP = median(sum_DAYSUPP, na.rm=TRUE),
    p25_DAYSUPP = quantile(sum_DAYSUPP, 0.25, na.rm=TRUE),
    p75_DAYSUPP = quantile(sum_DAYSUPP, 0.75, na.rm=TRUE),   
    median_AWP_per_prescription_year = median(AWP_per_DAYSUPP, na.rm=TRUE) * 365.24219,
    p25_AWP_per_prescription_year = quantile(AWP_per_DAYSUPP, 0.25, na.rm=TRUE) * 365.24219,
    p75_AWP_per_prescription_year = quantile(AWP_per_DAYSUPP, 0.75, na.rm=TRUE) * 365.24219, 
    median_patient_cost = median(sum_patient_cost, na.rm=TRUE),
    p25_patient_cost = quantile(sum_patient_cost, 0.25, na.rm=TRUE),
    p75_patient_cost = quantile(sum_patient_cost, 0.75, na.rm=TRUE), 
    median_patient_cost_per_prescription_year = median(patient_cost_per_DAYSUPP, na.rm=TRUE) * 365.24219,
    p25_patient_cost_per_prescription_year = quantile(patient_cost_per_DAYSUPP, 0.25, na.rm=TRUE) * 365.24219,
    p75_patient_cost_per_prescription_year = quantile(patient_cost_per_DAYSUPP, 0.75, na.rm=TRUE) * 365.24219
  ) %>% 
  collect()
ASM_cost_total_per_year_pediatric 
  



ASM_cost_AWP_per_year_pediatric_plot <- ggplot(data=ASM_cost_total_per_year_pediatric) + 
  geom_line(aes(x=`year(SVCDATE)`, y=median_AWP_per_prescription_year), color="purple2", lwd=1.5) + 
  geom_line(aes(x=`year(SVCDATE)`, y=p25_AWP_per_prescription_year), color="darkblue", lwd=1.5) + 
  geom_line(aes(x=`year(SVCDATE)`, y=p75_AWP_per_prescription_year), color="darkblue", lwd=1.5) + 
  theme(legend.position="none", panel.background=element_blank(), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), axis.ticks=element_blank(),
        axis.text=element_text(size=14, face="bold"), axis.text.x=element_text(angle=45, hjust=1),
        axis.title=element_text(size=20, face="bold")) +
  scale_x_continuous(name="Year", breaks=2006:2021) +
  scale_y_continuous(name="Median (p25-p75) cost ($)", breaks=seq(0, 10000, 1000), limits = c(0, 10001))
ASM_cost_AWP_per_year_pediatric_plot




ASM_cost_patient_cost_per_year_pediatric_plot <- ggplot(data=ASM_cost_total_per_year_pediatric) + 
  geom_line(aes(x=`year(SVCDATE)`, y=median_patient_cost_per_prescription_year), color="purple2", lwd=1.5) + 
  geom_line(aes(x=`year(SVCDATE)`, y=p25_patient_cost_per_prescription_year), color="darkblue", lwd=1.5) + 
  geom_line(aes(x=`year(SVCDATE)`, y=p75_patient_cost_per_prescription_year), color="darkblue", lwd=1.5) + 
  theme(legend.position="none", panel.background=element_blank(), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), axis.ticks=element_blank(),
        axis.text=element_text(size=14, face="bold"), axis.text.x=element_text(angle=45, hjust=1),
        axis.title=element_text(size=20, face="bold")) +
  scale_x_continuous(name="Year", breaks=2006:2021) +
  scale_y_continuous(name="Median (p25-p75) cost ($)", breaks=seq(0, 600, 100), limits = c(0, 601))
ASM_cost_patient_cost_per_year_pediatric_plot






####################Adult######################
# Total annual cost of antiseizure medication in adult onset epilepsy
ASM_cost_total_adult <- inflation_adjusted_ASM_epilepsy %>% 
  filter(pediatric_or_adult=="adult") %>%
  group_by(ENROLID) %>%
  mutate(
  sum_AWP = sum(AWP), 
  sum_DAYSUPP = sum(DAYSUPP), 
  AWP_per_DAYSUPP = sum_AWP / sum_DAYSUPP,
  sum_patient_cost = sum(sum(COINS), sum(COPAY), sum(DEDUCT), sum(DISPFEE)),
  patient_cost_per_DAYSUPP = sum_patient_cost / sum_DAYSUPP
  ) %>% 
  distinct(ENROLID, .keep_all=TRUE) %>% 
  ungroup() %>% 
  summarize(
    median_AWP = median(sum_AWP, na.rm=TRUE),
    p25_AWP = quantile(sum_AWP, 0.25, na.rm=TRUE),
    p75_AWP = quantile(sum_AWP, 0.75, na.rm=TRUE),    
    median_DAYSUPP = median(sum_DAYSUPP, na.rm=TRUE),
    p25_DAYSUPP = quantile(sum_DAYSUPP, 0.25, na.rm=TRUE),
    p75_DAYSUPP = quantile(sum_DAYSUPP, 0.75, na.rm=TRUE),   
    median_AWP_per_prescription_year = median(AWP_per_DAYSUPP, na.rm=TRUE) * 365.24219,
    p25_AWP_per_prescription_year = quantile(AWP_per_DAYSUPP, 0.25, na.rm=TRUE) * 365.24219,
    p75_AWP_per_prescription_year = quantile(AWP_per_DAYSUPP, 0.75, na.rm=TRUE) * 365.24219, 
    median_patient_cost = median(sum_patient_cost, na.rm=TRUE),
    p25_patient_cost = quantile(sum_patient_cost, 0.25, na.rm=TRUE),
    p75_patient_cost = quantile(sum_patient_cost, 0.75, na.rm=TRUE), 
    median_patient_cost_per_prescription_year = median(patient_cost_per_DAYSUPP, na.rm=TRUE) * 365.24219,
    p25_patient_cost_per_prescription_year = quantile(patient_cost_per_DAYSUPP, 0.25, na.rm=TRUE) * 365.24219,
    p75_patient_cost_per_prescription_year = quantile(patient_cost_per_DAYSUPP, 0.75, na.rm=TRUE) * 365.24219
  ) %>% 
  collect()
ASM_cost_total_adult
  
  


# Total annual cost of antiseizure medication per year in adult onset epilepsy
ASM_cost_total_per_year_adult <- inflation_adjusted_ASM_epilepsy %>% 
  filter(pediatric_or_adult=="adult") %>%
  group_by(year(SVCDATE), ENROLID) %>% 
  mutate(
  sum_AWP = sum(AWP), 
  sum_DAYSUPP = sum(DAYSUPP), 
  AWP_per_DAYSUPP = sum_AWP / sum_DAYSUPP,
  sum_patient_cost = sum(sum(COINS), sum(COPAY), sum(DEDUCT), sum(DISPFEE)),
  patient_cost_per_DAYSUPP = sum_patient_cost / sum_DAYSUPP    
  ) %>% 
  distinct(`year(SVCDATE)`, ENROLID, .keep_all=TRUE) %>%  
  ungroup() %>% 
  group_by(`year(SVCDATE)`) %>% 
  summarize(
    median_AWP = median(sum_AWP, na.rm=TRUE),
    p25_AWP = quantile(sum_AWP, 0.25, na.rm=TRUE),
    p75_AWP = quantile(sum_AWP, 0.75, na.rm=TRUE),    
    median_DAYSUPP = median(sum_DAYSUPP, na.rm=TRUE),
    p25_DAYSUPP = quantile(sum_DAYSUPP, 0.25, na.rm=TRUE),
    p75_DAYSUPP = quantile(sum_DAYSUPP, 0.75, na.rm=TRUE),   
    median_AWP_per_prescription_year = median(AWP_per_DAYSUPP, na.rm=TRUE) * 365.24219,
    p25_AWP_per_prescription_year = quantile(AWP_per_DAYSUPP, 0.25, na.rm=TRUE) * 365.24219,
    p75_AWP_per_prescription_year = quantile(AWP_per_DAYSUPP, 0.75, na.rm=TRUE) * 365.24219, 
    median_patient_cost = median(sum_patient_cost, na.rm=TRUE),
    p25_patient_cost = quantile(sum_patient_cost, 0.25, na.rm=TRUE),
    p75_patient_cost = quantile(sum_patient_cost, 0.75, na.rm=TRUE), 
    median_patient_cost_per_prescription_year = median(patient_cost_per_DAYSUPP, na.rm=TRUE) * 365.24219,
    p25_patient_cost_per_prescription_year = quantile(patient_cost_per_DAYSUPP, 0.25, na.rm=TRUE) * 365.24219,
    p75_patient_cost_per_prescription_year = quantile(patient_cost_per_DAYSUPP, 0.75, na.rm=TRUE) * 365.24219
  ) %>% 
  collect()
ASM_cost_total_per_year_adult 




ASM_cost_AWP_per_year_adult_plot <- ggplot(data=ASM_cost_total_per_year_adult) + 
  geom_line(aes(x=`year(SVCDATE)`, y=median_AWP_per_prescription_year), color="purple2", lwd=1.5) + 
  geom_line(aes(x=`year(SVCDATE)`, y=p25_AWP_per_prescription_year), color="darkblue", lwd=1.5) + 
  geom_line(aes(x=`year(SVCDATE)`, y=p75_AWP_per_prescription_year), color="darkblue", lwd=1.5) + 
  theme(legend.position="none", panel.background=element_blank(), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), axis.ticks=element_blank(),
        axis.text=element_text(size=14, face="bold"), axis.text.x=element_text(angle=45, hjust=1),
        axis.title=element_text(size=20, face="bold")) +
  scale_x_continuous(name="Year", breaks=2006:2021) +
  scale_y_continuous(name="Median (p25-p75) cost ($)", breaks=seq(0, 10000, 1000), limits = c(0, 10001))
ASM_cost_AWP_per_year_adult_plot




ASM_cost_patient_cost_per_year_adult_plot <- ggplot(data=ASM_cost_total_per_year_adult) + 
  geom_line(aes(x=`year(SVCDATE)`, y=median_patient_cost_per_prescription_year), color="purple2", lwd=1.5) + 
  geom_line(aes(x=`year(SVCDATE)`, y=p25_patient_cost_per_prescription_year), color="darkblue", lwd=1.5) + 
  geom_line(aes(x=`year(SVCDATE)`, y=p75_patient_cost_per_prescription_year), color="darkblue", lwd=1.5) + 
  theme(legend.position="none", panel.background=element_blank(), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), axis.ticks=element_blank(),
        axis.text=element_text(size=14, face="bold"), axis.text.x=element_text(angle=45, hjust=1),
        axis.title=element_text(size=20, face="bold")) +
  scale_x_continuous(name="Year", breaks=2006:2021) +
  scale_y_continuous(name="Median (p25-p75) cost ($)", breaks=seq(0, 600, 100), limits = c(0, 601))
ASM_cost_patient_cost_per_year_adult_plot
```




Cost of antiseizure medication per prescription year by generic binary
```{r}
####################Pediatric and adult######################
# Total annual cost of antiseizure medication by generic binary
ASM_cost_by_generic_binary <- inflation_adjusted_ASM_epilepsy %>% 
  group_by(ENROLID, generic_binary) %>%
  mutate(
  sum_AWP = sum(AWP), 
  sum_DAYSUPP = sum(DAYSUPP), 
  AWP_per_DAYSUPP = sum_AWP / sum_DAYSUPP,
  sum_patient_cost = sum(sum(COINS), sum(COPAY), sum(DEDUCT), sum(DISPFEE)),
  patient_cost_per_DAYSUPP = sum_patient_cost / sum_DAYSUPP
  ) %>% 
  distinct(ENROLID, generic_binary, .keep_all=TRUE) %>% 
  ungroup() %>% 
  group_by(generic_binary) %>% 
  summarize(
    median_AWP = median(sum_AWP, na.rm=TRUE),
    p25_AWP = quantile(sum_AWP, 0.25, na.rm=TRUE),
    p75_AWP = quantile(sum_AWP, 0.75, na.rm=TRUE),    
    median_DAYSUPP = median(sum_DAYSUPP, na.rm=TRUE),
    p25_DAYSUPP = quantile(sum_DAYSUPP, 0.25, na.rm=TRUE),
    p75_DAYSUPP = quantile(sum_DAYSUPP, 0.75, na.rm=TRUE),   
    median_AWP_per_prescription_year = median(AWP_per_DAYSUPP, na.rm=TRUE) * 365.24219,
    p25_AWP_per_prescription_year = quantile(AWP_per_DAYSUPP, 0.25, na.rm=TRUE) * 365.24219,
    p75_AWP_per_prescription_year = quantile(AWP_per_DAYSUPP, 0.75, na.rm=TRUE) * 365.24219, 
    median_patient_cost = median(sum_patient_cost, na.rm=TRUE),
    p25_patient_cost = quantile(sum_patient_cost, 0.25, na.rm=TRUE),
    p75_patient_cost = quantile(sum_patient_cost, 0.75, na.rm=TRUE), 
    median_patient_cost_per_prescription_year = median(patient_cost_per_DAYSUPP, na.rm=TRUE) * 365.24219,
    p25_patient_cost_per_prescription_year = quantile(patient_cost_per_DAYSUPP, 0.25, na.rm=TRUE) * 365.24219,
    p75_patient_cost_per_prescription_year = quantile(patient_cost_per_DAYSUPP, 0.75, na.rm=TRUE) * 365.24219
  ) %>% 
  collect()
ASM_cost_by_generic_binary




# Total annual cost of antiseizure medication per year by generic binary
ASM_cost_by_generic_binary_per_year <- inflation_adjusted_ASM_epilepsy %>% 
  group_by(year(SVCDATE), ENROLID, generic_binary) %>% 
  mutate(
  sum_AWP = sum(AWP), 
  sum_DAYSUPP = sum(DAYSUPP), 
  AWP_per_DAYSUPP = sum_AWP / sum_DAYSUPP,
  sum_patient_cost = sum(sum(COINS), sum(COPAY), sum(DEDUCT), sum(DISPFEE)),
  patient_cost_per_DAYSUPP = sum_patient_cost / sum_DAYSUPP    
  ) %>% 
  distinct(`year(SVCDATE)`, ENROLID, generic_binary, .keep_all=TRUE) %>%  
  ungroup() %>% 
  group_by(`year(SVCDATE)`, generic_binary) %>% 
  summarize(
    median_AWP = median(sum_AWP, na.rm=TRUE),
    p25_AWP = quantile(sum_AWP, 0.25, na.rm=TRUE),
    p75_AWP = quantile(sum_AWP, 0.75, na.rm=TRUE),    
    median_DAYSUPP = median(sum_DAYSUPP, na.rm=TRUE),
    p25_DAYSUPP = quantile(sum_DAYSUPP, 0.25, na.rm=TRUE),
    p75_DAYSUPP = quantile(sum_DAYSUPP, 0.75, na.rm=TRUE),   
    median_AWP_per_prescription_year = median(AWP_per_DAYSUPP, na.rm=TRUE) * 365.24219,
    p25_AWP_per_prescription_year = quantile(AWP_per_DAYSUPP, 0.25, na.rm=TRUE) * 365.24219,
    p75_AWP_per_prescription_year = quantile(AWP_per_DAYSUPP, 0.75, na.rm=TRUE) * 365.24219, 
    median_patient_cost = median(sum_patient_cost, na.rm=TRUE),
    p25_patient_cost = quantile(sum_patient_cost, 0.25, na.rm=TRUE),
    p75_patient_cost = quantile(sum_patient_cost, 0.75, na.rm=TRUE), 
    median_patient_cost_per_prescription_year = median(patient_cost_per_DAYSUPP, na.rm=TRUE) * 365.24219,
    p25_patient_cost_per_prescription_year = quantile(patient_cost_per_DAYSUPP, 0.25, na.rm=TRUE) * 365.24219,
    p75_patient_cost_per_prescription_year = quantile(patient_cost_per_DAYSUPP, 0.75, na.rm=TRUE) * 365.24219
  ) %>% 
  collect()
ASM_cost_by_generic_binary_per_year




ASM_cost_by_generic_binary_per_year_for_plot <- ASM_cost_by_generic_binary_per_year %>% 
  filter(generic_binary=="generic" | generic_binary=="brand name") %>% 
  collect()




ASM_cost_AWP_by_generic_binary_per_year_plot <- ggplot(data=ASM_cost_by_generic_binary_per_year_for_plot) + 
  geom_line(aes(x=`year(SVCDATE)`, y=median_AWP_per_prescription_year, color=generic_binary), lwd=1.5) + 
  geom_line(aes(x=`year(SVCDATE)`, y=p25_AWP_per_prescription_year, color=generic_binary), lwd=1, lty=2, alpha=0.5) + 
  geom_line(aes(x=`year(SVCDATE)`, y=p75_AWP_per_prescription_year, color=generic_binary), lwd=1, lty=2, alpha=0.5) + 
  scale_color_manual(values = c("generic" = "forestgreen",
                                "brand name"="red")) +
  theme(legend.position="none", panel.background=element_blank(), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), axis.ticks=element_blank(),
        axis.text=element_text(size=14, face="bold"), axis.text.x=element_text(angle=45, hjust=1),
        axis.title=element_text(size=20, face="bold")) +
  scale_x_continuous(name="Year", breaks=2006:2021) +
  scale_y_continuous(name="Median (p25-p75) cost ($)", breaks=seq(0, 35000, 5000), limits = c(0, 35001))
ASM_cost_AWP_by_generic_binary_per_year_plot 




ASM_cost_patient_cost_by_generic_binary_per_year_plot <- ggplot(data=ASM_cost_by_generic_binary_per_year_for_plot) + 
  geom_line(aes(x=`year(SVCDATE)`, y=median_patient_cost_per_prescription_year, color=generic_binary), lwd=1.5) + 
  geom_line(aes(x=`year(SVCDATE)`, y=p25_patient_cost_per_prescription_year, color=generic_binary), lwd=1, lty=2, alpha=0.5) + 
  geom_line(aes(x=`year(SVCDATE)`, y=p75_patient_cost_per_prescription_year, color=generic_binary), lwd=1, lty=2, alpha=0.5) + 
  scale_color_manual(values = c("generic" = "forestgreen",
                                "brand name"="red")) +
  theme(legend.position="none", panel.background=element_blank(), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), axis.ticks=element_blank(),
        axis.text=element_text(size=14, face="bold"), axis.text.x=element_text(angle=45, hjust=1),
        axis.title=element_text(size=20, face="bold")) +
  scale_x_continuous(name="Year", breaks=2006:2021) +
  scale_y_continuous(name="Median (p25-p75) cost ($)", breaks=seq(0, 1600, 200), limits = c(0, 1601))
ASM_cost_patient_cost_by_generic_binary_per_year_plot 








####################Pediatric######################
# Total annual cost of antiseizure medication by generic binary in pediatric onset epilepsy
ASM_cost_by_generic_binary_pediatric <- inflation_adjusted_ASM_epilepsy %>% 
  filter(pediatric_or_adult=="pediatric") %>%
  group_by(ENROLID, generic_binary) %>%
  mutate(
  sum_AWP = sum(AWP), 
  sum_DAYSUPP = sum(DAYSUPP), 
  AWP_per_DAYSUPP = sum_AWP / sum_DAYSUPP,
  sum_patient_cost = sum(sum(COINS), sum(COPAY), sum(DEDUCT), sum(DISPFEE)),
  patient_cost_per_DAYSUPP = sum_patient_cost / sum_DAYSUPP
  ) %>% 
  distinct(ENROLID, generic_binary, .keep_all=TRUE) %>% 
  ungroup() %>% 
  group_by(generic_binary) %>% 
  summarize(
    median_AWP = median(sum_AWP, na.rm=TRUE),
    p25_AWP = quantile(sum_AWP, 0.25, na.rm=TRUE),
    p75_AWP = quantile(sum_AWP, 0.75, na.rm=TRUE),    
    median_DAYSUPP = median(sum_DAYSUPP, na.rm=TRUE),
    p25_DAYSUPP = quantile(sum_DAYSUPP, 0.25, na.rm=TRUE),
    p75_DAYSUPP = quantile(sum_DAYSUPP, 0.75, na.rm=TRUE),   
    median_AWP_per_prescription_year = median(AWP_per_DAYSUPP, na.rm=TRUE) * 365.24219,
    p25_AWP_per_prescription_year = quantile(AWP_per_DAYSUPP, 0.25, na.rm=TRUE) * 365.24219,
    p75_AWP_per_prescription_year = quantile(AWP_per_DAYSUPP, 0.75, na.rm=TRUE) * 365.24219, 
    median_patient_cost = median(sum_patient_cost, na.rm=TRUE),
    p25_patient_cost = quantile(sum_patient_cost, 0.25, na.rm=TRUE),
    p75_patient_cost = quantile(sum_patient_cost, 0.75, na.rm=TRUE), 
    median_patient_cost_per_prescription_year = median(patient_cost_per_DAYSUPP, na.rm=TRUE) * 365.24219,
    p25_patient_cost_per_prescription_year = quantile(patient_cost_per_DAYSUPP, 0.25, na.rm=TRUE) * 365.24219,
    p75_patient_cost_per_prescription_year = quantile(patient_cost_per_DAYSUPP, 0.75, na.rm=TRUE) * 365.24219
  ) %>% 
  collect()
ASM_cost_by_generic_binary_pediatric




# Total annual cost of antiseizure medication per year by generic binary in pediatric onset epilepsy
ASM_cost_by_generic_binary_per_year_pediatric <- inflation_adjusted_ASM_epilepsy %>% 
  filter(pediatric_or_adult=="pediatric") %>%
  group_by(year(SVCDATE), ENROLID, generic_binary) %>% 
  mutate(
  sum_AWP = sum(AWP), 
  sum_DAYSUPP = sum(DAYSUPP), 
  AWP_per_DAYSUPP = sum_AWP / sum_DAYSUPP,
  sum_patient_cost = sum(sum(COINS), sum(COPAY), sum(DEDUCT), sum(DISPFEE)),
  patient_cost_per_DAYSUPP = sum_patient_cost / sum_DAYSUPP    
  ) %>% 
  distinct(`year(SVCDATE)`, ENROLID, generic_binary, .keep_all=TRUE) %>%  
  ungroup() %>% 
  group_by(`year(SVCDATE)`, generic_binary) %>% 
  summarize(
    median_AWP = median(sum_AWP, na.rm=TRUE),
    p25_AWP = quantile(sum_AWP, 0.25, na.rm=TRUE),
    p75_AWP = quantile(sum_AWP, 0.75, na.rm=TRUE),    
    median_DAYSUPP = median(sum_DAYSUPP, na.rm=TRUE),
    p25_DAYSUPP = quantile(sum_DAYSUPP, 0.25, na.rm=TRUE),
    p75_DAYSUPP = quantile(sum_DAYSUPP, 0.75, na.rm=TRUE),   
    median_AWP_per_prescription_year = median(AWP_per_DAYSUPP, na.rm=TRUE) * 365.24219,
    p25_AWP_per_prescription_year = quantile(AWP_per_DAYSUPP, 0.25, na.rm=TRUE) * 365.24219,
    p75_AWP_per_prescription_year = quantile(AWP_per_DAYSUPP, 0.75, na.rm=TRUE) * 365.24219, 
    median_patient_cost = median(sum_patient_cost, na.rm=TRUE),
    p25_patient_cost = quantile(sum_patient_cost, 0.25, na.rm=TRUE),
    p75_patient_cost = quantile(sum_patient_cost, 0.75, na.rm=TRUE), 
    median_patient_cost_per_prescription_year = median(patient_cost_per_DAYSUPP, na.rm=TRUE) * 365.24219,
    p25_patient_cost_per_prescription_year = quantile(patient_cost_per_DAYSUPP, 0.25, na.rm=TRUE) * 365.24219,
    p75_patient_cost_per_prescription_year = quantile(patient_cost_per_DAYSUPP, 0.75, na.rm=TRUE) * 365.24219
  ) %>% 
  collect()
ASM_cost_by_generic_binary_per_year_pediatric




ASM_cost_by_generic_binary_per_year_pediatric_for_plot <- ASM_cost_by_generic_binary_per_year_pediatric %>% 
  filter(generic_binary=="generic" | generic_binary=="brand name") %>% 
  collect()




ASM_cost_AWP_by_generic_binary_per_year_pediatric_plot <- ggplot(data=ASM_cost_by_generic_binary_per_year_pediatric_for_plot) + 
  geom_line(aes(x=`year(SVCDATE)`, y=median_AWP_per_prescription_year, color=generic_binary), lwd=1.5) + 
  geom_line(aes(x=`year(SVCDATE)`, y=p25_AWP_per_prescription_year, color=generic_binary), lwd=1, lty=2, alpha=0.5) + 
  geom_line(aes(x=`year(SVCDATE)`, y=p75_AWP_per_prescription_year, color=generic_binary), lwd=1, lty=2, alpha=0.5) + 
  scale_color_manual(values = c("generic" = "forestgreen",
                                "brand name"="red")) +
  theme(legend.position="none", panel.background=element_blank(), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), axis.ticks=element_blank(),
        axis.text=element_text(size=14, face="bold"), axis.text.x=element_text(angle=45, hjust=1),
        axis.title=element_text(size=20, face="bold")) +
  scale_x_continuous(name="Year", breaks=2006:2021) +
  scale_y_continuous(name="Median (p25-p75) cost ($)", breaks=seq(0, 35000, 5000), limits = c(0, 35001))
ASM_cost_AWP_by_generic_binary_per_year_pediatric_plot 




ASM_cost_patient_cost_by_generic_binary_per_year_pediatric_plot <- ggplot(data=ASM_cost_by_generic_binary_per_year_pediatric_for_plot) + 
  geom_line(aes(x=`year(SVCDATE)`, y=median_patient_cost_per_prescription_year, color=generic_binary), lwd=1.5) + 
  geom_line(aes(x=`year(SVCDATE)`, y=p25_patient_cost_per_prescription_year, color=generic_binary), lwd=1, lty=2, alpha=0.5) + 
  geom_line(aes(x=`year(SVCDATE)`, y=p75_patient_cost_per_prescription_year, color=generic_binary), lwd=1, lty=2, alpha=0.5) + 
  scale_color_manual(values = c("generic" = "forestgreen",
                                "brand name"="red")) +
  theme(legend.position="none", panel.background=element_blank(), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), axis.ticks=element_blank(),
        axis.text=element_text(size=14, face="bold"), axis.text.x=element_text(angle=45, hjust=1),
        axis.title=element_text(size=20, face="bold")) +
  scale_x_continuous(name="Year", breaks=2006:2021) +
  scale_y_continuous(name="Median (p25-p75) cost ($)", breaks=seq(0, 1600, 200), limits = c(0, 1601))
ASM_cost_patient_cost_by_generic_binary_per_year_pediatric_plot 
 





####################Adult######################
# Total annual cost of antiseizure medication by generic binary in adult onset epilepsy
ASM_cost_by_generic_binary_adult <- inflation_adjusted_ASM_epilepsy %>% 
  filter(pediatric_or_adult=="adult") %>%
  group_by(ENROLID, generic_binary) %>%
  mutate(
  sum_AWP = sum(AWP), 
  sum_DAYSUPP = sum(DAYSUPP), 
  AWP_per_DAYSUPP = sum_AWP / sum_DAYSUPP,
  sum_patient_cost = sum(sum(COINS), sum(COPAY), sum(DEDUCT), sum(DISPFEE)),
  patient_cost_per_DAYSUPP = sum_patient_cost / sum_DAYSUPP
  ) %>% 
  distinct(ENROLID, generic_binary, .keep_all=TRUE) %>% 
  ungroup() %>% 
  group_by(generic_binary) %>% 
  summarize(
    median_AWP = median(sum_AWP, na.rm=TRUE),
    p25_AWP = quantile(sum_AWP, 0.25, na.rm=TRUE),
    p75_AWP = quantile(sum_AWP, 0.75, na.rm=TRUE),    
    median_DAYSUPP = median(sum_DAYSUPP, na.rm=TRUE),
    p25_DAYSUPP = quantile(sum_DAYSUPP, 0.25, na.rm=TRUE),
    p75_DAYSUPP = quantile(sum_DAYSUPP, 0.75, na.rm=TRUE),   
    median_AWP_per_prescription_year = median(AWP_per_DAYSUPP, na.rm=TRUE) * 365.24219,
    p25_AWP_per_prescription_year = quantile(AWP_per_DAYSUPP, 0.25, na.rm=TRUE) * 365.24219,
    p75_AWP_per_prescription_year = quantile(AWP_per_DAYSUPP, 0.75, na.rm=TRUE) * 365.24219, 
    median_patient_cost = median(sum_patient_cost, na.rm=TRUE),
    p25_patient_cost = quantile(sum_patient_cost, 0.25, na.rm=TRUE),
    p75_patient_cost = quantile(sum_patient_cost, 0.75, na.rm=TRUE), 
    median_patient_cost_per_prescription_year = median(patient_cost_per_DAYSUPP, na.rm=TRUE) * 365.24219,
    p25_patient_cost_per_prescription_year = quantile(patient_cost_per_DAYSUPP, 0.25, na.rm=TRUE) * 365.24219,
    p75_patient_cost_per_prescription_year = quantile(patient_cost_per_DAYSUPP, 0.75, na.rm=TRUE) * 365.24219
  ) %>% 
  collect()
ASM_cost_by_generic_binary_adult




# Total annual cost of antiseizure medication per year by generic binary in adult onset epilepsy
ASM_cost_by_generic_binary_per_year_adult <- inflation_adjusted_ASM_epilepsy %>% 
  filter(pediatric_or_adult=="adult") %>%
  group_by(year(SVCDATE), ENROLID, generic_binary) %>% 
  mutate(
  sum_AWP = sum(AWP), 
  sum_DAYSUPP = sum(DAYSUPP), 
  AWP_per_DAYSUPP = sum_AWP / sum_DAYSUPP,
  sum_patient_cost = sum(sum(COINS), sum(COPAY), sum(DEDUCT), sum(DISPFEE)),
  patient_cost_per_DAYSUPP = sum_patient_cost / sum_DAYSUPP    
  ) %>% 
  distinct(`year(SVCDATE)`, ENROLID, generic_binary, .keep_all=TRUE) %>%  
  ungroup() %>% 
  group_by(`year(SVCDATE)`, generic_binary) %>% 
  summarize(
    median_AWP = median(sum_AWP, na.rm=TRUE),
    p25_AWP = quantile(sum_AWP, 0.25, na.rm=TRUE),
    p75_AWP = quantile(sum_AWP, 0.75, na.rm=TRUE),    
    median_DAYSUPP = median(sum_DAYSUPP, na.rm=TRUE),
    p25_DAYSUPP = quantile(sum_DAYSUPP, 0.25, na.rm=TRUE),
    p75_DAYSUPP = quantile(sum_DAYSUPP, 0.75, na.rm=TRUE),   
    median_AWP_per_prescription_year = median(AWP_per_DAYSUPP, na.rm=TRUE) * 365.24219,
    p25_AWP_per_prescription_year = quantile(AWP_per_DAYSUPP, 0.25, na.rm=TRUE) * 365.24219,
    p75_AWP_per_prescription_year = quantile(AWP_per_DAYSUPP, 0.75, na.rm=TRUE) * 365.24219, 
    median_patient_cost = median(sum_patient_cost, na.rm=TRUE),
    p25_patient_cost = quantile(sum_patient_cost, 0.25, na.rm=TRUE),
    p75_patient_cost = quantile(sum_patient_cost, 0.75, na.rm=TRUE), 
    median_patient_cost_per_prescription_year = median(patient_cost_per_DAYSUPP, na.rm=TRUE) * 365.24219,
    p25_patient_cost_per_prescription_year = quantile(patient_cost_per_DAYSUPP, 0.25, na.rm=TRUE) * 365.24219,
    p75_patient_cost_per_prescription_year = quantile(patient_cost_per_DAYSUPP, 0.75, na.rm=TRUE) * 365.24219
  ) %>% 
  collect()
ASM_cost_by_generic_binary_per_year_adult




ASM_cost_by_generic_binary_per_year_adult_for_plot <- ASM_cost_by_generic_binary_per_year_adult %>% 
  filter(generic_binary=="generic" | generic_binary=="brand name") %>% 
  collect()




ASM_cost_AWP_by_generic_binary_per_year_adult_plot <- ggplot(data=ASM_cost_by_generic_binary_per_year_adult_for_plot) + 
  geom_line(aes(x=`year(SVCDATE)`, y=median_AWP_per_prescription_year, color=generic_binary), lwd=1.5) + 
  geom_line(aes(x=`year(SVCDATE)`, y=p25_AWP_per_prescription_year, color=generic_binary), lwd=1, lty=2, alpha=0.5) + 
  geom_line(aes(x=`year(SVCDATE)`, y=p75_AWP_per_prescription_year, color=generic_binary), lwd=1, lty=2, alpha=0.5) + 
  scale_color_manual(values = c("generic" = "forestgreen",
                                "brand name"="red")) +
  theme(legend.position="none", panel.background=element_blank(), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), axis.ticks=element_blank(),
        axis.text=element_text(size=14, face="bold"), axis.text.x=element_text(angle=45, hjust=1),
        axis.title=element_text(size=20, face="bold")) +
  scale_x_continuous(name="Year", breaks=2006:2021) +
  scale_y_continuous(name="Median (p25-p75) cost ($)", breaks=seq(0, 35000, 5000), limits = c(0, 35001))
ASM_cost_AWP_by_generic_binary_per_year_adult_plot 




ASM_cost_patient_cost_by_generic_binary_per_year_adult_plot <- ggplot(data=ASM_cost_by_generic_binary_per_year_adult_for_plot) + 
  geom_line(aes(x=`year(SVCDATE)`, y=median_patient_cost_per_prescription_year, color=generic_binary), lwd=1.5) + 
  geom_line(aes(x=`year(SVCDATE)`, y=p25_patient_cost_per_prescription_year, color=generic_binary), lwd=1, lty=2, alpha=0.5) + 
  geom_line(aes(x=`year(SVCDATE)`, y=p75_patient_cost_per_prescription_year, color=generic_binary), lwd=1, lty=2, alpha=0.5) + 
  scale_color_manual(values = c("generic" = "forestgreen",
                                "brand name"="red")) +
  theme(legend.position="none", panel.background=element_blank(), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.border=element_blank(), axis.ticks=element_blank(),
        axis.text=element_text(size=14, face="bold"), axis.text.x=element_text(angle=45, hjust=1),
        axis.title=element_text(size=20, face="bold")) +
  scale_x_continuous(name="Year", breaks=2006:2021) +
  scale_y_continuous(name="Median (p25-p75) cost ($)", breaks=seq(0, 1600, 200), limits = c(0, 1601))
ASM_cost_patient_cost_by_generic_binary_per_year_adult_plot 
```




Create databases with information on days covered
```{r}
# Create database with information on days covered
data_days_covered <- inflation_adjusted_ASM_epilepsy %>% 
  group_by(ENROLID, ASM, generic_binary) %>% 
  arrange(SVCDATE, .by_group=TRUE) %>% 
  mutate(days_to_be_covered = as.numeric(dplyr::lead(SVCDATE, 1) - SVCDATE)) %>% 
  mutate(days_to_be_covered = case_when(
    is.na(days_to_be_covered) ~ DAYSUPP,
    TRUE ~ days_to_be_covered
  )) %>% 
  ungroup() %>% 
  rowwise() %>% 
  mutate(days_covered = min(days_to_be_covered, DAYSUPP)) %>%
  collect()
data_days_covered




data_days_covered_per_year <- inflation_adjusted_ASM_epilepsy %>% 
  group_by(year(SVCDATE), ENROLID, ASM, generic_binary) %>% 
  arrange(SVCDATE, .by_group=TRUE) %>% 
  mutate(days_to_be_covered = as.numeric(dplyr::lead(SVCDATE, 1) - SVCDATE)) %>% 
  mutate(days_to_be_covered = case_when(
    is.na(days_to_be_covered) ~ DAYSUPP,
    TRUE ~ days_to_be_covered
  )) %>% 
  ungroup() %>% 
  rowwise() %>% 
  mutate(days_covered = min(days_to_be_covered, DAYSUPP)) %>%
  collect()  
data_days_covered_per_year
```




Proportion of days covered
```{r}
####################Pediatric and adult######################
# Proportion of days covered
proportion_days_covered <- data_days_covered %>% 
  group_by(ENROLID, ASM, generic_binary) %>% 
  mutate(PDC = sum(days_covered) / sum(days_to_be_covered)) %>% 
  ungroup() %>% 
  distinct(ENROLID, ASM, generic_binary, .keep_all=TRUE) %>% 
  summarize(
    median_PDC = median(PDC, na.rm=TRUE),
    p25_PDF = quantile(PDC, 0.25, na.rm=TRUE),
    p75_PDF = quantile(PDC, 0.75, na.rm=TRUE)
  ) %>% 
  collect()
proportion_days_covered  




# Proportion of days covered by generic binary
proportion_days_covered_by_generic_binary <- data_days_covered %>% 
  group_by(ENROLID, ASM, generic_binary) %>% 
  mutate(PDC = sum(days_covered) / sum(days_to_be_covered)) %>% 
  ungroup() %>% 
  distinct(ENROLID, ASM, generic_binary, .keep_all=TRUE) %>%
  group_by(generic_binary) %>% 
  summarize(
    median_PDC = median(PDC, na.rm=TRUE),
    p25_PDF = quantile(PDC, 0.25, na.rm=TRUE),
    p75_PDF = quantile(PDC, 0.75, na.rm=TRUE)
  ) %>% 
  collect()
proportion_days_covered_by_generic_binary 
  



# Proportion of days covered per year
proportion_days_covered_per_year <- data_days_covered_per_year %>% 
  group_by(`year(SVCDATE)`, ENROLID, ASM) %>% 
  mutate(PDC = sum(days_covered) / sum(days_to_be_covered)) %>% 
  ungroup() %>% 
  distinct(`year(SVCDATE)`, ENROLID, ASM, .keep_all=TRUE) %>% 
  group_by(`year(SVCDATE)`) %>% 
  summarize(
    median_PDC = median(PDC, na.rm=TRUE),
    p25_PDF = quantile(PDC, 0.25, na.rm=TRUE),
    p75_PDF = quantile(PDC, 0.75, na.rm=TRUE)
  ) %>% 
  collect()
proportion_days_covered_per_year




# Proportion of days covered per year by generic binary
proportion_days_covered_per_year_by_generic_binary <- data_days_covered_per_year %>% 
  group_by(`year(SVCDATE)`, ENROLID, ASM, generic_binary) %>% 
  mutate(PDC = sum(days_covered) / sum(days_to_be_covered)) %>% 
  ungroup() %>% 
  distinct(`year(SVCDATE)`, ENROLID, ASM, generic_binary, .keep_all=TRUE) %>% 
  group_by(`year(SVCDATE)`, generic_binary) %>% 
  summarize(
    median_PDC = median(PDC, na.rm=TRUE),
    p25_PDF = quantile(PDC, 0.25, na.rm=TRUE),
    p75_PDF = quantile(PDC, 0.75, na.rm=TRUE)
  ) %>% 
  collect()
proportion_days_covered_per_year_by_generic_binary






####################Pediatric######################
# Proportion of days covered in pediatric onset epilepsy
proportion_days_covered_pediatric <- data_days_covered %>% 
  filter(pediatric_or_adult=="pediatric") %>%
  group_by(ENROLID, ASM, generic_binary) %>% 
  mutate(PDC = sum(days_covered) / sum(days_to_be_covered)) %>% 
  ungroup() %>% 
  distinct(ENROLID, ASM, generic_binary, .keep_all=TRUE) %>% 
  summarize(
    median_PDC = median(PDC, na.rm=TRUE),
    p25_PDF = quantile(PDC, 0.25, na.rm=TRUE),
    p75_PDF = quantile(PDC, 0.75, na.rm=TRUE)
  ) %>% 
  collect()
proportion_days_covered_pediatric




# Proportion of days covered by generic binary in pediatric onset epilepsy
proportion_days_covered_by_generic_binary_pediatric <- data_days_covered %>% 
  filter(pediatric_or_adult=="pediatric") %>%
  group_by(ENROLID, ASM, generic_binary) %>% 
  mutate(PDC = sum(days_covered) / sum(days_to_be_covered)) %>% 
  ungroup() %>% 
  distinct(ENROLID, ASM, generic_binary, .keep_all=TRUE) %>%
  group_by(generic_binary) %>% 
  summarize(
    median_PDC = median(PDC, na.rm=TRUE),
    p25_PDF = quantile(PDC, 0.25, na.rm=TRUE),
    p75_PDF = quantile(PDC, 0.75, na.rm=TRUE)
  ) %>% 
  collect()
proportion_days_covered_by_generic_binary_pediatric
  



# Proportion of days covered per year in pediatric onset epilepsy
proportion_days_covered_per_year_pediatric <- data_days_covered_per_year %>% 
  filter(pediatric_or_adult=="pediatric") %>%
  group_by(`year(SVCDATE)`, ENROLID, ASM) %>% 
  mutate(PDC = sum(days_covered) / sum(days_to_be_covered)) %>% 
  ungroup() %>% 
  distinct(`year(SVCDATE)`, ENROLID, ASM, .keep_all=TRUE) %>% 
  group_by(`year(SVCDATE)`) %>% 
  summarize(
    median_PDC = median(PDC, na.rm=TRUE),
    p25_PDF = quantile(PDC, 0.25, na.rm=TRUE),
    p75_PDF = quantile(PDC, 0.75, na.rm=TRUE)
  ) %>% 
  collect()
proportion_days_covered_per_year_pediatric




# Proportion of days covered per year by generic binary in pediatric onset epilepsy
proportion_days_covered_per_year_by_generic_binary_pediatric <- data_days_covered_per_year %>% 
  filter(pediatric_or_adult=="pediatric") %>%
  group_by(`year(SVCDATE)`, ENROLID, ASM, generic_binary) %>% 
  mutate(PDC = sum(days_covered) / sum(days_to_be_covered)) %>% 
  ungroup() %>% 
  distinct(`year(SVCDATE)`, ENROLID, ASM, generic_binary, .keep_all=TRUE) %>% 
  group_by(`year(SVCDATE)`, generic_binary) %>% 
  summarize(
    median_PDC = median(PDC, na.rm=TRUE),
    p25_PDF = quantile(PDC, 0.25, na.rm=TRUE),
    p75_PDF = quantile(PDC, 0.75, na.rm=TRUE)
  ) %>% 
  collect()
proportion_days_covered_per_year_by_generic_binary_pediatric






####################Adult######################
# Proportion of days covered in adult onset epilepsy
proportion_days_covered_adult <- data_days_covered %>% 
  filter(pediatric_or_adult=="adult") %>%
  group_by(ENROLID, ASM, generic_binary) %>% 
  mutate(PDC = sum(days_covered) / sum(days_to_be_covered)) %>% 
  ungroup() %>% 
  distinct(ENROLID, ASM, generic_binary, .keep_all=TRUE) %>% 
  summarize(
    median_PDC = median(PDC, na.rm=TRUE),
    p25_PDF = quantile(PDC, 0.25, na.rm=TRUE),
    p75_PDF = quantile(PDC, 0.75, na.rm=TRUE)
  ) %>% 
  collect()
proportion_days_covered_adult




# Proportion of days covered by generic binary in adult onset epilepsy
proportion_days_covered_by_generic_binary_adult <- data_days_covered %>% 
  filter(pediatric_or_adult=="adult") %>%
  group_by(ENROLID, ASM, generic_binary) %>% 
  mutate(PDC = sum(days_covered) / sum(days_to_be_covered)) %>% 
  ungroup() %>% 
  distinct(ENROLID, ASM, generic_binary, .keep_all=TRUE) %>%
  group_by(generic_binary) %>% 
  summarize(
    median_PDC = median(PDC, na.rm=TRUE),
    p25_PDF = quantile(PDC, 0.25, na.rm=TRUE),
    p75_PDF = quantile(PDC, 0.75, na.rm=TRUE)
  ) %>% 
  collect()
proportion_days_covered_by_generic_binary_adult
  



# Proportion of days covered per year in adult onset epilepsy
proportion_days_covered_per_year_adult <- data_days_covered_per_year %>% 
  filter(pediatric_or_adult=="adult") %>%
  group_by(`year(SVCDATE)`, ENROLID, ASM) %>% 
  mutate(PDC = sum(days_covered) / sum(days_to_be_covered)) %>% 
  ungroup() %>% 
  distinct(`year(SVCDATE)`, ENROLID, ASM, .keep_all=TRUE) %>% 
  group_by(`year(SVCDATE)`) %>% 
  summarize(
    median_PDC = median(PDC, na.rm=TRUE),
    p25_PDF = quantile(PDC, 0.25, na.rm=TRUE),
    p75_PDF = quantile(PDC, 0.75, na.rm=TRUE)
  ) %>% 
  collect()
proportion_days_covered_per_year_adult




# Proportion of days covered per year by generic binary in adult onset epilepsy
proportion_days_covered_per_year_by_generic_binary_adult <- data_days_covered_per_year %>% 
  filter(pediatric_or_adult=="adult") %>%
  group_by(`year(SVCDATE)`, ENROLID, ASM, generic_binary) %>% 
  mutate(PDC = sum(days_covered) / sum(days_to_be_covered)) %>% 
  ungroup() %>% 
  distinct(`year(SVCDATE)`, ENROLID, ASM, generic_binary, .keep_all=TRUE) %>% 
  group_by(`year(SVCDATE)`, generic_binary) %>% 
  summarize(
    median_PDC = median(PDC, na.rm=TRUE),
    p25_PDF = quantile(PDC, 0.25, na.rm=TRUE),
    p75_PDF = quantile(PDC, 0.75, na.rm=TRUE)
  ) %>% 
  collect()
proportion_days_covered_per_year_by_generic_binary_adult
```




Cost and proportion of days covered among the most expensive antiseizure medications
```{r}
####################Pediatric and adult######################
# Top 10 antiseizure medication AWP cost and their proportion of days covered
ASM_top_10_AWP_cost_PDC <- data_days_covered %>% 
  filter(generic_binary=="generic" | generic_binary=="brand name") %>% 
  group_by(ENROLID, ASM, generic_binary) %>%
  mutate(
  sum_AWP = sum(AWP), 
  sum_DAYSUPP = sum(DAYSUPP), 
  AWP_per_DAYSUPP = sum_AWP / sum_DAYSUPP,
  sum_patient_cost = sum(sum(COINS), sum(COPAY), sum(DEDUCT), sum(DISPFEE)),
  patient_cost_per_DAYSUPP = sum_patient_cost / sum_DAYSUPP,
  PDC = sum(days_covered) / sum(days_to_be_covered) 
  ) %>% 
  distinct(ENROLID, ASM, generic_binary, .keep_all=TRUE) %>% 
  ungroup() %>% 
  group_by(ASM, generic_binary) %>% 
  summarize(
    median_AWP = median(sum_AWP, na.rm=TRUE),
    p25_AWP = quantile(sum_AWP, 0.25, na.rm=TRUE),
    p75_AWP = quantile(sum_AWP, 0.75, na.rm=TRUE),    
    median_DAYSUPP = median(sum_DAYSUPP, na.rm=TRUE),
    p25_DAYSUPP = quantile(sum_DAYSUPP, 0.25, na.rm=TRUE),
    p75_DAYSUPP = quantile(sum_DAYSUPP, 0.75, na.rm=TRUE),   
    median_AWP_per_prescription_year = median(AWP_per_DAYSUPP, na.rm=TRUE) * 365.24219,
    p25_AWP_per_prescription_year = quantile(AWP_per_DAYSUPP, 0.25, na.rm=TRUE) * 365.24219,
    p75_AWP_per_prescription_year = quantile(AWP_per_DAYSUPP, 0.75, na.rm=TRUE) * 365.24219, 
    median_patient_cost = median(sum_patient_cost, na.rm=TRUE),
    p25_patient_cost = quantile(sum_patient_cost, 0.25, na.rm=TRUE),
    p75_patient_cost = quantile(sum_patient_cost, 0.75, na.rm=TRUE), 
    median_patient_cost_per_prescription_year = median(patient_cost_per_DAYSUPP, na.rm=TRUE) * 365.24219,
    p25_patient_cost_per_prescription_year = quantile(patient_cost_per_DAYSUPP, 0.25, na.rm=TRUE) * 365.24219,
    p75_patient_cost_per_prescription_year = quantile(patient_cost_per_DAYSUPP, 0.75, na.rm=TRUE) * 365.24219,
    median_PDC = median(PDC, na.rm=TRUE),
    p25_PDC = quantile(PDC, 0.25, na.rm=TRUE),
    p75_PDC = quantile(PDC, 0.75, na.rm=TRUE)
  ) %>% 
  arrange(desc(median_AWP_per_prescription_year)) %>% 
  top_n(10) %>% 
  collect()
ASM_top_10_AWP_cost_PDC




# Top 10 antiseizure medication patient cost and their proportion of days covered
ASM_top_10_patient_cost_PDC <- data_days_covered %>% 
  filter(generic_binary=="generic" | generic_binary=="brand name") %>% 
  group_by(ENROLID, ASM, generic_binary) %>%
  mutate(
  sum_AWP = sum(AWP), 
  sum_DAYSUPP = sum(DAYSUPP), 
  AWP_per_DAYSUPP = sum_AWP / sum_DAYSUPP,
  sum_patient_cost = sum(sum(COINS), sum(COPAY), sum(DEDUCT), sum(DISPFEE)),
  patient_cost_per_DAYSUPP = sum_patient_cost / sum_DAYSUPP,
  PDC = sum(days_covered) / sum(days_to_be_covered) 
  ) %>% 
  distinct(ENROLID, ASM, generic_binary, .keep_all=TRUE) %>% 
  ungroup() %>% 
  group_by(ASM, generic_binary) %>% 
  summarize(
    median_AWP = median(sum_AWP, na.rm=TRUE),
    p25_AWP = quantile(sum_AWP, 0.25, na.rm=TRUE),
    p75_AWP = quantile(sum_AWP, 0.75, na.rm=TRUE),    
    median_DAYSUPP = median(sum_DAYSUPP, na.rm=TRUE),
    p25_DAYSUPP = quantile(sum_DAYSUPP, 0.25, na.rm=TRUE),
    p75_DAYSUPP = quantile(sum_DAYSUPP, 0.75, na.rm=TRUE),   
    median_AWP_per_prescription_year = median(AWP_per_DAYSUPP, na.rm=TRUE) * 365.24219,
    p25_AWP_per_prescription_year = quantile(AWP_per_DAYSUPP, 0.25, na.rm=TRUE) * 365.24219,
    p75_AWP_per_prescription_year = quantile(AWP_per_DAYSUPP, 0.75, na.rm=TRUE) * 365.24219, 
    median_patient_cost = median(sum_patient_cost, na.rm=TRUE),
    p25_patient_cost = quantile(sum_patient_cost, 0.25, na.rm=TRUE),
    p75_patient_cost = quantile(sum_patient_cost, 0.75, na.rm=TRUE), 
    median_patient_cost_per_prescription_year = median(patient_cost_per_DAYSUPP, na.rm=TRUE) * 365.24219,
    p25_patient_cost_per_prescription_year = quantile(patient_cost_per_DAYSUPP, 0.25, na.rm=TRUE) * 365.24219,
    p75_patient_cost_per_prescription_year = quantile(patient_cost_per_DAYSUPP, 0.75, na.rm=TRUE) * 365.24219,
    median_PDC = median(PDC, na.rm=TRUE),
    p25_PDC = quantile(PDC, 0.25, na.rm=TRUE),
    p75_PDC = quantile(PDC, 0.75, na.rm=TRUE)
  ) %>% 
  arrange(desc(median_patient_cost_per_prescription_year)) %>% 
  top_n(10) %>% 
  collect()
ASM_top_10_patient_cost_PDC




# Top 10 antiseizure medication AWP cost per year and their proportion of days covered
ASM_top_10_AWP_cost_PDC_per_year <- data_days_covered %>% 
  filter(generic_binary=="generic" | generic_binary=="brand name") %>% 
  group_by(ENROLID, year(SVCDATE), ASM, generic_binary) %>%
  mutate(
  sum_AWP = sum(AWP), 
  sum_DAYSUPP = sum(DAYSUPP), 
  AWP_per_DAYSUPP = sum_AWP / sum_DAYSUPP,
  sum_patient_cost = sum(sum(COINS), sum(COPAY), sum(DEDUCT), sum(DISPFEE)),
  patient_cost_per_DAYSUPP = sum_patient_cost / sum_DAYSUPP,
  PDC = sum(days_covered) / sum(days_to_be_covered) 
  ) %>% 
  distinct(ENROLID, `year(SVCDATE)`, ASM, generic_binary, .keep_all=TRUE) %>% 
  ungroup() %>% 
  group_by(`year(SVCDATE)`, ASM, generic_binary) %>% 
  summarize(
    median_AWP = median(sum_AWP, na.rm=TRUE),
    p25_AWP = quantile(sum_AWP, 0.25, na.rm=TRUE),
    p75_AWP = quantile(sum_AWP, 0.75, na.rm=TRUE),    
    median_DAYSUPP = median(sum_DAYSUPP, na.rm=TRUE),
    p25_DAYSUPP = quantile(sum_DAYSUPP, 0.25, na.rm=TRUE),
    p75_DAYSUPP = quantile(sum_DAYSUPP, 0.75, na.rm=TRUE),   
    median_AWP_per_prescription_year = median(AWP_per_DAYSUPP, na.rm=TRUE) * 365.24219,
    p25_AWP_per_prescription_year = quantile(AWP_per_DAYSUPP, 0.25, na.rm=TRUE) * 365.24219,
    p75_AWP_per_prescription_year = quantile(AWP_per_DAYSUPP, 0.75, na.rm=TRUE) * 365.24219, 
    median_patient_cost = median(sum_patient_cost, na.rm=TRUE),
    p25_patient_cost = quantile(sum_patient_cost, 0.25, na.rm=TRUE),
    p75_patient_cost = quantile(sum_patient_cost, 0.75, na.rm=TRUE), 
    median_patient_cost_per_prescription_year = median(patient_cost_per_DAYSUPP, na.rm=TRUE) * 365.24219,
    p25_patient_cost_per_prescription_year = quantile(patient_cost_per_DAYSUPP, 0.25, na.rm=TRUE) * 365.24219,
    p75_patient_cost_per_prescription_year = quantile(patient_cost_per_DAYSUPP, 0.75, na.rm=TRUE) * 365.24219,
    median_PDC = median(PDC, na.rm=TRUE),
    p25_PDC = quantile(PDC, 0.25, na.rm=TRUE),
    p75_PDC = quantile(PDC, 0.75, na.rm=TRUE)
  ) %>% 
  ungroup() %>% 
  group_by(`year(SVCDATE)`) %>% 
  arrange(desc(median_AWP_per_prescription_year), .by_group=TRUE) %>% 
  top_n(10) %>% 
  collect()
ASM_top_10_AWP_cost_PDC_per_year




# Top 10 antiseizure medication patient cost per year and their proportion of days covered
ASM_top_10_patient_cost_PDC_per_year <- data_days_covered %>% 
  filter(generic_binary=="generic" | generic_binary=="brand name") %>% 
  group_by(ENROLID, year(SVCDATE), ASM, generic_binary) %>%
  mutate(
  sum_AWP = sum(AWP), 
  sum_DAYSUPP = sum(DAYSUPP), 
  AWP_per_DAYSUPP = sum_AWP / sum_DAYSUPP,
  sum_patient_cost = sum(sum(COINS), sum(COPAY), sum(DEDUCT), sum(DISPFEE)),
  patient_cost_per_DAYSUPP = sum_patient_cost / sum_DAYSUPP,
  PDC = sum(days_covered) / sum(days_to_be_covered) 
  ) %>% 
  distinct(ENROLID, `year(SVCDATE)`, ASM, generic_binary, .keep_all=TRUE) %>% 
  ungroup() %>% 
  group_by(`year(SVCDATE)`, ASM, generic_binary) %>% 
  summarize(
    median_AWP = median(sum_AWP, na.rm=TRUE),
    p25_AWP = quantile(sum_AWP, 0.25, na.rm=TRUE),
    p75_AWP = quantile(sum_AWP, 0.75, na.rm=TRUE),    
    median_DAYSUPP = median(sum_DAYSUPP, na.rm=TRUE),
    p25_DAYSUPP = quantile(sum_DAYSUPP, 0.25, na.rm=TRUE),
    p75_DAYSUPP = quantile(sum_DAYSUPP, 0.75, na.rm=TRUE),   
    median_AWP_per_prescription_year = median(AWP_per_DAYSUPP, na.rm=TRUE) * 365.24219,
    p25_AWP_per_prescription_year = quantile(AWP_per_DAYSUPP, 0.25, na.rm=TRUE) * 365.24219,
    p75_AWP_per_prescription_year = quantile(AWP_per_DAYSUPP, 0.75, na.rm=TRUE) * 365.24219, 
    median_patient_cost = median(sum_patient_cost, na.rm=TRUE),
    p25_patient_cost = quantile(sum_patient_cost, 0.25, na.rm=TRUE),
    p75_patient_cost = quantile(sum_patient_cost, 0.75, na.rm=TRUE), 
    median_patient_cost_per_prescription_year = median(patient_cost_per_DAYSUPP, na.rm=TRUE) * 365.24219,
    p25_patient_cost_per_prescription_year = quantile(patient_cost_per_DAYSUPP, 0.25, na.rm=TRUE) * 365.24219,
    p75_patient_cost_per_prescription_year = quantile(patient_cost_per_DAYSUPP, 0.75, na.rm=TRUE) * 365.24219,
    median_PDC = median(PDC, na.rm=TRUE),
    p25_PDC = quantile(PDC, 0.25, na.rm=TRUE),
    p75_PDC = quantile(PDC, 0.75, na.rm=TRUE)
  ) %>% 
  ungroup() %>% 
  group_by(`year(SVCDATE)`) %>% 
  arrange(desc(median_patient_cost_per_prescription_year), .by_group=TRUE) %>% 
  top_n(10) %>% 
  collect()
ASM_top_10_patient_cost_PDC_per_year
```








## 5. Disconnect from the database




Disconnect from the database
```{r}
# Disconnect
dbDisconnect(MarketScan)
```

